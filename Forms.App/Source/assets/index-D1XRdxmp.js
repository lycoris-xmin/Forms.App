import{_ as ne}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as L}from"./cny-BwVJSoTC.js";import{S as q,g as Y,_ as oe,a as se,b as re,T as ue,u as me,c as ie,d as de,e as pe,G as ce,H as fe,I as _e}from"./table-search-filter-oeJAv4cw.js";import{aP as ye,m as G,d as $,D as H,E as W,r as ve,i as ge,c as T,o as _,w as t,b as O,H as K,P as J,g as k,t as Q,f as e,z as X,e as R,h as o,a7 as U,B as F,q as be,s as ke,a as Ie,a8 as M,aA as Te,a9 as he}from"./index-C4fDvJn1.js";import{u as xe,A as z}from"./app.permissions-eEP3QY97.js";import{p as V}from"./index-DiqUFypO.js";import{u as we,F as Se,_ as Ae}from"./form-C4lsPmD3.js";import{_ as Re}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{t as Pe}from"./enums-Cr_YM2zq.js";import{_ as Ne}from"./index-Bgjt1Cd5.js";import{R as Ce}from"./dayjs-BBTQ6xGR.js";import{T as De}from"./Text-tnV5vzkU.js";import{C as Ue}from"./index-CfF1NG6B.js";import{T as B}from"./index-Cd0TkKik.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BSgdO99v.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";import"./EditOutlined-CFKuvutP.js";function He(s){const{pageIndex:d,pageSize:b}=s,p={pageIndex:d,pageSize:b};return Number.isNaN(Number.parseInt(s.platform,10))||(p.platform=s.platform),s.userId&&(p.userId=s.userId),s.beginTime&&(p.beginTime=s.beginTime),s.endTime&&(p.endTime=s.endTime),Number.isNaN(Number.parseInt(s.settlemented,10))||(p.settlemented=s.settlemented===1),G({url:"/api/alipay/lovepay/record/payPerSettle/list",params:{...p}})}function Oe(s){return s.length?G({url:"/api/alipay/lovepay/record/payPerSettle/settlement",method:"put",data:{ids:s}}):ye()}const j=$({__name:"tenuser-select",props:H({allowClear:{type:Boolean,default:!0},placeholder:{default:"- 全部 -"}},{value:{default:"",required:!0},valueModifiers:{}}),emits:["update:value"],setup(s){const d=W(s,"value"),b=ve([]),p=s,x=async r=>{const{data:c,error:y}=await Pe();!y&&c&&c.code===0&&(b.value=c.data.list)};return ge(()=>{x()}),(r,c)=>{const y=Y,h=q;return _(),T(h,{value:d.value,"onUpdate:value":c[0]||(c[0]=v=>d.value=v),placeholder:p.placeholder,"show-search":"","allow-clear":p.allowClear,onSearch:x},{default:t(()=>[(_(!0),O(K,null,J(b.value,v=>(_(),T(y,{key:v.value,value:v.value},{default:t(()=>[k(Q(`${v.text} (${v.data})`),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","allow-clear"])}}}),Fe={class:"flex-1"},$e={class:"w-full flex-y-center justify-end gap-12px"},Ee=$({name:"ReportAlipayLovePayRecordListSearch",__name:"search-filter",props:H({platform:{},userInfo:{}},{model:{required:!0},modelModifiers:{}}),emits:H(["reset","search"],["update:model"]),setup(s,{emit:d}){const{formRef:b,validate:p,resetFields:x}=we(),r=W(s,"model"),c=s,y=d;async function h(){await x(),y("reset")}async function v(){await p(),y("search")}function w(S,n){r.value.beginTime=n[0],r.value.endTime=n[1]}const P=S=>S&&S>=U().endOf("day");return(S,n)=>{const N=q,f=Ae,I=Ne,C=Ce,A=Y,D=se,i=F,l=re,a=oe,m=Se;return _(),T(ue,null,{default:t(()=>[e(m,{ref_key:"formRef",ref:b,name:"filer",model:r.value,"label-col":{span:5,md:7}},{default:t(()=>[e(a,{gutter:[16,16],wrap:""},{default:t(()=>[e(I,{span:24,md:12,lg:6},{default:t(()=>[e(f,{label:"支付平台",name:"platform",class:"m-0"},{default:t(()=>[e(N,{value:r.value.platform,"onUpdate:value":n[0]||(n[0]=u=>r.value.platform=u),placeholder:"- 全部 -",options:c.platform,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),c.userInfo.isTenant?(_(),T(I,{key:1,span:24,md:12,lg:6},{default:t(()=>[e(f,{label:"持有者",name:"userId",class:"m-0"},{default:t(()=>[e(j,{value:r.value.userId,"onUpdate:value":n[2]||(n[2]=u=>r.value.userId=u),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})):(_(),T(I,{key:0,span:24,md:12,lg:6},{default:t(()=>[e(f,{label:"所属商户",name:"userId",class:"m-0"},{default:t(()=>[e(Re,{value:r.value.userId,"onUpdate:value":n[1]||(n[1]=u=>r.value.userId=u),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),c.userInfo.isTenant?(_(),T(I,{key:2,span:24,md:12,lg:6},{default:t(()=>[e(f,{label:"使用人",name:"usedUserId",class:"m-0"},{default:t(()=>[e(j,{value:r.value.usedUserId,"onUpdate:value":n[3]||(n[3]=u=>r.value.usedUserId=u),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})):X("",!0),e(I,{span:24,md:12,lg:6},{default:t(()=>[e(f,{label:"创建时间",name:"createTimeRange",class:"m-0"},{default:t(()=>[e(C,{value:r.value.createTimeRange,"onUpdate:value":n[4]||(n[4]=u=>r.value.createTimeRange=u),"show-time":{hideDisabledOptions:!0,defaultValue:[o(U)("00:00:00","HH:mm:ss"),o(U)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],"disabled-date":P,onChange:w},null,8,["value","show-time"])]),_:1})]),_:1}),e(I,{span:24,md:12,lg:6},{default:t(()=>[e(f,{label:"结算状态",name:"settlemented",class:"m-0"},{default:t(()=>[e(N,{value:r.value.settlemented,"onUpdate:value":n[5]||(n[5]=u=>r.value.settlemented=u),placeholder:"- 全部 -","allow-clear":""},{default:t(()=>[e(A,{value:1},{default:t(()=>n[6]||(n[6]=[k("已结算")])),_:1}),e(A,{value:0},{default:t(()=>n[7]||(n[7]=[k("未结算")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),R("div",Fe,[e(f,{class:"m-0"},{default:t(()=>[R("div",$e,[e(i,{onClick:h},{icon:t(()=>[e(D,{class:"align-sub text-icon"})]),default:t(()=>[n[8]||(n[8]=R("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(i,{type:"primary",ghost:"",onClick:v},{icon:t(()=>[e(l,{class:"align-sub text-icon"})]),default:t(()=>[n[9]||(n[9]=R("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),Le={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Me=$({name:"report_alipaylovepaypersettle",__name:"index",setup(s){const d=be(),b=xe(),{tableWrapperRef:p,scrollConfig:x}=me(),r=ke({}),{columns:c,columnChecks:y,searchParams:h,resetSearchParams:v,data:w,getData:P,getDataByPage:S,loading:n,mobilePagination:N}=ie({apiFn:async(...i)=>{const l=await He(...i);return Object.assign(r,l.data.data.summary),l},apiParams:{pageIndex:1,pageSize:10},columns:C}),{checkedRowKeys:f,rowSelection:I}=de(w,P);function C(){const i=[{key:"alipayName",dataIndex:"alipayName",title:"亲情卡",align:"center",customRender:({record:a})=>a.alipayAccount?e("span",null,[a.alipayAccount,k("("),a.alipayName,k(")")]):e("span",null,[a.alipayName])},{key:"platform",dataIndex:"platform",title:"支付平台",align:"center",width:100,customRender:({record:a})=>{let m=V.filter(u=>u.value===a.platform);return m=m.length?m[0]:{label:"未知",value:a.platform,color:""},e(B,{color:m.color},{default:()=>[m.label]})}},{key:"planTaskId",dataIndex:"planTaskId",title:"任务编号",align:"center"},{key:"orderId",dataIndex:"orderId",title:"支付订单号",align:"center"},{key:"amount",dataIndex:"amount",title:"支付金额",align:"center",customRender:({record:a})=>e("span",{style:{color:a.amount>0?"#52c41a":"#ff4d4f"}},[a.amount])},{key:"priceDiff",dataIndex:"priceDiff",title:"差价",align:"center",customRender:({record:a})=>e("span",{style:{color:a.priceDiff>0?"#52c41a":"#ff4d4f"}},[a.priceDiff])}];d.userInfo.isTenant&&(i.push({key:"usedUserName",dataIndex:"usedUserName",title:"使用人",align:"center"}),i.push({key:"userName",dataIndex:"userName",title:"持有者",align:"center"})),d.userInfo.isTenant||i.push({key:"tenantName",dataIndex:"tenantName",title:"所属商户",align:"center"});const l=[{key:"settlemented",dataIndex:"settlemented",title:"结算状态",align:"center",width:100,customRender:({record:a})=>a.settlemented?e(B,{color:"success"},{default:()=>[k("已结算")]}):e(B,{color:"error"},{default:()=>[k("未结算")]})},{key:"createTime",dataIndex:"createTime",title:"支付时间",align:"center",width:200},{key:"operate",title:"操作",align:"left",width:80,customRender:({record:a})=>!d.userInfo.isTenantUser||!b.hasOne(z.Report.AlipayLovePayPerSettle)||a.settlemented||a.userId!==d.userInfo.id?"":e(he,{placement:"top",title:"结算"},{default:()=>[e(F,{size:"small",type:"link",onClick:()=>A(a.id)},{default:()=>[e(L,null,null)]})]})}];return[...i,...l]}async function A(i){var a;const l=i?[i]:[...f.value];if(l&&l.length){const{data:m,error:u}=await Oe(l);!u&&m&&m.code===0&&((a=window.$message)==null||a.success("结算成功"),P())}}const D=Ie(()=>{const i=Object.entries(r).map(([a,m])=>({key:a,value:m})),l=[];for(const a of c.value)if(a.key!=="amount"&&a.key!=="priceDiff")a.key==="operate"?l.push({key:a.key,value:""}):l.push({key:a.key,value:"——"});else{const m=i.find(u=>u.key===a.key);l.push({key:a.key,value:(m==null?void 0:m.value)||0})}return l});return(i,l)=>{const a=L,m=F,u=ne,E=_e,Z=De,ee=fe,ae=ce,te=pe,le=Ue;return _(),O("div",Le,[e(Ee,{model:o(h),"onUpdate:model":l[0]||(l[0]=g=>M(h)?h.value=g:null),"user-info":o(d).userInfo,platform:o(V),onReset:o(v),onSearch:l[1]||(l[1]=g=>o(S)(1))},null,8,["model","user-info","platform","onReset"]),e(le,{title:"个人亲情卡结算报表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:t(()=>[e(u,{columns:o(y),"onUpdate:columns":l[3]||(l[3]=g=>M(y)?y.value=g:null),"disabled-delete":o(f).length===0,loading:o(n)},{default:t(()=>[o(d).userInfo.isTenantUser||o(b).hasOne(o(z).Report.AlipayLovePayPerSettle.UPDATE)?(_(),T(m,{key:0,size:"small",ghost:"",type:"primary",disabled:o(f).length===0,onClick:l[2]||(l[2]=g=>A(""))},{icon:t(()=>[e(a)]),default:t(()=>[l[4]||(l[4]=R("span",{class:"ml-6px"},"批量结算",-1))]),_:1},8,["disabled"])):X("",!0)]),_:1},8,["columns","disabled-delete","loading"])]),default:t(()=>[e(te,{ref_key:"tableWrapperRef",ref:p,columns:o(c),"data-source":o(w),size:"small","row-selection":o(I),scroll:o(x),loading:o(n),"row-key":"id",pagination:o(N),class:"h-full"},Te({_:2},[o(w)&&o(w).length?{name:"summary",fn:t(()=>[e(ae,null,{default:t(()=>[e(ee,null,{default:t(()=>[e(E,{index:0},{default:t(()=>l[5]||(l[5]=[k("合计")])),_:1}),(_(!0),O(K,null,J(D.value,g=>(_(),T(E,{key:g.key},{default:t(()=>[e(Z,{type:isNaN(g.value)?"":g.value>0?"success":"danger"},{default:t(()=>[k(Q(g.value),1)]),_:2},1032,["type"])]),_:2},1024))),128))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["columns","data-source","row-selection","scroll","loading","pagination"])]),_:1})])}}}),da=Be(Me,[["__scopeId","data-v-12f87c36"]]);export{da as default};
