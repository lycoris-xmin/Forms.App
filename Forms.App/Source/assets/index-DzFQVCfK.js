import{_ as ve,a as ge}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{d as M,D as L,E as z,c as D,o as b,w as a,f as e,e as p,B as N,r as K,b as B,z as $,g as O,h as d,t as E,M as W,s as G,F as q,ab as be,C as Z,H as ye,P as we,aQ as he,q as ke,a8 as X,a9 as j,aR as xe}from"./index-CZVtSjPQ.js";import{_ as Ae,a as Fe,b as Ie,T as Te,S as De,u as Se,c as Ce,d as Ne,e as Re,f as Be}from"./table-search-filter-DgS7ifzw.js";import{u as $e,A as V}from"./app.permissions-B_pV7apU.js";import{u as J,F as H,_ as P,I as ee,S as Ee}from"./form-ZxLsforZ.js";import{_ as Le}from"./index.vue_vue_type_script_setup_true_lang-C6dTBFF2.js";import{_ as Oe}from"./index-DOEbmRvB.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as te}from"./index-BWb-9rJv.js";import{b as Ve,c as Me,d as Ue,e as ze,g as He,h as Pe,i as Y,j as je}from"./friend-DaO0S7HU.js";import{_ as Ke}from"./index-XLX1VXh_.js";import{L as ne}from"./index-Y4HE4_-c.js";import{_ as ae}from"./index-BVBn8Dpq.js";import{p as We}from"./index-DiqUFypO.js";import{T as oe}from"./index-DMMLrYUn.js";import{C as qe}from"./index-ClUX1lZP.js";import{T as Ge}from"./ToolFilled-djzCWACB.js";import{D as Je}from"./DeleteOutlined-CShsKEiR.js";import"./index-CQCXu6T9.js";import"./EyeOutlined-B3DWie8W.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";import"./responsiveObserve-CdtC9r70.js";import"./debounce-BsWDECm-.js";import"./isSymbol-DgABtkrl.js";import"./enums-XBoEbamp.js";const Qe={class:"flex-1"},Xe={class:"w-full flex-y-center justify-end gap-12px"},Ye=M({name:"FriendListSearch",__name:"search-filter",props:{model:{required:!0},modelModifiers:{}},emits:L(["reset","search"],["update:model"]),setup(F,{emit:f}){const{formRef:g,validate:r,resetFields:o}=J(),n=z(F,"model"),w=f;async function A(){await o(),w("reset")}async function y(){await r(),w("search")}return(I,i)=>{const u=P,s=Oe,t=Fe,c=N,_=Ie,h=Ae,k=H;return b(),D(Te,null,{default:a(()=>[e(k,{ref_key:"formRef",ref:g,model:n.value,"label-col":{span:5,md:7}},{default:a(()=>[e(h,{gutter:[16,16],wrap:""},{default:a(()=>[e(s,{span:24,md:12,lg:6},{default:a(()=>[e(u,{label:"好友",name:"id",class:"m-0"},{default:a(()=>[e(Le,{value:n.value.id,"onUpdate:value":i[0]||(i[0]=T=>n.value.id=T),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1}),p("div",Qe,[e(u,{class:"m-0"},{default:a(()=>[p("div",Xe,[e(c,{onClick:A},{icon:a(()=>[e(t,{class:"align-sub text-icon"})]),default:a(()=>[i[1]||(i[1]=p("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(c,{type:"primary",ghost:"",onClick:y},{icon:a(()=>[e(_,{class:"align-sub text-icon"})]),default:a(()=>[i[2]||(i[2]=p("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ze=U(Ye,[["__scopeId","data-v-50f37cad"]]),et={class:"steps-content"},tt={key:0,class:"steps-content"},nt={class:"friend-info"},at={class:"mb-6px"},ot={class:"mt-12px text-right"},st=M({__name:"sendfriend-modal",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:L(["submitted"],["update:visible"]),setup(F,{emit:f}){const g=K(null),r=z(F,"visible"),o=K(I()),{formRef:n,validate:w}=J(),A=f,y={friendAccount:[{required:!0,message:"请输入好友账号"}]};function I(){return{friendId:"",friendAccount:"",reasons:"",searchedFriend:null,alert:!1}}const i=async()=>{await w();try{const{data:s,error:t}=await Ve(o.value.friendAccount);!t&&s&&s.code===0&&s.data?(o.value.searchedFriend=s.data,o.value.alert=!1):(o.value.searchedFriend=null,o.value.alert=!0)}catch{o.value.searchedFriend=null,o.value.alert=!0}},u=async()=>{var _;const s={friendId:o.value.searchedFriend.id,friendAccount:o.value.searchedFriend.email,reasons:o.value.reasons},{data:t,error:c}=await Me(s);!c&&t&&t.code===0&&((_=window.$message)==null||_.success("申请成功"),A("submitted"),r.value=!1,o.value=I())};return(s,t)=>{const c=ee,_=N,h=te,k=P,T=Ke,v=H,S=W;return b(),D(S,{open:r.value,"onUpdate:open":t[2]||(t[2]=R=>r.value=R),title:"搜索好友","mask-closable":!1,width:"450px",footer:null},{default:a(()=>[p("div",null,[e(v,{ref_key:"formRef",ref:n,name:"operate",layout:"vertical",model:o.value,rules:y},{default:a(()=>[p("div",et,[e(k,{label:"好友账号",name:"friendAccount"},{default:a(()=>[e(h,{class:"select-action"},{default:a(()=>[e(c,{ref_key:"inputRef",ref:g,value:o.value.friendAccount,"onUpdate:value":t[0]||(t[0]=R=>o.value.friendAccount=R),placeholder:"好友账号"},null,8,["value"]),e(_,{ghost:"",size:"small",type:"primary",onClick:i},{icon:a(()=>[e(d(Ee))]),default:a(()=>[t[3]||(t[3]=O(" 搜索 "))]),_:1})]),_:1})]),_:1})]),o.value.searchedFriend?(b(),B("div",tt,[e(k,{label:"搜索结果",name:"groupName"},{default:a(()=>[p("div",nt,[p("p",null,"账号："+E(o.value.searchedFriend.email),1),p("p",null,"昵称："+E(o.value.searchedFriend.nickName),1),p("p",at,"备注："+E(o.value.searchedFriend.remark||"无"),1),e(c,{ref_key:"inputRef",ref:g,value:o.value.reasons,"onUpdate:value":t[1]||(t[1]=R=>o.value.reasons=R),placeholder:"申请理由"},null,8,["value"])])]),_:1})])):$("",!0),o.value.alert?(b(),D(T,{key:1,type:"warning",message:"未找到好友信息"})):$("",!0)]),_:1},8,["model"]),p("div",ot,[e(_,{type:"primary",disabled:!o.value.searchedFriend,onClick:u},{default:a(()=>t[4]||(t[4]=[O("添加好友")])),_:1},8,["disabled"])])])]),_:1},8,["open"])}}}),it=U(st,[["__scopeId","data-v-ea6faf41"]]),lt=M({name:"FriendSettingDrawer",__name:"setting-drawer",props:L({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:L(["submitted"],["update:visible"]),setup(F,{emit:f}){const g=f,r=z(F,"visible"),o=F,n=G({id:"",friendAccount:"",friendNickName:"",loading:!0,submitLoading:!1}),{formRef:w,validate:A,resetFields:y}=J();q(r,()=>{r.value&&(y(),be(async()=>{I()}))});function I(){try{Object.keys(n).forEach(s=>{Object.keys(o.rowData).includes(s)&&(n[s]=o.rowData[s])})}finally{n.loading=!1}}function i(){r.value=!1}async function u(){var s;await A(),n.submitLoading=!0;try{const{data:t,error:c}=await Ue({...n});!c&&t&&t.code===0&&((s=window.$message)==null||s.success("更新成功"),i(),g("submitted"))}finally{n.submitLoading=!1}}return(s,t)=>{const c=ee,_=P,h=H,k=N,T=te,v=ae;return b(),D(v,{open:r.value,"onUpdate:open":t[1]||(t[1]=S=>r.value=S),title:"信息修改",width:500},{footer:a(()=>[e(T,{size:16},{default:a(()=>[e(k,{onClick:i},{default:a(()=>t[2]||(t[2]=[O("取消")])),_:1}),e(k,{type:"primary",loading:n.submitLoading,onClick:u},{default:a(()=>t[3]||(t[3]=[O("保存")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[p("div",{class:Z(["body",{loading:n.loading}])},[e(h,{ref_key:"formRef",ref:w,layout:"vertical",model:n,"label-col":{span:5,md:7}},{default:a(()=>[e(_,{label:"好友备注",name:"friendNickName"},{default:a(()=>[e(c,{value:n.friendNickName,"onUpdate:value":t[0]||(t[0]=S=>n.friendNickName=S),placeholder:"请输入好友备注",maxlength:30,"show-count":""},null,8,["value"])]),_:1})]),_:1},8,["model"]),e(ne,{loading:n.loading},null,8,["loading"])],2)]),_:1},8,["open"])}}}),rt=U(lt,[["__scopeId","data-v-ec3409b8"]]),dt={key:0,class:"shop-list"},ut={class:"shop-name"},ct={class:"shop-status center flex"},mt={class:"shop-actions center flex"},pt={key:1},ft=M({name:"FriendSettingDrawer",__name:"audit-shop",props:L({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:L(["submitted"],["update:visible"]),setup(F,{emit:f}){const g=f,r=z(F,"visible"),o=F,n=G({id:"",friendNickName:"",status:0,loading:!0,submitLoading:!1,planformType:0}),w=K([]);q(r,async()=>{r.value&&(await A(),n.planformType=0)});async function A(){try{Object.keys(n).forEach(i=>{Object.keys(o.rowData).includes(i)&&(n[i]=o.rowData[i])}),await y(n.planformType)}finally{n.loading=!1}}async function y(i=n.planformType){n.loading=!0;try{const{id:u}=n,{data:s,error:t}=await ze(u,i);!t&&(s!=null&&s.data)&&(w.value=JSON.parse(JSON.stringify(s.data.list)))}finally{n.loading=!1}}q(()=>n.planformType,i=>{y(i)});const I=(i,u)=>{i.auditId==="0"?W.confirm({title:"确认审核",content:`确认通过该店铺「${i.shopName}」吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{var h;const{id:s}=n,t={auditId:i.auditId,friendId:s,shopName:i.shopName,planformType:u},{data:c,error:_}=await He(t);!_&&(c==null?void 0:c.code)===0&&((h=window.$message)==null||h.success("申请成功"),y(u),g("submitted"))}}):W.confirm({title:"确认撤销",content:`确认撤销该店铺「${i.shopName}」吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{var c;const{data:s,error:t}=await Pe(i.auditId);!t&&(s==null?void 0:s.code)===0&&((c=window.$message)==null||c.success("撤销成功"),y(u),g("submitted"))}})};return(i,u)=>{const s=De,t=P,c=H,_=oe,h=N,k=he,T=ae;return b(),D(T,{open:r.value,"onUpdate:open":u[1]||(u[1]=v=>r.value=v),title:"店铺审核",width:600},{default:a(()=>[e(c,{model:n},{default:a(()=>[e(t,{label:"平台",name:"planformType",class:"m-0"},{default:a(()=>[e(s,{value:n.planformType,"onUpdate:value":u[0]||(u[0]=v=>n.planformType=v),class:"planform-type",placeholder:"- 全部 -",options:d(We)},null,8,["value","options"])]),_:1})]),_:1},8,["model"]),p("div",{class:Z(["body",{loading:n.loading}])},[w.value.length>0?(b(),B("div",dt,[u[2]||(u[2]=p("h3",null,"好友店铺",-1)),(b(!0),B(ye,null,we(w.value,v=>(b(),B("div",{key:v.id,class:"shop-item"},[p("span",ut,E(v.shopName),1),p("span",ct,[e(_,{color:v.auditId>0?"green":"red"},{default:a(()=>[O(E(v.auditId>0?"已审核":"未审核"),1)]),_:2},1032,["color"])]),p("div",mt,[e(h,{size:"small",type:"link",onClick:S=>I(v,n.planformType)},{default:a(()=>[O(E(v.auditId>0?"撤销":"审核"),1)]),_:2},1032,["onClick"])])]))),128))])):(b(),B("div",pt,[e(k,{description:"该账户没有店铺需要审核"})])),e(ne,{loading:n.loading},null,8,["loading"])],2)]),_:1},8,["open"])}}}),_t=U(ft,[["__scopeId","data-v-50ec9b33"]]),vt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},gt=M({name:"friend_list",__name:"index",setup(F){const f=ke(),g=$e(),r=G({rowId:"",resetLoading:!1,rowDetail:{},expandedRowKeys:[],settingDrawerVisible:!1,auditDrawerVisible:!1}),{tableWrapperRef:o,scrollConfig:n}=Se(),{columns:w,columnChecks:A,data:y,getData:I,getDataByPage:i,loading:u,mobilePagination:s,searchParams:t,resetSearchParams:c}=Ce({apiFn:je,apiParams:{pageIndex:1,pageSize:10},columns:re}),{editingData:_,handleEdit:h,checkedRowKeys:k,rowSelection:T,onBatchDeleted:v,onDeleted:S}=Ne(y,I);function R(){r.bindingModalVisible=!0}function se(){r.bindingDrawerVisible=!0}async function ie(){const m=k.value;if(m&&m.length){const{data:l,error:C}=await Y(m);!C&&l&&l.code===0&&v()}}async function le(m){const{data:l,error:C}=await Y([m]);!C&&l&&l.code===0&&S()}function re(){const m=[{key:"friendAccount",dataIndex:"friendAccount",title:"好友账号",width:170}];return m.push({key:"friendNickName",dataIndex:"friendNickName",title:"好友名称（备注）",align:"center",width:180}),m.push({key:"auditShopCount",dataIndex:"auditShopCount",title:"审核店铺数量",width:180,ellipsis:!0}),m.push({key:"status",dataIndex:"status",title:"状态",align:"center",width:120,customRender:({record:l})=>{const C=l.status===!0;return e(oe,{color:C?"green":"red"},{default:()=>[C?"在线":"离线"]})}}),m.push({key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200,visible:!1}),f.userInfo.isTenant&&m.push({key:"operate",title:"操作",align:"center",width:130,fixed:"right",customRender:({record:l})=>e("div",{class:"v-center center flex gap-4px"},[de(l),ue(l),ce(l)])}),m}async function Q(m,l="setting"){h(m.id),l==="setting"?r.settingDrawerVisible=!0:l==="audit"&&(r.auditDrawerVisible=!0)}function de(m){return!g.hasOne(V.Friend.List.UPDATE)||!f.userInfo.isTenant?"":e(j,{placement:"top",title:"设置"},{default:()=>[e(N,{size:"small",type:"link",onClick:()=>Q(m,"setting"),class:"v-center center flex"},{default:()=>[e(Ge,null,null)]})]})}function ue(m){return!g.hasOne(V.Friend.Audit.VIEW)||!f.userInfo.isTenant?"":e(j,{placement:"top",title:"审核"},{default:()=>[e(N,{size:"small",type:"link",onClick:()=>Q(m,"audit"),class:"v-center center flex"},{default:()=>[e(xe,{icon:"carbon:report"},null)]})]})}function ce(m){return!g.hasOne(V.Friend.List.DELETE)||!f.userInfo.isTenant?"":e(Be,{title:"确认删除吗？",onConfirm:()=>le(m.id)},{default:()=>[e(j,{placement:"top",title:"删除"},{default:()=>[e(N,{danger:!0,size:"small",type:"link",class:"v-center center flex"},{default:()=>[e(Je,null,null)]})]})]})}return(m,l)=>{const C=ge,me=N,pe=ve,fe=Re,_e=qe;return b(),B("div",vt,[e(Ze,{model:d(t),"onUpdate:model":l[0]||(l[0]=x=>X(t)?t.value=x:null),"user-info":d(f).userInfo,onReset:d(c),onSearch:l[1]||(l[1]=x=>d(i)(1))},null,8,["model","user-info","onReset"]),e(_e,{title:"好友列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"device-card flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:a(()=>[e(pe,{columns:d(A),"onUpdate:columns":l[2]||(l[2]=x=>X(A)?A.value=x:null),"disabled-delete":d(k).length===0,loading:d(u),"delete-btn":d(g).hasOne(d(V).Friend.List.DELETE),onDelete:ie},{prefix:a(()=>[d(g).hasOne(d(V).Friend.List.CREATE)&&d(f).userInfo.isTenant?(b(),D(me,{key:0,size:"small",ghost:"",type:"primary",onClick:R},{icon:a(()=>[e(C,{class:"align-sub text-icon"})]),default:a(()=>[l[7]||(l[7]=p("span",{class:"ml-6px"},"添加好友",-1))]),_:1})):$("",!0)]),_:1},8,["columns","disabled-delete","loading","delete-btn"])]),default:a(()=>[e(fe,{ref_key:"tableWrapperRef",ref:o,"expanded-row-keys":r.expandedRowKeys,"onUpdate:expandedRowKeys":l[3]||(l[3]=x=>r.expandedRowKeys=x),columns:d(w),"data-source":d(y),size:"small","row-selection":d(T),scroll:d(n),loading:d(u),"row-key":"id",pagination:d(s),class:"h-full"},null,8,["expanded-row-keys","columns","data-source","row-selection","scroll","loading","pagination"]),d(f).userInfo.isTenant?(b(),D(it,{key:0,visible:r.bindingModalVisible,"onUpdate:visible":l[4]||(l[4]=x=>r.bindingModalVisible=x),onSubmitted:se},null,8,["visible"])):$("",!0),d(f).userInfo.isTenant?(b(),D(rt,{key:1,visible:r.settingDrawerVisible,"onUpdate:visible":l[5]||(l[5]=x=>r.settingDrawerVisible=x),"row-data":d(_),onSubmitted:d(i)},null,8,["visible","row-data","onSubmitted"])):$("",!0),d(f).userInfo.isTenant?(b(),D(_t,{key:2,visible:r.auditDrawerVisible,"onUpdate:visible":l[6]||(l[6]=x=>r.auditDrawerVisible=x),"row-data":d(_),onSubmitted:d(i)},null,8,["visible","row-data","onSubmitted"])):$("",!0)]),_:1})])}}}),jt=U(gt,[["__scopeId","data-v-cc646b3e"]]);export{jt as default};
