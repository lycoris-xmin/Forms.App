import{_ as oe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{K as se,_ as ie,a as re,b as ue,T as de,u as ce,c as pe,d as me,e as fe,f as _e}from"./table-search-filter-DgS7ifzw.js";import{f as e,O as be,m as D,aP as ye,d as $,D as H,E as Q,s as P,a as q,r as ge,F as X,c as j,o as E,w as u,e as C,B as x,g as N,b as Y,z as ve,h as d,a8 as G,a9 as V}from"./index-CZVtSjPQ.js";import{u as we,A as B}from"./app.permissions-B_pV7apU.js";import{u as he,a as ke,F as xe,_ as Z,I as De}from"./form-ZxLsforZ.js";import{S as ee}from"./index-BWb-9rJv.js";import{_ as te}from"./index-BVBn8Dpq.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as Se}from"./index-ClUX1lZP.js";import{E as Ae}from"./EditOutlined-S8fzz_Is.js";import{D as Oe}from"./DeleteOutlined-CShsKEiR.js";import"./index-CQCXu6T9.js";import"./EyeOutlined-B3DWie8W.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";import"./responsiveObserve-CdtC9r70.js";import"./debounce-BsWDECm-.js";import"./isSymbol-DgABtkrl.js";var Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512.5 390.6c-29.9 0-57.9 11.6-79.1 32.8-21.1 21.2-32.8 49.2-32.8 79.1 0 29.9 11.7 57.9 32.8 79.1 21.2 21.1 49.2 32.8 79.1 32.8 29.9 0 57.9-11.7 79.1-32.8 21.1-21.2 32.8-49.2 32.8-79.1 0-29.9-11.7-57.9-32.8-79.1a110.96 110.96 0 00-79.1-32.8zm412.3 235.5l-65.4-55.9c3.1-19 4.7-38.4 4.7-57.7s-1.6-38.8-4.7-57.7l65.4-55.9a32.03 32.03 0 009.3-35.2l-.9-2.6a442.5 442.5 0 00-79.6-137.7l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.2 28.9c-30-24.6-63.4-44-99.6-57.5l-15.7-84.9a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52-9.4-106.8-9.4-158.8 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.3a353.44 353.44 0 00-98.9 57.3l-81.8-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a445.93 445.93 0 00-79.6 137.7l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.2 56.5c-3.1 18.8-4.6 38-4.6 57 0 19.2 1.5 38.4 4.6 57l-66 56.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.3 44.8 96.8 79.6 137.7l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.8-29.1c29.8 24.5 63 43.9 98.9 57.3l15.8 85.3a32.05 32.05 0 0025.8 25.7l2.7.5a448.27 448.27 0 00158.8 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-84.9c36.2-13.6 69.6-32.9 99.6-57.5l81.2 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.5-87.4 79.6-137.7l.9-2.6c4.3-12.4.6-26.3-9.5-35zm-412.3 52.2c-97.1 0-175.8-78.7-175.8-175.8s78.7-175.8 175.8-175.8 175.8 78.7 175.8 175.8-78.7 175.8-175.8 175.8z"}}]},name:"setting",theme:"filled"};function W(n){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(l).filter(function(m){return Object.getOwnPropertyDescriptor(l,m).enumerable}))),a.forEach(function(m){Be(n,m,l[m])})}return n}function Be(n,t,l){return t in n?Object.defineProperty(n,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):n[t]=l,n}var L=function(t,l){var a=W({},t,l.attrs);return e(be,W({},a,{icon:Fe}),null)};L.displayName="SettingFilled";L.inheritAttrs=!1;function Ce(n){const{pageIndex:t,pageSize:l}=n;return D({url:"/api/role/list",params:{pageIndex:t,pageSize:l}})}function Ee(n){return D({url:"/api/role",method:"post",data:{roleName:n}})}function Te(n){const{id:t,roleName:l}=n;return D({url:"/api/role",method:"put",data:{id:t,roleName:l}})}function J(n){return!n||!n.length?ye():D({url:"/api/role",method:"delete",params:{ids:n}})}function Pe(n){return D({url:`/api/role/permission/${n}`})}function Ne(n,t){return D({url:`/api/role/permission/${n}`,method:"put",data:{permissions:t}})}const $e={class:"body"},Ke=$({name:"RoleOperateDrawer",__name:"operate-drawer",props:H({operateType:{default:"add"},rowData:{default:null}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(n,{emit:t}){const{formRef:l,validate:a,resetFields:m}=he(),b=Q(n,"visible"),f=P({submit:!1}),y=n,p=t,i=q(()=>({add:"新增角色",edit:"编辑角色"})[y.operateType]),o=q(()=>y.operateType==="edit"),s=ge(g()),{defaultRequiredRule:R}=ke(),S={roleName:R};X(b,()=>{b.value&&(w(),m())});function g(){return{id:"",roleName:""}}function w(){s.value=g(),o.value&&y.rowData&&Object.assign(s.value,y.rowData)}function A(){b.value=!1}async function K(){var h;await a(),f.submit=!0;try{const{data:_,error:v}=o.value?await Te({...s.value}):await Ee(s.value.roleName);!v&&_&&_.code===0&&((h=window.$message)==null||h.success("保存成功"),A(),p("submitted"))}finally{f.submit=!1}}return(h,_)=>{const v=De,z=Z,I=xe,T=x,M=ee,U=te;return E(),j(U,{open:b.value,"onUpdate:open":_[1]||(_[1]=O=>b.value=O),title:i.value,width:550},{footer:u(()=>[e(M,{size:16},{default:u(()=>[e(T,{onClick:A},{default:u(()=>_[2]||(_[2]=[N("取消")])),_:1}),e(T,{type:"primary",loading:f.submit,onClick:K},{default:u(()=>_[3]||(_[3]=[N("保存")])),_:1},8,["loading"])]),_:1})]),default:u(()=>[C("div",$e,[e(I,{ref_key:"formRef",ref:l,name:"operate",layout:"vertical",model:s.value,rules:S},{default:u(()=>[e(z,{label:"角色名称",name:"roleName"},{default:u(()=>[e(v,{value:s.value.roleName,"onUpdate:value":_[0]||(_[0]=O=>s.value.roleName=O),autocomplete:"off",placeholder:"角色名称"},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","title"])}}}),ze=Re(Ke,[["__scopeId","data-v-cb9fd8bd"]]),Ie={key:0,class:"body"},Me=$({name:"RolePermissionDrawer",__name:"permission-drawer",props:H({id:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(n){const t=Q(n,"visible"),l=P({submit:!1}),a=P({id:"",treeData:[],checkedKeys:[],expandedKeys:[]}),m=n;X(t,async()=>{t.value&&await b()});async function b(){if(a.id===m.id)return;a.id=m.id;const{data:p,error:i}=await Pe(m.id);!i&&p&&p.code===0?(a.expandedKeys=p.data.list.map(o=>o.key),a.checkedKeys=p.data.list.flatMap(o=>o.children).filter(o=>o.selectable).map(o=>o.key),a.treeData=p.data.list.map(o=>({key:o.key,title:o.title,selectable:o.selectable,children:o.children.map(s=>({key:s.key,title:s.title,selectable:s.selectable,isLeaf:!0,class:"isLeaf"}))}))):(a.expandedKeys=[],a.checkedKeys=[],a.treeData=[])}function f(){t.value=!1}async function y(){var p;l.submit=!0;try{const{data:i,error:o}=await Ne(m.id,a.checkedKeys.filter(s=>s.includes(".")));!o&&i&&i.code===0&&((p=window.$message)==null||p.success("保存成功"),f())}finally{l.submit=!1}}return(p,i)=>{const o=se,s=x,R=ee,S=te;return E(),j(S,{open:t.value,"onUpdate:open":i[2]||(i[2]=g=>t.value=g),title:"权限设置",width:550},{footer:u(()=>[e(R,{size:16},{default:u(()=>[e(s,{onClick:f},{default:u(()=>i[3]||(i[3]=[N("取消")])),_:1}),e(s,{type:"primary",loading:l.submit,onClick:y},{default:u(()=>i[4]||(i[4]=[N("保存")])),_:1},8,["loading"])]),_:1})]),default:u(()=>{var g;return[(g=a.treeData)!=null&&g.length?(E(),Y("div",Ie,[e(o,{"checked-keys":a.checkedKeys,"onUpdate:checkedKeys":i[0]||(i[0]=w=>a.checkedKeys=w),"expanded-keys":a.expandedKeys,"onUpdate:expandedKeys":i[1]||(i[1]=w=>a.expandedKeys=w),checkable:"","tree-data":a.treeData,"default-expand-all":!0},null,8,["checked-keys","expanded-keys","tree-data"])])):ve("",!0)]}),_:1},8,["open"])}}}),Ue={class:"flex-1"},Ve={class:"w-full flex-y-center justify-end gap-12px"},He=$({name:"SystemRoleListSearch",__name:"search-filter",emits:["reset","search"],setup(n,{emit:t}){const l=t;async function a(){l("reset")}async function m(){l("search")}return(b,f)=>{const y=re,p=x,i=ue,o=Z,s=ie;return E(),j(de,null,{default:u(()=>[e(s,{gutter:[16,16],wrap:""},{default:u(()=>[C("div",Ue,[e(o,{class:"m-0"},{default:u(()=>[C("div",Ve,[e(p,{onClick:a},{icon:u(()=>[e(y,{class:"align-sub text-icon"})]),default:u(()=>[f[0]||(f[0]=C("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(p,{type:"primary",ghost:"",onClick:m},{icon:u(()=>[e(i,{class:"align-sub text-icon"})]),default:u(()=>[f[1]||(f[1]=C("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1})}}}),je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ut=$({name:"system_role",__name:"index",setup(n){const t=we(),{tableWrapperRef:l,scrollConfig:a}=ce(),{columns:m,columnChecks:b,data:f,getData:y,loading:p,mobilePagination:i,getDataByPage:o}=pe({apiFn:Ce,apiParams:{pageIndex:1,pageSize:10},columns:M}),{drawerVisible:s,operateType:R,editingData:S,handleAdd:g,handleEdit:w,checkedRowKeys:A,rowSelection:K,onBatchDeleted:h,onDeleted:_}=me(f,y),v=P({id:"",permissionVisable:!1});async function z(){const r=A.value;if(r&&r.length){const{data:c,error:F}=await J(r);!F&&c&&c.code===0&&h()}}async function I(r){const{data:c,error:F}=await J([r]);!F&&c&&c.code===0&&_()}function T(r){v.id=r,v.permissionVisable=!0}function M(){return[{key:"roleName",dataIndex:"roleName",title:"角色名称",align:"center"},{key:"count",dataIndex:"count",title:"用户数量",align:"center"},{key:"operate",title:"操作",align:"left",width:120,customRender:({record:c})=>e("div",{class:"v-center flex gap-8px"},[U(c),O(c),ne(c)])}]}function U(r){return t.hasOne(B.System.Role.UPDATE)?e(V,{placement:"top",title:"权限设置"},{default:()=>[e(x,{type:"link",size:"small",onClick:()=>T(r.id)},{default:()=>[e(L,null,null)]})]}):""}function O(r){return!t.hasOne(B.System.Role.UPDATE)||r.id==="1001"||r.id==="1002"||r.id==="1003"?"":e(V,{placement:"top",title:"编辑"},{default:()=>[e(x,{size:"small",type:"link",onClick:()=>w(r.id)},{default:()=>[e(Ae,null,null)]})]})}function ne(r){return!t.hasOne(B.System.Role.DELETE)||r.id==="1001"||r.id==="1002"||r.id==="1003"?"":e(_e,{title:"确认删除吗？",onConfirm:()=>I(r.id)},{default:()=>[e(V,{placement:"top",title:"删除"},{default:()=>[e(x,{danger:!0,size:"small",type:"link"},{default:()=>[e(Oe,null,null)]})]})]})}return(r,c)=>{const F=oe,ae=fe,le=Se;return E(),Y("div",je,[e(He,{onSearch:c[0]||(c[0]=k=>d(o)(1))}),e(le,{title:"角色列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:u(()=>[e(F,{columns:d(b),"onUpdate:columns":c[1]||(c[1]=k=>G(b)?b.value=k:null),"disabled-delete":d(A).length===0,loading:d(p),"add-btn":d(t).hasOne(d(B).System.Role.CREATE),"delete-btn":d(t).hasOne(d(B).System.Role.DELETE),onAdd:d(g),onDelete:z},null,8,["columns","disabled-delete","loading","add-btn","delete-btn","onAdd"])]),default:u(()=>[e(ae,{ref_key:"tableWrapperRef",ref:l,columns:d(m),"data-source":d(f),size:"small","row-selection":d(K),scroll:d(a),loading:d(p),"row-key":"id",pagination:d(i),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(ze,{visible:d(s),"onUpdate:visible":c[2]||(c[2]=k=>G(s)?s.value=k:null),"operate-type":d(R),"row-data":d(S),onSubmitted:d(o)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(Me,{id:v.id,visible:v.permissionVisable,"onUpdate:visible":c[3]||(c[3]=k=>v.permissionVisable=k)},null,8,["id","visible"])]),_:1})])}}});export{ut as default};
