import{_ as Y}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{d as K,D as Z,E as ee,c as te,o as O,w as n,f as e,e as A,h as o,B as T,q as ae,s as N,r as E,b as ne,a8 as P,M as se,a9 as S,aR as U}from"./index-CZVtSjPQ.js";import{_ as oe,S as le,a as re,b as ue,T as ie,u as de,c as ce,d as me,e as pe,f as fe}from"./table-search-filter-DgS7ifzw.js";import{u as _e,A as M}from"./app.permissions-B_pV7apU.js";import{f as V}from"./enum-map-friend-Ciom99R_.js";import{u as ve,F as ge,_ as we,I as z}from"./form-ZxLsforZ.js";import{_ as xe}from"./index-DOEbmRvB.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as be}from"./index-ClUX1lZP.js";import{k as $,l as ke}from"./friend-DaO0S7HU.js";import{T as q}from"./index-DMMLrYUn.js";import"./index-CQCXu6T9.js";import"./EyeOutlined-B3DWie8W.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";import"./responsiveObserve-CdtC9r70.js";import"./debounce-BsWDECm-.js";import"./isSymbol-DgABtkrl.js";const ye={class:"flex-1"},he={class:"w-full flex-y-center justify-end gap-12px"},Re=K({name:"FriendListSearch",__name:"search-filter",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search"],["update:model"]),setup(D,{emit:g}){const{formRef:k,validate:u,resetFields:y}=ve(),i=ee(D,"model"),h=g;async function C(){await y(),h("reset")}async function w(){await u(),h("search")}return(I,l)=>{const _=z,c=we,x=xe,b=le,B=re,R=T,F=ue,m=oe,v=ge;return O(),te(ie,null,{default:n(()=>[e(v,{ref_key:"formRef",ref:k,model:i.value,"label-col":{span:5,md:7}},{default:n(()=>[e(m,{gutter:[16,16],wrap:""},{default:n(()=>[e(x,{span:24,md:12,lg:6},{default:n(()=>[e(c,{label:"好友账号",name:"Account",class:"m-0"},{default:n(()=>[e(_,{value:i.value.Account,"onUpdate:value":l[0]||(l[0]=p=>i.value.Account=p),placeholder:"好友账号"},null,8,["value"])]),_:1})]),_:1}),e(x,{span:24,md:12,lg:6},{default:n(()=>[e(c,{label:"好友昵称",name:"NickName",class:"m-0"},{default:n(()=>[e(_,{value:i.value.NickName,"onUpdate:value":l[1]||(l[1]=p=>i.value.NickName=p),placeholder:"好友昵称"},null,8,["value"])]),_:1})]),_:1}),e(x,{span:24,md:12,lg:6},{default:n(()=>[e(c,{label:"状态",name:"status",class:"m-0"},{default:n(()=>[e(b,{value:i.value.status,"onUpdate:value":l[2]||(l[2]=p=>i.value.status=p),placeholder:"- 全部 -",options:o(V),"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),A("div",ye,[e(c,{class:"m-0"},{default:n(()=>[A("div",he,[e(R,{onClick:C},{icon:n(()=>[e(B,{class:"align-sub text-icon"})]),default:n(()=>[l[3]||(l[3]=A("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(R,{type:"primary",ghost:"",onClick:w},{icon:n(()=>[e(F,{class:"align-sub text-icon"})]),default:n(()=>[l[4]||(l[4]=A("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae=L(Re,[["__scopeId","data-v-6d7c514f"]]),Ce={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ie=K({name:"friend_request",__name:"index",setup(D){const g=ae(),k=_e(),u=N({id:"",consent:0,refuse:""}),y=N({rowId:"",resetLoading:!1,rowDetail:{},expandedRowKeys:[],settingDrawerVisible:!1,auditDrawerVisible:!1}),{tableWrapperRef:i,scrollConfig:h}=de(),{columns:C,columnChecks:w,data:I,getData:l,getDataByPage:_,loading:c,mobilePagination:x,searchParams:b,resetSearchParams:B}=ce({apiFn:ke,apiParams:{pageIndex:1,pageSize:10},columns:j}),{checkedRowKeys:R,rowSelection:F}=me(I,l),m=E(""),v=E(!1),p=(s,t)=>{u.consent=s,u.id=t,m.value="",v.value=!0},H=async()=>{var a,d,f;if(!m.value){(a=window.$message)==null||a.warning("请填写拒绝原因");return}u.refuse=m.value;const{data:s,error:t}=await $(u);!t&&s&&(s.code===0?((d=window.$message)==null||d.success("拒绝成功"),v.value=!1,_(1)):(f=window.$message)==null||f.error((s==null?void 0:s.msg)||"拒绝失败"))},W=async(s,t)=>{var f;u.consent=s,u.id=t;const{data:a,error:d}=await $(u);!d&&a&&a.code===0&&((f=window.$message)==null||f.success("添加成功")),_(1)};function j(){return[{key:"email",dataIndex:"email",title:"好友账号",width:100},{key:"nickName",dataIndex:"nickName",title:"对方昵称",width:60},{key:"reasons",dataIndex:"reasons",title:"申请备注",width:200},{key:"status",dataIndex:"status",title:"申请状态",align:"center",width:50,customRender:({record:t})=>{const a=V.find(d=>d.value===t.status);return(a==null?void 0:a.value)===10?e(S,{placement:"top",title:e("span",null,[t.refuseReason||""])},{default:()=>[e(q,{color:a==null?void 0:a.color},{default:()=>[a==null?void 0:a.label]})]}):e(q,{color:a==null?void 0:a.color},{default:()=>[a==null?void 0:a.label]})}},{key:"createTime",dataIndex:"createTime",title:"申请时间",width:100},{key:"operate",title:"操作",align:"center",width:100,fixed:"right",customRender:({record:t})=>t.status===10||t.status===1?"":t.havState?e("div",{class:"flex-center gap-4px"},[G(t),J(t)]):""}]}function G(s){return!k.hasOne(M.Friend.Request.CREATE)||!g.userInfo.isTenant?"":e(fe,{placement:"left",title:"确定添加对方为好友吗?","ok-text":"确定","cancel-text":"取消",onConfirm:()=>W(1,s.id)},{default:()=>[e(S,{placement:"top",title:"通过"},{default:()=>[e(T,{size:"small",type:"link"},{default:()=>[e(U,{icon:"covid:social-distancing-correct-5"},null)]})]})]})}function J(s){return!k.hasOne(M.Friend.Request.UPDATE)||!g.userInfo.isTenant?"":e(S,{placement:"top",title:"拒绝"},{default:()=>[e(T,{size:"small",type:"link",onClick:()=>p(0,s.id)},{default:()=>[e(U,{icon:"ic:baseline-disabled-by-default"},null)]})]})}return(s,t)=>{const a=Y,d=pe,f=be,Q=z,X=se;return O(),ne("div",Ce,[e(Ae,{model:o(b),"onUpdate:model":t[0]||(t[0]=r=>P(b)?b.value=r:null),"user-info":o(g).userInfo,onReset:o(B),onSearch:t[1]||(t[1]=r=>o(_)(1))},null,8,["model","user-info","onReset"]),e(f,{title:"申请列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"device-card flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:n(()=>[e(a,{columns:o(w),"onUpdate:columns":t[2]||(t[2]=r=>P(w)?w.value=r:null),"disabled-delete":o(R).length===0,loading:o(c)},null,8,["columns","disabled-delete","loading"])]),default:n(()=>[e(d,{ref_key:"tableWrapperRef",ref:i,"expanded-row-keys":y.expandedRowKeys,"onUpdate:expandedRowKeys":t[3]||(t[3]=r=>y.expandedRowKeys=r),columns:o(C),"data-source":o(I),size:"small","row-selection":o(F),scroll:o(h),loading:o(c),"row-key":"id",pagination:o(x),class:"h-full"},null,8,["expanded-row-keys","columns","data-source","row-selection","scroll","loading","pagination"])]),_:1}),e(X,{visible:v.value,"onUpdate:visible":t[5]||(t[5]=r=>v.value=r),title:"请输入拒绝原因","ok-text":"确认","cancel-text":"取消",onOk:H},{default:n(()=>[e(Q,{value:m.value,"onUpdate:value":t[4]||(t[4]=r=>m.value=r),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["visible"])])}}}),We=L(Ie,[["__scopeId","data-v-fc77e9f9"]]);export{We as default};
