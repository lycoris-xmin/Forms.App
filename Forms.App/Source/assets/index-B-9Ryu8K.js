import{_ as te}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as ae,a as oe,b as ne,T as le,u as se,c as re,d as ie,e as ue,f as de}from"./table-search-filter-oeJAv4cw.js";import{aP as G,m as S,d as V,D as H,E as K,c as J,o as L,w as o,f as e,e as v,B as E,s as me,a as z,r as ce,F as pe,g as M,b as fe,h as n,a8 as j,a9 as q,ai as _e}from"./index-C4fDvJn1.js";import{u as ye,A as F}from"./app.permissions-eEP3QY97.js";import{u as Q,F as X,_ as Y,I as Z,a as ge,d as ve}from"./form-C4lsPmD3.js";import{_ as be}from"./index-Bgjt1Cd5.js";import{S as we}from"./index-DjcmxpZa.js";import{_ as he}from"./index-BbA-ww4S.js";import{_ as De}from"./index-B0OEq9ON.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as xe}from"./index-CfF1NG6B.js";import{T as Re}from"./index-Cd0TkKik.js";import{E as Ae}from"./EditOutlined-CFKuvutP.js";import{D as Ce}from"./DeleteOutlined-vV5-dJ7B.js";import"./index-BSgdO99v.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";function Pe(t){const{pageIndex:m,pageSize:i}=t,y={pageIndex:m,pageSize:i};return t.name&&(y.name=t.name),S({url:"/api/categoryrepeatpurchase/list",params:{...y}})}function Te(t){return S({url:"/api/categoryrepeatpurchase",method:"post",data:{name:t.name,keyword:t.keyword,limitDays:t.limitDays}})}function Fe(t){const{id:m}=t,i={id:m};return t.name&&(i.name=t.name),t.keyword&&(i.keyword=t.keyword),t.limitDays=Number.parseInt(t.limitDays,10),Number.isNaN(t.limitDays)||(i.limitDays=t.limitDays),Object.keys(i).length===1?G():S({url:"/api/categoryrepeatpurchase",method:"put",data:{...i}})}function W(t){return!t||!t.length?G():S({url:"/api/categoryrepeatpurchase",method:"delete",params:{ids:t}})}const Ee={class:"flex-1"},Se={class:"w-full flex-y-center justify-end gap-12px"},Be=V({name:"CategoryRepeatPurchaseListSearch",__name:"search-filter",props:{model:{required:!0},modelModifiers:{}},emits:H(["reset","search"],["update:model"]),setup(t,{emit:m}){const{formRef:i,validate:y,resetFields:x}=Q(),u=K(t,"model"),p=m;async function f(){await x(),p("reset")}async function h(){await y(),p("search")}return(R,c)=>{const l=Z,D=Y,g=be,A=oe,b=E,C=ne,d=ae,a=X;return L(),J(le,null,{default:o(()=>[e(a,{ref_key:"formRef",ref:i,name:"filer",model:u.value,"label-col":{span:5,md:7}},{default:o(()=>[e(d,{gutter:[16,16],wrap:""},{default:o(()=>[e(g,{span:24,md:12,lg:6},{default:o(()=>[e(D,{label:"类目",name:"name",class:"m-0"},{default:o(()=>[e(l,{value:u.value.name,"onUpdate:value":c[0]||(c[0]=w=>u.value.name=w),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),v("div",Ee,[e(D,{class:"m-0"},{default:o(()=>[v("div",Se,[e(b,{onClick:f},{icon:o(()=>[e(A,{class:"align-sub text-icon"})]),default:o(()=>[c[1]||(c[1]=v("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(b,{type:"primary",ghost:"",onClick:h},{icon:o(()=>[e(C,{class:"align-sub text-icon"})]),default:o(()=>[c[2]||(c[2]=v("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ie={class:"body"},Oe=V({name:"SystemUserOperateDrawer",__name:"operate-drawer",props:H({operateType:{default:"add"},rowData:{default:null}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(t,{emit:m}){const{formRef:i,validate:y,resetFields:x}=Q(),u=K(t,"visible"),p=me({submit:!1}),f=t,h=m,R=z(()=>({add:"新增类目复购配置",edit:"编辑类目复购配置"})[f.operateType]),c=z(()=>f.operateType==="edit"),l=ce(g()),D=z(()=>{const{defaultRequiredRule:d}=ge();return{keyword:d,limitDays:d}});pe(u,()=>{u.value&&(A(),x())});function g(){return{keyword:"",limitDays:30}}function A(){if(l.value=g(),c.value&&f.rowData){Object.assign(l.value,f.rowData),l.value.keyword="";for(const d of f.rowData.keyword)l.value.keyword+=`${d}
`}}function b(){u.value=!1}async function C(){var d;await y(),p.submit=!0;try{const{data:a,error:w}=c.value?await Fe({...l.value}):await Te({...l.value});!w&&a&&a.code===0&&((d=window.$message)==null||d.success("保存成功"),b(),h("submitted"))}finally{p.submit=!1}}return(d,a)=>{const w=Z,P=Y,B=he,I=ve,O=X,T=E,U=we,N=De;return L(),J(N,{open:u.value,"onUpdate:open":a[3]||(a[3]=s=>u.value=s),title:R.value,width:500},{footer:o(()=>[e(U,{size:16},{default:o(()=>[e(T,{onClick:b},{default:o(()=>a[6]||(a[6]=[M("取消")])),_:1}),e(T,{type:"primary",loading:p.submit,onClick:C},{default:o(()=>a[7]||(a[7]=[M("保存")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[v("div",Ie,[e(O,{ref_key:"formRef",ref:i,name:"operate",layout:"vertical",model:l.value,rules:D.value},{default:o(()=>[e(P,{label:"类目名称",name:"name"},{default:o(()=>[e(w,{value:l.value.name,"onUpdate:value":a[0]||(a[0]=s=>l.value.name=s),autocomplete:"off",placeholder:"请输入类目名称"},null,8,["value"])]),_:1}),e(P,{label:"复购限制天数",name:"limitDays"},{default:o(()=>[e(B,{value:l.value.limitDays,"onUpdate:value":a[1]||(a[1]=s=>l.value.limitDays=s),controls:!1,min:1,step:1},{addonAfter:o(()=>a[4]||(a[4]=[v("span",null,"天",-1)])),_:1},8,["value"])]),_:1}),e(P,{name:"keyword"},{label:o(()=>a[5]||(a[5]=[v("p",null,[M(" 类目关键词 "),v("small",{class:"p-l-8px"},"*如果有多个关键词请每行一个")],-1)])),default:o(()=>[e(I,{value:l.value.keyword,"onUpdate:value":a[2]||(a[2]=s=>l.value.keyword=s),placeholder:"请输入类目关键词","auto-size":{minRows:6}},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["open","title"])}}}),Ue=ke(Oe,[["__scopeId","data-v-f67c9e75"]]),Ne={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function $e(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!_e(t)}const st=V({name:"platform_categoryrepeat",__name:"index",setup(t){const m=ye(),{tableWrapperRef:i,scrollConfig:y}=se(),{columns:x,columnChecks:u,data:p,getData:f,getDataByPage:h,loading:R,mobilePagination:c,searchParams:l,resetSearchParams:D}=re({apiFn:Pe,apiParams:{pageIndex:1,pageSize:10},columns:T}),{drawerVisible:g,operateType:A,editingData:b,handleAdd:C,handleEdit:d,checkedRowKeys:a,rowSelection:w,onBatchDeleted:P,onDeleted:B}=ie(p,f);async function I(){const s=a.value;if(s&&s.length){const{data:r,error:_}=await W(s);!_&&r&&r.code===0&&P()}}async function O(s){const{data:r,error:_}=await W([s]);!_&&r&&r.code===0&&B()}function T(){return[{key:"name",dataIndex:"name",title:"类目名称",width:200},{key:"keyword",dataIndex:"keyword",title:"关键词",customRender:({record:r})=>e("div",{class:"v-center wrap flex gap-4px"},[r.keyword.map((_,$)=>e(Re,{bordered:!1,color:"processing",key:$},$e(_)?_:{default:()=>[_]}))])},{key:"limitDays",dataIndex:"limitDays",title:"复购限制(天)",width:150},{key:"operate",title:"操作",align:"center",width:130,customRender:({record:r})=>e("div",{class:"flex-center gap-4px"},[U(r),N(r)])}]}function U(s){return m.hasOne(F.Platform.CategoryRepeatPurchase.UPDATE)?e(q,{placement:"top",title:"编辑"},{default:()=>[e(E,{size:"small",type:"link",onClick:()=>d(s.id)},{default:()=>[e(Ae,null,null)]})]}):""}function N(s){return m.hasOne(F.Platform.CategoryRepeatPurchase.DELETE)?e(de,{title:"确认删除吗？",onConfirm:()=>O(s.id)},{default:()=>[e(q,{placement:"top",title:"删除"},{default:()=>[e(E,{danger:!0,size:"small",type:"link"},{default:()=>[e(Ce,null,null)]})]})]}):""}return(s,r)=>{const _=te,$=ue,ee=xe;return L(),fe("div",Ne,[e(Be,{model:n(l),"onUpdate:model":r[0]||(r[0]=k=>j(l)?l.value=k:null),onReset:n(D),onSearch:r[1]||(r[1]=k=>n(h)(1))},null,8,["model","onReset"]),e(ee,{title:"复购关键词列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:o(()=>[e(_,{columns:n(u),"onUpdate:columns":r[2]||(r[2]=k=>j(u)?u.value=k:null),"disabled-delete":n(a).length===0,loading:n(R),"add-btn":n(m).hasOne(n(F).Platform.CategoryRepeatPurchase.CREATE),"delete-btn":n(m).hasOne(n(F).Platform.CategoryRepeatPurchase.DELETE),onAdd:n(C),onDelete:I},null,8,["columns","disabled-delete","loading","add-btn","delete-btn","onAdd"])]),default:o(()=>[e($,{ref_key:"tableWrapperRef",ref:i,columns:n(x),"data-source":n(p),size:"small","row-selection":n(w),scroll:n(y),loading:n(R),"row-key":"id",pagination:n(c),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(Ue,{visible:n(g),"onUpdate:visible":r[3]||(r[3]=k=>j(g)?g.value=k:null),"operate-type":n(A),"row-data":n(b),onSubmitted:n(h)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{st as default};
