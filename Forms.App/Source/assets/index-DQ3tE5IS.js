import{_ as Fe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as De,S as ce,g as me,a as Pe,b as Oe,T as Le,u as Re,c as He,d as Ke,e as ze,f as Ve}from"./table-search-filter-oeJAv4cw.js";import{d as ae,D as q,E as fe,c as I,o as v,w as l,f as e,z as te,e as p,B as W,s as _e,a as je,r as Ge,F as qe,aa as ve,b as $,h as i,H as X,P as Y,g as k,t as Z,q as We,i as Je,a8 as ee,a9 as se}from"./index-C4fDvJn1.js";import{u as Qe,A as G}from"./app.permissions-eEP3QY97.js";import{P as Xe,S as Ye,U as Ze,C as et,p as ue,D as ie,G as tt}from"./enum-map-product-CMyz06oT.js";import{I as re,i as de}from"./empty-a1btfWut.js";import{u as ge,F as ke,_ as he,I as we,a as at,c as lt}from"./form-C4lsPmD3.js";import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{_ as nt}from"./index.vue_vue_type_script_setup_true_lang-DSCZeeAS.js";import{_ as ot}from"./index-Bgjt1Cd5.js";import{T as st,_ as ut,P as it,C as ye}from"./index-CfF1NG6B.js";import{_ as rt}from"./index-KSR7zqBo.js";import{R as dt}from"./RetweetOutlined-BZ1EcIpA.js";import{L as pt,_ as ct}from"./index-Q7LyDRqH.js";import{E as be}from"./EditOutlined-CFKuvutP.js";import{D as Ie}from"./DeleteOutlined-vV5-dJ7B.js";import{_ as mt}from"./index-BbA-ww4S.js";import{S as ft}from"./index-DjcmxpZa.js";import{T as Se}from"./index-Cd0TkKik.js";import{_ as _t}from"./index-B0OEq9ON.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as vt}from"./enums-Cr_YM2zq.js";import"./index-BSgdO99v.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";import"./index-DcD6wSoE.js";const gt={class:"flex-1"},kt={class:"w-full flex-y-center justify-end gap-12px"},ht=ae({name:"ALIProductListSearch",__name:"search-filter",props:q({userInfo:{},productType:{},shopNameEnum:{}},{model:{required:!0},modelModifiers:{}}),emits:q(["reset","search"],["update:model"]),setup(T,{emit:S}){const{formRef:x,validate:E,resetFields:B}=ge(),m=fe(T,"model"),g=T,y=S;async function f(){await B(),y("reset")}async function A(){await E(),y("search")}return(F,t)=>{const C=we,h=he,w=ot,D=me,K=ce,P=Pe,N=W,M=Oe,O=De,L=ke;return v(),I(Le,null,{default:l(()=>[e(L,{ref_key:"formRef",ref:x,model:m.value,"label-col":{span:5,md:7}},{default:l(()=>[e(O,{gutter:[16,16],wrap:""},{default:l(()=>[e(w,{span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"商品编号",name:"itemId",class:"m-0"},{default:l(()=>[e(C,{value:m.value.itemId,"onUpdate:value":t[0]||(t[0]=_=>m.value.itemId=_),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e(w,{span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"商品名称",name:"title",class:"m-0"},{default:l(()=>[e(C,{value:m.value.title,"onUpdate:value":t[1]||(t[1]=_=>m.value.title=_),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e(w,{span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"所属店铺",name:"shopId",class:"m-0"},{default:l(()=>[e(nt,{value:m.value.shopId,"onUpdate:value":t[2]||(t[2]=_=>m.value.shopId=_),platform:1,"allow-clear":!0,"show-search":!0,options:g.shopNameEnum},null,8,["value","options"])]),_:1})]),_:1}),te("",!0),g.userInfo.isTenant?g.userInfo.isTenantUser?te("",!0):(v(),I(w,{key:2,span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"创建员工",name:"userId",class:"m-0"},{default:l(()=>[e(pe,{value:m.value.userId,"onUpdate:value":t[5]||(t[5]=_=>m.value.userId=_),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})]),_:1})):(v(),I(w,{key:1,span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"所属商户",name:"userId",class:"m-0"},{default:l(()=>[e(pe,{value:m.value.userId,"onUpdate:value":t[4]||(t[4]=_=>m.value.userId=_),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),p("div",gt,[e(h,{class:"m-0"},{default:l(()=>[p("div",kt,[e(N,{onClick:f},{icon:l(()=>[e(P,{class:"align-sub text-icon"})]),default:l(()=>[t[6]||(t[6]=p("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(N,{type:"primary",ghost:"",onClick:A},{icon:l(()=>[e(M,{class:"align-sub text-icon"})]),default:l(()=>[t[7]||(t[7]=p("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}});const wt={class:"upload"},yt=["src"],bt={key:1},It={class:"v-center center flex gap-8px"},St={class:"sku-panel"},xt={class:"v-center space-between top text-right"},At={class:"wrap flex gap-6px"},Ct={class:"v-center center flex"},Ut={class:"cny"},Tt={class:"v-center center action flex"},Nt={class:"v-center space-between flex"},Mt={class:"sku-item"},$t={class:"v-center end flex gap-8px"},Et=ae({name:"ALIProductOperateDrawer",__name:"operate-drawer",props:q({operateType:{},rowData:{},productType:{},shopNameEnum:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["refreshShopNameEnum","submitted"],["update:visible"]),setup(T,{emit:S}){const{formRef:x,validate:E,resetFields:B}=ge(),{defaultRequiredRule:m}=at(),g=fe(T,"visible"),y=_e({submit:!1}),f=T,A=S,F=je(()=>({add:"新增商品",edit:"编辑商品"})[f.operateType]),t=Ge(h()),C={itemId:m,shopId:m,title:m};qe(g,()=>{g.value&&(A("refreshShopNameEnum"),w(),B())});function h(){return{id:"",type:0,itemId:"",url:"",shopId:"",title:"",image:"",skuMap:[],tab:"base",fileList:[],imagePriview:""}}function w(){t.value=h(),f.operateType==="edit"&&f.rowData&&(Object.assign(t.value,f.rowData),t.value.image="",f.rowData.image&&(t.value.imagePriview=window.$isDebugger?`${ve}${f.rowData.image}`:f.rowData.image),t.value.skuMap.forEach(o=>o.value=o.sku.join(",")))}function D(){g.value=!1}function K(){if(!t.value.url){t.value.itemId="",t.value.shopId="";return}try{const o=decodeURIComponent(t.value.url),s=new URL(o).pathname.split("/").filter(Boolean),u=s.findIndex(c=>c.includes("html")||c.includes("htm")),n=s[u].split(".");n&&n.length?t.value.itemId=n[0]:t.value.itemId=""}catch{t.value.itemId=""}}function P(){t.value.skuMap.push({sku:[""],price:"",edit:!0,add:!0})}function N(o){var a;if(t.value.skuMap[o].sku.filter(s=>!s).length){(a=window.$message)==null||a.warning("存在未填写的SKU，请先填写");return}t.value.skuMap[o].sku.push("")}function M(o,a){o.sku.splice(a,1)}function O(o){var a;(a=window.$modal)==null||a.confirm({title:"提示",cancelText:"取消",okText:"确定",content:"确定要取消编辑吗？",onOk(){t.value.skuMap[o].add?t.value.skuMap.splice(o,1):t.value.skuMap[o].edit=!1}})}function L(o){var a,s,u;if(t.value.skuMap[o].sku.filter(Boolean).length===0){(a=window.$message)==null||a.warning("请填写正确的SKU信息");return}if(!t.value.skuMap[o].price){(s=window.$message)==null||s.warning("请填写正确的价格信息");return}if(t.value.skuMap[o].price=Number.parseFloat(t.value.skuMap[o].price),Number.isNaN(t.value.skuMap[o].price)||t.value.skuMap[o].price<=0){(u=window.$message)==null||u.warning("请填写正确的价格信息");return}t.value.skuMap[o].value=t.value.skuMap[o].sku.join(","),t.value.skuMap[o].edit=!1,delete t.value.skuMap[o].add}function _(o){var a;(a=window.$modal)==null||a.confirm({title:"警告",cancelText:"取消",okText:"确定",content:"确定要删除吗？",onOk(){t.value.skuMap.splice(o,1)}})}function R(){t.value.fileList&&t.value.fileList.length&&(t.value.image=t.value.fileList[0].originFileObj,t.value.imagePriview=URL.createObjectURL(t.value.image),t.value.fileList=[])}function z(o,a){return f.shopNameEnum.filter(s=>s.text.includes(o)).filter(s=>s.value===a.value).length>0}function J(){A("refreshShopNameEnum",!0)}async function Q(){var o;if(await E(),f.operateType!=="edit"&&t.value.skuMap.length===0){(o=window.$modal)==null||o.confirm({title:"提示",cancelText:"取消",okText:"确定",content:"您还未添加商品SKU信息，确定该商品没有SKU直接提交吗？",async onOk(){await V()},onCancel(){t.value.tab!=="sku"&&(t.value.tab="sku")}});return}await V()}async function V(){var o,a,s;y.submit=!0;try{const u={...t.value};if(u.skuMap=t.value.skuMap.map(d=>({sku:d.value.split(",").filter(Boolean),price:Number.parseFloat(d.price)})),u.skuMap.filter(d=>Number.isNaN(d.price)||d.price<=0).length){(o=window.$message)==null||o.warning("SKU价格必须大为0"),t.value.tab!=="sku"&&(t.value.tab="sku");return}const n=u.skuMap.map(d=>JSON.stringify(d.sku));if([...new Set(n)].length!==n.length){(a=window.$message)==null||a.warning("存在重复的SKU组合，请核对"),t.value.tab!=="sku"&&(t.value.tab="sku");return}const{data:c,error:U}=f.operateType==="edit"?await Ze(u):await et(u);!U&&c&&c.code===0&&((s=window.$message)==null||s.success("保存成功"),D(),A("submitted"))}finally{y.submit=!1}}return(o,a)=>{const s=me,u=ce,n=he,c=rt,U=we,d=W,Ae=ke,le=ut,Ce=Se,ne=ye,Ue=lt,Te=mt,Ne=ct,Me=pt,$e=st,Ee=ft,Be=_t;return v(),I(Be,{open:g.value,"onUpdate:open":a[6]||(a[6]=r=>g.value=r),title:F.value,width:650},{footer:l(()=>[e(Ee,{size:16},{default:l(()=>[e(d,{onClick:D},{default:l(()=>a[17]||(a[17]=[k("取消")])),_:1}),e(d,{type:"primary",loading:y.submit,onClick:Q},{default:l(()=>a[18]||(a[18]=[k("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[e($e,{"active-key":t.value.tab,"onUpdate:activeKey":a[5]||(a[5]=r=>t.value.tab=r)},{default:l(()=>[e(le,{key:"base"},{tab:l(()=>[p("span",null,[e(i(Xe)),a[7]||(a[7]=k(" 基础信息 "))])]),default:l(()=>[e(Ae,{ref_key:"formRef",ref:x,layout:"vertical",model:t.value,rules:C},{default:l(()=>[te("",!0),e(n,{name:"image"},{default:l(()=>[p("div",wt,[e(c,{"file-list":t.value.fileList,"onUpdate:fileList":a[1]||(a[1]=r=>t.value.fileList=r),accept:"image/jpeg,image/png,image/webp",name:"image","list-type":"picture-card",class:"uploader","show-upload-list":!1,"before-upload":()=>!1,onChange:R},{default:l(()=>[t.value.imagePriview?(v(),$("img",{key:0,src:t.value.imagePriview,alt:"商品主图"},null,8,yt)):(v(),$("div",bt,[e(i(it)),a[8]||(a[8]=p("div",{class:"ant-upload-text"},"上传",-1))]))]),_:1},8,["file-list"]),a[9]||(a[9]=p("p",null,"商品主图",-1))])]),_:1}),e(n,{label:"商品链接",name:"url"},{default:l(()=>[e(U,{value:t.value.url,"onUpdate:value":a[2]||(a[2]=r=>t.value.url=r),placeholder:"请输入商品链接",onBlur:K},null,8,["value"])]),_:1}),e(n,{label:"商品标题",name:"title"},{default:l(()=>[e(U,{value:t.value.title,"onUpdate:value":a[3]||(a[3]=r=>t.value.title=r),placeholder:"请输入商品标题"},null,8,["value"])]),_:1}),e(n,{label:"所属店铺",name:"shopId"},{default:l(()=>[p("div",It,[e(u,{value:t.value.shopId,"onUpdate:value":a[4]||(a[4]=r=>t.value.shopId=r),"show-search":"","filter-option":z},{default:l(()=>[(v(!0),$(X,null,Y(f.shopNameEnum,r=>(v(),I(s,{key:r.value,value:r.value},{default:l(()=>[k(Z(r.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),e(d,{class:"v-center flex",onClick:J},{default:l(()=>[e(i(dt))]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1}),e(le,{key:"sku"},{tab:l(()=>[p("span",null,[e(i(Ye)),a[10]||(a[10]=k(" SKU组合 "))])]),default:l(()=>[p("div",St,[p("div",xt,[e(d,{size:"small",type:"primary",ghost:"",onClick:P},{default:l(()=>a[11]||(a[11]=[k("添加SKU组合")])),_:1})]),e(Me,{size:"small","data-source":t.value.skuMap},{renderItem:l(({item:r,index:H})=>[e(Ne,null,{default:l(()=>[r.edit?(v(),I(ne,{key:1,class:"edit pt-6px"},{title:l(()=>[p("div",Nt,[a[13]||(a[13]=p("p",null,"SKU编辑",-1)),e(d,{size:"small",type:"primary",ghost:"",onClick:b=>N(H)},{default:l(()=>a[12]||(a[12]=[k("添加SKU")])),_:2},1032,["onClick"])])]),default:l(()=>[p("div",Mt,[(v(!0),$(X,null,Y(r.sku,(b,j)=>(v(),I(n,{key:j},{default:l(()=>[e(Ue,{compact:"",class:"flex gap-0px"},{default:l(()=>[e(U,{value:r.sku[j],"onUpdate:value":oe=>r.sku[j]=oe,placeholder:"请输入SKU"},null,8,["value","onUpdate:value"]),e(d,{danger:"",onClick:oe=>M(r,j)},{default:l(()=>a[14]||(a[14]=[k("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(n,null,{default:l(()=>[e(Te,{value:r.price,"onUpdate:value":b=>r.price=b,prefix:"￥",min:0,"string-mode":"",controls:!1,precision:2},null,8,["value","onUpdate:value"])]),_:2},1024)]),p("div",$t,[e(d,{size:"small",onClick:b=>O(H)},{default:l(()=>a[15]||(a[15]=[k("取消")])),_:2},1032,["onClick"]),e(d,{size:"small",type:"primary",ghost:"",onClick:b=>L(H)},{default:l(()=>a[16]||(a[16]=[k("确定")])),_:2},1032,["onClick"])])]),_:2},1024)):(v(),I(ne,{key:0,class:"sku-view",title:`SKU组合 ${H+1}`},{default:l(()=>[p("div",null,[p("div",At,[(v(!0),$(X,null,Y(r.sku,b=>(v(),I(Ce,{key:b,class:"center v-center flex",color:"processing"},{default:l(()=>[k(Z(b),1)]),_:2},1024))),128))]),p("div",Ct,[p("span",Ut,Z(r.price),1)]),p("div",Tt,[e(d,{class:"v-center flex",size:"small",type:"link",onClick:()=>r.edit=!0},{default:l(()=>[e(i(be))]),_:2},1032,["onClick"]),e(d,{class:"v-center flex",danger:"",size:"small",type:"link",onClick:b=>_(H)},{default:l(()=>[e(i(Ie))]),_:2},1032,["onClick"])])])]),_:2},1032,["title"]))]),_:2},1024)]),_:1},8,["data-source"])])]),_:1})]),_:1},8,["active-key"])]),_:1},8,["open","title"])}}}),Bt=xe(Et,[["__scopeId","data-v-a4b0cf34"]]),Ft={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Dt=ae({name:"alibaba_product",__name:"index",setup(T){const S=We(),x=Qe(),{tableWrapperRef:E,scrollConfig:B}=Re(),{columns:m,columnChecks:g,data:y,getData:f,getDataByPage:A,loading:F,mobilePagination:t,searchParams:C,resetSearchParams:h}=He({apiFn:s=>tt({...s}),apiParams:{pageIndex:1,pageSize:10},columns:V}),{drawerVisible:w,operateType:D,editingData:K,handleAdd:P,handleEdit:N,checkedRowKeys:M,rowSelection:O,onBatchDeleted:L,onDeleted:_}=Ke(y,f),R=_e({shopNameEnum:[]});Je(()=>{z()});async function z(s=!1){var u;try{const{data:n,error:c}=await vt();!c&&n&&n.code===0&&(R.shopNameEnum=n.data.list,s&&((u=window.$message)==null||u.success("刷新列表成功")))}catch{}}async function J(){const s=M.value;if(s&&s.length){const{data:u,error:n}=await ie(s);!n&&u&&u.code===0&&L()}}async function Q(s){var u;(u=window.$modal)==null||u.confirm({title:"提示",cancelText:"取消",okText:"确定",content:"为避免查看任务时找不到对应商品，系统将只会删除未发布过任务的商品！",async onOk(){const{data:n,error:c}=await ie([s]);!c&&n&&n.code===0&&_()}})}function V(){const s=[{key:"image",dataIndex:"image",title:"商品主图",width:100,customRender({record:n}){return n.image.startsWith("http")?e("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[e(re,{width:64,height:64,src:n.image,fallback:de},null)]):e("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[e(re,{width:64,height:64,src:window.$isDebugger?`${ve}${n.image}`:n.image,fallback:de},null)])}},{key:"title",dataIndex:"title",title:"商品名称",width:400,customRender({record:n}){function c(){return n.id||n.productCode||n.itemId?e("p",null,[k("商品编号："),n.itemId]):""}return n.url?e("div",{class:"product-title"},[e("a",{href:n.url,target:"_blank"},[n.title]),c()]):e("div",{class:"product-title"},[e("a",null,[n.title]),c()])}},{key:"shopName",dataIndex:"shopName",title:"店铺名称",width:250,ellipsis:!0,customRender({record:n}){return e("span",{class:"shop-name"},[n.shopName])}},{key:"skuMap",dataIndex:"skuMap",title:"SKU组合数",align:"center",width:130,customRender({record:n}){return e(Se,null,{default:()=>{var c;return[((c=n.skuMap)==null?void 0:c.length)||0,k("个组合")]}})}}];(!S.userInfo.isTenant||!S.userInfo.isTenantUser)&&s.push({key:"createUser",dataIndex:"createUser",title:S.userInfo.isTenant?"添加员工":"所属商户",align:"center",width:130});const u=[{key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200},{key:"operate",title:"操作",align:"center",width:100,customRender:({record:n})=>e("div",{class:"flex-center gap-4px"},[o(n),a(n)])}];return s.concat(u)}function o(s){return x.hasOne(G.Ali1688.Product.UPDATE)?e(se,{placement:"top",title:"编辑"},{default:()=>[e(W,{size:"small",type:"link",disabled:s.syncStatus===1,onClick:()=>N(s.id)},{default:()=>[e(be,null,null)]})]}):""}function a(s){return x.hasOne(G.Ali1688.Product.DELETE)?e(Ve,{title:"确认删除吗？",onConfirm:()=>Q(s.id)},{default:()=>[e(se,{placement:"top",title:"删除"},{default:()=>[e(W,{danger:!0,size:"small",type:"link"},{default:()=>[e(Ie,null,null)]})]})]}):""}return(s,u)=>{const n=Fe,c=ze,U=ye;return v(),$("div",Ft,[e(ht,{model:i(C),"onUpdate:model":u[0]||(u[0]=d=>ee(C)?C.value=d:null),"user-info":i(S).userInfo,"product-type":i(ue),"shop-name-enum":R.shopNameEnum,onReset:i(h),onSearch:u[1]||(u[1]=d=>i(A)(1))},null,8,["model","user-info","product-type","shop-name-enum","onReset"]),e(U,{title:"商品列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[e(n,{columns:i(g),"onUpdate:columns":u[2]||(u[2]=d=>ee(g)?g.value=d:null),"disabled-delete":i(M).length===0,loading:i(F),"add-btn":i(x).hasOne(i(G).Ali1688.Product.CREATE),"delete-btn":i(x).hasOne(i(G).Ali1688.Product.DELETE),onAdd:i(P),onDelete:J},null,8,["columns","disabled-delete","loading","add-btn","delete-btn","onAdd"])]),default:l(()=>[e(c,{ref_key:"tableWrapperRef",ref:E,columns:i(m),"data-source":i(y),size:"small","row-selection":i(O),scroll:i(B),loading:i(F),"row-key":"id",pagination:i(t),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(Bt,{visible:i(w),"onUpdate:visible":u[3]||(u[3]=d=>ee(w)?w.value=d:null),"operate-type":i(D),"row-data":i(K),"product-type":i(ue),"shop-name-enum":R.shopNameEnum,onRefreshShopNameEnum:u[4]||(u[4]=d=>z(d)),onSubmitted:i(A)},null,8,["visible","operate-type","row-data","product-type","shop-name-enum","onSubmitted"])]),_:1})])}}}),ma=xe(Dt,[["__scopeId","data-v-7d079718"]]);export{ma as default};
