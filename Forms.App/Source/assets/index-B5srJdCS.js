import{m as P,aP as G,d as k,q as U,s as $,i as S,b as v,o as m,f as n,w as p,B as F,g as N,a as E,dx as M,r as I,dy as W,aa as j,e as u,c as g,z as R,h as Q,ab as J,C as h,T as K}from"./index-C4fDvJn1.js";import{u as L,F as B,_ as D,I as T,a as X}from"./form-C4lsPmD3.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{L as O}from"./index-EP99CXY3.js";import{P as q,C as V}from"./index-CfF1NG6B.js";import{S as Y}from"./index-COUQcoAB.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";function Z(y){const{nickName:s,email:t,wechat:a}=y,o={nickName:s,email:t};return a&&(o.wechat=a),P({url:"/api/userprofile",method:"put",data:o})}function ee(y){const{oldPassword:s,password:t}=y;return P({url:"/api/userprofile/changepassword",method:"put",data:{oldPassword:s,password:t}})}function te(){return P({url:"/api/userprofile/settlement",method:"get"})}function ae(y){const{alipayAccount:s,alipayQRCode:t,wechatPayQRCode:a}=y;if(!s&&!a)return G();const o=new FormData;return s&&o.append("alipayAccount",s),t&&o.append("alipayQRCode",t),a&&o.append("wechatPayQRCode",a),P({url:"/api/userprofile/settlement",method:"post",data:o,headers:{"Content-Type":t||a?"multipart/form-data":"application/x-www-form-urlencoded"}})}function oe(){return P({url:"/api/userprofile/subscription"})}const ne={class:"profile"},se=k({name:"UserCenterProfile",__name:"profile",setup(y){const s=U(),{formRef:t,validate:a}=L(),o=$({email:"",nickName:"",wechat:""}),l={nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]};S(()=>{o.nickName=s.userInfo.nickName,o.email=s.userInfo.email,o.wechat=s.userInfo.wechat});const e=async()=>{var f;await a();const{data:i,error:r}=Z({...o});!r&&i&&i.code===0&&((f=window.$message)==null||f.success("保存成功"))};return(i,r)=>{const f=T,w=D,C=B,c=F;return m(),v("div",ne,[n(C,{ref_key:"formRef",ref:t,model:o,rules:l,layout:"vertical"},{default:p(()=>[n(w,{label:"登录邮箱"},{default:p(()=>[n(f,{value:o.email,"onUpdate:value":r[0]||(r[0]=d=>o.email=d),disabled:""},null,8,["value"])]),_:1}),n(w,{label:"用户昵称",name:"nickName"},{default:p(()=>[n(f,{value:o.nickName,"onUpdate:value":r[1]||(r[1]=d=>o.nickName=d)},null,8,["value"])]),_:1}),n(w,{label:"联系微信",name:"wechat"},{default:p(()=>[n(f,{value:o.wechat,"onUpdate:value":r[2]||(r[2]=d=>o.wechat=d)},null,8,["value"])]),_:1})]),_:1},8,["model"]),n(c,{type:"primary",onClick:e},{default:p(()=>r[3]||(r[3]=[N("保存")])),_:1})])}}}),le=A(se,[["__scopeId","data-v-53f3e2dc"]]),ie={class:"pwd"},re=k({name:"UserCenterPassword",__name:"password",setup(y){const{formRef:s,validate:t}=L(),a=$({oldPassword:"",password:"",confirmPassword:""}),o=E(()=>{const{formRules:e,createConfirmPwdRule:i}=X();return{oldPassword:e.pwd,password:e.pwd,confirmPassword:i(a.password)}}),l=async()=>{var r;await t();const{data:e,error:i}=await ee({...a});!i&&e&&e.code===0&&((r=window.$message)==null||r.success("修改成功"))};return(e,i)=>{const r=T,f=D,w=B,C=F;return m(),v("div",ie,[n(w,{ref_key:"formRef",ref:s,model:a,rules:o.value,layout:"vertical"},{default:p(()=>[n(f,{label:"原密码",name:"oldPassword","validate-first":!0},{default:p(()=>[n(r,{value:a.oldPassword,"onUpdate:value":i[0]||(i[0]=c=>a.oldPassword=c),type:"password"},null,8,["value"])]),_:1}),n(f,{label:"新密码",name:"password","validate-first":!0},{default:p(()=>[n(r,{value:a.password,"onUpdate:value":i[1]||(i[1]=c=>a.password=c),type:"password"},null,8,["value"])]),_:1}),n(f,{label:"新密码",name:"confirmPassword","validate-first":!0},{default:p(()=>[n(r,{value:a.confirmPassword,"onUpdate:value":i[2]||(i[2]=c=>a.confirmPassword=c),type:"password"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"]),n(C,{type:"primary",onClick:l},{default:p(()=>i[3]||(i[3]=[N("保存")])),_:1})])}}}),ce=A(re,[["__scopeId","data-v-1d2ba430"]]),de=M(W.Settlement,()=>{let y=!1;const s=I(""),t=I(""),a=I("");async function o(e=!1){if(y&&!e)return;const{data:i,error:r}=await te();!r&&i&&i.code===0&&(l(i.data),y=!0)}function l(e){s.value=e.alipayAccount||"",t.value=e.alipayQRCode||"",a.value=e.wechatPayQRCode||"",y=!1}return{alipayAccount:s,alipayQRCode:t,wechatPayQRCode:a,initSettlement:o,setSettlement:l}}),ue={class:"body"},pe={class:"settlement"},me={class:"grid"},fe=["src"],ye=["src"],ve=k({name:"UserCenterAlipay",__name:"settlement",setup(y){const s=U(),t=de(),a=I(null),{formRef:o,validate:l}=L(),e=$({alipayAccount:"",alipayImage:void 0,alipayQRCode:"",wechatPayQRCode:"",wechatPayImage:void 0,type:"alipay",loading:!0,btnLoading:!1}),i={alipayAccount:[{required:!0,message:"支付宝账号不能为空",trigger:"blur"}]};S(async()=>{await r()});async function r(c=!1){try{await t.initSettlement(c),e.alipayAccount=t.alipayAccount,t.alipayQRCode&&(window.$isDebugger?e.alipayQRCode=`${j}/nocache${t.alipayQRCode}`:e.alipayQRCode=`/nocache${t.alipayQRCode}`),t.wechatPayQRCode&&(window.$isDebugger?e.wechatPayQRCode=`${j}/nocache${t.wechatPayQRCode}`:e.wechatPayQRCode=`/nocache${t.wechatPayQRCode}`)}finally{e.loading=!1}}const f=c=>{e.type=c,a.value.click()},w=c=>{c.target.files&&c.target.files.length&&(e.type==="alipay"?(e.alipayImage=c.target.files[0],e.alipayQRCode=URL.createObjectURL(e.alipayImage)):(e.wechatPayImage=c.target.files[0],e.wechatPayQRCode=URL.createObjectURL(e.wechatPayImage)),c.target.value="")},C=async()=>{var c;await l(),e.btnLoading=!0;try{const d={alipayAccount:e.alipayAccount,alipayQRCode:e.alipayImage,wechatPayQRCode:e.wechatPayImage},{data:_,error:x}=await ae(d);!x&&_&&_.code===0&&(await r(!0),(c=window.$message)==null||c.success("保存成功"),e.alipayImage=void 0,e.wechatPayImage=void 0,s.userInfo.isSettlement=!0)}finally{e.btnLoading=!1}};return(c,d)=>{const _=D,x=T,H=B,z=F;return m(),v("div",ue,[u("div",pe,[u("input",{ref_key:"uploadRef",ref:a,type:"file",accept:"image/jpeg,image/png",class:"upload",onChange:w},null,544),u("div",me,[n(H,{ref_key:"formRef",ref:o,model:e,rules:i,layout:"vertical"},{default:p(()=>[n(_,{label:"支付宝收款码"},{default:p(()=>[e.alipayQRCode?(m(),v("div",{key:0,class:"view",onClick:d[0]||(d[0]=b=>f("alipay"))},[u("img",{src:e.alipayQRCode},null,8,fe)])):(m(),v("div",{key:1,class:"view center v-center flex",onClick:d[1]||(d[1]=b=>f("alipay"))},[n(Q(q),{class:"icon"})]))]),_:1}),n(_,{label:"支付宝账号",name:"alipayAccount"},{default:p(()=>[n(x,{value:e.alipayAccount,"onUpdate:value":d[2]||(d[2]=b=>e.alipayAccount=b),placeholder:"请输入支付宝账号"},null,8,["value"])]),_:1})]),_:1},8,["model"]),n(H,{layout:"vertical"},{default:p(()=>[n(_,{label:"微信收款码"},{default:p(()=>[e.wechatPayQRCode?(m(),v("div",{key:0,class:"view",onClick:d[3]||(d[3]=b=>f("wechatPay"))},[u("img",{src:e.wechatPayQRCode},null,8,ye)])):(m(),v("div",{key:1,class:"view center v-center flex",onClick:d[4]||(d[4]=b=>f("wechatPay"))},[n(Q(q),{class:"icon"})]))]),_:1})]),_:1})]),n(z,{type:"primary",loading:e.btnLoading,onClick:C},{default:p(()=>d[5]||(d[5]=[N("保存")])),_:1},8,["loading"])]),e.loading?(m(),g(O,{key:0,loading:e.loading,"bg-color":"#fff"},null,8,["loading"])):R("",!0)])}}}),we=A(ve,[["__scopeId","data-v-bd3d82d1"]]),_e={class:"subscription"},ge=k({__name:"sub-scription ",setup(y){const s=$({unUseDays:0,totalDays:0,loading:!0});S(async()=>{setTimeout(async()=>{try{await t()}finally{s.loading=!1}},500)});async function t(){const{data:a,error:o}=await oe();!o&&a&&a.code===0&&J(()=>{Object.assign(s,a.data)})}return(a,o)=>{const l=Y,e=V;return m(),v("div",{class:h(["body",{show:!s.loading}])},[u("div",_e,[n(e,null,{default:p(()=>[n(l,{title:"未使用",value:s.unUseDays,suffix:"天"},null,8,["value"])]),_:1}),n(e,null,{default:p(()=>[n(l,{title:"累计总使用",value:s.totalDays,suffix:"天"},null,8,["value"])]),_:1})]),s.loading?(m(),g(O,{key:0,loading:s.loading,"bg-color":"#fff"},null,8,["loading"])):R("",!0)],2)}}}),Ce=A(ge,[["__scopeId","data-v-9463a9b2"]]),be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},he={class:"card-body"},Re={class:"menu-group"},Pe={key:0,class:"menu-group"},ke={key:1,class:"menu-group"},$e={class:"card-container"},Ae=k({name:"user-center",__name:"index",setup(y){const s=U(),t=$({name:["profile","pwd","settlement","subscription"],active:"profile"}),a=o=>{t.active!==o&&(t.active=o,location.href=`${location.origin}${location.pathname}#${o}`)};return S(()=>{if(location.hash){const o=location.hash.replace("#","");t.name.includes(o)&&a(o)}}),(o,l)=>{const e=V;return m(),v("div",be,[n(e,{title:"个人中心",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{default:p(()=>[u("div",he,[u("div",null,[u("div",Re,[l[4]||(l[4]=u("p",{class:"title"},"基础信息",-1)),u("ul",null,[u("li",{class:h({active:t.active==="profile"}),onClick:l[0]||(l[0]=i=>a("profile"))},"个人信息",2),u("li",{class:h({active:t.active==="pwd"}),onClick:l[1]||(l[1]=i=>a("pwd"))},"修改密码",2)])]),Q(s).userInfo.isTenant?(m(),v("div",Pe,[l[5]||(l[5]=u("p",{class:"title"},"使用数",-1)),u("ul",null,[u("li",{class:h({active:t.active==="subscription"}),onClick:l[2]||(l[2]=i=>a("subscription"))}," 使用数列表 ",2)])])):R("",!0),Q(s).userInfo.isTenant?(m(),v("div",ke,[l[6]||(l[6]=u("p",{class:"title"},"结算设置",-1)),u("ul",null,[u("li",{class:h({active:t.active==="settlement"}),onClick:l[3]||(l[3]=i=>a("settlement"))}," 差价结算 ",2)])])):R("",!0)]),u("div",$e,[n(K,{name:"tab-view",mode:"out-in"},{default:p(()=>[t.active==="profile"?(m(),g(le,{key:0})):t.active==="pwd"?(m(),g(ce,{key:1})):t.active==="settlement"?(m(),g(we,{key:2})):t.active==="subscription"?(m(),g(Ce,{key:3})):R("",!0)]),_:1})])])]),_:1})])}}}),He=A(Ae,[["__scopeId","data-v-7e38dc36"]]);export{He as default};
