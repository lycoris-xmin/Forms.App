import{_ as Be}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{_ as Fe,S as ce,g as me,a as Pe,b as Oe,T as Re,u as Le,c as He,d as Ke,e as ze,f as Ve}from"./table-search-filter-DgS7ifzw.js";import{d as ae,D as q,E as fe,c as y,o as f,w as l,f as e,z as te,e as p,B as W,s as _e,a as je,r as Ye,F as qe,aa as ve,b as M,h as i,H as Q,P as X,g as k,t as Z,q as We,i as Ge,a8 as ee,a9 as se}from"./index-CZVtSjPQ.js";import{u as Je,A as Y}from"./app.permissions-B_pV7apU.js";import{P as Qe,S as Xe,f as Ze,a as et,p as ue,b as ie,c as tt}from"./enum-map-product-_U1bkNb8.js";import{I as re,i as de}from"./empty-DqSXm535.js";import{u as ge,F as ke,_ as he,I as we,a as at,c as lt}from"./form-ZxLsforZ.js";import{_ as nt}from"./index.vue_vue_type_script_setup_true_lang-pVOlQRHe.js";import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-DfKPtv9S.js";import{_ as ot}from"./index-DOEbmRvB.js";import{T as st,_ as ut,P as it,C as ye}from"./index-ClUX1lZP.js";import{R as rt}from"./RetweetOutlined-BcZHN5eo.js";import{L as dt,_ as pt}from"./index-C3lI4CWL.js";import{E as be}from"./EditOutlined-S8fzz_Is.js";import{D as Se}from"./DeleteOutlined-CShsKEiR.js";import{S as ct}from"./index-BWb-9rJv.js";import{T as xe}from"./index-DMMLrYUn.js";import{_ as mt}from"./index-CENDnRYG.js";import{_ as ft}from"./index-CMROBQfz.js";import{_ as _t}from"./index-BVBn8Dpq.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{k as vt}from"./enums-XBoEbamp.js";import"./index-CQCXu6T9.js";import"./EyeOutlined-B3DWie8W.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";import"./responsiveObserve-CdtC9r70.js";import"./debounce-BsWDECm-.js";import"./isSymbol-DgABtkrl.js";import"./index-CblUf4ME.js";const gt={class:"flex-1"},kt={class:"w-full flex-y-center justify-end gap-12px"},ht=ae({name:"TaobaoProductListSearch",__name:"search-filter",props:q({userInfo:{},productType:{},shopNameEnum:{}},{model:{required:!0},modelModifiers:{}}),emits:q(["reset","search"],["update:model"]),setup(U,{emit:x}){const{formRef:I,validate:D,resetFields:E}=ge(),c=fe(U,"model"),g=U,b=x;async function _(){await E(),b("reset")}async function T(){await D(),b("search")}return(B,t)=>{const C=we,h=he,w=ot,F=me,K=ce,P=Pe,$=W,N=Oe,O=Fe,R=ke;return f(),y(Re,null,{default:l(()=>[e(R,{ref_key:"formRef",ref:I,model:c.value,"label-col":{span:5,md:7}},{default:l(()=>[e(O,{gutter:[16,16],wrap:""},{default:l(()=>[e(w,{span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"商品编号",name:"itemId",class:"m-0"},{default:l(()=>[e(C,{value:c.value.itemId,"onUpdate:value":t[0]||(t[0]=v=>c.value.itemId=v),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e(w,{span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"商品名称",name:"title",class:"m-0"},{default:l(()=>[e(C,{value:c.value.title,"onUpdate:value":t[1]||(t[1]=v=>c.value.title=v),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e(w,{span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"所属店铺",name:"shopId",class:"m-0"},{default:l(()=>[g.userInfo.isTenant?(f(),y(pe,{key:0,value:c.value.shopId,"onUpdate:value":t[2]||(t[2]=v=>c.value.shopId=v),platform:2,"allow-clear":!0,"show-search":!0,options:g.shopNameEnum},null,8,["value","options"])):(f(),y(pe,{key:1,value:c.value.shopId,"onUpdate:value":t[3]||(t[3]=v=>c.value.shopId=v),platform:2,remote:!0,"allow-clear":!0,"show-search":!0},null,8,["value"]))]),_:1})]),_:1}),te("",!0),g.userInfo.isTenant?te("",!0):(f(),y(w,{key:1,span:24,md:12,lg:6},{default:l(()=>[e(h,{label:"所属商户",name:"userId",class:"m-0"},{default:l(()=>[e(nt,{value:c.value.userId,"onUpdate:value":t[5]||(t[5]=v=>c.value.userId=v),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),p("div",gt,[e(h,{class:"m-0"},{default:l(()=>[p("div",kt,[e($,{onClick:_},{icon:l(()=>[e(P,{class:"align-sub text-icon"})]),default:l(()=>[t[6]||(t[6]=p("span",{class:"ml-8px"},"重置",-1))]),_:1}),e($,{type:"primary",ghost:"",onClick:T},{icon:l(()=>[e(N,{class:"align-sub text-icon"})]),default:l(()=>[t[7]||(t[7]=p("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}});const wt={class:"upload"},yt=["src"],bt={key:1},St={class:"v-center center flex gap-8px"},xt={class:"sku-panel"},It={class:"v-center space-between top text-right"},Tt={class:"wrap flex gap-6px"},Ct={class:"v-center center flex"},At={class:"cny"},Ut={class:"v-center center action flex"},$t={class:"v-center space-between flex"},Nt={class:"sku-item"},Mt={class:"v-center end flex gap-8px"},Dt=ae({name:"TaobaoProductOperateDrawer",__name:"operate-drawer",props:q({operateType:{},rowData:{},productType:{},shopNameEnum:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["refreshShopNameEnum","submitted"],["update:visible"]),setup(U,{emit:x}){const{formRef:I,validate:D,resetFields:E}=ge(),{defaultRequiredRule:c}=at(),g=fe(U,"visible"),b=_e({submit:!1}),_=U,T=x,B=je(()=>({add:"新增商品",edit:"编辑商品"})[_.operateType]),t=Ye(h()),C={itemId:c,shopId:c,title:c};qe(g,()=>{g.value&&(T("refreshShopNameEnum"),w(),E())});function h(){return{id:"",type:0,itemId:"",url:"",shopId:"",title:"",image:"",skuMap:[],tab:"base",fileList:[],imagePriview:""}}function w(){t.value=h(),_.operateType==="edit"&&_.rowData&&(Object.assign(t.value,_.rowData),t.value.image="",_.rowData.image&&(t.value.imagePriview=window.$isDebugger?`${ve}${_.rowData.image}`:_.rowData.image),t.value.skuMap.forEach(n=>n.value=n.sku.join(",")))}function F(){g.value=!1}function K(){if(!t.value.url)return;const n=new URL(t.value.url);t.value.itemId=n.searchParams.get("id")||"",t.value.url=`${n.protocol}//${n.host}${n.pathname}?id=${t.value.itemId}`}function P(){t.value.skuMap.push({sku:[""],price:"",edit:!0,add:!0})}function $(n){var a;if(t.value.skuMap[n].sku.filter(s=>!s).length){(a=window.$message)==null||a.warning("存在未填写的SKU，请先填写");return}t.value.skuMap[n].sku.push("")}function N(n,a){n.sku.splice(a,1)}function O(n){var a;(a=window.$modal)==null||a.confirm({title:"提示",cancelText:"取消",okText:"确定",content:"确定要取消编辑吗？",onOk(){t.value.skuMap[n].add?t.value.skuMap.splice(n,1):t.value.skuMap[n].edit=!1}})}function R(n){var a,s,u;if(t.value.skuMap[n].sku.filter(Boolean).length===0){(a=window.$message)==null||a.warning("请填写正确的SKU信息");return}if(!t.value.skuMap[n].price){(s=window.$message)==null||s.warning("请填写正确的价格信息");return}if(t.value.skuMap[n].price=Number.parseFloat(t.value.skuMap[n].price),Number.isNaN(t.value.skuMap[n].price)||t.value.skuMap[n].price<=0){(u=window.$message)==null||u.warning("请填写正确的价格信息");return}t.value.skuMap[n].value=t.value.skuMap[n].sku.join(","),t.value.skuMap[n].edit=!1,delete t.value.skuMap[n].add}function v(n){var a;(a=window.$modal)==null||a.confirm({title:"警告",cancelText:"取消",okText:"确定",content:"确定要删除吗？",onOk(){t.value.skuMap.splice(n,1)}})}function L(){t.value.fileList&&t.value.fileList.length&&(t.value.image=t.value.fileList[0].originFileObj,t.value.imagePriview=URL.createObjectURL(t.value.image),t.value.fileList=[])}function z(n,a){return _.shopNameEnum.filter(s=>s.text.includes(n)).filter(s=>s.value===a.value).length>0}function G(){T("refreshShopNameEnum",!0)}async function J(){var n;if(await D(),_.operateType!=="edit"&&t.value.skuMap.length===0){(n=window.$modal)==null||n.confirm({title:"提示",cancelText:"取消",okText:"确定",content:"您还未添加商品SKU信息，确定该商品没有SKU直接提交吗？",async onOk(){await V()},onCancel(){t.value.tab!=="sku"&&(t.value.tab="sku")}});return}await V()}async function V(){var n,a,s;b.submit=!0;try{const u={...t.value};if(u.skuMap=t.value.skuMap.map(d=>({sku:d.value.split(",").filter(Boolean),price:Number.parseFloat(d.price)})),u.skuMap.filter(d=>Number.isNaN(d.price)||d.price<=0).length){(n=window.$message)==null||n.warning("SKU价格必须大为0"),t.value.tab!=="sku"&&(t.value.tab="sku");return}const o=u.skuMap.map(d=>JSON.stringify(d.sku));if([...new Set(o)].length!==o.length){(a=window.$message)==null||a.warning("存在重复的SKU组合，请核对"),t.value.tab!=="sku"&&(t.value.tab="sku");return}const{data:m,error:A}=_.operateType==="edit"?await Ze(u):await et(u);!A&&m&&m.code===0&&((s=window.$message)==null||s.success("保存成功"),F(),T("submitted"))}finally{b.submit=!1}}return(n,a)=>{const s=me,u=ce,o=he,m=mt,A=we,d=W,Te=ke,le=ut,Ce=xe,ne=ye,Ae=lt,Ue=ft,$e=pt,Ne=dt,Me=st,De=ct,Ee=_t;return f(),y(Ee,{open:g.value,"onUpdate:open":a[6]||(a[6]=r=>g.value=r),title:B.value,width:650},{footer:l(()=>[e(De,{size:16},{default:l(()=>[e(d,{onClick:F},{default:l(()=>a[17]||(a[17]=[k("取消")])),_:1}),e(d,{type:"primary",loading:b.submit,onClick:J},{default:l(()=>a[18]||(a[18]=[k("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[e(Me,{"active-key":t.value.tab,"onUpdate:activeKey":a[5]||(a[5]=r=>t.value.tab=r)},{default:l(()=>[e(le,{key:"base"},{tab:l(()=>[p("span",null,[e(i(Qe)),a[7]||(a[7]=k(" 基础信息 "))])]),default:l(()=>[e(Te,{ref_key:"formRef",ref:I,layout:"vertical",model:t.value,rules:C},{default:l(()=>[te("",!0),e(o,{name:"image"},{default:l(()=>[p("div",wt,[e(m,{"file-list":t.value.fileList,"onUpdate:fileList":a[1]||(a[1]=r=>t.value.fileList=r),accept:"image/jpeg,image/png,image/webp",name:"image","list-type":"picture-card",class:"uploader","show-upload-list":!1,"before-upload":()=>!1,onChange:L},{default:l(()=>[t.value.imagePriview?(f(),M("img",{key:0,src:t.value.imagePriview,alt:"商品主图"},null,8,yt)):(f(),M("div",bt,[e(i(it)),a[8]||(a[8]=p("div",{class:"ant-upload-text"},"上传",-1))]))]),_:1},8,["file-list"]),a[9]||(a[9]=p("p",null,"商品主图",-1))])]),_:1}),e(o,{label:"商品链接",name:"url"},{default:l(()=>[e(A,{value:t.value.url,"onUpdate:value":a[2]||(a[2]=r=>t.value.url=r),placeholder:"请输入商品链接",onBlur:K},null,8,["value"])]),_:1}),e(o,{label:"商品标题",name:"title"},{default:l(()=>[e(A,{value:t.value.title,"onUpdate:value":a[3]||(a[3]=r=>t.value.title=r),placeholder:"请输入商品标题"},null,8,["value"])]),_:1}),e(o,{label:"所属店铺",name:"shopId"},{default:l(()=>[p("div",St,[e(u,{value:t.value.shopId,"onUpdate:value":a[4]||(a[4]=r=>t.value.shopId=r),"show-search":"","filter-option":z},{default:l(()=>[(f(!0),M(Q,null,X(_.shopNameEnum,r=>(f(),y(s,{key:r.value,value:r.value},{default:l(()=>[k(Z(r.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),e(d,{class:"v-center flex",onClick:G},{default:l(()=>[e(i(rt))]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1}),e(le,{key:"sku"},{tab:l(()=>[p("span",null,[e(i(Xe)),a[10]||(a[10]=k(" SKU组合 "))])]),default:l(()=>[p("div",xt,[p("div",It,[e(d,{size:"small",type:"primary",ghost:"",onClick:P},{default:l(()=>a[11]||(a[11]=[k("添加SKU组合")])),_:1})]),e(Ne,{size:"small","data-source":t.value.skuMap},{renderItem:l(({item:r,index:H})=>[e($e,null,{default:l(()=>[r.edit?(f(),y(ne,{key:1,class:"edit pt-6px"},{title:l(()=>[p("div",$t,[a[13]||(a[13]=p("p",null,"SKU编辑",-1)),e(d,{size:"small",type:"primary",ghost:"",onClick:S=>$(H)},{default:l(()=>a[12]||(a[12]=[k("添加SKU")])),_:2},1032,["onClick"])])]),default:l(()=>[p("div",Nt,[(f(!0),M(Q,null,X(r.sku,(S,j)=>(f(),y(o,{key:j},{default:l(()=>[e(Ae,{compact:"",class:"flex gap-0px"},{default:l(()=>[e(A,{value:r.sku[j],"onUpdate:value":oe=>r.sku[j]=oe,placeholder:"请输入SKU"},null,8,["value","onUpdate:value"]),e(d,{danger:"",onClick:oe=>N(r,j)},{default:l(()=>a[14]||(a[14]=[k("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(o,null,{default:l(()=>[e(Ue,{value:r.price,"onUpdate:value":S=>r.price=S,prefix:"￥",min:0,"string-mode":"",controls:!1,precision:2},null,8,["value","onUpdate:value"])]),_:2},1024)]),p("div",Mt,[e(d,{size:"small",onClick:S=>O(H)},{default:l(()=>a[15]||(a[15]=[k("取消")])),_:2},1032,["onClick"]),e(d,{size:"small",type:"primary",ghost:"",onClick:S=>R(H)},{default:l(()=>a[16]||(a[16]=[k("确定")])),_:2},1032,["onClick"])])]),_:2},1024)):(f(),y(ne,{key:0,class:"sku-view",title:`SKU组合 ${H+1}`},{default:l(()=>[p("div",null,[p("div",Tt,[(f(!0),M(Q,null,X(r.sku,S=>(f(),y(Ce,{key:S,class:"center v-center flex",color:"processing"},{default:l(()=>[k(Z(S),1)]),_:2},1024))),128))]),p("div",Ct,[p("span",At,Z(r.price),1)]),p("div",Ut,[e(d,{class:"v-center flex",size:"small",type:"link",onClick:()=>r.edit=!0},{default:l(()=>[e(i(be))]),_:2},1032,["onClick"]),e(d,{class:"v-center flex",danger:"",size:"small",type:"link",onClick:S=>v(H)},{default:l(()=>[e(i(Se))]),_:2},1032,["onClick"])])])]),_:2},1032,["title"]))]),_:2},1024)]),_:1},8,["data-source"])])]),_:1})]),_:1},8,["active-key"])]),_:1},8,["open","title"])}}}),Et=Ie(Dt,[["__scopeId","data-v-cfeeed18"]]),Bt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ft=ae({name:"douyin_product",__name:"index",setup(U){const x=We(),I=Je(),{tableWrapperRef:D,scrollConfig:E}=Le(),{columns:c,columnChecks:g,data:b,getData:_,getDataByPage:T,loading:B,mobilePagination:t,searchParams:C,resetSearchParams:h}=He({apiFn:s=>tt({...s}),apiParams:{pageIndex:1,pageSize:10},columns:V}),{drawerVisible:w,operateType:F,editingData:K,handleAdd:P,handleEdit:$,checkedRowKeys:N,rowSelection:O,onBatchDeleted:R,onDeleted:v}=Ke(b,_),L=_e({shopNameEnum:[]});Ge(()=>{z()});async function z(s=!1){var u;try{const{data:o,error:m}=await vt();!m&&o&&o.code===0&&(L.shopNameEnum=o.data.list,s&&((u=window.$message)==null||u.success("刷新列表成功")))}catch{}}async function G(){const s=N.value;if(s&&s.length){const{data:u,error:o}=await ie(s);!o&&u&&u.code===0&&R()}}async function J(s){var u;(u=window.$modal)==null||u.confirm({title:"提示",cancelText:"取消",okText:"确定",content:"为避免查看任务时找不到对应商品，系统将只会删除未发布过任务的商品！",async onOk(){const{data:o,error:m}=await ie([s]);!m&&o&&o.code===0&&v()}})}function V(){const s=[{key:"image",dataIndex:"image",title:"商品主图",width:100,customRender({record:o}){return o.image.startsWith("http")?e("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[e(re,{width:64,height:64,src:o.image,fallback:de},null)]):e("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[e(re,{width:64,height:64,src:window.$isDebugger?`${ve}${o.image}`:o.image,fallback:de},null)])}},{key:"title",dataIndex:"title",title:"商品名称",width:400,customRender({record:o}){function m(){return o.itemId?e("p",null,[k("商品编号："),o.itemId]):""}return o.url?e("div",{class:"product-title"},[e("a",{href:o.url,target:"_blank"},[o.title]),m()]):e("div",{class:"product-title"},[e("a",null,[o.title]),m()])}},{key:"shopName",dataIndex:"shopName",title:"店铺名称",width:250,ellipsis:!0,customRender({record:o}){return o.shopName}},{key:"skuMap",dataIndex:"skuMap",title:"SKU组合数",align:"center",width:130,customRender({record:o}){return e(xe,null,{default:()=>{var m;return[((m=o.skuMap)==null?void 0:m.length)||0,k("个组合")]}})}}];(!x.userInfo.isTenant||!x.userInfo.isTenantUser)&&s.push({key:"createUser",dataIndex:"createUser",title:x.userInfo.isTenant?"添加员工":"所属商户",align:"center",width:130});const u=[{key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200},{key:"operate",title:"操作",align:"center",width:100,customRender:({record:o})=>e("div",{class:"flex-center gap-4px"},[n(o),a(o)])}];return s.concat(u)}function n(s){return I.hasOne(Y.DY.Product.UPDATE)?e(se,{placement:"top",title:"编辑"},{default:()=>[e(W,{size:"small",type:"link",disabled:s.syncStatus===1,onClick:()=>$(s.id)},{default:()=>[e(be,null,null)]})]}):""}function a(s){return I.hasOne(Y.DY.Product.DELETE)?e(Ve,{title:"确认删除吗？",onConfirm:()=>J(s.id)},{default:()=>[e(se,{placement:"top",title:"删除"},{default:()=>[e(W,{danger:!0,size:"small",type:"link"},{default:()=>[e(Se,null,null)]})]})]}):""}return(s,u)=>{const o=Be,m=ze,A=ye;return f(),M("div",Bt,[e(ht,{model:i(C),"onUpdate:model":u[0]||(u[0]=d=>ee(C)?C.value=d:null),"user-info":i(x).userInfo,"product-type":i(ue),"shop-name-enum":L.shopNameEnum,onReset:i(h),onSearch:u[1]||(u[1]=d=>i(T)(1))},null,8,["model","user-info","product-type","shop-name-enum","onReset"]),e(A,{title:"商品列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[e(o,{columns:i(g),"onUpdate:columns":u[2]||(u[2]=d=>ee(g)?g.value=d:null),"disabled-delete":i(N).length===0,loading:i(B),"add-btn":i(I).hasOne(i(Y).DY.Product.CREATE),"delete-btn":i(I).hasOne(i(Y).DY.Product.DELETE),onAdd:i(P),onDelete:G},null,8,["columns","disabled-delete","loading","add-btn","delete-btn","onAdd"])]),default:l(()=>[e(m,{ref_key:"tableWrapperRef",ref:D,columns:i(c),"data-source":i(b),size:"small","row-selection":i(O),scroll:i(E),loading:i(B),"row-key":"id",pagination:i(t),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(Et,{visible:i(w),"onUpdate:visible":u[3]||(u[3]=d=>ee(w)?w.value=d:null),"operate-type":i(F),"row-data":i(K),"product-type":i(ue),"shop-name-enum":L.shopNameEnum,onRefreshShopNameEnum:u[4]||(u[4]=d=>z(d)),onSubmitted:i(T)},null,8,["visible","operate-type","row-data","product-type","shop-name-enum","onSubmitted"])]),_:1})])}}}),ma=Ie(Ft,[["__scopeId","data-v-4b794cd3"]]);export{ma as default};
