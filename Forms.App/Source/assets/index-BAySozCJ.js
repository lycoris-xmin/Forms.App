import{_ as ae}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{_ as q}from"./cny-Bw4WYv4c.js";import{_ as te,S as ne,F as le,g as oe,a as se,b as re,T as ue,u as ie,c as me,d as de,e as pe,G as ce,H as fe,I as _e}from"./table-search-filter-DgS7ifzw.js";import{m as X,aP as ye,d as Z,D as W,E as ve,s as ee,i as ge,c as k,o as f,w as a,f as e,z as P,e as S,b as C,H as G,P as V,g,t as j,h as o,a7 as z,B as Y,q as he,a as be,a8 as K,aA as ke,a9 as Ie}from"./index-CZVtSjPQ.js";import{u as Te,A as J}from"./app.permissions-B_pV7apU.js";import{p as Q}from"./index-DiqUFypO.js";import{u as xe,F as we,_ as Ae,I as Se}from"./form-ZxLsforZ.js";import{_ as Ne}from"./index.vue_vue_type_script_setup_true_lang-pVOlQRHe.js";import{U as Pe}from"./UserOutlined-Cd3yZI2R.js";import{s as Re}from"./enums-XBoEbamp.js";import{_ as Le}from"./index-DOEbmRvB.js";import{R as Ce}from"./dayjs-AyO5q5yK.js";import{T as De}from"./Text-B_F8cy3U.js";import{C as Ue}from"./index-ClUX1lZP.js";import{T as $}from"./index-DMMLrYUn.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CQCXu6T9.js";import"./EyeOutlined-B3DWie8W.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";import"./responsiveObserve-CdtC9r70.js";import"./debounce-BsWDECm-.js";import"./isSymbol-DgABtkrl.js";import"./EditOutlined-S8fzz_Is.js";function Fe(s){const{pageIndex:h,pageSize:T}=s,_={pageIndex:h,pageSize:T};return Number.isNaN(Number.parseInt(s.platform,10))||(_.platform=s.platform),s.alipayLovePayId&&(_.alipayLovePayId=s.alipayLovePayId),s.shopName&&(_.shopName=s.shopName),s.userId&&(_.userId=s.userId),s.beginTime&&(_.beginTime=s.beginTime),s.endTime&&(_.endTime=s.endTime),Number.isNaN(Number.parseInt(s.settlemented,10))||(_.settlemented=s.settlemented===1),X({url:"/api/alipay/lovepay/record/entSettle/list",params:{..._}})}function Be(s){return s.length?X({url:"/api/alipay/lovepay/record/entSettle/settlement",method:"put",data:{ids:s}}):ye()}const Ee={class:"flex-1"},He={class:"w-full flex-y-center justify-end gap-12px"},Me=Z({name:"ReportAlipayLovePayRecordListSearch",__name:"search-filter",props:W({platform:{},userInfo:{}},{model:{required:!0},modelModifiers:{}}),emits:W(["reset","search"],["update:model"]),setup(s,{emit:h}){const{formRef:T,validate:_,resetFields:D}=xe(),u=ve(s,"model"),x=ee({alipayLovePay:[]}),v=s,w=h;ge(()=>{U()});async function U(){const{data:m,error:n}=await Re();!n&&m&&m.code===0&&(x.alipayLovePay=m.data.list)}async function A(){await D(),w("reset")}async function R(){await _(),w("search")}function O(m,n){u.value.beginTime=n[0],u.value.endTime=n[1]}const L=m=>m&&m>=z().endOf("day");function F(m,n){if(!n||!n.options||!n.options.length)return!1;for(const I of n.options){if(x.alipayLovePay.filter(y=>y.filter(r=>r.text.includes(m)||r.data.includes(m)).length>0).length)return!0;const p=I.children();if(p&&p.length){for(const y of p)if(y.children.toLowerCase().includes(m))return!0}}return!1}return(m,n)=>{const I=ne,p=Ae,y=Le,r=oe,l=le,t=Se,i=Ce,b=se,N=Y,B=re,E=te,H=we;return f(),k(ue,null,{default:a(()=>[e(H,{ref_key:"formRef",ref:T,name:"filer",model:u.value,"label-col":{span:5,md:7}},{default:a(()=>[e(E,{gutter:[16,16],wrap:""},{default:a(()=>[e(y,{span:24,md:12,lg:6},{default:a(()=>[e(p,{label:"支付平台",name:"platform",class:"m-0"},{default:a(()=>[e(I,{value:u.value.platform,"onUpdate:value":n[0]||(n[0]=d=>u.value.platform=d),placeholder:"- 全部 -",options:v.platform,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),v.userInfo.isTenant?(f(),k(y,{key:0,span:24,md:12,lg:6},{default:a(()=>[e(p,{label:"亲情卡",name:"alipayLovePayId",class:"m-0"},{default:a(()=>[v.userInfo.isTenant&&!v.userInfo.isTenantUser?(f(),k(I,{key:0,value:u.value.alipayLovePayId,"onUpdate:value":n[1]||(n[1]=d=>u.value.alipayLovePayId=d),"show-search":"","option-filter-prop":"children","filter-option":F,placeholder:"- 全部 -","allow-clear":""},{default:a(()=>[(f(!0),C(G,null,V(x.alipayLovePay,(d,M)=>(f(),k(l,{key:M},{label:a(()=>[S("span",null,[e(o(Pe)),g(" "+j(d[0].data),1)])]),default:a(()=>[(f(!0),C(G,null,V(d,c=>(f(),k(r,{key:c.value,value:c.value},{default:a(()=>[g(j(c.text),1)]),_:2},1032,["value"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])):P("",!0)]),_:1})]),_:1})):P("",!0),v.userInfo.isTenant?P("",!0):(f(),k(y,{key:1,span:24,md:12,lg:6},{default:a(()=>[e(p,{label:"所属商户",name:"userId",class:"m-0"},{default:a(()=>[e(Ne,{value:u.value.userId,"onUpdate:value":n[2]||(n[2]=d=>u.value.userId=d),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),v.userInfo.isTenant&&!v.userInfo.isTenantUser?(f(),k(y,{key:2,span:24,md:12,lg:6},{default:a(()=>[e(p,{label:"店铺名称",name:"shopName",class:"m-0"},{default:a(()=>[e(t,{value:u.value.shopName,"onUpdate:value":n[3]||(n[3]=d=>u.value.shopName=d),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1})):P("",!0),e(y,{span:24,md:12,lg:6},{default:a(()=>[e(p,{label:"创建时间",name:"createTimeRange",class:"m-0"},{default:a(()=>[e(i,{value:u.value.createTimeRange,"onUpdate:value":n[4]||(n[4]=d=>u.value.createTimeRange=d),"show-time":{hideDisabledOptions:!0,defaultValue:[o(z)("00:00:00","HH:mm:ss"),o(z)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],"disabled-date":L,onChange:O},null,8,["value","show-time"])]),_:1})]),_:1}),e(y,{span:24,md:12,lg:6},{default:a(()=>[e(p,{label:"结算状态",name:"settlemented",class:"m-0"},{default:a(()=>[e(I,{value:u.value.settlemented,"onUpdate:value":n[5]||(n[5]=d=>u.value.settlemented=d),placeholder:"- 全部 -","allow-clear":""},{default:a(()=>[e(r,{value:1},{default:a(()=>n[6]||(n[6]=[g("已结算")])),_:1}),e(r,{value:0},{default:a(()=>n[7]||(n[7]=[g("未结算")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),S("div",Ee,[e(p,{class:"m-0"},{default:a(()=>[S("div",He,[e(N,{onClick:A},{icon:a(()=>[e(b,{class:"align-sub text-icon"})]),default:a(()=>[n[8]||(n[8]=S("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(N,{type:"primary",ghost:"",onClick:R},{icon:a(()=>[e(B,{class:"align-sub text-icon"})]),default:a(()=>[n[9]||(n[9]=S("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},$e=Z({name:"report_alipaylovepayentsettle",__name:"index",setup(s){const h=he(),T=Te(),{tableWrapperRef:_,scrollConfig:D}=ie(),u=ee({}),{columns:x,columnChecks:v,searchParams:w,resetSearchParams:U,data:A,getData:R,getDataByPage:O,loading:L,mobilePagination:F}=me({apiFn:async(...r)=>{const l=await Fe(...r);return Object.assign(u,l.data.data.summary),l},apiParams:{pageIndex:1,pageSize:10},columns:I}),{checkedRowKeys:m,rowSelection:n}=de(A,R);function I(){const r=[{key:"alipayName",dataIndex:"alipayName",title:"亲情卡",align:"center",customRender:({record:t})=>t.alipayAccount?e("span",null,[t.alipayAccount,g("("),t.alipayName,g(")")]):e("span",null,[t.alipayName])},{key:"platform",dataIndex:"platform",title:"支付平台",align:"center",width:100,customRender:({record:t})=>{let i=Q.filter(b=>b.value===t.platform);return i=i.length?i[0]:{label:"未知",value:t.platform,color:""},e($,{color:i.color},{default:()=>[i.label]})}},{key:"planTaskId",dataIndex:"planTaskId",title:"任务编号",align:"center"},{key:"orderId",dataIndex:"orderId",title:"支付订单号",align:"center"},{key:"amount",dataIndex:"amount",title:"支付金额",align:"center",customRender:({record:t})=>e("span",{style:{color:t.amount>0?"#52c41a":"#ff4d4f"}},[t.amount])},{key:"priceDiff",dataIndex:"priceDiff",title:"差价",align:"center",customRender:({record:t})=>e("span",{style:{color:t.priceDiff>0?"#52c41a":"#ff4d4f"}},[t.priceDiff])}];h.userInfo.isTenant&&r.push({key:"usedUserName",dataIndex:"usedUserName",title:"使用人",align:"center"},{key:"shopName",dataIndex:"shopName",title:"店铺",align:"center"}),h.userInfo.isTenant||r.push({key:"tenantName",dataIndex:"tenantName",title:"所属商户",align:"center"});const l=[{key:"settlemented",dataIndex:"settlemented",title:"结算状态",align:"center",width:100,customRender:({record:t})=>t.settlemented?e($,{color:"success"},{default:()=>[g("已结算")]}):e($,{color:"error"},{default:()=>[g("未结算")]})},{key:"createTime",dataIndex:"createTime",title:"支付时间",align:"center",width:200},{key:"operate",title:"操作",align:"left",width:80,customRender:({record:t})=>!T.hasOne(J.Report.AlipayLovePayEntSettle)||h.userInfo.isTenant||t.settlemented?"":e(Ie,{placement:"top",title:"结算"},{default:()=>[e(Y,{size:"small",type:"link",onClick:()=>p(t.id)},{default:()=>[e(q,null,null)]})]})}];return[...r,...l]}async function p(r){var t;const l=r?[r]:[...m.value];if(l&&l.length){const{data:i,error:b}=await Be(l);!b&&i&&i.code===0&&((t=window.$message)==null||t.success("结算成功"),R())}}const y=be(()=>{const r=Object.entries(u).map(([t,i])=>({key:t,value:i})),l=[];for(const t of x.value)if(t.key!=="amount"&&t.key!=="priceDiff")t.key==="operate"?l.push({key:t.key,value:""}):l.push({key:t.key,value:"——"});else{const i=r.find(b=>b.key===t.key);l.push({key:t.key,value:(i==null?void 0:i.value)||0})}return l});return(r,l)=>{const t=q,i=Y,b=ae,N=_e,B=De,E=fe,H=ce,d=pe,M=Ue;return f(),C("div",ze,[e(Me,{model:o(w),"onUpdate:model":l[0]||(l[0]=c=>K(w)?w.value=c:null),"user-info":o(h).userInfo,platform:o(Q),onReset:o(U),onSearch:l[1]||(l[1]=c=>o(O)(1))},null,8,["model","user-info","platform","onReset"]),e(M,{title:"企业亲情卡结算报表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:a(()=>[e(b,{columns:o(v),"onUpdate:columns":l[2]||(l[2]=c=>K(v)?v.value=c:null),"disabled-delete":o(m).length===0,loading:o(L)},{default:a(()=>[o(h).userInfo.isTenant||o(T).hasOne(o(J).Report.AlipayLovePayEntSettle.UPDATE)?(f(),k(i,{key:0,size:"small",ghost:"",type:"primary",disabled:o(m).length===0},{icon:a(()=>[e(t)]),default:a(()=>[l[3]||(l[3]=S("span",{class:"ml-6px"},"批量结算",-1))]),_:1},8,["disabled"])):P("",!0)]),_:1},8,["columns","disabled-delete","loading"])]),default:a(()=>[e(d,{ref_key:"tableWrapperRef",ref:_,columns:o(x),"data-source":o(A),size:"small","row-selection":o(n),scroll:o(D),loading:o(L),"row-key":"id",pagination:o(F),class:"h-full"},ke({_:2},[o(A)&&o(A).length?{name:"summary",fn:a(()=>[e(H,null,{default:a(()=>[e(E,null,{default:a(()=>[e(N,{index:0},{default:a(()=>l[4]||(l[4]=[g("合计")])),_:1}),(f(!0),C(G,null,V(y.value,c=>(f(),k(N,{key:c.key},{default:a(()=>[e(B,{type:isNaN(c.value)?"":c.value>0?"success":"danger"},{default:a(()=>[g(j(c.value),1)]),_:2},1032,["type"])]),_:2},1024))),128))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["columns","data-source","row-selection","scroll","loading","pagination"])]),_:1})])}}}),ca=Oe($e,[["__scopeId","data-v-67db0791"]]);export{ca as default};
