import{_ as Ts}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{S as Se,g as ze,_ as Qe,r as Us,s as Fs,a as Xe,b as Ze,T as Ds,u as et,c as tt,d as lt,e as st,f as Me}from"./table-search-filter-oeJAv4cw.js";import{d as pe,D as ve,E as re,r as ne,F as ge,c as g,o as n,w as l,f as t,z as D,b as P,H as le,P as ie,g as p,t as T,B as de,h as y,e,ab as ke,a7 as Pe,s as Ne,i as Ve,a9 as _e,a as ps,ad as cs,ae as vs,T as ot,ac as ms,af as Rs,q as fs,M as gs,a8 as as,aa as Bs,ah as Ms,ai as Ls}from"./index-C4fDvJn1.js";import{u as Ns,A as Oe}from"./app.permissions-eEP3QY97.js";import{p as je,b as Es}from"./index-DiqUFypO.js";import{c as Je}from"./helper-n1q5wElC.js";import{i as Ae,I as Ie}from"./empty-a1btfWut.js";import{_ as Hs,a as Os}from"./index-DvGwdmYs.js";import{u as Ee,a as at,F as Te,_ as me,I as Ge,d as nt}from"./form-C4lsPmD3.js";import{u as zs,f as Vs,a as Ys,o as js,S as Ke,_ as ns,b as Ks,c as _s,q as Gs,r as Ws,s as qs,t as Js,p as Ye,h as is,R as Qs,A as Xs,v as us,w as Zs,k as eo,x as to,F as lo,m as so,n as oo}from"./calculate-pPROSkpL.js";import{S as Fe}from"./index-DjcmxpZa.js";import{P as Ue,C as ao}from"./index-CfF1NG6B.js";import{_ as He}from"./index-BbA-ww4S.js";import{_ as De}from"./index-B0OEq9ON.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ds}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{_ as no,v as ks,B as io}from"./video-C95y-ngW.js";import{_ as it}from"./index.vue_vue_type_script_setup_true_lang-DSCZeeAS.js";import{_ as ut}from"./index-Bgjt1Cd5.js";import{R as uo,D as ro}from"./dayjs-BBTQ6xGR.js";import{L as We}from"./index-EP99CXY3.js";import{d as ws}from"./debounce-C-eHgR1J.js";import{a as po,b as co,k as dt,c as ys}from"./enums-Cr_YM2zq.js";import{C as qe}from"./index-BSgdO99v.js";import{T as ue}from"./index-Cd0TkKik.js";import{L as bs,_ as xs,a as Cs}from"./index-Q7LyDRqH.js";import{E as $e}from"./EyeOutlined-DMOywdMm.js";import{D as Le}from"./DeleteOutlined-vV5-dJ7B.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./china.area-DOOnik0V.js";import"./isSymbol-7IJmde0n.js";const vo=pe({name:"PlanTaskCompletionDrawer",__name:"completion-drawer",props:ve({rowData:{default:()=>({})},lovePayEnum:{default:()=>[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ve(["submitted"],["update:visible"]),setup(z,{emit:U}){const B=re(z,"visible"),a=z,{provinceOptions:b,useCity:i}=zs(),{formRef:F,validate:u,resetFields:E}=Ee(),{defaultRequiredRule:s}=at(),_=U,K={orderId:s,payPrice:s,province:[],city:[],address:[],name:[],phone:[],lovePayId:[{required:!0,message:"请选择亲情卡"}]},w=ne(m()),R=ne([]),N=ne(null);ge(B,async k=>{k&&(E(),w.value=m(),a.rowData.success||(w.value.success=0),await X())});function m(){return{id:"",success:1,orderId:"",payPrice:null,province:"",city:"",address:"",name:"",phone:"",addressContent:"",note:"",isLovePay:!1,lovePayId:"",lovePayName:"",lovePayEnum:a.lovePayEnum??[],newLovePayName:"",loading:!1}}function V(){R.value=i(w.value.province),w.value.city=R.value[0].value}const v=(k,$)=>$.value.toLowerCase().includes(k.toLowerCase());async function X(){const{data:k,error:$}=await Vs(a.rowData.id);if(!$&&k&&k.code===0){const c=k.data;w.value.id=c.id,w.value.success=c.success?1:0,w.value.orderId=c.orderId||"",w.value.payPrice=typeof c.payPrice<"u"&&c.payPrice!==null&&c.payPrice!==""?Number(c.payPrice):null,w.value.province=c.province||"",w.value.city=c.city||"",w.value.address=c.address||"",w.value.name=c.name||"",w.value.phone=c.phone||"",w.value.lovePayId=c.lovePayId||"",w.value.lovePayName=c.lovePayName||"",w.value.isLovePay=!!(c.lovePayId||c.lovePayName),w.value.note=c.note||"",oe()}}function oe(){var k;w.value.province&&(R.value=i(w.value.province),w.value.city&&!R.value.find($=>$.value===w.value.city)&&(w.value.city=((k=R.value[0])==null?void 0:k.value)||""))}function h(){B.value=!1}async function f(){var k;if(await u(),w.value.success===0){await G();return}(k=window.$modal)==null||k.confirm({title:"订单补全信息提示",cancelText:"取消",okText:"确定",content:"请确认商品信息是否填写正确，提交后将无法修改，确定要提交吗？",async onOk(){await G()}})}async function G(){var k;w.value.loading=!0;try{const{data:$,error:c}=await Ys({...w.value});!c&&$&&$.code===0&&((k=window.$message)==null||k.success("保存成功"),_("submitted"),h())}finally{w.value.loading=!1}}function M(k){if(k.preventDefault(),!w.value.newLovePayName)return;w.value.newLovePayName=w.value.newLovePayName.trim();const $=-1*Date.now();w.value.lovePayEnum.filter(c=>c.value===$).length||w.value.lovePayEnum.push({text:w.value.newLovePayName,value:$}),w.value.lovePayId=$,w.value.lovePayName=w.value.newLovePayName,ke(()=>{var c;w.value.newLovePayName="",(c=N.value)==null||c.focus()})}function H(){w.value.lovePayId<-1&&(w.value.lovePayName=w.value.lovePayEnum.filter(k=>k.value===w.value.lovePayId)[0].text)}function W(k,$){return a.lovePayEnum.filter(c=>c.text.includes(k)).filter(c=>c.value===$.value).length>0}return(k,$)=>{const c=Se,Y=me,Q=ze,q=Hs,ee=Os,C=Ge,o=de,r=Fe,x=He,S=nt,I=Te,d=De;return n(),g(d,{open:B.value,"onUpdate:open":$[12]||($[12]=A=>B.value=A),title:"任务信息",width:550},{footer:l(()=>[t(r,{size:16},{default:l(()=>[t(o,{onClick:h},{default:l(()=>$[17]||($[17]=[p("取消")])),_:1}),t(o,{type:"primary",loading:w.value.loading,onClick:f},{default:l(()=>$[18]||($[18]=[p("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(I,{ref_key:"formRef",ref:F,name:"operate",layout:"vertical",model:w.value,rules:K},{default:l(()=>[t(Y,{label:"购买结果",name:"success"},{default:l(()=>[t(c,{value:w.value.success,"onUpdate:value":$[0]||($[0]=A=>w.value.success=A),options:[{value:0,label:"购买失败"},{value:1,label:"购买成功"}],disabled:a.rowData.success},null,8,["value","disabled"])]),_:1}),w.value.success===1&&w.value.isLovePay?(n(),g(Y,{key:0,label:"亲情卡",name:"lovePayId"},{default:l(()=>[a.rowData.success?(n(),g(C,{key:1,value:w.value.lovePayName,"onUpdate:value":$[3]||($[3]=A=>w.value.lovePayName=A),disabled:""},null,8,["value"])):(n(),g(c,{key:0,value:w.value.lovePayId,"onUpdate:value":$[2]||($[2]=A=>w.value.lovePayId=A),placeholder:"请选择亲情卡","show-search":"","filter-option":W,onChange:H},{dropdownRender:l(({menuNode:A})=>[t(q,{vnodes:A},null,8,["vnodes"]),t(ee,{class:"mb-4px mt-4px"}),t(r,{class:"select-action"},{default:l(()=>[t(C,{ref_key:"inputRef",ref:N,value:w.value.newLovePayName,"onUpdate:value":$[1]||($[1]=j=>w.value.newLovePayName=j),placeholder:"新亲情卡"},null,8,["value"]),t(o,{ghost:"",size:"small",type:"primary",onClick:M},{icon:l(()=>[t(y(Ue))]),default:l(()=>[$[13]||($[13]=p(" 添加新亲情卡 "))]),_:1})]),_:1})]),default:l(()=>[(n(!0),P(le,null,ie(w.value.lovePayEnum,A=>(n(),g(Q,{key:A.value,value:A.value},{default:l(()=>[p(T(A.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1})):D("",!0),w.value.success===1?(n(),g(Y,{key:1,label:"订单号",name:"orderId"},{default:l(()=>[t(C,{value:w.value.orderId,"onUpdate:value":$[4]||($[4]=A=>w.value.orderId=A),autocomplete:"off",placeholder:"请输入订单号",disabled:a.rowData.success},null,8,["value","disabled"])]),_:1})):D("",!0),w.value.success===1?(n(),g(Y,{key:2,label:"支付金额",name:"payPrice"},{default:l(()=>[t(x,{value:w.value.payPrice,"onUpdate:value":$[5]||($[5]=A=>w.value.payPrice=A),min:0,controls:!1,precision:2,disabled:a.rowData.success},{addonBefore:l(()=>$[14]||($[14]=[e("span",null,"￥",-1)])),addonAfter:l(()=>$[15]||($[15]=[e("span",null,"元",-1)])),_:1},8,["value","disabled"])]),_:1})):D("",!0),w.value.success===1?(n(),g(Y,{key:3,label:"省份",name:"province"},{default:l(()=>[t(c,{value:w.value.province,"onUpdate:value":$[6]||($[6]=A=>w.value.province=A),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,options:y(b),"filter-option":v,disabled:a.rowData.success,onChange:V},null,8,["value","options","disabled"])]),_:1})):D("",!0),w.value.success===1?(n(),g(Y,{key:4,label:"市区",name:"city"},{default:l(()=>[t(c,{value:w.value.city,"onUpdate:value":$[7]||($[7]=A=>w.value.city=A),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,options:R.value,"filter-option":v,disabled:a.rowData.success},{notFoundContent:l(()=>$[16]||($[16]=[e("p",null,"没有找到匹配的市区",-1)])),_:1},8,["value","options","disabled"])]),_:1})):D("",!0),w.value.success===1?(n(),g(Y,{key:5,label:"详细地址",name:"address"},{default:l(()=>[t(S,{value:w.value.address,"onUpdate:value":$[8]||($[8]=A=>w.value.address=A),autocomplete:"off",placeholder:"请输入详细地址","auto-size":{minRows:5},disabled:a.rowData.success},null,8,["value","disabled"])]),_:1})):D("",!0),w.value.success===1?(n(),g(Y,{key:6,label:"收货人",name:"name"},{default:l(()=>[t(C,{value:w.value.name,"onUpdate:value":$[9]||($[9]=A=>w.value.name=A),autocomplete:"off",placeholder:"请输入收货人名称",disabled:a.rowData.success},null,8,["value","disabled"])]),_:1})):D("",!0),w.value.success===1?(n(),g(Y,{key:7,label:"联系方式",name:"phone"},{default:l(()=>[t(C,{value:w.value.phone,"onUpdate:value":$[10]||($[10]=A=>w.value.phone=A),autocomplete:"off",placeholder:"请输入联系方式",disabled:a.rowData.success},null,8,["value","disabled"])]),_:1})):D("",!0),t(Y,{label:"任务备注"},{default:l(()=>[t(S,{value:w.value.note,"onUpdate:value":$[11]||($[11]=A=>w.value.note=A),"auto-size":{minRows:3},maxlength:300},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),rs=ce(vo,[["__scopeId","data-v-f835b7d2"]]),mo={class:"flex-1"},fo={class:"w-full flex-y-center justify-end gap-12px"},go={class:"v-center center flex"},_o={class:"ml-8px"},ko=pe({name:"PlanTaskListSearch",__name:"search-filter",props:ve({userInfo:{},mode:{}},{model:{required:!0},modelModifiers:{}}),emits:ve(["reset","search"],["update:model"]),setup(z,{emit:U}){const{formRef:B,resetFields:a}=Ee(),b=re(z,"model"),i=z,F=ne(!1),u=U;async function E(){await a(),u("reset")}async function s(){u("search")}function _(w,R){b.value.beginTime=R[0],b.value.endTime=R[1]}const K=w=>w&&w>=Pe().endOf("day");return(w,R)=>{const N=Se,m=me,V=ut,v=Ge,X=uo,oe=de,h=Xe,f=Ze,G=Qe,M=Te;return n(),g(Ds,null,{default:l(()=>[t(M,{ref_key:"formRef",ref:B,class:"search-filter",model:b.value,"label-col":{span:5,md:7}},{default:l(()=>[t(G,{gutter:[16,16],wrap:""},{default:l(()=>[t(V,{span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"任务模式",name:"mode",class:"m-0"},{default:l(()=>[t(N,{value:b.value.mode,"onUpdate:value":R[0]||(R[0]=H=>b.value.mode=H),placeholder:"- 全部 -",options:i.mode,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),t(V,{span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"商品标题",name:"title",class:"m-0"},{default:l(()=>[t(v,{value:b.value.title,"onUpdate:value":R[1]||(R[1]=H=>b.value.title=H),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),i.userInfo.tenantType===20||!i.userInfo.isTenant?(n(),g(V,{key:0,span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"店铺名称",name:"shopName",class:"m-0"},{default:l(()=>[t(v,{value:b.value.shopName,"onUpdate:value":R[2]||(R[2]=H=>b.value.shopName=H),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1})):i.userInfo.tenantType!==20||!i.userInfo.isTenant?(n(),g(V,{key:1,span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"店铺名称",name:"shopId",class:"m-0"},{default:l(()=>[t(it,{value:b.value.shopId,"onUpdate:value":R[3]||(R[3]=H=>b.value.shopId=H),platform:2,remote:!0,"show-search":!0,"filter-option":!1},null,8,["value"])]),_:1})]),_:1})):D("",!0),t(V,{span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"订单编号",name:"orderId",class:"m-0"},{default:l(()=>[t(v,{value:b.value.orderId,"onUpdate:value":R[4]||(R[4]=H=>b.value.orderId=H),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),F.value?(n(),g(V,{key:2,span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"执行设备",name:"deviceId",class:"m-0"},{default:l(()=>[t(no,{value:b.value.deviceId,"onUpdate:value":R[5]||(R[5]=H=>b.value.deviceId=H)},null,8,["value"])]),_:1})]),_:1})):D("",!0),F.value?(n(),g(V,{key:3,span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"购买状态",name:"success",class:"m-0"},{default:l(()=>[t(N,{value:b.value.success,"onUpdate:value":R[6]||(R[6]=H=>b.value.success=H),placeholder:"- 全部 -",options:[{value:!0,label:"成功"},{value:!1,label:"失败"}],"allow-clear":""},null,8,["value"])]),_:1})]),_:1})):D("",!0),F.value?(n(),g(V,{key:4,span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"任务状态",name:"status",class:"m-0"},{default:l(()=>[t(N,{value:b.value.status,"onUpdate:value":R[7]||(R[7]=H=>b.value.status=H),placeholder:"- 全部 -",options:y(js),"allow-clear":"",mode:"multiple","max-tag-count":"responsive"},null,8,["value","options"])]),_:1})]),_:1})):D("",!0),F.value?(n(),g(V,{key:5,span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"创建时间",name:"createTimeRange",class:"m-0"},{default:l(()=>[t(X,{value:b.value.createTimeRange,"onUpdate:value":R[8]||(R[8]=H=>b.value.createTimeRange=H),"show-time":{hideDisabledOptions:!0,defaultValue:[y(Pe)("00:00:00","HH:mm:ss"),y(Pe)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],"disabled-date":K,onChange:_},null,8,["value","show-time"])]),_:1})]),_:1})):D("",!0),F.value&&!i.userInfo.isTenant?(n(),g(V,{key:6,span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"创建商户",name:"userId",class:"m-0"},{default:l(()=>[t(ds,{value:b.value.userId,"onUpdate:value":R[9]||(R[9]=H=>b.value.userId=H),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})):F.value&&!i.userInfo.isTenantUser?(n(),g(V,{key:7,span:24,md:12,lg:6},{default:l(()=>[t(m,{label:"创建员工",name:"userId",class:"m-0"},{default:l(()=>[t(ds,{value:b.value.userId,"onUpdate:value":R[10]||(R[10]=H=>b.value.userId=H),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})]),_:1})):D("",!0),e("div",mo,[t(m,{class:"m-0"},{default:l(()=>[e("div",fo,[t(oe,{onClick:R[11]||(R[11]=()=>F.value=!F.value)},{default:l(()=>[e("div",go,[F.value?(n(),g(y(Us),{key:0})):(n(),g(y(Fs),{key:1})),e("span",_o,T(F.value?"收起筛选":"展开更多"),1)])]),_:1}),t(oe,{onClick:E},{icon:l(()=>[t(h,{class:"align-sub text-icon"})]),default:l(()=>[R[12]||(R[12]=e("span",{class:"ml-8px"},"重置",-1))]),_:1}),t(oe,{type:"primary",ghost:"",onClick:s},{icon:l(()=>[t(f,{class:"align-sub text-icon"})]),default:l(()=>[R[13]||(R[13]=e("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),wo=ce(ko,[["__scopeId","data-v-c0232aa9"]]),yo={class:"v-center flex gap-8px"},bo=pe({name:"PlanTaskFriendsSelect",__name:"friends-select",props:{value:{default:""},valueModifiers:{}},emits:["update:value"],setup(z){const U=re(z,"value"),B=Ne({lastSearchFilter:"",friendsOptions:[]}),a=ws(async b=>{B.lastSearchFilter=b;const{data:i,error:F}=await po(b);!F&&i&&i.code===0&&i.data&&i.data.list&&i.data.list.length&&(B.friendsOptions=i.data.list.map(u=>({value:u.value,label:u.text})),B.friendsOptions.length===1&&(U.value=B.friendsOptions[0].value))});return Ve(()=>{a()}),(b,i)=>{const F=ze,u=Se,E=de,s=me;return n(),g(s,{name:"friend"},{label:l(()=>i[2]||(i[2]=[e("p",null,[p(" 指定好友 "),e("small",{class:"info"},"* 如未找到好友，请核好友列表是否已添加且已有审核过的店铺")],-1)])),default:l(()=>[e("div",yo,[t(u,{value:U.value,"onUpdate:value":i[0]||(i[0]=_=>U.value=_),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,onSearch:y(a)},{notFoundContent:l(()=>i[3]||(i[3]=[e("p",null,"没有可分配的好友",-1)])),default:l(()=>[(n(!0),P(le,null,ie(B.friendsOptions,_=>(n(),g(F,{key:_.value,value:_.value},{default:l(()=>[p(T(_.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onSearch"]),t(E,{onClick:i[1]||(i[1]=()=>y(a)(B.lastSearchFilter))},{default:l(()=>i[4]||(i[4]=[p("刷新")])),_:1})])]),_:1})}}}),hs=ce(bo,[["__scopeId","data-v-b39c4076"]]),xo={class:"v-center flex gap-8px"},Co=pe({name:"PlanTaskDeviceSelect",__name:"device-select",props:{value:{default:""},valueModifiers:{}},emits:["update:value"],setup(z){const U=re(z,"value"),B=Ne({lastSearchFilter:"",deviceIdOptions:[]}),a=ws(async b=>{B.lastSearchFilter=b;const{data:i,error:F}=await co(b);!F&&i&&i.code===0&&i.data&&i.data.list&&i.data.list.length&&(B.deviceIdOptions=i.data.list.map(u=>({value:u.value,label:u.text})),B.deviceIdOptions.length===1&&(U.value=B.deviceIdOptions[0].value))});return Ve(()=>{a("")}),(b,i)=>{const F=ze,u=Se,E=de,s=me;return n(),g(s,{name:"deviceId"},{label:l(()=>i[2]||(i[2]=[e("p",null,[p(" 指定设备 "),e("small",{class:"info"},"* 如未找到设备，请核对设备剩余使用数")],-1)])),default:l(()=>[e("div",xo,[t(u,{value:U.value,"onUpdate:value":i[0]||(i[0]=_=>U.value=_),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,onSearch:y(a)},{notFoundContent:l(()=>i[3]||(i[3]=[e("p",null,"没有可分配的设备",-1)])),default:l(()=>[(n(!0),P(le,null,ie(B.deviceIdOptions,_=>(n(),g(F,{key:_.value,value:_.value},{default:l(()=>[p(T(_.label)+" ("+T(_.value)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onSearch"]),t(E,{onClick:i[1]||(i[1]=()=>y(a)(B.lastSearchFilter))},{default:l(()=>i[4]||(i[4]=[p("刷新")])),_:1})])]),_:1})}}}),Ps=ce(Co,[["__scopeId","data-v-bbe8a460"]]),ho={class:"space-between v-center mb-12px flex"},Po={class:"products"},$o={class:"v-center mb-6px flex gap-8px"},Ao=["onClick"],Io={class:"v-center flex gap-8px"},So={class:"products-image"},To={class:"products-body"},Uo={class:"sku"},Fo={class:"mb-6px"},Do={class:"v-center flex gap-8px"},Ro={class:"v-center num-container flex gap-8px"},Bo={class:"v-center del-btn flex gap-6px"},Mo={class:"text-center"},Lo={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},No={class:"flex-1"},Eo={class:"w-full flex-y-center justify-end gap-12px"},Ho=pe({__name:"again-product-select",props:ve({shopId:{default:""}},{products:{default:[]},productsModifiers:{},multiple:{type:Boolean,default:!1},multipleModifiers:{}}),emits:ve(["submitted","shopValidate"],["update:products","update:multiple"]),setup(z,{expose:U,emit:B}){const a=re(z,"products"),b=re(z,"multiple"),i=ne(h()),{tableWrapperRef:F,scrollConfig:u}=et(),{columns:E,data:s,getData:_,getDataByPage:K,loading:w,mobilePagination:R,searchParams:N,resetSearchParams:m}=tt({apiFn:G,apiParams:{platform:0,shopId:"",url:"",title:"",itemId:"",pageIndex:1,pageSize:10},columns:M}),{checkedRowKeys:V,rowSelection:v}=lt(s,_),X=z,oe=B;ge(()=>i.value.visible,C=>{C||q()}),ge(V,C=>{if(!b.value&&C.length>1){const o=V.value.at(-1);V.value.splice(0,V.value.length,...o!==void 0?[o]:[]),v.value.selectedRowKeys=[o],v.value.selectedRows=v.value.selectedRows.filter(r=>r.id===o)}}),ge(()=>i.value.products,C=>{var r;for(const x of C){const S=a.value.findIndex(I=>I.id===x.id);S>-1?(a.value[S].skuList=x.selectedSkuMap?JSON.parse(x.selectedSkuMap):[],a.value[S].keyword=x.keyword,a.value[S].count=x.count,a.value[S].price=x.price,a.value[S].scope=x.scope,a.value[S].main=x.main):a.value.push({id:x.id,shopName:x.shopName,url:x.url,image:x.image,title:x.title,keyword:x.keyword,skuCount:((r=x.skuMap)==null?void 0:r.length)||0,skuList:x.selectedSkuMap?JSON.parse(x.selectedSkuMap):[],count:x.count,price:x.price,scope:x.scope,main:x.main,comment:x.comment})}const o=C.map(x=>x.id);a.value=a.value.filter(x=>o.includes(x.id)),oe("submitted")},{deep:!0}),Ve(()=>{W()});function h(){return{visible:!1,products:[],loading:!0}}async function f(){if(X.shopId===""||X.shopId==="0"){oe("shopValidate");return}i.value.visible=!0;try{N.shopId!==X.shopId&&(i.value.loading=!0,N.shopId=X.shopId,await K(1))}finally{i.value.loading&&(i.value.loading=!1)}}function G(C){return i.value.visible?ys({...C}):Promise.resolve({code:0,msg:"",data:{count:0,list:[],pageIndex:1,pageSize:10}})}function M(){return[{key:"image",dataIndex:"image",title:"商品主图",width:80,customRender({record:o}){return t("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[t(Ie,{width:64,height:64,src:o.image,fallback:Ae},null)])}},{key:"title",dataIndex:"title",title:"商品"},{key:"shopName",dataIndex:"shopName",title:"店铺",width:200}]}function H(){var o;if(!N.url)return;const C=new URL(N.url);if(N.itemId=C.searchParams.get("id")||"",!N.itemId){(o=window.$message)==null||o.warning("商品链接解析失败，请核对链接或手动填写商品Id");return}N.url=`${C.protocol}//${C.host}${C.pathname}?id=${i.value.itemId}`}async function W(){try{const{data:C,error:o}=await dt();!o&&C&&C.code===0&&(i.value.shopNameEnum=C.data.list)}catch{}}function k(){ke(()=>{var C;!b.value&&i.value.products.length>1&&((C=window.$message)==null||C.warning("只能保留一个商品，请删除其他商品"),b.value=!0)})}function $(C,o){o.main?i.value.products.forEach((r,x)=>r.main=x===C):i.value.products.filter(r=>r.main).length===0&&(o.main=!0)}function c(){const C=v.value.selectedRows.map((o,r)=>({id:o.id,shopName:o.shopName,url:o.url,image:o.image,title:o.title,keyword:"",skuMap:o.skuMap.map(x=>({sku:x.sku,price:x.price,value:JSON.stringify(x.sku),label:x.sku.join("+")})),selectedSkuMap:null,skuList:[],count:1,price:0,scope:10,main:r===0}));if(b.value)for(const o of C)i.value.products.filter(r=>r.id===o.id).length||(o.main=i.value.products.filter(r=>r.main).length===0,i.value.products.push(o));else(i.value.products.length===0||C[0].id!==i.value.products[0].id)&&(i.value.products=[C[0]]);i.value.visible=!1}function Y(C){const o=i.value.products[C].skuMap.filter(r=>r.value===i.value.products[C].selectedSkuMap);o&&o.length?i.value.products[C].price=o[0].price:i.value.products[C].price=0}function Q(C){i.value.products=i.value.products.filter((o,r)=>r!==C),i.value.products.length&&!i.value.products.filter(o=>o.main).length&&(i.value.products[0].main=!0)}function q(){V.value=[],v.value.selectedRowKeys=[],v.value.selectedRows=[]}function ee(C){var o;C?window.open(C):(o=window.$message)==null||o.warning("该商品没有添加商品链接，无法跳转")}return U({initSelectedProducts:()=>{i.value=h(),q()},setSelectedProducts:(C=[])=>{i.value.products=C.map(o=>({id:o.id,shopName:o.shopName,url:o.url,image:o.image,title:o.title,keyword:o.keyword,skuMap:o.skuMap.map(r=>({sku:r.sku,price:r.price,value:JSON.stringify(r.sku),label:r.sku.join("+")})),selectedSkuMap:o.selectedSkuMap?JSON.parse(o.selectedSkuMap):null,skuList:o.skuList,count:o.count,price:o.price,scope:o.scope,main:o.main,comment:o.comment}))}}),(C,o)=>{const r=qe,x=Ie,S=Se,I=ue,d=Ge,A=He,j=_e,se=de,ae=Me,J=me,fe=ut,be=Xe,xe=Ze,Ce=Qe,he=Te,we=st,Re=Fe,Be=De;return n(),P(le,null,[e("p",ho,[e("span",null,"商品列表(已选 "+T(i.value.products.length)+" 个)",1),t(r,{checked:b.value,"onUpdate:checked":o[0]||(o[0]=L=>b.value=L),onChange:k},{default:l(()=>o[8]||(o[8]=[p("多商品")])),_:1},8,["checked"])]),e("ul",Po,[(n(!0),P(le,null,ie(i.value.products,(L,ye)=>(n(),P("li",{key:L.id},[e("div",$o,[b.value?(n(),g(r,{key:0,checked:L.main,"onUpdate:checked":Z=>L.main=Z,onChange:()=>$(ye,L)},{default:l(()=>o[9]||(o[9]=[p(" 主商品 ")])),_:2},1032,["checked","onUpdate:checked","onChange"])):D("",!0),e("p",{class:"title",onClick:Z=>ee(L.url)},T(L.title),9,Ao)]),e("div",Io,[e("div",So,[t(x,{width:100,height:100,src:L.image,fallback:y(Ae)},null,8,["src","fallback"])]),e("div",To,[e("div",Uo,[L.skuMap.length?(n(),g(S,{key:0,value:L.selectedSkuMap,"onUpdate:value":Z=>L.selectedSkuMap=Z,options:L.skuMap,placeholder:"请选择商品Sku",onChange:Z=>Y(ye)},null,8,["value","onUpdate:value","options","onChange"])):(n(),g(I,{key:1},{default:l(()=>o[10]||(o[10]=[p("该商品无Sku")])),_:1}))]),e("div",Fo,[t(d,{value:L.keyword,"onUpdate:value":Z=>L.keyword=Z,placeholder:L.main?"请输入搜索关键词":"没有输入输入关键词则进店查找"},null,8,["value","onUpdate:value","placeholder"])]),e("div",Do,[e("div",Ro,[t(A,{value:L.price,"onUpdate:value":Z=>L.price=Z,min:0,max:99999,controls:!1,precision:2},{addonBefore:l(()=>o[11]||(o[11]=[e("span",null,"价格",-1)])),addonAfter:l(()=>o[12]||(o[12]=[e("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"]),t(A,{value:L.count,"onUpdate:value":Z=>L.count=Z,min:1,max:99999,controls:!1,precision:0},{addonBefore:l(()=>o[13]||(o[13]=[e("span",null,"购买",-1)])),addonAfter:l(()=>o[14]||(o[14]=[e("span",null,"件",-1)])),_:2},1032,["value","onUpdate:value"]),t(A,{value:L.scope,"onUpdate:value":Z=>L.scope=Z,min:0,max:99999,controls:!1,precision:2},{addonBefore:l(()=>[t(j,{placement:"top"},{title:l(()=>o[15]||(o[15]=[e("span",null,"下单商品时商品单价与填写价格相差符合差额范围内才下单",-1)])),default:l(()=>[o[16]||(o[16]=e("span",null,"浮动差额 ±",-1))]),_:1})]),addonAfter:l(()=>o[17]||(o[17]=[e("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"])]),e("div",Bo,[t(ae,{title:"确认删除吗？",placement:"left",onConfirm:()=>Q(ye)},{default:l(()=>[t(se,{danger:"",size:"small"},{default:l(()=>o[18]||(o[18]=[p("删除")])),_:1})]),_:2},1032,["onConfirm"])])])])])]))),128))]),b.value||i.value.products.length===0?(n(),P("div",{key:0,class:"actions mb-12px",onClick:f},[e("p",Mo,[t(y(Ue)),o[19]||(o[19]=p(" 添加商品 "))])])):D("",!0),t(Be,{open:i.value.visible,"onUpdate:open":o[7]||(o[7]=L=>i.value.visible=L),title:"商品选择",width:800},{footer:l(()=>[t(Re,{size:16},{default:l(()=>[t(se,{onClick:o[6]||(o[6]=()=>i.value.visible=!1)},{default:l(()=>o[22]||(o[22]=[p("取消")])),_:1}),t(se,{type:"primary",disabled:y(V).length===0,onClick:c},{default:l(()=>o[23]||(o[23]=[p("确定")])),_:1},8,["disabled"])]),_:1})]),default:l(()=>[e("div",Lo,[t(he,{model:y(N),"label-col":{span:5,md:7}},{default:l(()=>[t(Ce,{class:"row",gutter:[16,16],wrap:""},{default:l(()=>[t(fe,{span:12},{default:l(()=>[t(J,{label:"商品链接",name:"url",class:"m-0"},{default:l(()=>[t(d,{value:y(N).url,"onUpdate:value":o[1]||(o[1]=L=>y(N).url=L),placeholder:"",onBlur:H},null,8,["value"])]),_:1})]),_:1}),t(fe,{span:12},{default:l(()=>[t(J,{label:"商品编号",name:"itemId",class:"m-0"},{default:l(()=>[t(d,{value:y(N).itemId,"onUpdate:value":o[2]||(o[2]=L=>y(N).itemId=L),placeholder:""},null,8,["value"])]),_:1})]),_:1}),t(fe,{span:12},{default:l(()=>[t(J,{label:"商品名称",name:"title",class:"m-0"},{default:l(()=>[t(d,{value:y(N).title,"onUpdate:value":o[3]||(o[3]=L=>y(N).title=L),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e("div",No,[t(J,{class:"m-0"},{default:l(()=>[e("div",Eo,[t(se,{onClick:o[4]||(o[4]=L=>y(m)())},{icon:l(()=>[t(be,{class:"align-sub text-icon"})]),default:l(()=>[o[20]||(o[20]=e("span",{class:"ml-8px"},"重置",-1))]),_:1}),t(se,{type:"primary",ghost:"",onClick:o[5]||(o[5]=L=>y(K)(1))},{icon:l(()=>[t(xe,{class:"align-sub text-icon"})]),default:l(()=>[o[21]||(o[21]=e("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"]),t(we,{ref_key:"tableWrapperRef",ref:F,columns:y(E),"data-source":y(s),size:"small","row-selection":y(v),scroll:y(u),loading:y(w),"row-key":"id",pagination:y(R),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),t(We,{loading:i.value.loading},null,8,["loading"])])]),_:1},8,["open"])],64)}}}),Oo=ce(Ho,[["__scopeId","data-v-a446c427"]]),zo={class:"v-center flex gap-8px"},Vo={class:"actions"},Yo=pe({name:"PlanTaskActions",__name:"actions",props:{actions:{default:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,lookPlantingGrass:!0,lookAskEveryone:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0}},actionsModifiers:{}},emits:["update:actions"],setup(z){const U=re(z,"actions");return(B,a)=>{const b=He,i=me,F=qe;return n(),P(le,null,[t(i,null,{label:l(()=>a[8]||(a[8]=[e("p",null,[p(" 货比三家 "),e("small",{class:"text-danger ml-1"},"* 都为0不进行货比")],-1)])),default:l(()=>[e("div",zo,[t(b,{value:U.value.shopAround.min,"onUpdate:value":a[0]||(a[0]=u=>U.value.shopAround.min=u),min:0,controls:!1,precision:0},{addonBefore:l(()=>a[9]||(a[9]=[e("span",null,"最少",-1)])),addonAfter:l(()=>a[10]||(a[10]=[e("span",null,"次",-1)])),_:1},8,["value"]),t(b,{value:U.value.shopAround.max,"onUpdate:value":a[1]||(a[1]=u=>U.value.shopAround.max=u),min:0,controls:!1,precision:0},{addonBefore:l(()=>a[11]||(a[11]=[e("span",null,"最多",-1)])),addonAfter:l(()=>a[12]||(a[12]=[e("span",null,"次",-1)])),_:1},8,["value"])])]),_:1}),t(i,{label:"商品互动"},{default:l(()=>[e("ul",Vo,[e("li",null,[t(F,{checked:U.value.addCart,"onUpdate:checked":a[2]||(a[2]=u=>U.value.addCart=u)},{default:l(()=>a[13]||(a[13]=[p("商品加购")])),_:1},8,["checked"])]),e("li",null,[t(F,{checked:U.value.favorite,"onUpdate:checked":a[3]||(a[3]=u=>U.value.favorite=u)},{default:l(()=>a[14]||(a[14]=[p("商品收藏")])),_:1},8,["checked"])]),e("li",null,[t(F,{checked:U.value.useFirstBrowse,"onUpdate:checked":a[4]||(a[4]=u=>U.value.useFirstBrowse=u)},{default:l(()=>a[15]||(a[15]=[p("随机搜索浏览多次")])),_:1},8,["checked"])]),e("li",null,[t(F,{checked:U.value.lookComment,"onUpdate:checked":a[5]||(a[5]=u=>U.value.lookComment=u)},{default:l(()=>a[16]||(a[16]=[p(" 随机看商品评价 "),e("span",{class:"text-danger"},"（3-10次动态）",-1)])),_:1},8,["checked"])]),e("li",null,[t(F,{checked:U.value.lookPlantingGrass,"onUpdate:checked":a[6]||(a[6]=u=>U.value.lookPlantingGrass=u)},{default:l(()=>a[17]||(a[17]=[p(" 随机看种草信息 "),e("span",{class:"text-danger"},"（3-10次动态）",-1)])),_:1},8,["checked"])]),e("li",null,[t(F,{checked:U.value.useFindBrowse,"onUpdate:checked":a[7]||(a[7]=u=>U.value.useFindBrowse=u)},{default:l(()=>a[18]||(a[18]=[p("找到指定商品后不购买，再次随机浏览后下单")])),_:1},8,["checked"])])])]),_:1})],64)}}}),$s=ce(Yo,[["__scopeId","data-v-5ea4d9f7"]]),jo={class:"grid-2 grid"},Ko=pe({name:"PlanTaskTimePicler",__name:"time-picker",props:{beginTime:{default:""},beginTimeModifiers:{},endTime:{default:""},endTimeModifiers:{}},emits:["update:beginTime","update:endTime"],setup(z,{expose:U}){const B=re(z,"beginTime"),a=re(z,"endTime");function b(F,u){const E=Pe().startOf("day");if(u===0){const _=E.add(7,"days");return F.isBefore(E)?!0:!!F.isAfter(_)}if(F.isBefore(E))return!0;const s=B.value?Pe(B.value):null;if(s!==null){const _=s.add(3,"days");if(F.isBefore(s)||!F.isAfter(s)||!F.isBefore(_))return!0}return!1}function i(F){(!a.value||Pe(a.value).isBefore(F))&&(a.value=Pe(F).endOf("day").format("YYYY-MM-DD HH:mm:ss"))}return U({initDateRange:()=>{const F=Pe();B.value=F.format("YYYY-MM-DD HH:mm:ss"),a.value=F.endOf("day").format("YYYY-MM-DD HH:mm:ss")}}),(F,u)=>{const E=ro,s=me;return n(),P("div",jo,[t(s,{label:"开始时间",name:"beginTime"},{default:l(()=>[t(E,{value:B.value,"onUpdate:value":u[0]||(u[0]=_=>B.value=_),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"","disabled-date":_=>b(_,0),onChange:i},null,8,["value","disabled-date"])]),_:1}),t(s,{label:"结束时间",name:"endTime"},{default:l(()=>[t(E,{value:a.value,"onUpdate:value":u[1]||(u[1]=_=>a.value=_),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"","disabled-date":_=>b(_,1)},null,8,["value","disabled-date"])]),_:1})])}}}),As=ce(Ko,[["__scopeId","data-v-63ae446d"]]),Go={class:"mb-12px"},Wo={key:0},qo={class:"mb-8px"},Jo={class:"wrap flex gap-8px"},Qo={key:0},Xo={key:1},Zo={key:2,class:"comment-preview"},ea=["src"],ta={class:"wrap v-center center flex gap-8px"},la=["onClick"],sa={key:3,class:"comment-preview"},oa=["src"],aa={class:"wrap v-center center flex gap-8px"},na=["onClick"],ia={class:"wrap flex gap-8px"},ua=["src"],da={class:"wrap v-center center flex gap-8px"},ra={key:1,class:"stop"},pa={class:"text-center"},ca={key:0,class:"preview uploder"},va=["src"],ma={class:"wrap v-center center flex gap-8px"},fa={key:1,class:"stop"},ga={class:"text-center"},_a={class:"video"},ka=["src","type"],wa=pe({name:"PlanTaskComment",__name:"again-product-comment",props:{products:{default:[]},productsModifiers:{}},emits:["update:products"],setup(z,{expose:U}){const B=ne(null),a=ne(null),{formRef:b,resetFields:i}=Ee(),F=re(z,"products"),u=ne(s()),E=ps(()=>u.value.images.length+u.value.videos.length===9);ge(F,h=>{if(h&&h.length){const f=h.map(M=>{const H={...M};return(!H.comment||!H.comment.hasComment)&&(H.comment=_()),H}),G=h.map(M=>M.id);u.value.products=u.value.products.filter(M=>G.includes(M.id));for(const M of f){const H=u.value.products.findIndex(W=>W.id===M.id);H>-1?Object.assign(u.value.products[H],M):u.value.products.push(M)}}else u.value.products=[]},{deep:!0});function s(){return{products:[],visible:!1,index:-1,title:"",text:"",images:[],videos:[],preview:{visible:!1,src:"",type:""}}}function _(){return{hasComment:!1,text:"",images:[],videos:[]}}function K(h,f){u.value.index=h,u.value.title=`商品：${f.title}`,u.value.visible=!0}function w(h){u.value.products[h].comment=_()}function R(){var h;!E.value&&u.value.videos.length<9&&((h=B.value)==null||h.click())}function N(){var h;!E.value&&u.value.videos.length===0&&((h=a.value)==null||h.click())}function m(h){try{if(h.target.files&&h.target.files.length)for(const f of h.target.files){if(E.value)break;const G={src:URL.createObjectURL(f),file:f,visible:!1};u.value.images.push(G)}}finally{B.value.value=""}}async function V(h){var f,G;if(h.target.files&&h.target.files.length)try{const M=await ks(h.target.files[0]);if(M.isFileSizeOver(5)){(f=window.$message)==null||f.warning("文件过大，请更换文件"),M.dispose();return}if(M.duration<5||M.duration>15){(G=window.$message)==null||G.warning("视频时长需要在5-15秒之间"),M.dispose();return}u.value.videos.push({file:M.file,size:M.sizeText,preview:M.thumbnail,src:M.src})}finally{a.value.value=""}}function v(h){u.value.images.splice(h,1)}function X({src:h,type:f}){u.value.preview.visible=!0,u.value.preview.src=h,u.value.preview.type=f}async function oe(){F.value[u.value.index].comment={hasComment:!0,mode:0,text:u.value.text,images:u.value.images.map(h=>({file:h.file,src:h.src})),videos:u.value.videos.map(h=>({file:h.file,preview:h.preview,src:h.src,type:h.type}))},u.value.visible=!1,ke(()=>{u.value.text="",u.value.images=[],u.value.videos=[]})}return U({initComment:()=>{i(),u.value=s()}}),(h,f)=>{const G=ue,M=Ie,H=Cs,W=de,k=Me,$=xs,c=bs,Y=nt,Q=me,q=Te,ee=Fe,C=De;return n(),P(le,null,[e("div",Go,[f[12]||(f[12]=e("p",{class:"form-label mb-12px"},"商品评价",-1)),t(c,{"item-layout":"vertical","data-source":u.value.products},{renderItem:l(({item:o,index:r})=>[(n(),g($,{key:o.id},{actions:l(()=>[o.comment.hasComment?(n(),g(k,{key:0,title:"确认删除吗？",placement:"top",onConfirm:()=>w(r)},{default:l(()=>[t(W,{size:"small",danger:""},{default:l(()=>f[10]||(f[10]=[p("删除评价")])),_:1})]),_:2},1032,["onConfirm"])):(n(),g(W,{key:1,size:"small",onClick:x=>K(r,o)},{default:l(()=>f[11]||(f[11]=[p("添加评价")])),_:2},1032,["onClick"]))]),default:l(()=>[t(H,{description:o.skuList.join(";")||"-"},{title:l(()=>[e("p",null,[o.main?(n(),g(G,{key:0,color:"purple"},{default:l(()=>f[7]||(f[7]=[p("主商品")])),_:1})):D("",!0),p(" "+T(o.title),1)])]),avatar:l(()=>[t(M,{height:"60px",width:"60px",src:o.image,fallback:y(Ae)},null,8,["src","fallback"])]),_:2},1032,["description"]),o.comment.hasComment?(n(),P("div",Wo,[e("p",qo,T(o.comment.text),1),e("div",Jo,[o.comment.images&&o.comment.images.length?(n(),P("div",Qo,[(n(!0),P(le,null,ie(o.comment.images,x=>(n(),P("div",{key:x,class:"comment-preview"},[t(M,{src:x.src,height:80,width:80},null,8,["src"])]))),128))])):o.comment.imageUrls&&o.comment.imageUrls.length?(n(),P("div",Xo,[(n(!0),P(le,null,ie(o.comment.imageUrls,x=>(n(),P("div",{key:x,class:"comment-preview"},[t(M,{src:x,height:80,width:80},null,8,["src"])]))),128))])):D("",!0),o.comment.videos&&o.comment.videos.length?(n(),P("div",Zo,[e("img",{src:o.comment.videos[0].preview,height:80,width:80},null,8,ea),e("div",ta,[e("p",{onClick:()=>X(o.comment.videos[0])},[t(y($e)),f[8]||(f[8]=p(" 预览 "))],8,la)])])):o.comment.videoUrls&&o.comment.videoUrls.length?(n(),P("div",sa,[e("img",{src:o.comment.videoUrls[0],height:80,width:80},null,8,oa),e("div",aa,[e("p",{onClick:()=>X(o.comment.videoUrls[0])},[t(y($e)),f[9]||(f[9]=p(" 预览 "))],8,na)])])):D("",!0)])])):D("",!0)]),_:2},1024))]),_:1},8,["data-source"])]),t(C,{open:u.value.visible,"onUpdate:open":f[4]||(f[4]=o=>u.value.visible=o),title:u.value.title,width:800},{footer:l(()=>[t(ee,{size:16},{default:l(()=>[t(W,{onClick:f[3]||(f[3]=()=>u.value.visible=!1)},{default:l(()=>f[17]||(f[17]=[p("取消")])),_:1}),t(W,{type:"primary",onClick:oe},{default:l(()=>f[18]||(f[18]=[p("确定")])),_:1})]),_:1})]),default:l(()=>[t(q,{ref_key:"formRef",ref:b,name:"operate",layout:"vertical",model:u.value},{default:l(()=>[t(Q,{label:"文字",name:"text"},{default:l(()=>[t(Y,{value:u.value.text,"onUpdate:value":f[0]||(f[0]=o=>u.value.text=o),"auto-size":{minRows:6},"show-count":"",maxlength:300,placeholder:"请输入文字评价"},null,8,["value"])]),_:1}),t(Q,null,{label:l(()=>f[13]||(f[13]=[e("p",null,[p(" 图片 "),e("small",{class:"text-danger ml-4px"},"* 图片+视频最多9个，且图片必须小于2.1M")],-1)])),default:l(()=>[e("input",{ref_key:"imageUploadRef",ref:B,type:"file",accept:"image/jpeg,image/png",class:"upload-hidden",multiple:"",onChange:m},null,544),e("div",ia,[u.value.images.length?(n(),g(cs,{key:0,tag:"ul",name:"list",class:"wrap flex gap-8px"},{default:l(()=>[(n(!0),P(le,null,ie(u.value.images,(o,r)=>(n(),P("li",{key:o.src,class:"preview uploder"},[t(M,{width:200,preview:{visible:o.visible,onVisibleChange:x=>o.visible=x},src:o.src},null,8,["preview","src"]),e("img",{src:o.src},null,8,ua),e("div",da,[t(y($e),{onClick:x=>o.visible=!0},null,8,["onClick"]),t(y(Le),{onClick:x=>v(r)},null,8,["onClick"])])]))),128))]),_:1})):D("",!0),u.value.images.length<9&&!E.value?(n(),P("div",{key:1,class:"uploder center v-center flex",onClick:R},[u.value.images.length<9&&!E.value?(n(),g(y(Ue),{key:0})):u.value.images.length<9?(n(),P("div",ra,[e("p",pa,[t(y(Ke))]),f[14]||(f[14]=e("p",{class:"text-center"},"数量已上限",-1))])):D("",!0)])):D("",!0)])]),_:1}),t(Q,{name:"videos"},{label:l(()=>f[15]||(f[15]=[e("p",null,[p(" 视频 "),e("small",{class:"text-danger ml-4px"},"* 视频最多一个，且视频时长必须5-15秒之间")],-1)])),default:l(()=>[e("input",{ref_key:"videoUploadRef",ref:a,type:"file",accept:"video/*",class:"upload-hidden",onChange:V},null,544),u.value.videos.length?(n(),P("div",ca,[e("img",{src:u.value.videos[0].preview},null,8,va),e("div",ma,[t(y($e),{onClick:f[1]||(f[1]=()=>X(u.value.videos[0]))}),t(y(Le),{onClick:f[2]||(f[2]=()=>u.value.videos=[])})])])):D("",!0),u.value.videos.length?D("",!0):(n(),P("div",{key:1,class:"uploder center v-center flex",onClick:N},[u.value.videos.length===0&&!E.value?(n(),g(y(Ue),{key:0})):u.value.videos.length===0?(n(),P("div",fa,[e("p",ga,[t(y(Ke))]),f[16]||(f[16]=e("p",{class:"text-center"},"数量已上限",-1))])):D("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),(n(),g(vs,{to:"body"},[t(ot,{name:"fade",mode:"out-in"},{default:l(()=>[u.value.preview.visible?(n(),P("div",{key:0,class:"file-preview center v-center flex",onClick:f[6]||(f[6]=o=>u.value.preview.visible=!1)},[e("div",_a,[e("video",{controls:"",autoplay:"",onClick:f[5]||(f[5]=ms(()=>{},["stop"]))},[e("source",{src:u.value.preview.src,type:u.value.preview.type},null,8,ka)])])])):D("",!0)]),_:1})]))],64)}}}),ya=ce(wa,[["__scopeId","data-v-78de0f4e"]]),ba={class:"line"},xa={class:"line"},Ca=pe({name:"PlanTaskAgreement",__name:"agreement",setup(z){const U=Ne({dayLimit:2,dayLimitChecked:!0,freeTimeBehaviorChecked:!0,aiScrollChecked:!0,common:!0}),B=a=>{U[a]=!0};return(a,b)=>{const i=qe,F=me;return n(),g(F,{label:"友情提示"},{default:l(()=>[e("div",null,[e("div",ba,[e("p",null,[t(i,{checked:U.dayLimitChecked,"onUpdate:checked":b[0]||(b[0]=u=>U.dayLimitChecked=u),onChange:b[1]||(b[1]=()=>B("dayLimitChecked"))},{default:l(()=>[p(" 组网限制日均"+T(U.dayLimit)+"单 ",1)]),_:1},8,["checked"])]),e("p",null,[t(i,{checked:U.freeTimeBehaviorChecked,"onUpdate:checked":b[2]||(b[2]=u=>U.freeTimeBehaviorChecked=u),onChange:b[3]||(b[3]=()=>B("freeTimeBehaviorChecked"))},{default:l(()=>b[8]||(b[8]=[p(" 闲暇时光做动态浏览 ")])),_:1},8,["checked"])])]),e("div",xa,[e("p",null,[t(i,{checked:U.aiScrollChecked,"onUpdate:checked":b[4]||(b[4]=u=>U.aiScrollChecked=u),onChange:b[5]||(b[5]=()=>B("aiScrollChecked"))},{default:l(()=>b[9]||(b[9]=[p(" AI 判断手指不同滑动 ")])),_:1},8,["checked"])]),e("p",null,[t(i,{checked:U.common,"onUpdate:checked":b[6]||(b[6]=u=>U.common=u),onChange:b[7]||(b[7]=()=>B("common"))},{default:l(()=>b[10]||(b[10]=[p(" 请保持手机常亮，它要每天学习不同使用手机的习惯 ")])),_:1},8,["checked"])])])])]),_:1})}}}),Is=ce(Ca,[["__scopeId","data-v-bb134eb8"]]),Ss=pe({name:"PlanTaskExcludeAreaSelect",__name:"exclude-area-select",props:ve({label:{default:"排除地区"},name:{default:"excludeArea"},allowClear:{type:Boolean,default:!0},placeholder:{default:"不排除"}},{value:{default:[]},valueModifiers:{}}),emits:["update:value"],setup(z){const U=ns.SHOW_PARENT,{chinaArea:B}=Ks(),a=re(z,"value"),b=z;return(i,F)=>{const u=ns,E=me;return n(),g(E,{label:b.label,name:b.name},{default:l(()=>[t(u,{value:a.value,"onUpdate:value":F[0]||(F[0]=s=>a.value=s),"tree-data":y(B),"tree-checkable":"","allow-clear":i.allowClear,"show-checked-strategy":y(U),"search-placeholder":b.allowClear,placeholder:b.placeholder},null,8,["value","tree-data","allow-clear","show-checked-strategy","search-placeholder","placeholder"])]),_:1},8,["label","name"])}}}),ha={class:"body"},Pa={class:"space-between v-center flex"},$a={key:0,class:"option-disabled"},Aa={key:1},Ia={class:"info"},Sa={class:"v-center form-inline flex"},Ta={key:3,class:"v-center form-inline flex"},Ua=pe({name:"PlanTaskAgainDrawer",__name:"again-drawer",props:ve({rowData:{default:null},userInfo:{},mode:{default:()=>[]},platform:{default:0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ve(["submitted"],["update:visible"]),setup(z,{emit:U}){const B=_s(),a=re(z,"visible"),b=ne(null),i=ne(null),F=ne(null),{formRef:u,validate:E,resetFields:s,validateFields:_}=Ee(),{defaultRequiredRule:K,createRequiredRule:w}=at(),R=Ne({loading:!1,spinLoading:!1}),N=z,m=ne(X()),V=U,v={mode:K,shopId:w("请选择店铺"),count:K,price:K,pairScope:K,pairMultiple:K};ge(a,async W=>{if(W){if(s(),m.value=X(),N.rowData){R.spinLoading=!0;try{const{data:k,error:$}=await Gs(N.rowData.id);if($||!(k&&k.code===0)){M();return}k.data.products&&k.data.products.length&&(m.value.multiple=k.data.products.length>1),Object.keys(m.value).forEach(c=>{Object.keys(k.data).includes(c)&&(c==="products"?(m.value.selectedProducts=k.data[c],b.value.setSelectedProducts(k.data[c])):m.value[c]=k.data[c])})}finally{R.spinLoading=!1}}ke(()=>{window.scrollTo(0,0),F.value.initDateRange()})}else ke(()=>{i.value.initComment(),b.value.initSelectedProducts()})});function X(){return{mode:10,friendId:null,deviceId:null,shopId:"",multiple:!1,multiplePlatform:[N.platform],products:[],price:0,count:1,pairScope:0,calculatePairScope:0,pairMultiple:0,maxPairProductCount:0,actions:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,lookPlantingGrass:!0,lookAskEveryone:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0},excludeArea:[],beginTime:"",endTime:""}}function oe(){}function h(){m.value.products=[],ke(()=>{b.value.initSelectedProducts()})}function f(){_("shopId")}function G(){m.value.products.length||(m.value.price=0);const W=B.createCalculator(0);for(const k of m.value.products){const $=B.createCalculator(k.count).multiply(k.price).getResult();W.add($)}m.value.price=W.multiply(m.value.count).getResult(),(m.value.pairScope===0||m.value.pairScope===m.value.calculatePairScope)&&(m.value.calculatePairScope=B.createCalculator(m.value.price).multiply(.1).getResult(),m.value.calculatePairScope<10&&(m.value.calculatePairScope=10),m.value.pairScope=m.value.calculatePairScope)}function M(){a.value=!1}async function H(){var c,Y,Q,q,ee,C,o;if(await E(),m.value.products.length===0){(c=window.$message)==null||c.warning("请选择要下发任务的商品");return}for(const r of m.value.products)if(r.skuCount>0&&r.skuList.length===0){(Y=window.$message)==null||Y.warning(`${r.title} 未选择Sku`);return}else if(r.main&&!r.keyword){(Q=window.$message)==null||Q.warning(`${r.title} 商品关键词未填写`);return}else if(r.price===0){(q=window.$message)==null||q.warning(`${r.title} 商品价格必须大于0`);return}else if(r.count===0){(ee=window.$message)==null||ee.warning(`${r.title} 件数必须大于0`);return}else if(r.scope===0){(C=window.$message)==null||C.warning(`${r.title} 购买差额必须大于0`);return}const W={oldTaskId:N.rowData.id,mode:m.value.mode,shopId:m.value.shopId,shopName:m.value.products[0].shopName,friendId:m.value.friendId,deviceId:m.value.deviceId,multiplePlatform:m.value.multiplePlatform,products:m.value.products.map(r=>{var I,d,A;let x=((I=r.comment)==null?void 0:I.hasComment)||!1;x&&!r.comment.text&&(!r.comment.images||!r.comment.images.length)&&(!r.comment.videos||!r.comment.videos.length)&&(!r.comment.videoUrls||!r.comment.videoUrls.length)&&(!r.comment.imageUrls||!r.comment.imageUrls.length)&&(x=!1);const S=x?{mode:r.comment.mode,text:r.comment.text||"",imageUrls:r.comment.imageUrls,images:(d=r.comment.images)==null?void 0:d.map(j=>j.file),videoUrls:r.comment.videoUrls,videos:(A=r.comment.videos)==null?void 0:A.map(j=>j.file)}:null;return{id:r.id,title:r.title,url:r.url,image:r.image,keyword:r.keyword,price:r.price,scope:r.scope,count:r.count,skuList:r.skuList,comment:S,main:r.main}}),pairScope:m.value.pairScope,price:m.value.price,count:m.value.count,maxPairProductCount:m.value.maxPairProductCount,actions:{addCart:m.value.actions.addCart,favorite:m.value.actions.favorite,lookAskEveryone:m.value.actions.lookAskEveryone,lookComment:m.value.actions.lookComment,lookPlantingGrass:m.value.actions.lookPlantingGrass,shopAround:{...m.value.actions.shopAround},useFindBrowse:m.value.actions.useFindBrowse,useFirstBrowse:m.value.actions.useFirstBrowse,useWaitForBuy:m.value.actions.useWaitForBuy},excludeArea:[...m.value.excludeArea],beginTime:m.value.beginTime,endTime:m.value.endTime},{data:k,error:$}=await Ws(W);R.loading=!0;try{!$&&k&&k.code===0&&((o=window.$message)==null||o.success("保存成功"),V("submitted"),M())}finally{R.loading=!1}}return(W,k)=>{const $=ze,c=Se,Y=me,Q=He,q=Te,ee=de,C=Fe,o=De;return n(),g(o,{open:a.value,"onUpdate:open":k[16]||(k[16]=r=>a.value=r),title:"快速发布",width:750,push:!1},{footer:l(()=>[t(C,{size:16},{default:l(()=>[t(ee,{onClick:M},{default:l(()=>k[27]||(k[27]=[p("取消")])),_:1}),t(ee,{type:"primary",disabled:R.spinLoading,loading:R.loading,onClick:H},{default:l(()=>k[28]||(k[28]=[p(" 保存 ")])),_:1},8,["disabled","loading"])]),_:1})]),default:l(()=>[e("div",ha,[t(q,{ref_key:"formRef",ref:u,name:"operate",layout:"vertical",model:m.value,rules:v},{default:l(()=>[t(Y,{name:"mode",label:"任务模式"},{default:l(()=>[t(c,{value:m.value.mode,"onUpdate:value":k[0]||(k[0]=r=>m.value.mode=r),disabled:"",onChange:oe},{default:l(()=>[(n(!0),P(le,null,ie(N.mode,r=>(n(),g($,{key:r.value,value:r.value},{default:l(()=>[e("p",Pa,[e("span",null,T(r.label),1),!N.userInfo.isSettlement&&(r.value===0||r.value===1)?(n(),P("span",$a," 设置结算收款码后，才可以使用联网配对 ")):(n(),P("span",Aa,[e("span",Ia,T(N.mode.filter(x=>x.value===r.value)[0].info),1)]))])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),m.value.mode===0||m.value.mode===1?(n(),g(Y,{key:0,name:"multiplePlatform"},{label:l(()=>k[17]||(k[17]=[e("p",null,[p(" 匹配平台 "),e("small",{class:"text-danger ml-1"},"* 可选择多平台匹配")],-1)])),default:l(()=>[t(c,{value:m.value.multiplePlatform,"onUpdate:value":k[1]||(k[1]=r=>m.value.multiplePlatform=r),mode:"multiple",placeholder:"请选择平台"},{default:l(()=>[(n(!0),P(le,null,ie(y(je),r=>(n(),g($,{key:r.value,value:r.value},{default:l(()=>[p(T(r.label)+"联盟 ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):D("",!0),m.value.mode===1?(n(),g(hs,{key:1,value:m.value.friend,"onUpdate:value":k[2]||(k[2]=r=>m.value.friend=r)},null,8,["value"])):m.value.mode===20?(n(),g(Ps,{key:2,value:m.value.deviceId,"onUpdate:value":k[3]||(k[3]=r=>m.value.deviceId=r)},null,8,["value"])):D("",!0),t(Y,{name:"shopId",label:"任务店铺"},{default:l(()=>[t(it,{value:m.value.shopId,"onUpdate:value":k[4]||(k[4]=r=>m.value.shopId=r),platform:2,remote:!0,"allow-clear":!0,"show-search":!0,onChange:h},null,8,["value"])]),_:1}),t(Oo,{ref_key:"productSelectRef",ref:b,products:m.value.products,"onUpdate:products":k[5]||(k[5]=r=>m.value.products=r),multiple:m.value.multiple,"onUpdate:multiple":k[6]||(k[6]=r=>m.value.multiple=r),"shop-id":m.value.shopId,onShopValidate:f,onSubmitted:G},null,8,["products","multiple","shop-id"]),e("div",Sa,[t(Y,{name:"count",label:"任务单数"},{default:l(()=>[t(Q,{value:m.value.count,"onUpdate:value":k[7]||(k[7]=r=>m.value.count=r),min:1,max:100,controls:!1,precision:0,onChange:G},{addonAfter:l(()=>k[18]||(k[18]=[e("span",null,"单",-1)])),_:1},8,["value"])]),_:1}),t(Y,{name:"price"},{label:l(()=>k[19]||(k[19]=[e("p",null,[p(" 任务总价 "),e("small",{class:"text-danger ml-1"},"* 系统自动计算无需填写")],-1)])),default:l(()=>[t(Q,{value:m.value.price,"onUpdate:value":k[8]||(k[8]=r=>m.value.price=r),min:0,max:99999,controls:!1,precision:2,readonly:""},{addonAfter:l(()=>k[20]||(k[20]=[e("span",null,"元",-1)])),_:1},8,["value"])]),_:1})]),m.value.mode===0||m.value.mode===1?(n(),P("div",Ta,[t(Y,{name:"pairScope"},{label:l(()=>k[21]||(k[21]=[e("p",null,[p(" 配对差额 "),e("small",{class:"text-danger ml-1"},"* 与好友任务的价格相差上下浮动值")],-1)])),default:l(()=>[t(Q,{value:m.value.pairScope,"onUpdate:value":k[9]||(k[9]=r=>m.value.pairScope=r),min:0,controls:!1,precision:2},{addonBefore:l(()=>k[22]||(k[22]=[e("span",null,"±",-1)])),addonAfter:l(()=>k[23]||(k[23]=[e("span",null,"元",-1)])),_:1},8,["value"])]),_:1}),t(Y,{name:"maxPairProductCount"},{label:l(()=>k[24]||(k[24]=[e("p",null,[p(" 多链接匹配 "),e("small",{class:"text-danger ml-1"},"*范围：0-5，为 0 不限制")],-1)])),default:l(()=>[t(Q,{value:m.value.maxPairProductCount,"onUpdate:value":k[10]||(k[10]=r=>m.value.maxPairProductCount=r),min:0,max:5,controls:!1,precision:0},{addonBefore:l(()=>k[25]||(k[25]=[e("span",null,"允许最大",-1)])),addonAfter:l(()=>k[26]||(k[26]=[e("span",null,"链接数",-1)])),_:1},8,["value"])]),_:1})])):D("",!0),t($s,{actions:m.value.actions,"onUpdate:actions":k[11]||(k[11]=r=>m.value.actions=r)},null,8,["actions"]),t(ya,{ref_key:"planTaskCommentRef",ref:i,products:m.value.products,"onUpdate:products":k[12]||(k[12]=r=>m.value.products=r)},null,8,["products"]),t(Ss,{value:m.value.excludeArea,"onUpdate:value":k[13]||(k[13]=r=>m.value.excludeArea=r)},null,8,["value"]),t(As,{ref_key:"planTaskTimePickerRef",ref:F,"begin-time":m.value.beginTime,"onUpdate:beginTime":k[14]||(k[14]=r=>m.value.beginTime=r),"end-time":m.value.endTime,"onUpdate:endTime":k[15]||(k[15]=r=>m.value.endTime=r)},null,8,["begin-time","end-time"]),t(Is,{platform:0})]),_:1},8,["model"]),t(We,{loading:R.spinLoading},null,8,["loading"])])]),_:1},8,["open"])}}}),Fa=ce(Ua,[["__scopeId","data-v-794fc990"]]),Da={class:"space-between v-center mb-12px flex"},Ra={class:"products"},Ba={class:"v-center mb-6px flex gap-8px"},Ma=["onClick"],La={class:"v-center flex gap-8px"},Na={class:"products-image"},Ea={class:"products-body"},Ha={class:"sku"},Oa={class:"mb-6px"},za={class:"v-center flex gap-8px"},Va={class:"v-center num-container flex gap-8px"},Ya={class:"v-center del-btn flex gap-6px"},ja={class:"text-center"},Ka={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ga={class:"flex-1"},Wa={class:"w-full flex-y-center justify-end gap-12px"},qa=pe({__name:"product-select",props:ve({shopId:{default:""}},{products:{default:[]},productsModifiers:{},multiple:{type:Boolean,default:!1},multipleModifiers:{}}),emits:ve(["submitted","shopValidate"],["update:products","update:multiple"]),setup(z,{expose:U,emit:B}){const a=re(z,"products"),b=re(z,"multiple"),i=ne(h()),{tableWrapperRef:F,scrollConfig:u}=et(),{columns:E,data:s,getData:_,getDataByPage:K,loading:w,mobilePagination:R,searchParams:N,resetSearchParams:m}=tt({apiFn:G,apiParams:{platform:30,shopId:"",url:"",title:"",itemId:"",pageIndex:1,pageSize:10},columns:M}),{checkedRowKeys:V,rowSelection:v}=lt(s,_),X=z,oe=B;ge(()=>i.value.visible,C=>{C||q()}),ge(V,C=>{if(!b.value&&C.length>1){const o=V.value.at(-1);V.value.splice(0,V.value.length,...o!==void 0?[o]:[]),v.value.selectedRowKeys=[o],v.value.selectedRows=v.value.selectedRows.filter(r=>r.id===o)}}),ge(()=>i.value.products,C=>{var r;for(const x of C){const S=a.value.findIndex(I=>I.id===x.id);S>-1?(a.value[S].skuList=x.selectedSkuMap?JSON.parse(x.selectedSkuMap):[],a.value[S].keyword=x.keyword,a.value[S].count=x.count,a.value[S].price=x.price,a.value[S].scope=x.scope,a.value[S].main=x.main):a.value.push({id:x.id,shopName:x.shopName,url:x.url,image:x.image,title:x.title,keyword:x.keyword,skuCount:((r=x.skuMap)==null?void 0:r.length)||0,skuList:x.selectedSkuMap?JSON.parse(x.selectedSkuMap):[],count:x.count,price:x.price,scope:x.scope,main:x.main})}const o=C.map(x=>x.id);a.value=a.value.filter(x=>o.includes(x.id)),oe("submitted")},{deep:!0}),Ve(()=>{W()});function h(){return{visible:!1,products:[],loading:!0}}async function f(){if(X.shopId===""||X.shopId==="0"){oe("shopValidate");return}i.value.visible=!0;try{N.shopId!==X.shopId&&(i.value.loading=!0,N.shopId=X.shopId,await K(1))}finally{i.value.loading&&(i.value.loading=!1)}}function G(C){return i.value.visible?ys({...C}):Promise.resolve({code:0,msg:"",data:{count:0,list:[],pageIndex:1,pageSize:10}})}function M(){return[{key:"image",dataIndex:"image",title:"商品主图",width:80,customRender({record:o}){return t("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[t(Ie,{width:64,height:64,src:o.image,fallback:Ae},null)])}},{key:"title",dataIndex:"title",title:"商品"},{key:"shopName",dataIndex:"shopName",title:"店铺",width:200}]}function H(){var o;if(!N.url)return;const C=new URL(N.url);if(N.itemId=C.searchParams.get("id")||"",!N.itemId){(o=window.$message)==null||o.warning("商品链接解析失败，请核对链接或手动填写商品Id");return}N.url=`${C.protocol}//${C.host}${C.pathname}?id=${i.value.itemId}`}async function W(){try{const{data:C,error:o}=await dt();!o&&C&&C.code===0&&(i.value.shopNameEnum=C.data.list)}catch{}}function k(){ke(()=>{var C;!b.value&&i.value.products.length>1&&((C=window.$message)==null||C.warning("只能保留一个商品，请删除其他商品"),b.value=!0)})}function $(C,o){o.main?i.value.products.forEach((r,x)=>r.main=x===C):i.value.products.filter(r=>r.main).length===0&&(o.main=!0)}function c(){const C=v.value.selectedRows.map((o,r)=>({id:o.id,shopName:o.shopName,url:o.url,image:o.image,title:o.title,keyword:"",skuMap:o.skuMap.map(x=>({sku:x.sku,price:x.price,value:JSON.stringify(x.sku),label:x.sku.join("+")})),selectedSkuMap:null,skuList:[],count:1,price:0,scope:10,main:r===0}));if(b.value)for(const o of C)i.value.products.filter(r=>r.id===o.id).length||(o.main=i.value.products.filter(r=>r.main).length===0,i.value.products.push(o));else(i.value.products.length===0||C[0].id!==i.value.products[0].id)&&(i.value.products=[C[0]]);i.value.visible=!1}function Y(C){const o=i.value.products[C].skuMap.filter(r=>r.value===i.value.products[C].selectedSkuMap);o&&o.length?i.value.products[C].price=o[0].price:i.value.products[C].price=0}function Q(C){i.value.products=i.value.products.filter((o,r)=>r!==C),i.value.products.length&&!i.value.products.filter(o=>o.main).length&&(i.value.products[0].main=!0)}function q(){V.value=[],v.value.selectedRowKeys=[],v.value.selectedRows=[]}function ee(C){var o;C?window.open(C):(o=window.$message)==null||o.warning("该商品没有添加商品链接，无法跳转")}return U({initSelectedProducts:()=>{i.value=h(),q()}}),(C,o)=>{const r=qe,x=Ie,S=Se,I=ue,d=Ge,A=He,j=_e,se=de,ae=Me,J=me,fe=ut,be=Xe,xe=Ze,Ce=Qe,he=Te,we=st,Re=Fe,Be=De;return n(),P(le,null,[e("p",Da,[e("span",null,"商品列表(已选 "+T(i.value.products.length)+" 个)",1),t(r,{checked:b.value,"onUpdate:checked":o[0]||(o[0]=L=>b.value=L),onChange:k},{default:l(()=>o[8]||(o[8]=[p("多商品")])),_:1},8,["checked"])]),e("ul",Ra,[(n(!0),P(le,null,ie(i.value.products,(L,ye)=>(n(),P("li",{key:L.id},[e("div",Ba,[b.value?(n(),g(r,{key:0,checked:L.main,"onUpdate:checked":Z=>L.main=Z,onChange:()=>$(ye,L)},{default:l(()=>o[9]||(o[9]=[p(" 主商品 ")])),_:2},1032,["checked","onUpdate:checked","onChange"])):D("",!0),e("p",{class:"title",onClick:Z=>ee(L.url)},T(L.title),9,Ma)]),e("div",La,[e("div",Na,[t(x,{width:100,height:100,src:L.image,fallback:y(Ae)},null,8,["src","fallback"])]),e("div",Ea,[e("div",Ha,[L.skuMap.length?(n(),g(S,{key:0,value:L.selectedSkuMap,"onUpdate:value":Z=>L.selectedSkuMap=Z,options:L.skuMap,placeholder:"请选择商品Sku",onChange:Z=>Y(ye)},null,8,["value","onUpdate:value","options","onChange"])):(n(),g(I,{key:1},{default:l(()=>o[10]||(o[10]=[p("该商品无Sku")])),_:1}))]),e("div",Oa,[t(d,{value:L.keyword,"onUpdate:value":Z=>L.keyword=Z,placeholder:L.main?"请输入搜索关键词":"没有输入输入关键词则进店查找"},null,8,["value","onUpdate:value","placeholder"])]),e("div",za,[e("div",Va,[t(A,{value:L.price,"onUpdate:value":Z=>L.price=Z,min:0,max:99999,controls:!1,precision:2},{addonBefore:l(()=>o[11]||(o[11]=[e("span",null,"价格",-1)])),addonAfter:l(()=>o[12]||(o[12]=[e("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"]),t(A,{value:L.count,"onUpdate:value":Z=>L.count=Z,min:1,max:99999,controls:!1,precision:0},{addonBefore:l(()=>o[13]||(o[13]=[e("span",null,"购买",-1)])),addonAfter:l(()=>o[14]||(o[14]=[e("span",null,"件",-1)])),_:2},1032,["value","onUpdate:value"]),t(A,{value:L.scope,"onUpdate:value":Z=>L.scope=Z,min:0,max:99999,controls:!1,precision:2},{addonBefore:l(()=>[t(j,{placement:"top"},{title:l(()=>o[15]||(o[15]=[e("span",null,"下单商品时商品单价与填写价格相差符合差额范围内才下单",-1)])),default:l(()=>[o[16]||(o[16]=e("span",null,"浮动差额 ±",-1))]),_:1})]),addonAfter:l(()=>o[17]||(o[17]=[e("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"])]),e("div",Ya,[t(ae,{title:"确认删除吗？",placement:"left",onConfirm:()=>Q(ye)},{default:l(()=>[t(se,{danger:"",size:"small"},{default:l(()=>o[18]||(o[18]=[p("删除")])),_:1})]),_:2},1032,["onConfirm"])])])])])]))),128))]),b.value||i.value.products.length===0?(n(),P("div",{key:0,class:"actions mb-12px",onClick:f},[e("p",ja,[t(y(Ue)),o[19]||(o[19]=p(" 添加商品 "))])])):D("",!0),t(Be,{open:i.value.visible,"onUpdate:open":o[7]||(o[7]=L=>i.value.visible=L),title:"商品选择",width:800},{footer:l(()=>[t(Re,{size:16},{default:l(()=>[t(se,{onClick:o[6]||(o[6]=()=>i.value.visible=!1)},{default:l(()=>o[22]||(o[22]=[p("取消")])),_:1}),t(se,{type:"primary",disabled:y(V).length===0,onClick:c},{default:l(()=>o[23]||(o[23]=[p("确定")])),_:1},8,["disabled"])]),_:1})]),default:l(()=>[e("div",Ka,[t(he,{model:y(N),"label-col":{span:5,md:7}},{default:l(()=>[t(Ce,{class:"row",gutter:[16,16],wrap:""},{default:l(()=>[t(fe,{span:12},{default:l(()=>[t(J,{label:"商品链接",name:"url",class:"m-0"},{default:l(()=>[t(d,{value:y(N).url,"onUpdate:value":o[1]||(o[1]=L=>y(N).url=L),placeholder:"",onBlur:H},null,8,["value"])]),_:1})]),_:1}),t(fe,{span:12},{default:l(()=>[t(J,{label:"商品编号",name:"itemId",class:"m-0"},{default:l(()=>[t(d,{value:y(N).itemId,"onUpdate:value":o[2]||(o[2]=L=>y(N).itemId=L),placeholder:""},null,8,["value"])]),_:1})]),_:1}),t(fe,{span:12},{default:l(()=>[t(J,{label:"商品名称",name:"title",class:"m-0"},{default:l(()=>[t(d,{value:y(N).title,"onUpdate:value":o[3]||(o[3]=L=>y(N).title=L),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e("div",Ga,[t(J,{class:"m-0"},{default:l(()=>[e("div",Wa,[t(se,{onClick:o[4]||(o[4]=L=>y(m)())},{icon:l(()=>[t(be,{class:"align-sub text-icon"})]),default:l(()=>[o[20]||(o[20]=e("span",{class:"ml-8px"},"重置",-1))]),_:1}),t(se,{type:"primary",ghost:"",onClick:o[5]||(o[5]=L=>y(K)(1))},{icon:l(()=>[t(xe,{class:"align-sub text-icon"})]),default:l(()=>[o[21]||(o[21]=e("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"]),t(we,{ref_key:"tableWrapperRef",ref:F,columns:y(E),"data-source":y(s),size:"small","row-selection":y(v),scroll:y(u),loading:y(w),"row-key":"id",pagination:y(R),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),t(We,{loading:i.value.loading},null,8,["loading"])])]),_:1},8,["open"])],64)}}}),Ja=ce(qa,[["__scopeId","data-v-9578a669"]]),Qa={class:"mb-12px"},Xa={key:0},Za={class:"mb-8px"},en={class:"wrap flex gap-8px"},tn={key:0,class:"comment-preview"},ln=["src"],sn={class:"wrap v-center center flex gap-8px"},on=["onClick"],an={class:"wrap flex gap-8px"},nn=["src"],un={class:"wrap v-center center flex gap-8px"},dn={key:1,class:"stop"},rn={class:"text-center"},pn={key:0,class:"preview uploder"},cn=["src"],vn={class:"wrap v-center center flex gap-8px"},mn={key:1,class:"stop"},fn={class:"text-center"},gn={class:"video"},_n=["src","type"],kn=pe({name:"PlanTaskComment",__name:"product-comment",props:{products:{default:[]},productsModifiers:{}},emits:["update:products"],setup(z,{expose:U}){const B=ne(null),a=ne(null),{formRef:b,resetFields:i}=Ee(),F=re(z,"products"),u=ne(s()),E=ps(()=>u.value.images.length+u.value.videos.length===6);ge(F,h=>{if(h&&h.length){const f=h.map(M=>{const H={...M};return(!H.comment||!H.comment.hasComment)&&(H.comment=_()),H}),G=h.map(M=>M.id);u.value.products=u.value.products.filter(M=>G.includes(M.id));for(const M of f){const H=u.value.products.findIndex(W=>W.id===M.id);H>-1?Object.assign(u.value.products[H],M):u.value.products.push(M)}}else u.value.products=[]},{deep:!0});function s(){return{products:[],visible:!1,index:-1,title:"",text:"",images:[],videos:[],preview:{visible:!1,src:"",type:""}}}function _(){return{hasComment:!1,text:"",images:[],videos:[]}}function K(h,f){u.value.index=h,u.value.title=`商品：${f.title}`,u.value.visible=!0}function w(h){u.value.products[h].comment=_()}function R(){var h;!E.value&&u.value.videos.length<6&&((h=B.value)==null||h.click())}function N(){var h;!E.value&&u.value.videos.length===0&&((h=a.value)==null||h.click())}function m(h){try{if(h.target.files&&h.target.files.length)for(const f of h.target.files){if(E.value)break;const G={src:URL.createObjectURL(f),file:f,visible:!1};u.value.images.push(G)}}finally{B.value.value=""}}async function V(h){var f,G;if(h.target.files&&h.target.files.length)try{const M=await ks(h.target.files[0]);if(M.isFileSizeOver(5)){(f=window.$message)==null||f.warning("文件过大，请更换文件"),M.dispose();return}if(M.duration<5||M.duration>15){(G=window.$message)==null||G.warning("视频时长需要在5-15秒之间"),M.dispose();return}u.value.videos.push({file:M.file,size:M.sizeText,preview:M.thumbnail,src:M.src})}finally{a.value.value=""}}function v(h){u.value.images.splice(h,1)}function X({src:h,type:f}){u.value.preview.visible=!0,u.value.preview.src=h,u.value.preview.type=f}async function oe(){F.value[u.value.index].comment={hasComment:!0,mode:0,text:u.value.text,images:u.value.images.map(h=>({file:h.file,src:h.src})),videos:u.value.videos.map(h=>({file:h.file,preview:h.preview,src:h.src,type:h.type}))},u.value.visible=!1,ke(()=>{u.value.text="",u.value.images=[],u.value.videos=[]})}return U({initComment:()=>{i(),u.value=s()}}),(h,f)=>{const G=ue,M=Ie,H=Cs,W=de,k=Me,$=xs,c=bs,Y=nt,Q=me,q=Te,ee=Fe,C=De;return n(),P(le,null,[e("div",Qa,[f[11]||(f[11]=e("p",{class:"form-label mb-12px"},"商品评价",-1)),t(c,{"item-layout":"vertical","data-source":u.value.products},{renderItem:l(({item:o,index:r})=>[(n(),g($,{key:o.id},{actions:l(()=>[o.comment.hasComment?(n(),g(k,{key:0,title:"确认删除吗？",placement:"top",onConfirm:()=>w(r)},{default:l(()=>[t(W,{size:"small",danger:""},{default:l(()=>f[9]||(f[9]=[p("删除评价")])),_:1})]),_:2},1032,["onConfirm"])):(n(),g(W,{key:1,size:"small",onClick:x=>K(r,o)},{default:l(()=>f[10]||(f[10]=[p("添加评价")])),_:2},1032,["onClick"]))]),default:l(()=>[t(H,{description:o.skuList.join(";")||"-"},{title:l(()=>[e("p",null,[o.main?(n(),g(G,{key:0,color:"purple"},{default:l(()=>f[7]||(f[7]=[p("主商品")])),_:1})):D("",!0),p(" "+T(o.title),1)])]),avatar:l(()=>[t(M,{height:"60px",width:"60px",src:o.image,fallback:y(Ae)},null,8,["src","fallback"])]),_:2},1032,["description"]),o.comment.hasComment?(n(),P("div",Xa,[e("p",Za,T(o.comment.text),1),e("div",en,[(n(!0),P(le,null,ie(o.comment.images,x=>(n(),P("div",{key:x,class:"comment-preview"},[t(M,{src:x.src,height:80,width:80},null,8,["src"])]))),128)),o.comment.videos.length?(n(),P("div",tn,[e("img",{src:o.comment.videos[0].preview,height:80,width:80},null,8,ln),e("div",sn,[e("p",{onClick:()=>X(o.comment.videos[0])},[t(y($e)),f[8]||(f[8]=p(" 预览 "))],8,on)])])):D("",!0)])])):D("",!0)]),_:2},1024))]),_:1},8,["data-source"])]),t(C,{open:u.value.visible,"onUpdate:open":f[4]||(f[4]=o=>u.value.visible=o),title:u.value.title,width:800},{footer:l(()=>[t(ee,{size:16},{default:l(()=>[t(W,{onClick:f[3]||(f[3]=()=>u.value.visible=!1)},{default:l(()=>f[16]||(f[16]=[p("取消")])),_:1}),t(W,{type:"primary",onClick:oe},{default:l(()=>f[17]||(f[17]=[p("确定")])),_:1})]),_:1})]),default:l(()=>[t(q,{ref_key:"formRef",ref:b,name:"operate",layout:"vertical",model:u.value},{default:l(()=>[t(Q,{label:"文字",name:"text"},{default:l(()=>[t(Y,{value:u.value.text,"onUpdate:value":f[0]||(f[0]=o=>u.value.text=o),"auto-size":{minRows:6},"show-count":"",maxlength:300,placeholder:"请输入文字评价"},null,8,["value"])]),_:1}),t(Q,null,{label:l(()=>f[12]||(f[12]=[e("p",null,[p(" 图片 "),e("small",{class:"text-danger ml-4px"},"* 图片+视频最多6个，且图片必须小于3M")],-1)])),default:l(()=>[e("input",{ref_key:"imageUploadRef",ref:B,type:"file",accept:"image/jpeg,image/png",class:"upload-hidden",multiple:"",onChange:m},null,544),e("div",an,[u.value.images.length?(n(),g(cs,{key:0,tag:"ul",name:"list",class:"wrap flex gap-8px"},{default:l(()=>[(n(!0),P(le,null,ie(u.value.images,(o,r)=>(n(),P("li",{key:o.src,class:"preview uploder"},[t(M,{width:200,preview:{visible:o.visible,onVisibleChange:x=>o.visible=x},src:o.src},null,8,["preview","src"]),e("img",{src:o.src},null,8,nn),e("div",un,[t(y($e),{onClick:x=>o.visible=!0},null,8,["onClick"]),t(y(Le),{onClick:x=>v(r)},null,8,["onClick"])])]))),128))]),_:1})):D("",!0),u.value.images.length<6&&!E.value?(n(),P("div",{key:1,class:"uploder center v-center flex",onClick:R},[u.value.images.length<6&&!E.value?(n(),g(y(Ue),{key:0})):u.value.images.length<6?(n(),P("div",dn,[e("p",rn,[t(y(Ke))]),f[13]||(f[13]=e("p",{class:"text-center"},"数量已上限",-1))])):D("",!0)])):D("",!0)])]),_:1}),t(Q,{name:"videos"},{label:l(()=>f[14]||(f[14]=[e("p",null,[p(" 视频 "),e("small",{class:"text-danger ml-4px"},"* 视频最多一个，且视频时长必须5-15秒之间")],-1)])),default:l(()=>[e("input",{ref_key:"videoUploadRef",ref:a,type:"file",accept:"video/*",class:"upload-hidden",onChange:V},null,544),u.value.videos.length?(n(),P("div",pn,[e("img",{src:u.value.videos[0].preview},null,8,cn),e("div",vn,[t(y($e),{onClick:f[1]||(f[1]=()=>X(u.value.videos[0]))}),t(y(Le),{onClick:f[2]||(f[2]=()=>u.value.videos=[])})])])):D("",!0),u.value.videos.length?D("",!0):(n(),P("div",{key:1,class:"uploder center v-center flex",onClick:N},[u.value.videos.length===0&&!E.value?(n(),g(y(Ue),{key:0})):u.value.videos.length===0?(n(),P("div",mn,[e("p",fn,[t(y(Ke))]),f[15]||(f[15]=e("p",{class:"text-center"},"数量已上限",-1))])):D("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),(n(),g(vs,{to:"body"},[t(ot,{name:"fade",mode:"out-in"},{default:l(()=>[u.value.preview.visible?(n(),P("div",{key:0,class:"file-preview center v-center flex",onClick:f[6]||(f[6]=o=>u.value.preview.visible=!1)},[e("div",gn,[e("video",{controls:"",autoplay:"",onClick:f[5]||(f[5]=ms(()=>{},["stop"]))},[e("source",{src:u.value.preview.src,type:u.value.preview.type},null,8,_n)])])])):D("",!0)]),_:1})]))],64)}}}),wn=ce(kn,[["__scopeId","data-v-efd0842d"]]),yn={class:"body"},bn={class:"space-between v-center flex"},xn={key:0,class:"option-disabled"},Cn={key:1},hn={class:"info"},Pn={class:"v-center form-inline flex"},$n={key:0,class:"v-center form-inline flex"},An=pe({name:"PlanTaskCreateDrawer",__name:"create-drawer",props:ve({userInfo:{},mode:{default:()=>[]},platform:{default:0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ve(["submitted"],["update:visible"]),setup(z,{emit:U}){const B=Rs(),a=fs(),b=_s(),i=re(z,"visible"),F=z,{formRef:u,validate:E,resetFields:s,validateFields:_}=Ee(),{defaultRequiredRule:K,createRequiredRule:w}=at(),R=ne(null),N=ne(null),m=ne(null),V=ne(!1),v=ne(h()),X=U,oe={mode:K,shopId:w("请选择店铺"),friendId:w("请选择好友"),deviceId:w("请选择设备"),count:K,price:K,pairScope:K,pairMultiple:K,multiplePlatform:w("请至少选择一个平台")};ge(i,$=>{$?(s(),v.value=h(),ke(()=>{m.value.initDateRange()})):ke(()=>{R.value.initSelectedProducts(),N.value.initComment()})});function h(){return{mode:10,friendId:null,deviceId:null,shopId:"",multiple:!1,multiplePlatform:[F.platform],products:[],price:0,count:1,pairScope:0,calculatePairScope:0,pairMultiple:0,maxPairProductCount:0,actions:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,lookPlantingGrass:!0,lookAskEveryone:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0},excludeArea:[],beginTime:"",endTime:""}}function f($){($===0||$===1)&&(a.userInfo.isSettlement||(window.$modal.confirm({title:"提示",content:"需要先设置结算收款码，现在去设置吗？",okText:"去设置",cancelText:"取消",onOk:()=>{B.push({name:"user-center",hash:"#settlement"})}}),v.value.mode=10))}function G(){v.value.products=[],ke(()=>{R.value.initSelectedProducts()})}function M(){v.value.products.length||(v.value.price=0);const $=b.createCalculator(0);for(const c of v.value.products){const Y=b.createCalculator(c.count).multiply(c.price).getResult();$.add(Y)}v.value.price=$.multiply(v.value.count).getResult(),(v.value.pairScope===0||v.value.pairScope===v.value.calculatePairScope)&&(v.value.calculatePairScope=b.createCalculator(v.value.price).multiply(.1).getResult(),v.value.calculatePairScope<10&&(v.value.calculatePairScope=10),v.value.pairScope=v.value.calculatePairScope)}function H(){_("shopId")}function W(){i.value=!1}async function k(){var Q,q,ee,C,o,r,x,S,I;if(await E(),v.value.products.length===0){(Q=window.$message)==null||Q.warning("请选择要下发任务的商品");return}for(const d of v.value.products){if(d.skuCount>0&&d.skuList.length===0){(q=window.$message)==null||q.warning(`${d.title} 未选择Sku`);return}else if(d.main&&!d.keyword){(ee=window.$message)==null||ee.warning(`${d.title} 商品关键词未填写`);return}else if(d.price===0){(C=window.$message)==null||C.warning(`${d.title} 商品价格必须大于0`);return}else if(d.count===0){(o=window.$message)==null||o.warning(`${d.title} 件数必须大于0`);return}else if(d.scope===0){(r=window.$message)==null||r.warning(`${d.title} 购买差额必须大于0`);return}if((x=d.comment)!=null&&x.hasComment&&!(d.comment.text||d.comment.images&&d.comment.images.length>0||d.comment.videos&&d.comment.videos.length>0)){(S=window.$message)==null||S.warning(`${d.title} 评论内容不能为空（文本/图片/视频至少选一项）`);return}}const $={mode:v.value.mode,platform:30,shopId:v.value.shopId,shopName:v.value.products[0].shopName,friendId:v.value.friendId,deviceId:v.value.deviceId,multiplePlatform:v.value.multiplePlatform,products:v.value.products.map(d=>{var J,fe,be,xe,Ce,he;const A=((J=d.comment)==null?void 0:J.hasComment)||!1,j=((fe=d.comment)==null?void 0:fe.text)||((be=d.comment)==null?void 0:be.images)&&d.comment.images.length>0||((xe=d.comment)==null?void 0:xe.videos)&&d.comment.videos.length>0,ae=A&&j?{hasComment:!0,mode:d.comment.mode,text:d.comment.text||"",images:(Ce=d.comment.images)==null?void 0:Ce.map(we=>we.file),videos:(he=d.comment.videos)==null?void 0:he.map(we=>we.file)}:null;return{id:d.id,title:d.title,url:d.url,image:d.image,keyword:d.keyword,price:d.price,scope:d.scope,count:d.count,skuList:d.skuList,comment:ae,main:d.main}}),pairScope:v.value.pairScope,price:v.value.price,count:v.value.count,maxPairProductCount:v.value.maxPairProductCount,actions:{addCart:v.value.actions.addCart,favorite:v.value.actions.favorite,lookAskEveryone:v.value.actions.lookAskEveryone,lookComment:v.value.actions.lookComment,lookPlantingGrass:v.value.actions.lookPlantingGrass,shopAround:{...v.value.actions.shopAround},useFindBrowse:v.value.actions.useFindBrowse,useFirstBrowse:v.value.actions.useFirstBrowse,useWaitForBuy:v.value.actions.useWaitForBuy},excludeArea:[...v.value.excludeArea],beginTime:v.value.beginTime,endTime:v.value.endTime},{data:c,error:Y}=await qs($);V.value=!0;try{!Y&&c&&c.code===0&&((I=window.$message)==null||I.success("保存成功"),X("submitted"),W())}finally{V.value=!1}}return($,c)=>{const Y=ze,Q=Se,q=me,ee=He,C=Te,o=de,r=Fe,x=De;return n(),g(x,{open:i.value,"onUpdate:open":c[16]||(c[16]=S=>i.value=S),title:"新增任务",width:750,push:!1},{footer:l(()=>[t(r,{size:16},{default:l(()=>[t(o,{onClick:W},{default:l(()=>c[27]||(c[27]=[p("取消")])),_:1}),t(o,{type:"primary",loading:V.value,onClick:k},{default:l(()=>c[28]||(c[28]=[p("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[e("div",yn,[t(C,{ref_key:"formRef",ref:u,name:"operate",layout:"vertical",model:v.value,rules:oe},{default:l(()=>[t(q,{name:"mode",label:"任务模式"},{default:l(()=>[t(Q,{value:v.value.mode,"onUpdate:value":c[0]||(c[0]=S=>v.value.mode=S),onChange:f},{default:l(()=>[(n(!0),P(le,null,ie(F.mode,S=>(n(),g(Y,{key:S.value,value:S.value},{default:l(()=>[e("p",bn,[e("span",null,T(S.label),1),!F.userInfo.isSettlement&&(S.value===0||S.value===1)?(n(),P("span",xn," 设置结算收款码后，才可以使用组网配对 ")):(n(),P("span",Cn,[e("span",hn,T(F.mode.filter(I=>I.value===S.value)[0].info),1)]))])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(ot,{name:"flip",mode:"out-in"},{default:l(()=>[v.value.mode===1?(n(),g(hs,{key:0,value:v.value.friendId,"onUpdate:value":c[1]||(c[1]=S=>v.value.friendId=S)},null,8,["value"])):v.value.mode===20?(n(),g(Ps,{key:1,value:v.value.deviceId,"onUpdate:value":c[2]||(c[2]=S=>v.value.deviceId=S)},null,8,["value"])):D("",!0)]),_:1}),t(q,{name:"shopId",label:"任务店铺"},{default:l(()=>[t(it,{value:v.value.shopId,"onUpdate:value":c[3]||(c[3]=S=>v.value.shopId=S),platform:2,remote:!0,"allow-clear":!0,"show-search":!0,onChange:G},null,8,["value"])]),_:1}),t(Ja,{ref_key:"productSelectRef",ref:R,products:v.value.products,"onUpdate:products":c[4]||(c[4]=S=>v.value.products=S),multiple:v.value.multiple,"onUpdate:multiple":c[5]||(c[5]=S=>v.value.multiple=S),"shop-id":v.value.shopId,onShopValidate:H,onSubmitted:M},null,8,["products","multiple","shop-id"]),e("div",Pn,[t(q,{name:"count",label:"任务单数"},{default:l(()=>[t(ee,{value:v.value.count,"onUpdate:value":c[6]||(c[6]=S=>v.value.count=S),min:1,max:100,controls:!1,precision:0,onChange:M},{addonAfter:l(()=>c[17]||(c[17]=[e("span",null,"单",-1)])),_:1},8,["value"])]),_:1}),t(q,{name:"price"},{label:l(()=>c[18]||(c[18]=[e("p",null,[p(" 任务总价 "),e("small",{class:"text-danger ml-1"},"* 系统自动计算无需填写")],-1)])),default:l(()=>[t(ee,{value:v.value.price,"onUpdate:value":c[7]||(c[7]=S=>v.value.price=S),min:0,max:99999,controls:!1,precision:2,readonly:""},{addonAfter:l(()=>c[19]||(c[19]=[e("span",null,"元",-1)])),_:1},8,["value"])]),_:1})]),v.value.mode===0||v.value.mode===1?(n(),P("div",$n,[t(q,{name:"pairScope"},{label:l(()=>c[20]||(c[20]=[e("p",null,[p(" 配对差额 "),e("small",{class:"text-danger ml-1"},"* 与好友任务的价格相差上下浮动值")],-1)])),default:l(()=>[t(ee,{value:v.value.pairScope,"onUpdate:value":c[8]||(c[8]=S=>v.value.pairScope=S),min:0,controls:!1,precision:2},{addonBefore:l(()=>c[21]||(c[21]=[e("span",null,"±",-1)])),addonAfter:l(()=>c[22]||(c[22]=[e("span",null,"元",-1)])),_:1},8,["value"])]),_:1}),v.value.multiple?(n(),g(q,{key:0,name:"maxPairProductCount"},{label:l(()=>c[23]||(c[23]=[e("p",null,[p(" 多链接匹配 "),e("small",{class:"text-danger ml-1"},"*范围：0-5，为 0 不限制")],-1)])),default:l(()=>[t(ee,{value:v.value.maxPairProductCount,"onUpdate:value":c[9]||(c[9]=S=>v.value.maxPairProductCount=S),min:0,max:5,controls:!1,precision:0},{addonBefore:l(()=>c[24]||(c[24]=[e("span",null,"允许最大",-1)])),addonAfter:l(()=>c[25]||(c[25]=[e("span",null,"链接数",-1)])),_:1},8,["value"])]),_:1})):D("",!0)])):D("",!0),v.value.mode===0||v.value.mode===1?(n(),g(q,{key:1,name:"multiplePlatform"},{label:l(()=>c[26]||(c[26]=[e("p",null,[p(" 匹配平台 "),e("small",{class:"text-danger ml-1"},"* 可选择多平台匹配")],-1)])),default:l(()=>[t(Q,{value:v.value.multiplePlatform,"onUpdate:value":c[10]||(c[10]=S=>v.value.multiplePlatform=S),mode:"multiple",placeholder:"请选择平台"},{default:l(()=>[(n(!0),P(le,null,ie(y(je),S=>(n(),g(Y,{key:S.value,value:S.value},{default:l(()=>[p(T(S.label)+"联盟 ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):D("",!0),t($s,{actions:v.value.actions,"onUpdate:actions":c[11]||(c[11]=S=>v.value.actions=S)},null,8,["actions"]),t(wn,{ref_key:"planTaskCommentRef",ref:N,products:v.value.products,"onUpdate:products":c[12]||(c[12]=S=>v.value.products=S)},null,8,["products"]),t(Ss,{value:v.value.excludeArea,"onUpdate:value":c[13]||(c[13]=S=>v.value.excludeArea=S)},null,8,["value"]),t(As,{ref_key:"planTaskTimePickerRef",ref:m,"begin-time":v.value.beginTime,"onUpdate:beginTime":c[14]||(c[14]=S=>v.value.beginTime=S),"end-time":v.value.endTime,"onUpdate:endTime":c[15]||(c[15]=S=>v.value.endTime=S)},null,8,["begin-time","end-time"]),t(Is,{platform:0})]),_:1},8,["model"])])]),_:1},8,["open"])}}}),In=ce(An,[["__scopeId","data-v-263a5de1"]]),Sn={class:"products"},Tn={class:"v-center mb-6px flex gap-8px"},Un=["onClick"],Fn={class:"v-center flex gap-8px"},Dn={class:"products-image"},Rn={class:"products-body"},Bn={class:"sku"},Mn={key:0,class:"wrap v-center flex gap-5px"},Ln={key:1,class:"wrap v-center flex gap-5px"},Nn={class:"mb-6px"},En={class:"v-center flex gap-8px"},Hn={class:"v-center num-container flex gap-8px"},On={class:"display-item"},zn={class:"value highlight"},Vn={class:"display-item"},Yn={class:"value"},jn={class:"display-item"},Kn={class:"value highlight"},Gn=pe({__name:"sub-Products-modal",props:ve({subProductsData:{default:()=>[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(z){const U=z,B=re(z,"visible");function a(b){var i;b?window.open(b):(i=window.$message)==null||i.warning("该商品没有添加商品链接，无法跳转")}return(b,i)=>{const F=ue,u=Ie,E=gs;return n(),g(E,{open:B.value,"onUpdate:open":i[0]||(i[0]=s=>B.value=s),title:"商品详情",width:800,footer:null},{default:l(()=>[e("ul",Sn,[(n(!0),P(le,null,ie(U.subProductsData,s=>{var _;return n(),P("li",{key:s.id},[e("div",Tn,[s.main?(n(),g(F,{key:0},{default:l(()=>i[1]||(i[1]=[p("主商品")])),_:1})):D("",!0),e("p",{class:"title",onClick:K=>a(s.url)},T(s.title),9,Un)]),e("div",Fn,[e("div",Dn,[t(u,{width:100,height:100,src:s.image,fallback:y(Ae)},null,8,["src","fallback"])]),e("div",Rn,[e("div",Bn,[s.skuList&&((_=s.skuList)!=null&&_.length)?(n(),P("div",Mn,[i[2]||(i[2]=p(" 商品SKU: ")),(n(!0),P(le,null,ie(s.skuList,K=>(n(),g(F,{key:K},{default:l(()=>[p(T(K),1)]),_:2},1024))),128))])):(n(),P("div",Ln,[i[4]||(i[4]=p(" 商品SKU: ")),t(F,null,{default:l(()=>i[3]||(i[3]=[p("该商品无Sku")])),_:1})]))]),e("div",Nn,[e("p",null,"商品关键词:"+T(s.keyword??"—"),1)]),e("div",En,[e("div",Hn,[e("span",On,[i[5]||(i[5]=e("span",{class:"prefix"},"价格",-1)),e("span",zn,T(s.price),1),i[6]||(i[6]=e("span",{class:"suffix"},"元",-1))]),e("span",Vn,[i[7]||(i[7]=e("span",{class:"prefix"},"购买",-1)),e("span",Yn,T(s.count),1),i[8]||(i[8]=e("span",{class:"suffix"},"件",-1))]),e("span",jn,[i[9]||(i[9]=e("span",{class:"prefix"},"浮动差额 ±",-1)),e("span",Kn,T(s.scope),1),i[10]||(i[10]=e("span",{class:"suffix"},"元",-1))])])])])])])}),128))])]),_:1},8,["open"])}}}),Wn=ce(Gn,[["__scopeId","data-v-0bee0d13"]]),qn={class:"body"},Jn={key:0,class:"detail grid-mode grid"},Qn={class:"descriptions"},Xn={class:"grid"},Zn={class:"item"},ei={class:"content"},ti={class:"item"},li={class:"content"},si={class:"item"},oi={class:"content"},ai={class:"item"},ni={class:"content"},ii={key:0,class:"wrap v-center flex gap-5px"},ui={key:1},di={class:"grid-2 grid"},ri={class:"item"},pi={class:"content"},ci={class:"item"},vi={class:"content"},mi={class:"cny"},fi={class:"grid-2 grid"},gi={class:"item"},_i={class:"content"},ki={key:1},wi={class:"item"},yi={class:"content"},bi={class:"cny"},xi={class:"grid-2 grid"},Ci={class:"item"},hi={class:"content"},Pi={class:"cny"},$i={class:"item"},Ai={class:"content"},Ii={class:"cny"},Si={class:"grid"},Ti={class:"item"},Ui={class:"content"},Fi={class:"item"},Di={key:0,class:"content"},Ri={key:1,class:"content"},Bi={class:"grid-2 grid"},Mi={class:"item"},Li={class:"content"},Ni={class:"item"},Ei={class:"content"},Hi={class:"grid-2 grid"},Oi={class:"item"},zi={class:"content"},Vi={class:"item"},Yi={class:"content"},ji={key:0,class:"cny"},Ki={class:"item"},Gi={class:"content"},Wi={class:"item"},qi={class:"content"},Ji={key:0},Qi={key:0},Xi={class:"descriptions"},Zi={class:"grid"},eu={class:"item"},tu={class:"content"},lu={class:"item"},su={class:"content"},ou={class:"item"},au={class:"content"},nu={class:"item"},iu={class:"content"},uu={key:0,class:"wrap v-center flex gap-5px"},du={key:1},ru={class:"grid-2 grid"},pu={class:"item"},cu={class:"content"},vu={class:"item"},mu={class:"content"},fu={class:"cny"},gu={class:"grid-2 grid"},_u={class:"item"},ku={class:"content"},wu={key:1},yu={class:"item"},bu={class:"content"},xu={class:"cny"},Cu={class:"grid-2 grid"},hu={class:"item"},Pu={class:"content"},$u={class:"item"},Au={class:"content"},Iu={class:"grid-2 grid"},Su={class:"item"},Tu={class:"content"},Uu={key:0},Fu={class:"item"},Du={class:"content"},Ru={key:0,class:"cny"},Bu={class:"item"},Mu={class:"content"},Lu={class:"item"},Nu={class:"content"},Eu={key:0},Hu={class:"grid"},Ou={class:"item"},zu={class:"content"},Vu={class:"grid"},Yu={class:"item item-border-hide"},ju={class:"content"},Ku={key:0},Gu={class:"cny"},Wu={key:1,class:"detail"},qu={class:"descriptions"},Ju={class:"grid"},Qu={class:"item"},Xu={class:"content"},Zu={class:"item"},ed={class:"content"},td={class:"item"},ld={class:"content"},sd={class:"item"},od={class:"content"},ad={key:0,class:"wrap v-center flex gap-5px"},nd={key:1},id={class:"grid-2 grid"},ud={class:"item"},dd={class:"content"},rd={class:"item"},pd={class:"content"},cd={class:"cny"},vd={class:"grid-2 grid"},md={class:"item"},fd={class:"content"},gd={key:1},_d={class:"item"},kd={class:"content"},wd={class:"cny"},yd={class:"grid-2 grid"},bd={class:"item"},xd={class:"content"},Cd={class:"cny"},hd={class:"item"},Pd={class:"content"},$d={class:"grid"},Ad={class:"item"},Id={class:"content"},Sd={class:"item"},Td={key:0,class:"content"},Ud={key:1,class:"content"},Fd={class:"grid-2 grid"},Dd={class:"item"},Rd={class:"content"},Bd={class:"item"},Md={class:"content"},Ld={class:"grid-2 grid"},Nd={class:"item"},Ed={class:"content"},Hd={key:0},Od={class:"item"},zd={class:"content"},Vd={key:0,class:"cny"},Yd={class:"item"},jd={class:"content"},Kd={class:"item"},Gd={class:"content"},Wd={key:0},qd={class:"grid"},Jd={class:"item item-border-hide"},Qd={class:"content"},Xd=pe({name:"PlanTaskDetailDrawer",__name:"detail-modal",props:ve({id:{default:""},planTaskStatus:{default:()=>[]},mode:{default:()=>{}}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(z){const U=re(z,"visible"),B=z,a=Ne({id:"",owner:{},pair:{},loading:!0,subProductsVisible:!1,subProductsData:[]});ge(U,async E=>{E&&(console.log("DetailModal received props.id:",B.id),await b())});async function b(){var E,s,_,K;a.loading=!0;try{const{data:w,error:R}=await Js(B.id);if(R||!w||w.code!==0)return;Object.assign(a.owner,w.data.owner),a.owner.statusMap=i((E=a.owner)==null?void 0:E.status),a.owner.payTypeMap=F((s=a.owner)==null?void 0:s.payType),B.mode===0&&(Object.assign(a.pair,w.data.pair),a.pair.statusMap=i((_=a.pair)==null?void 0:_.status),a.pair.payTypeMap=F((K=a.pair)==null?void 0:K.payType)),a.id=B.id}catch{U.value=!1}finally{a.loading=!1}}function i(E){const s=B.planTaskStatus.find(_=>_.value===E);return{label:(s==null?void 0:s.label)||"未知异常",color:(s==null?void 0:s.color)||"error"}}function F(E){const s=Es.find(_=>_.value===E);return{label:(s==null?void 0:s.label)||"未知",color:(s==null?void 0:s.color)||"error"}}function u(E){a.subProductsVisible=!0,a.subProductsData=E?a.owner.products:a.pair.products}return(E,s)=>{const _=ue,K=de,w=_e,R=gs;return n(),P(le,null,[t(R,{open:U.value,"onUpdate:open":s[4]||(s[4]=N=>U.value=N),title:"任务详情",width:B.mode===0?"70vw":"40vw",footer:null},{default:l(()=>{var N,m,V,v,X,oe,h,f,G,M,H,W,k,$,c,Y,Q,q,ee,C,o,r,x,S,I,d,A,j,se,ae,J,fe,be,xe,Ce,he,we,Re,Be,L,ye,Z,rt,pt,ct,vt,mt,ft,gt,_t,kt,wt,yt,bt,xt,Ct,ht,Pt,$t,At,It,St,Tt,Ut,Ft,Dt,Rt,Bt,Mt,Lt,Nt,Et,Ht,Ot,zt,Vt,Yt,jt,Kt,Gt,Wt,qt,Jt,Qt,Xt,Zt,el,tl,ll,sl,ol,al,nl,il,ul,dl,rl,pl,cl,vl,ml,fl,gl,_l,kl,wl,yl,bl,xl,Cl,hl,Pl,$l,Al,Il,Sl,Tl,Ul,Fl,Dl,Rl,Bl,Ml,Ll,Nl,El,Hl,Ol,zl,Vl,Yl,jl,Kl,Gl,Wl,ql,Jl,Ql,Xl,Zl,es,ts,ls,ss,os;return[e("div",qn,[B.mode===0?(n(),P("div",Jn,[e("div",null,[s[40]||(s[40]=e("p",{class:"title"},"我方任务详情",-1)),e("div",Qn,[e("div",Xn,[e("div",Zn,[s[6]||(s[6]=e("div",{class:"label"},[e("p",null,"商品标题")],-1)),e("div",ei,[e("p",null,T(((m=(N=a.owner.products)==null?void 0:N[0])==null?void 0:m.title)??"—"),1)])]),e("div",ti,[s[7]||(s[7]=e("div",{class:"label"},[e("p",null,"店铺名称")],-1)),e("div",li,[e("p",null,T(((v=(V=a.owner.products)==null?void 0:V[0])==null?void 0:v.shopName)??"—"),1)])]),e("div",si,[s[8]||(s[8]=e("div",{class:"label"},[e("p",null,"关键词")],-1)),e("div",oi,[e("p",null,T(((oe=(X=a.owner.products)==null?void 0:X[0])==null?void 0:oe.keyword)??"—"),1)])]),e("div",ai,[s[9]||(s[9]=e("div",{class:"label"},[e("p",null,"商品SKU")],-1)),e("div",ni,[(G=(f=(h=a.owner.products)==null?void 0:h[0])==null?void 0:f.skuList)!=null&&G.length?(n(),P("div",ii,[(n(!0),P(le,null,ie((H=(M=a.owner.products)==null?void 0:M[0])==null?void 0:H.skuList,O=>(n(),g(_,{key:O},{default:l(()=>[p(T(O),1)]),_:2},1024))),128))])):(n(),P("p",ui,"无SKU商品"))])])]),e("div",di,[e("div",ri,[s[10]||(s[10]=e("div",{class:"label"},[e("p",null,"购买件数")],-1)),e("div",pi,[e("p",null,"x "+T(((k=(W=a.owner.products)==null?void 0:W[0])==null?void 0:k.count)??1),1)])]),e("div",ci,[s[11]||(s[11]=e("div",{class:"label"},[e("p",null,"购买单价")],-1)),e("div",vi,[e("p",mi,T(((c=($=a.owner.products)==null?void 0:$[0])==null?void 0:c.price)??0),1)])])]),e("div",fi,[e("div",gi,[s[12]||(s[12]=e("div",{class:"label"},[e("p",null,"商品总数")],-1)),e("div",_i,[a.owner.products&&a.owner.products.length>1?(n(),g(w,{key:0,title:"点击查看商品详情"},{default:l(()=>[t(K,{onClick:s[0]||(s[0]=O=>u(!0))},{default:l(()=>{var O;return[p(T((O=a.owner)==null?void 0:O.productCount)+"个",1)]}),_:1})]),_:1})):(n(),P("p",ki,T((Y=a.owner)==null?void 0:Y.productCount),1))])]),e("div",wi,[s[13]||(s[13]=e("div",{class:"label"},[e("p",null,"商品总价")],-1)),e("div",yi,[e("p",bi,T((Q=a.owner)==null?void 0:Q.totalPrice),1)])])]),e("div",xi,[e("div",Ci,[s[14]||(s[14]=e("div",{class:"label"},[e("p",null,"购买差额")],-1)),e("div",hi,[e("p",Pi,T(((ee=(q=a.owner.products)==null?void 0:q[0])==null?void 0:ee.scope)??0),1)])]),e("div",$i,[s[15]||(s[15]=e("div",{class:"label"},[e("p",null,"配对差额")],-1)),e("div",Ai,[e("p",Ii,T((C=a.owner)==null?void 0:C.pairScope),1)])])]),e("div",Si,[e("div",Ti,[s[25]||(s[25]=e("div",{class:"label"},[e("p",null,"商品互动")],-1)),e("div",Ui,[(r=(o=a.owner)==null?void 0:o.actions)!=null&&r.addCart?(n(),g(_,{key:0,color:"orange"},{default:l(()=>s[16]||(s[16]=[p("加购")])),_:1})):D("",!0),(S=(x=a.owner)==null?void 0:x.actions)!=null&&S.favorite?(n(),g(_,{key:1,color:"red"},{default:l(()=>s[17]||(s[17]=[p("收藏")])),_:1})):D("",!0),(d=(I=a.owner)==null?void 0:I.actions)!=null&&d.lookComment?(n(),g(_,{key:2,color:"blue"},{default:l(()=>s[18]||(s[18]=[p("随机看评价")])),_:1})):D("",!0),(j=(A=a.owner)==null?void 0:A.actions)!=null&&j.lookPlantingGrass?(n(),g(_,{key:3,color:"green"},{default:l(()=>s[19]||(s[19]=[p("随机看种草")])),_:1})):D("",!0),(ae=(se=a.owner)==null?void 0:se.actions)!=null&&ae.lookAskEveryone?(n(),g(_,{key:4,color:"cyan"},{default:l(()=>s[20]||(s[20]=[p("随机看问大家")])),_:1})):D("",!0),(fe=(J=a.owner)==null?void 0:J.actions)!=null&&fe.useFirstBrowse?(n(),g(_,{key:5,color:"geekblue"},{default:l(()=>s[21]||(s[21]=[p("第一次搜索")])),_:1})):D("",!0),(xe=(be=a.owner)==null?void 0:be.actions)!=null&&xe.useFindBrowse?(n(),g(_,{key:6,color:"purple"},{default:l(()=>s[22]||(s[22]=[p("继续浏览")])),_:1})):D("",!0),(he=(Ce=a.owner)==null?void 0:Ce.actions)!=null&&he.useWaitForBuy?(n(),g(_,{key:7,color:"volcano"},{default:l(()=>s[23]||(s[23]=[p("返回首页等待三分钟")])),_:1})):D("",!0),!((we=a.owner)!=null&&we.actions)||Object.entries(a.owner.actions).filter(([O,te])=>typeof te=="boolean").every(([O,te])=>!te)?(n(),g(_,{key:8},{default:l(()=>s[24]||(s[24]=[p(" 无 ")])),_:1})):D("",!0)])]),e("div",Fi,[s[27]||(s[27]=e("div",{class:"label"},[e("p",null,"排除区域")],-1)),(Re=a.owner)!=null&&Re.excludeArea&&a.owner.excludeArea.length?(n(),P("div",Di,[(n(!0),P(le,null,ie((Be=a.owner)==null?void 0:Be.excludeArea,O=>(n(),g(_,{key:O},{default:l(()=>[p(T(O),1)]),_:2},1024))),128))])):D("",!0),!((L=a.owner)!=null&&L.excludeArea)||!((ye=a.owner)!=null&&ye.excludeArea.length)?(n(),P("div",Ri,[t(_,null,{default:l(()=>s[26]||(s[26]=[p("无")])),_:1})])):D("",!0)])]),e("div",Bi,[e("div",Mi,[s[31]||(s[31]=e("div",{class:"label"},[e("p",null,"购买状态")],-1)),e("div",Li,[(Z=a.owner)!=null&&Z.success?(n(),g(_,{key:0,color:"success"},{default:l(()=>s[28]||(s[28]=[p("购买成功")])),_:1})):((rt=a.owner)==null?void 0:rt.status)>=30?(n(),g(_,{key:1,color:"error"},{default:l(()=>s[29]||(s[29]=[p("购买失败")])),_:1})):(n(),g(_,{key:2},{default:l(()=>s[30]||(s[30]=[p("-")])),_:1}))])]),e("div",Ni,[s[32]||(s[32]=e("div",{class:"label"},[e("p",null,"任务状态")],-1)),e("div",Ei,[(pt=a.owner)!=null&&pt.statusMap?(n(),g(w,{key:0,title:(ct=a.owner)!=null&&ct.status?"购买成功":((vt=a.owner)==null?void 0:vt.remark)||"程序执行异常"},{default:l(()=>{var O;return[t(_,{color:(O=a.owner)==null?void 0:O.statusMap.color},{default:l(()=>{var te;return[p(T((te=a.owner)==null?void 0:te.statusMap.label),1)]}),_:1},8,["color"])]}),_:1},8,["title"])):D("",!0)])])]),e("div",Hi,[e("div",Oi,[s[34]||(s[34]=e("div",{class:"label"},[e("p",null,"订单号")],-1)),e("div",zi,[(mt=a.owner)!=null&&mt.success?(n(),g(_,{key:0,onClick:s[1]||(s[1]=O=>{var te;return y(Je)((te=a.owner)==null?void 0:te.orderId)})},{default:l(()=>{var O;return[p(T((O=a.owner)==null?void 0:O.orderId),1)]}),_:1})):(n(),g(_,{key:1},{default:l(()=>s[33]||(s[33]=[p("-")])),_:1}))])]),e("div",Vi,[s[36]||(s[36]=e("div",{class:"label"},[e("p",null,"支付金额")],-1)),e("div",Yi,[(ft=a.owner)!=null&&ft.success?(n(),P("p",ji,T((gt=a.owner)==null?void 0:gt.payPrice),1)):(n(),g(_,{key:1},{default:l(()=>s[35]||(s[35]=[p("-")])),_:1}))])]),e("div",Ki,[s[37]||(s[37]=e("div",{class:"label"},[e("p",null,"支付方式")],-1)),e("div",Gi,[t(_,{color:(kt=(_t=a.owner)==null?void 0:_t.payTypeMap)==null?void 0:kt.color},{default:l(()=>{var O,te;return[p(T((te=(O=a.owner)==null?void 0:O.payTypeMap)==null?void 0:te.label),1)]}),_:1},8,["color"])])]),e("div",Wi,[s[39]||(s[39]=e("div",{class:"label"},[e("p",null,"支付时间")],-1)),e("div",qi,[(wt=a.owner)!=null&&wt.success?(n(),P("p",Ji,T((yt=a.owner)==null?void 0:yt.completeTime),1)):(n(),g(_,{key:1},{default:l(()=>s[38]||(s[38]=[p("-")])),_:1}))])])])])]),a.pair?(n(),P("div",Qi,[s[64]||(s[64]=e("p",{class:"title"},"对方任务详情",-1)),e("div",Xi,[e("div",Zi,[e("div",eu,[s[41]||(s[41]=e("div",{class:"label"},[e("p",null,"商品标题")],-1)),e("div",tu,[e("p",null,T(((xt=(bt=a.pair.products)==null?void 0:bt[0])==null?void 0:xt.title)??"—"),1)])]),e("div",lu,[s[42]||(s[42]=e("div",{class:"label"},[e("p",null,"店铺名称")],-1)),e("div",su,[e("p",null,T(((ht=(Ct=a.pair.products)==null?void 0:Ct[0])==null?void 0:ht.shopName)??"—"),1)])]),e("div",ou,[s[43]||(s[43]=e("div",{class:"label"},[e("p",null,"关键词")],-1)),e("div",au,[e("p",null,T((($t=(Pt=a.pair.products)==null?void 0:Pt[0])==null?void 0:$t.keyword)??"—"),1)])]),e("div",nu,[s[44]||(s[44]=e("div",{class:"label"},[e("p",null,"商品SKU")],-1)),e("div",iu,[(St=(It=(At=a.pair.products)==null?void 0:At[0])==null?void 0:It.skuList)!=null&&St.length?(n(),P("div",uu,[(n(!0),P(le,null,ie((Ut=(Tt=a.pair.products)==null?void 0:Tt[0])==null?void 0:Ut.skuList,O=>(n(),g(_,{key:O},{default:l(()=>[p(T(O),1)]),_:2},1024))),128))])):(n(),P("p",du,"无SKU商品"))])])]),e("div",ru,[e("div",pu,[s[45]||(s[45]=e("div",{class:"label"},[e("p",null,"购买件数")],-1)),e("div",cu,[e("p",null,"x "+T(((Dt=(Ft=a.pair.products)==null?void 0:Ft[0])==null?void 0:Dt.count)??1),1)])]),e("div",vu,[s[46]||(s[46]=e("div",{class:"label"},[e("p",null,"购买单价")],-1)),e("div",mu,[e("p",fu,T(((Bt=(Rt=a.pair.products)==null?void 0:Rt[0])==null?void 0:Bt.price)??0),1)])])]),e("div",gu,[e("div",_u,[s[47]||(s[47]=e("div",{class:"label"},[e("p",null,"商品总数")],-1)),e("div",ku,[a.pair.products&&a.pair.products.length>1?(n(),g(w,{key:0,title:"点击查看商品详情"},{default:l(()=>[t(K,{onClick:s[2]||(s[2]=O=>u(!1))},{default:l(()=>{var O;return[p(T((O=a.pair)==null?void 0:O.productCount)+"个",1)]}),_:1})]),_:1})):(n(),P("p",wu,T((Mt=a.pair)==null?void 0:Mt.productCount),1))])]),e("div",yu,[s[48]||(s[48]=e("div",{class:"label"},[e("p",null,"商品总价")],-1)),e("div",bu,[e("p",xu,T((Lt=a.pair)==null?void 0:Lt.totalPrice),1)])])]),e("div",Cu,[e("div",hu,[s[52]||(s[52]=e("div",{class:"label"},[e("p",null,"购买状态")],-1)),e("div",Pu,[(Nt=a.pair)!=null&&Nt.success?(n(),g(_,{key:0,color:"success"},{default:l(()=>s[49]||(s[49]=[p("购买成功")])),_:1})):((Et=a.pair)==null?void 0:Et.status)>=30?(n(),g(_,{key:1,color:"error"},{default:l(()=>s[50]||(s[50]=[p("购买失败")])),_:1})):(n(),g(_,{key:2},{default:l(()=>s[51]||(s[51]=[p("-")])),_:1}))])]),e("div",$u,[s[53]||(s[53]=e("div",{class:"label"},[e("p",null,"任务状态")],-1)),e("div",Au,[(Ht=a.pair)!=null&&Ht.statusMap?(n(),g(w,{key:0,title:(Ot=a.pair)!=null&&Ot.status?"购买成功":((zt=a.pair)==null?void 0:zt.remark)||"程序执行异常"},{default:l(()=>{var O;return[t(_,{color:(O=a.pair)==null?void 0:O.statusMap.color},{default:l(()=>{var te;return[p(T((te=a.pair)==null?void 0:te.statusMap.label),1)]}),_:1},8,["color"])]}),_:1},8,["title"])):D("",!0)])])]),e("div",Iu,[e("div",Su,[s[55]||(s[55]=e("div",{class:"label"},[e("p",null,"订单号")],-1)),e("div",Tu,[(Vt=a.pair)!=null&&Vt.success?(n(),P("p",Uu,T((Yt=a.pair)==null?void 0:Yt.orderId),1)):(n(),g(_,{key:1},{default:l(()=>s[54]||(s[54]=[p("-")])),_:1}))])]),e("div",Fu,[s[57]||(s[57]=e("div",{class:"label"},[e("p",null,"支付金额")],-1)),e("div",Du,[(jt=a.pair)!=null&&jt.success?(n(),P("p",Ru,T((Kt=a.pair)==null?void 0:Kt.payPrice),1)):(n(),g(_,{key:1},{default:l(()=>s[56]||(s[56]=[p("-")])),_:1}))])]),e("div",Bu,[s[58]||(s[58]=e("div",{class:"label"},[e("p",null,"支付方式")],-1)),e("div",Mu,[t(_,{color:(Wt=(Gt=a.pair)==null?void 0:Gt.payTypeMap)==null?void 0:Wt.color},{default:l(()=>{var O,te;return[p(T((te=(O=a.pair)==null?void 0:O.payTypeMap)==null?void 0:te.label),1)]}),_:1},8,["color"])])]),e("div",Lu,[s[60]||(s[60]=e("div",{class:"label"},[e("p",null,"支付时间")],-1)),e("div",Nu,[(qt=a.pair)!=null&&qt.success?(n(),P("p",Eu,T((Jt=a.pair)==null?void 0:Jt.completeTime),1)):(n(),g(_,{key:1},{default:l(()=>s[59]||(s[59]=[p("-")])),_:1}))])])]),e("div",Hu,[e("div",Ou,[s[61]||(s[61]=e("div",{class:"label"},[e("p",null,"执行设备")],-1)),e("div",zu,T(`${(Qt=a.pair)!=null&&Qt.deviceName?(Xt=a.pair)==null?void 0:Xt.deviceName:"设备已被删除"} ( ${(Zt=a.pair)!=null&&Zt.deviceName?(el=a.pair)==null?void 0:el.deviceId:"设备已被删除"} )`),1)])]),e("div",Vu,[e("div",Yu,[s[63]||(s[63]=e("div",{class:"label"},[e("p",null,"任务差额")],-1)),e("div",ju,[(tl=a.owner)!=null&&tl.diffPrice&&Number.parseFloat(a.owner.diffPrice)!==0?(n(),P("p",Ku,[p(T(a.owner.diffPrice.includes("-")?"我方需补差额 ":"对方需补差额 ")+" ",1),e("span",Gu,T(a.owner.diffPrice.replace("-","")),1)])):(n(),g(_,{key:1,type:"success"},{default:l(()=>s[62]||(s[62]=[p("无需补差价")])),_:1}))])])])])])):D("",!0)])):(n(),P("div",Wu,[e("div",qu,[e("div",Ju,[e("div",Qu,[s[65]||(s[65]=e("div",{class:"label"},[e("p",null,"商品标题")],-1)),e("div",Xu,[e("p",null,T(((sl=(ll=a.owner.products)==null?void 0:ll[0])==null?void 0:sl.title)??"—"),1)])]),e("div",Zu,[s[66]||(s[66]=e("div",{class:"label"},[e("p",null,"店铺名称")],-1)),e("div",ed,[e("p",null,T(((al=(ol=a.owner.products)==null?void 0:ol[0])==null?void 0:al.shopName)??"—"),1)])]),e("div",td,[s[67]||(s[67]=e("div",{class:"label"},[e("p",null,"关键词")],-1)),e("div",ld,[e("p",null,T(((il=(nl=a.owner.products)==null?void 0:nl[0])==null?void 0:il.keyword)??"—"),1)])]),e("div",sd,[s[68]||(s[68]=e("div",{class:"label"},[e("p",null,"商品SKU")],-1)),e("div",od,[(rl=(dl=(ul=a.owner.products)==null?void 0:ul[0])==null?void 0:dl.skuList)!=null&&rl.length?(n(),P("div",ad,[(n(!0),P(le,null,ie((cl=(pl=a.owner.products)==null?void 0:pl[0])==null?void 0:cl.skuList,O=>(n(),g(_,{key:O},{default:l(()=>[p(T(O),1)]),_:2},1024))),128))])):(n(),P("p",nd,"无SKU商品"))])])]),e("div",id,[e("div",ud,[s[69]||(s[69]=e("div",{class:"label"},[e("p",null,"购买件数")],-1)),e("div",dd,[e("p",null,"x "+T(((ml=(vl=a.owner.products)==null?void 0:vl[0])==null?void 0:ml.count)??1),1)])]),e("div",rd,[s[70]||(s[70]=e("div",{class:"label"},[e("p",null,"购买单价")],-1)),e("div",pd,[e("p",cd,T(((gl=(fl=a.owner.products)==null?void 0:fl[0])==null?void 0:gl.price)??0),1)])])]),e("div",vd,[e("div",md,[s[71]||(s[71]=e("div",{class:"label"},[e("p",null,"商品总数")],-1)),e("div",fd,[a.owner.products&&a.owner.products.length>1?(n(),g(w,{key:0,title:"点击查看商品详情"},{default:l(()=>[t(K,{onClick:s[3]||(s[3]=O=>u(!0))},{default:l(()=>{var O;return[p(T((O=a.owner)==null?void 0:O.productCount)+"个",1)]}),_:1})]),_:1})):(n(),P("p",gd,T((_l=a.owner)==null?void 0:_l.productCount),1))])]),e("div",_d,[s[72]||(s[72]=e("div",{class:"label"},[e("p",null,"商品总价")],-1)),e("div",kd,[e("p",wd,T((kl=a.owner)==null?void 0:kl.totalPrice),1)])])]),e("div",yd,[e("div",bd,[s[73]||(s[73]=e("div",{class:"label"},[e("p",null,"购买差额")],-1)),e("div",xd,[e("p",Cd,T(((yl=(wl=a.owner.products)==null?void 0:wl[0])==null?void 0:yl.scope)??0),1)])]),e("div",hd,[s[75]||(s[75]=e("div",{class:"label"},[e("p",null,"配对差额")],-1)),e("div",Pd,[e("p",null,[t(_,null,{default:l(()=>s[74]||(s[74]=[p("-")])),_:1})])])])]),e("div",$d,[e("div",Ad,[s[85]||(s[85]=e("div",{class:"label"},[e("p",null,"商品互动")],-1)),e("div",Id,[(xl=(bl=a.owner)==null?void 0:bl.actions)!=null&&xl.addCart?(n(),g(_,{key:0,color:"orange"},{default:l(()=>s[76]||(s[76]=[p("加购")])),_:1})):D("",!0),(hl=(Cl=a.owner)==null?void 0:Cl.actions)!=null&&hl.favorite?(n(),g(_,{key:1,color:"red"},{default:l(()=>s[77]||(s[77]=[p("收藏")])),_:1})):D("",!0),($l=(Pl=a.owner)==null?void 0:Pl.actions)!=null&&$l.lookComment?(n(),g(_,{key:2,color:"blue"},{default:l(()=>s[78]||(s[78]=[p("随机看评价")])),_:1})):D("",!0),(Il=(Al=a.owner)==null?void 0:Al.actions)!=null&&Il.lookPlantingGrass?(n(),g(_,{key:3,color:"green"},{default:l(()=>s[79]||(s[79]=[p("随机看种草")])),_:1})):D("",!0),(Tl=(Sl=a.owner)==null?void 0:Sl.actions)!=null&&Tl.lookAskEveryone?(n(),g(_,{key:4,color:"cyan"},{default:l(()=>s[80]||(s[80]=[p("随机看问大家")])),_:1})):D("",!0),(Fl=(Ul=a.owner)==null?void 0:Ul.actions)!=null&&Fl.useFirstBrowse?(n(),g(_,{key:5,color:"geekblue"},{default:l(()=>s[81]||(s[81]=[p("第一次搜索")])),_:1})):D("",!0),(Rl=(Dl=a.owner)==null?void 0:Dl.actions)!=null&&Rl.useFindBrowse?(n(),g(_,{key:6,color:"purple"},{default:l(()=>s[82]||(s[82]=[p("继续浏览")])),_:1})):D("",!0),(Ml=(Bl=a.owner)==null?void 0:Bl.actions)!=null&&Ml.useWaitForBuy?(n(),g(_,{key:7,color:"volcano"},{default:l(()=>s[83]||(s[83]=[p("返回首页等待三分钟")])),_:1})):D("",!0),!((Ll=a.owner)!=null&&Ll.actions)||Object.entries(a.owner.actions).filter(([O,te])=>typeof te=="boolean").every(([O,te])=>!te)?(n(),g(_,{key:8},{default:l(()=>s[84]||(s[84]=[p(" 无 ")])),_:1})):D("",!0)])]),e("div",Sd,[s[87]||(s[87]=e("div",{class:"label"},[e("p",null,"排除区域")],-1)),(Nl=a.owner)!=null&&Nl.excludeArea&&a.owner.excludeArea.length?(n(),P("div",Td,[(n(!0),P(le,null,ie((El=a.owner)==null?void 0:El.excludeArea,O=>(n(),g(_,{key:O},{default:l(()=>[p(T(O),1)]),_:2},1024))),128))])):D("",!0),!((Hl=a.owner)!=null&&Hl.excludeArea)||!((Ol=a.owner)!=null&&Ol.excludeArea.length)?(n(),P("div",Ud,[t(_,null,{default:l(()=>s[86]||(s[86]=[p("无")])),_:1})])):D("",!0)])]),e("div",Fd,[e("div",Dd,[s[91]||(s[91]=e("div",{class:"label"},[e("p",null,"购买状态")],-1)),e("div",Rd,[(zl=a.owner)!=null&&zl.success?(n(),g(_,{key:0,color:"success"},{default:l(()=>s[88]||(s[88]=[p("购买成功")])),_:1})):((Vl=a.owner)==null?void 0:Vl.status)>=30?(n(),g(_,{key:1,color:"error"},{default:l(()=>s[89]||(s[89]=[p("购买失败")])),_:1})):(n(),g(_,{key:2},{default:l(()=>s[90]||(s[90]=[p("-")])),_:1}))])]),e("div",Bd,[s[92]||(s[92]=e("div",{class:"label"},[e("p",null,"任务状态")],-1)),e("div",Md,[(Yl=a.owner)!=null&&Yl.statusMap?(n(),g(w,{key:0,title:(jl=a.owner)!=null&&jl.status?"购买成功":((Kl=a.owner)==null?void 0:Kl.remark)||"程序执行异常"},{default:l(()=>{var O;return[t(_,{color:(O=a.owner)==null?void 0:O.statusMap.color},{default:l(()=>{var te;return[p(T((te=a.owner)==null?void 0:te.statusMap.label),1)]}),_:1},8,["color"])]}),_:1},8,["title"])):D("",!0)])])]),e("div",Ld,[e("div",Nd,[s[94]||(s[94]=e("div",{class:"label"},[e("p",null,"订单号")],-1)),e("div",Ed,[(Gl=a.owner)!=null&&Gl.success?(n(),P("p",Hd,T((Wl=a.owner)==null?void 0:Wl.orderId),1)):(n(),g(_,{key:1},{default:l(()=>s[93]||(s[93]=[p("-")])),_:1}))])]),e("div",Od,[s[96]||(s[96]=e("div",{class:"label"},[e("p",null,"支付金额")],-1)),e("div",zd,[(ql=a.owner)!=null&&ql.success?(n(),P("p",Vd,T((Jl=a.owner)==null?void 0:Jl.payPrice),1)):(n(),g(_,{key:1},{default:l(()=>s[95]||(s[95]=[p("-")])),_:1}))])]),e("div",Yd,[s[97]||(s[97]=e("div",{class:"label"},[e("p",null,"支付方式")],-1)),e("div",jd,[t(_,{color:(Xl=(Ql=a.owner)==null?void 0:Ql.payTypeMap)==null?void 0:Xl.color},{default:l(()=>{var O,te;return[p(T((te=(O=a.owner)==null?void 0:O.payTypeMap)==null?void 0:te.label),1)]}),_:1},8,["color"])])]),e("div",Kd,[s[99]||(s[99]=e("div",{class:"label"},[e("p",null,"支付时间")],-1)),e("div",Gd,[(Zl=a.owner)!=null&&Zl.success?(n(),P("p",Wd,T((es=a.owner)==null?void 0:es.completeTime),1)):(n(),g(_,{key:1},{default:l(()=>s[98]||(s[98]=[p("-")])),_:1}))])])]),e("div",qd,[e("div",Jd,[s[100]||(s[100]=e("div",{class:"label"},[e("p",null,"执行设备")],-1)),e("div",Qd,T(`${(ts=a.owner)!=null&&ts.deviceName?(ls=a.owner)==null?void 0:ls.deviceName:"设备已被删除"} ( ${(ss=a.owner)!=null&&ss.deviceName?(os=a.owner)==null?void 0:os.deviceId:"设备已被删除"} )`),1)])])])])),t(We,{loading:a.loading},null,8,["loading"])])]}),_:1},8,["open","width"]),t(Wn,{visible:a.subProductsVisible,"onUpdate:visible":s[5]||(s[5]=N=>a.subProductsVisible=N),"sub-products-data":a.subProductsData},null,8,["visible","sub-products-data"])],64)}}}),Zd=ce(Xd,[["__scopeId","data-v-45cdff25"]]),er={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function tr(z){return typeof z=="function"||Object.prototype.toString.call(z)==="[object Object]"&&!Ls(z)}const lr=pe({name:"douyin_task",__name:"index",setup(z){const U=fs(),B=Ns(),{tableWrapperRef:a,scrollConfig:b}=et(),i=Ne({switch:{id:"",loading:!1},createVisible:!1,againLoading:!1,detailVisible:!1,commentVisible:!1,againVisible:!1,completionVisible:!1,editRow:{},exportLoading:!1,shopNameEnum:[]}),{columns:F,columnChecks:u,data:E,getData:s,getDataByPage:_,loading:K,mobilePagination:w,searchParams:R,resetSearchParams:N}=tt({apiFn:(...I)=>to(...I),apiParams:{pageIndex:1,pageSize:10},columns:W}),{onBatchDeleted:m,onDeleted:V,checkedRowKeys:v,rowSelection:X}=lt(E,s);Ve(async()=>{R.platform=30,await oe()});async function oe(){const{data:I,error:d}=await dt("");!d&&I&&I.code===0&&(i.shopNameEnum=I.data.list)}async function h(I){const{data:d,error:A}=await us([I]);!A&&d&&d.code===0&&V()}async function f(){const I=v.value;if(I&&I.length){const{data:d,error:A}=await us(I);!A&&d&&d.code===0&&m()}}function G(I){i.editRow=I,i.againVisible=!0}function M(I){i.editRow=I,i.completionVisible=!0}function H(I){return!U.userInfo.isTenant||![30,31,40,41].includes(I.status)?"":t(_e,{placement:"top",title:"任务信息"},{default:()=>[t(de,{type:"link",size:"small",onClick:()=>M(I)},{default:()=>[t(io,null,null)]})]})}function W(){const I=[{key:"title",dataIndex:"title",title:"任务商品",width:500,ellipsis:!0,customRender:({record:d})=>{let A=Ye.filter(ae=>ae.value===d.mode);A=A.length?A[0]:{label:"未知",value:d.mode,color:""};let j=je.filter(ae=>ae.value===d.platform);j=j.length?j[0]:{label:"未知",value:d.platform,color:""};function se(){return d.mode===0||d.mode!==20&&(d.status===0||d.status===10)?"":d.deviceName&&d.deviceId!=="0"?t(ue,{color:"cyan",onClick:()=>Je(d.deviceId),style:"cursor:pointer;"},{default:()=>[p("执行设备："),d.deviceName,p(" ("),d.deviceId,p(")")]}):t(ue,{color:"error"},{default:()=>[p("执行设备：设备已删除")]})}return t("div",{class:"plantask-product"},[t("div",{class:"v-center flex gap-10px"},[t(ue,{color:"default",style:"cursor:pointer;",onClick:()=>Je(d.id)},{default:()=>[p("任务编号："),d.id]}),t(ue,{color:A.color},{default:()=>[p("任务模式："),A.label]}),se()]),t("div",{class:"flex"},[t("div",{class:"plantask-image"},[t(Ie,{width:120,height:120,src:d.image,fallback:Ae},null)]),t("div",{class:"plantask-info"},[t("div",{class:"plantask-title v-center flex"},[t(ue,{color:j.color},{default:()=>[p("DY联盟")]}),t(_e,{placement:"top",title:d.title},{default:()=>[t("a",{href:d.productUrl,target:"_blank"},[d.title])]})]),t("p",{class:"plantask-shop"},[t("span",{class:"label"},[p("店铺名称：")]),d.shopName]),t("p",{class:"plantask-sku v-center flex"},[t("span",{class:"label"},[p("任务SKU：")]),Q(d.skuList)]),t("div",{class:"v-center flex gap-10px"},[t("p",{class:"plantask-price f-12px"},[t("span",{class:"label"},[p("商品单价：")]),t("span",null,[q(d.price)])]),t("p",{class:"f-12px"},[t("span",{class:"label"},[p("购买件数：")]),t("span",null,[p("x "),d.count])]),t("p",{class:"plantask-price f-12px"},[t("span",{class:"label"},[p("商品总价：")]),t("span",null,[q(d.totalPrice,!0)])])]),t("p",{class:"plantask-keyword f-12px"},[t("span",{class:"text-right"},[p("宝贝排名：")]),t("span",{title:d.ranking||"-"},[d.ranking>0?d.ranking:"-"])]),t("p",{class:"plantask-keyword f-12px",title:`关键词：${d.keyword||""}`},[t("span",{class:"label"},[p("关键词：")]),d.keyword])])])])}},{key:"account",dataIndex:"account",title:"任务信息",width:300,ellipsis:!0,customRender:({record:d})=>{let A=d.ip;return A&&d.ipAddress&&(A=`${A} (${d.ipAddress})`),t("div",{style:"font-size:14px"},[t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[p("DY号：")]),t("span",{title:d.account||"-"},[d.account||"-"])]),t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[p("订单号：")]),t("span",{title:d.orderId||"-"},[d.orderId||"-"])]),t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[p("下单IP：")]),t("span",{title:A||"-"},[A||"-"])]),t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[p("收货地址：")]),t("span",{title:d.address||"-"},[d.address||"-"])])])}},{key:"success",dataIndex:"success",title:"购买状态",width:100,align:"center",customRender:({record:d})=>d.status>=30?d.success?t(ue,{color:"success"},{default:()=>[p("购买成功")]}):t(ue,{color:"error"},{default:()=>[p("购买失败")]}):"-"},{key:"status",dataIndex:"status",title:"状态",width:100,align:"center",customRender:({record:d})=>{if(d.status===20){const j=oo.filter(se=>se.value===d.step);if(j&&j.length)return t(ue,{color:j[0].color},{default:()=>[j[0].label]})}let A=is.filter(j=>j.value===d.status);return A=A.length?A[0]:{label:"未知",value:d.platform,color:"error"},d.status===31||d.status===41?t(_e,{placement:"top",title:t("span",null,[d.remark||"程序执行异常"])},{default:()=>[t(ue,{color:A.color},{default:()=>[A.label]})]}):t(ue,{color:A.color},{default:()=>[A.label]})}},{key:"note",dataIndex:"note",title:"任务备注",width:200,ellipsis:!0},{key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200}];return U.userInfo.isTenant?U.userInfo.isTenant&&!U.userInfo.isTenantUser&&I.push({key:"creator",dataIndex:"creator",title:"创建人",align:"center",width:130}):I.push({key:"creator",dataIndex:"creator",title:"所属商户",align:"center",width:130}),I.push({key:"operate",title:"操作",align:"center",width:140,fixed:"right",customRender:({record:d})=>t("div",{class:"flex-center gap-4px"},[k(d),Y(d),c(d),$(d),H(d)])}),I}function k(I){return I.status===0||I.status===5||I.status>11?t(_e,{placement:"top",title:"任务详情"},{default:()=>[t(de,{type:"link",size:"small",onClick:()=>C(I)},{default:()=>[t($e,null,null)]})]}):""}function $(I){if(B.hasOne(Oe.DY.Task.DELETE)&&U.userInfo.isTenant){if([30,31,40,41,11,20].includes(I.status))return"";if(I.status===0||I.status===10||I.status===100)return t(Me,{title:"确认删除吗？",onConfirm:()=>h(I.id)},{default:()=>[t(_e,{placement:"top",title:"删除"},{default:()=>[t(de,{danger:!0,size:"small",type:"link"},{default:()=>[t(Le,null,null)]})]})]});if(I.mode===10||I.mode===20)return t(Me,{title:"确认删除吗？",onConfirm:()=>h(I.id)},{default:()=>[t(_e,{placement:"top",title:"删除"},{default:()=>[t(de,{danger:!0,size:"small",type:"link"},{default:()=>[t(Le,null,null)]})]})]})}return""}function c(I){return B.hasOne(Oe.DY.Task.UPDATE)&&U.userInfo.isTenant&&[20,21].includes(I.status)?t(_e,{placement:"top",title:"停止任务"},{default:()=>[t(de,{danger:!0,size:"small",type:"link",onClick:()=>S(I.id)},{default:()=>[t(Ms,null,null)]})]}):""}function Y(I){return B.hasOne(Oe.DY.Task.CREATE)&&U.userInfo.isTenant?t(_e,{placement:"top",title:"快速发布"},{default:()=>[t(de,{loading:i.againLoading,type:"link",size:"small",onClick:()=>G(I)},{default:()=>[t(lo,null,null)]})]}):""}function Q(I){return!I||!I.length?t(ue,null,{default:()=>[p("无SKU")]}):I.map(d=>t(ue,{key:d,color:"processing"},tr(d)?d:{default:()=>[d]}))}function q(I,d=!1){return t("span",{class:"cny",style:d?"font-weight:600;letter-spacing: 1px;":""},[I])}function ee(){i.createVisible=!0}function C(I){i.editRow=I,i.detailVisible=!0}async function o(){var I,d;if(!R.beginTime||!R.endTime){(I=window.$message)==null||I.warning("请选择要下载的订单报表的时间范围");return}if(await _(1),!(E.value.length<=0)){(d=window.$message)==null||d.success("正在生成报表"),i.exportLoading=!0;try{const{data:A,error:j}=await Zs(R);!j&&A&&A.code===0&&r(A.data)}catch{i.exportLoading=!1}}}function r(I){let d=0;const A=setInterval(async()=>{var ae;if(d>100){(ae=window.$message)==null||ae.error("报表导出失败，请稍后再试"),clearInterval(A),i.exportLoading=!1;return}const{data:j,error:se}=await eo(I);if(!se&&j&&j.code===0&&j.data.complete){i.exportLoading=!1,clearInterval(A),x(I);return}d+=1},3e3)}async function x(I){var d,A;try{const j=await fetch(`${Bs}/api/plantask/excel/${I}`,{mode:"cors"});j.ok||(d=window.$message)==null||d.error("下载异常");const se=await j.blob(),ae=document.createElement("a");ae.href=URL.createObjectURL(se),ae.download=`订单信息报表_${new Date().getTime()}.xlsx`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(ae.href)}catch(j){(A=window.$message)==null||A.error(`下载失败:${j}`)}}function S(I){var d;(d=window.$modal)==null||d.confirm({title:"停止提示",cancelText:"取消",okText:"确定",content:"停止任务后无法恢复，确定要停止当前任务吗？",async onOk(){const{data:A,error:j}=await so(I);!j&&A&&A.code===0&&(window.$message.success("停止指令已发送，请耐心等待！"),_())}})}return(I,d)=>{const A=de,j=Ts,se=st,ae=ao;return n(),P("div",er,[t(wo,{model:y(R),"onUpdate:model":d[0]||(d[0]=J=>as(R)?R.value=J:null),"user-info":y(U).userInfo,platform:y(je),status:y(is),mode:y(Ye),"shop-name-enum":i.shopNameEnum,onReset:y(N),onSearch:d[1]||(d[1]=J=>y(_)(1))},null,8,["model","user-info","platform","status","mode","shop-name-enum","onReset"]),t(ae,{title:"任务列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"plantask flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[t(j,{columns:y(u),"onUpdate:columns":d[3]||(d[3]=J=>as(u)?u.value=J:null),"disabled-delete":y(v).length===0,loading:y(K),"add-btn":y(U).userInfo.isTenant&&y(B).hasOne(y(Oe).DY.Task.CREATE),"delete-btn":y(U).userInfo.isTenant&&y(B).hasOne(y(Oe).DY.Task.DELETE),"delete-confirm-text":"仅会删除未开始与配对中的任务，确认删除吗？",onAdd:ee,onDelete:f},{default:l(()=>[t(A,{size:"small",ghost:"",type:"primary",class:"v-center flex",disabled:!y(E).length,onClick:d[2]||(d[2]=()=>y(_)())},{icon:l(()=>[t(y(Qs))]),default:l(()=>[d[11]||(d[11]=e("span",{class:"ml-6px"},"任务进度刷新",-1))]),_:1},8,["disabled"]),t(A,{size:"small",ghost:"",type:"primary",class:"v-center flex",disabled:!y(E).length,loading:i.exportLoading,onClick:o},{icon:l(()=>[t(y(Xs))]),default:l(()=>[d[12]||(d[12]=e("span",{class:"ml-6px"},"下载订单报表",-1))]),_:1},8,["disabled","loading"])]),_:1},8,["columns","disabled-delete","loading","add-btn","delete-btn"])]),default:l(()=>[t(se,{ref_key:"tableWrapperRef",ref:a,"expanded-row-keys":i.expandedRowKeys,"onUpdate:expandedRowKeys":d[4]||(d[4]=J=>i.expandedRowKeys=J),columns:y(F),"data-source":y(E),size:"small",scroll:y(b),loading:y(K),"row-key":"id","row-selection":y(X),pagination:y(w),class:"h-full"},null,8,["expanded-row-keys","columns","data-source","scroll","loading","row-selection","pagination"])]),_:1}),t(In,{visible:i.createVisible,"onUpdate:visible":d[5]||(d[5]=J=>i.createVisible=J),"user-info":y(U).userInfo,mode:y(Ye),onSubmitted:y(_)},null,8,["visible","user-info","mode","onSubmitted"]),t(rs,{visible:i.completionVisible,"onUpdate:visible":d[6]||(d[6]=J=>i.completionVisible=J),"row-data":i.editRow,onSubmitted:y(_)},null,8,["visible","row-data","onSubmitted"]),t(Fa,{visible:i.againVisible,"onUpdate:visible":d[7]||(d[7]=J=>i.againVisible=J),"row-data":i.editRow,"user-info":y(U).userInfo,mode:y(Ye),onSubmitted:d[8]||(d[8]=J=>y(_)(1))},null,8,["visible","row-data","user-info","mode"]),t(rs,{visible:i.completionVisible,"onUpdate:visible":d[9]||(d[9]=J=>i.completionVisible=J),"row-data":i.editRow,onSubmitted:y(_)},null,8,["visible","row-data","onSubmitted"]),t(Zd,{id:i.editRow.id,visible:i.detailVisible,"onUpdate:visible":d[10]||(d[10]=J=>i.detailVisible=J),onSubmitted:y(_)},null,8,["id","visible","onSubmitted"])])}}}),Mr=ce(lr,[["__scopeId","data-v-0a81b276"]]);export{Mr as default};
