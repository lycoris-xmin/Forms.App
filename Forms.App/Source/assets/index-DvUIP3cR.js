import{_ as Ut}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{S as ye,_ as Ke,a as Ge,b as Je,T as Ft,g as ze,u as qe,c as Qe,d as Xe,e as Ze,f as Re,A as Rt}from"./table-search-filter-oeJAv4cw.js";import{d as ie,D as me,E as ue,r as ae,F as fe,c as R,o as m,w as t,f as e,z as V,e as n,h as f,B as oe,g as b,a7 as be,s as He,i as Ee,b as U,H as le,P as se,t as te,ab as ke,a9 as ge,ac as et,C as Bt,a as vt,ad as ft,ae as gt,T as tt,af as Dt,q as kt,a8 as it,aa as Mt,ag as Ht,ah as Et,ai as Lt}from"./index-C4fDvJn1.js";import{u as Ot,A as Fe}from"./app.permissions-eEP3QY97.js";import{p as Oe}from"./index-DiqUFypO.js";import{c as rt}from"./helper-n1q5wElC.js";import{i as xe,I as Ae}from"./empty-a1btfWut.js";import{u as Be,a as lt,F as he,_ as de,I as Ve,d as at,Q as Nt}from"./form-C4lsPmD3.js";import{u as zt,f as Vt,a as jt,S as _t,_ as dt,b as Yt,c as wt,d as Wt,e as Kt,g as Gt,p as Le,h as pt,R as Jt,A as qt,i as ct,j as Qt,k as Xt,l as Zt,F as el,m as tl,n as ll}from"./calculate-pPROSkpL.js";import{S as Ie}from"./index-DjcmxpZa.js";import{_ as De}from"./index-BbA-ww4S.js";import{_ as Se}from"./index-B0OEq9ON.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as mt}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{_ as nt}from"./index.vue_vue_type_script_setup_true_lang-DSCZeeAS.js";import{_ as ot}from"./index-Bgjt1Cd5.js";import{R as al,D as nl}from"./dayjs-BBTQ6xGR.js";import{L as st}from"./index-EP99CXY3.js";import{d as bt}from"./debounce-C-eHgR1J.js";import{a as ol,b as sl,f as ut,c as yt}from"./enums-Cr_YM2zq.js";import{C as je}from"./index-BSgdO99v.js";import{P as Ye,C as ul}from"./index-CfF1NG6B.js";import{T as re}from"./index-Cd0TkKik.js";import{L as ht,_ as Ct,a as xt}from"./index-Q7LyDRqH.js";import{E as Me}from"./EyeOutlined-DMOywdMm.js";import{D as Ne}from"./DeleteOutlined-vV5-dJ7B.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./china.area-DOOnik0V.js";import"./isSymbol-7IJmde0n.js";const il=ie({name:"PlanTaskCompletionDrawer",__name:"completion-drawer",props:me({rowData:{default:()=>({})}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:me(["submitted"],["update:visible"]),setup(E,{emit:D}){const C=ue(E,"visible"),h=E,{provinceOptions:p,useCity:l}=zt(),{formRef:i,validate:B,resetFields:$}=Be(),{defaultRequiredRule:H}=lt(),F=D,J={orderId:H,payPrice:H,province:H,city:H,address:H,name:H,phone:H},A=ae(O()),I=ae([]);fe(C,async P=>{P&&($(),A.value=O(),h.rowData.success||(A.value.success=0),await o())});function O(){return{id:"",success:1,orderId:"",payPrice:0,province:"",city:"",address:"",name:"",phone:"",addressContent:"",note:"",loading:!1}}function d(){I.value=l(A.value.province),A.value.city=I.value[0].value}const L=(P,S)=>S.value.toLowerCase().includes(P.toLowerCase());async function o(){const{data:P,error:S}=await Vt(h.rowData.id);!S&&P&&P.code===0&&(A.value.id=P.data.id,P.data.success&&(A.value.orderId=P.data.orderId,A.value.payPrice=P.data.payPrice,A.value.province=P.data.province,A.value.city=P.data.city,A.value.address=P.data.address,A.value.name=P.data.name,A.value.phone=P.data.phone),A.value.note=P.data.note||"")}function v(){C.value=!1}async function G(){var P;if(await B(),A.value.success===0){await M();return}(P=window.$modal)==null||P.confirm({title:"订单补全信息提示",cancelText:"取消",okText:"确定",content:"请确认商品信息是否填写正确，提交后将无法修改，确定要提交吗？",async onOk(){await M()}})}async function M(){var P;A.value.loading=!0;try{const{data:S,error:Q}=await jt({...A.value});!Q&&S&&S.code===0&&((P=window.$message)==null||P.success("保存成功"),F("submitted"),v())}finally{A.value.loading=!1}}return(P,S)=>{const Q=ye,N=de,X=Ve,_=De,j=at,k=he,W=oe,q=Ie,w=Se;return m(),R(w,{open:C.value,"onUpdate:open":S[9]||(S[9]=g=>C.value=g),title:"任务信息",width:550},{footer:t(()=>[e(q,{size:16},{default:t(()=>[e(W,{onClick:v},{default:t(()=>S[13]||(S[13]=[b("取消")])),_:1}),e(W,{type:"primary",loading:A.value.loading,onClick:G},{default:t(()=>S[14]||(S[14]=[b("保存")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(k,{ref_key:"formRef",ref:i,name:"operate",layout:"vertical",model:A.value,rules:J},{default:t(()=>[e(N,{label:"购买结果",name:"success"},{default:t(()=>[e(Q,{value:A.value.success,"onUpdate:value":S[0]||(S[0]=g=>A.value.success=g),options:[{value:0,label:"购买失败"},{value:1,label:"购买成功"}],disabled:h.rowData.success},null,8,["value","disabled"])]),_:1}),A.value.success===1?(m(),R(N,{key:0,label:"订单号",name:"orderId"},{default:t(()=>[e(X,{value:A.value.orderId,"onUpdate:value":S[1]||(S[1]=g=>A.value.orderId=g),autocomplete:"off",placeholder:"请输入订单号",disabled:h.rowData.success},null,8,["value","disabled"])]),_:1})):V("",!0),A.value.success===1?(m(),R(N,{key:1,label:"支付金额",name:"payPrice"},{default:t(()=>[e(_,{value:A.value.payPrice,"onUpdate:value":S[2]||(S[2]=g=>A.value.payPrice=g),min:0,controls:!1,precision:2,disabled:h.rowData.success},{addonBefore:t(()=>S[10]||(S[10]=[n("span",null,"￥",-1)])),addonAfter:t(()=>S[11]||(S[11]=[n("span",null,"元",-1)])),_:1},8,["value","disabled"])]),_:1})):V("",!0),A.value.success===1?(m(),R(N,{key:2,label:"省份",name:"province"},{default:t(()=>[e(Q,{value:A.value.province,"onUpdate:value":S[3]||(S[3]=g=>A.value.province=g),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,options:f(p),"filter-option":L,disabled:h.rowData.success,onChange:d},null,8,["value","options","disabled"])]),_:1})):V("",!0),A.value.success===1?(m(),R(N,{key:3,label:"市区",name:"city"},{default:t(()=>[e(Q,{value:A.value.city,"onUpdate:value":S[4]||(S[4]=g=>A.value.city=g),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,options:I.value,"filter-option":L,disabled:h.rowData.success},{notFoundContent:t(()=>S[12]||(S[12]=[n("p",null,"没有找到匹配的市区",-1)])),_:1},8,["value","options","disabled"])]),_:1})):V("",!0),A.value.success===1?(m(),R(N,{key:4,label:"详细地址",name:"address"},{default:t(()=>[e(j,{value:A.value.address,"onUpdate:value":S[5]||(S[5]=g=>A.value.address=g),autocomplete:"off",placeholder:"请输入详细地址","auto-size":{minRows:5},disabled:h.rowData.success},null,8,["value","disabled"])]),_:1})):V("",!0),A.value.success===1?(m(),R(N,{key:5,label:"收货人",name:"name"},{default:t(()=>[e(X,{value:A.value.name,"onUpdate:value":S[6]||(S[6]=g=>A.value.name=g),autocomplete:"off",placeholder:"请输入收货人名称",disabled:h.rowData.success},null,8,["value","disabled"])]),_:1})):V("",!0),A.value.success===1?(m(),R(N,{key:6,label:"联系方式",name:"phone"},{default:t(()=>[e(X,{value:A.value.phone,"onUpdate:value":S[7]||(S[7]=g=>A.value.phone=g),autocomplete:"off",placeholder:"请输入联系方式",disabled:h.rowData.success},null,8,["value","disabled"])]),_:1})):V("",!0),e(N,{label:"任务备注"},{default:t(()=>[e(j,{value:A.value.note,"onUpdate:value":S[8]||(S[8]=g=>A.value.note=g),"auto-size":{minRows:3},maxlength:300},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),rl=pe(il,[["__scopeId","data-v-ea1e4d6c"]]),dl={class:"flex-1"},pl={class:"w-full flex-y-center justify-end gap-12px"},cl=ie({name:"AliPlanTaskListSearch",__name:"search-filter",props:me({userInfo:{},mode:{},status:{},shopNameEnum:{}},{model:{required:!0},modelModifiers:{}}),emits:me(["reset","search"],["update:model"]),setup(E,{emit:D}){const{formRef:C,validate:h,resetFields:p}=Be(),l=ue(E,"model"),i=E,B=D;async function $(){await p(),B("reset")}async function H(){await h(),B("search")}function F(A,I){l.value.beginTime=I[0],l.value.endTime=I[1]}const J=A=>A&&A>=be().endOf("day");return(A,I)=>{const O=ye,d=de,L=ot,o=Ve,v=al,G=Ge,M=oe,P=Je,S=Ke,Q=he;return m(),R(Ft,null,{default:t(()=>[e(Q,{ref_key:"formRef",ref:C,class:"search-filter",model:l.value,"label-col":{span:5,md:7}},{default:t(()=>[e(S,{gutter:[16,16],wrap:""},{default:t(()=>[e(L,{span:24,md:12,lg:6},{default:t(()=>[e(d,{label:"任务模式",name:"mode",class:"m-0"},{default:t(()=>[e(O,{value:l.value.mode,"onUpdate:value":I[0]||(I[0]=N=>l.value.mode=N),placeholder:"- 全部 -",options:i.mode,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),e(L,{span:24,md:12,lg:6},{default:t(()=>[e(d,{label:"任务状态",name:"status",class:"m-0"},{default:t(()=>[e(O,{value:l.value.status,"onUpdate:value":I[1]||(I[1]=N=>l.value.status=N),placeholder:"- 全部 -",options:i.status,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),e(L,{span:24,md:12,lg:6},{default:t(()=>[e(d,{label:"商品标题",name:"title",class:"m-0"},{default:t(()=>[e(o,{value:l.value.title,"onUpdate:value":I[2]||(I[2]=N=>l.value.title=N),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),e(L,{span:24,md:12,lg:6},{default:t(()=>[e(d,{label:"所属店铺",name:"shopId",class:"m-0"},{default:t(()=>[e(nt,{value:l.value.shopId,"onUpdate:value":I[3]||(I[3]=N=>l.value.shopId=N),platform:1,"show-search":!i.userInfo.isTenant,remote:!i.userInfo.isTenant,options:i.userInfo.isTenant?i.shopNameEnum:void 0},null,8,["value","show-search","remote","options"])]),_:1})]),_:1}),e(L,{span:24,md:12,lg:6},{default:t(()=>[e(d,{label:"创建时间",name:"createTimeRange",class:"m-0"},{default:t(()=>[e(v,{value:l.value.createTimeRange,"onUpdate:value":I[4]||(I[4]=N=>l.value.createTimeRange=N),"show-time":{hideDisabledOptions:!0,defaultValue:[f(be)("00:00:00","HH:mm:ss"),f(be)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],"disabled-date":J,onChange:F},null,8,["value","show-time"])]),_:1})]),_:1}),i.userInfo.isTenant?i.userInfo.isTenantUser?V("",!0):(m(),R(L,{key:1,span:24,md:12,lg:6},{default:t(()=>[e(d,{label:"创建员工",name:"userId",class:"m-0"},{default:t(()=>[e(mt,{value:l.value.userId,"onUpdate:value":I[6]||(I[6]=N=>l.value.userId=N),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})]),_:1})):(m(),R(L,{key:0,span:24,md:12,lg:6},{default:t(()=>[e(d,{label:"创建商户",name:"userId",class:"m-0"},{default:t(()=>[e(mt,{value:l.value.userId,"onUpdate:value":I[5]||(I[5]=N=>l.value.userId=N),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),n("div",dl,[e(d,{class:"m-0"},{default:t(()=>[n("div",pl,[e(M,{onClick:$},{icon:t(()=>[e(G,{class:"align-sub text-icon"})]),default:t(()=>[I[7]||(I[7]=n("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(M,{type:"primary",ghost:"",onClick:H},{icon:t(()=>[e(P,{class:"align-sub text-icon"})]),default:t(()=>[I[8]||(I[8]=n("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),ml=pe(cl,[["__scopeId","data-v-eb2353ac"]]),vl={class:"v-center flex gap-8px"},fl=ie({name:"PlanTaskFriendsSelect",__name:"friends-select",props:{value:{default:""},valueModifiers:{}},emits:["update:value"],setup(E){const D=ue(E,"value"),C=He({lastSearchFilter:"",friendsOptions:[]}),h=bt(async p=>{C.lastSearchFilter=p;const{data:l,error:i}=await ol(p);!i&&l&&l.code===0&&l.data&&l.data.list&&l.data.list.length&&(C.friendsOptions=l.data.list.map(B=>({value:B.value,label:B.text})),C.friendsOptions.length===1&&(D.value=C.friendsOptions[0].value))});return Ee(()=>{h()}),(p,l)=>{const i=ze,B=ye,$=oe,H=de;return m(),R(H,{name:"friend"},{label:t(()=>l[2]||(l[2]=[n("p",null,[b(" 指定好友 "),n("small",{class:"info"},"* 如未找到好友，请核好友列表是否已添加且已有审核过的店铺")],-1)])),default:t(()=>[n("div",vl,[e(B,{value:D.value,"onUpdate:value":l[0]||(l[0]=F=>D.value=F),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,onSearch:f(h)},{notFoundContent:t(()=>l[3]||(l[3]=[n("p",null,"没有可分配的好友",-1)])),default:t(()=>[(m(!0),U(le,null,se(C.friendsOptions,F=>(m(),R(i,{key:F.value,value:F.value},{default:t(()=>[b(te(F.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onSearch"]),e($,{onClick:l[1]||(l[1]=()=>f(h)(C.lastSearchFilter))},{default:t(()=>l[4]||(l[4]=[b("刷新")])),_:1})])]),_:1})}}}),At=pe(fl,[["__scopeId","data-v-2b7be08f"]]),gl={class:"v-center flex gap-8px"},kl=ie({name:"PlanTaskDeviceSelect",__name:"device-select",props:{value:{default:""},valueModifiers:{}},emits:["update:value"],setup(E){const D=ue(E,"value"),C=He({lastSearchFilter:"",deviceIdOptions:[]}),h=bt(async p=>{C.lastSearchFilter=p;const{data:l,error:i}=await sl(p);!i&&l&&l.code===0&&l.data&&l.data.list&&l.data.list.length&&(C.deviceIdOptions=l.data.list.map(B=>({value:B.value,label:B.text})),C.deviceIdOptions.length===1&&(D.value=C.deviceIdOptions[0].value))});return Ee(()=>{h("")}),(p,l)=>{const i=ze,B=ye,$=oe,H=de;return m(),R(H,{name:"deviceId"},{label:t(()=>l[2]||(l[2]=[n("p",null,[b(" 指定设备 "),n("small",{class:"info"},"* 如未找到设备，请核对设备剩余使用数")],-1)])),default:t(()=>[n("div",gl,[e(B,{value:D.value,"onUpdate:value":l[0]||(l[0]=F=>D.value=F),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,onSearch:f(h)},{notFoundContent:t(()=>l[3]||(l[3]=[n("p",null,"没有可分配的设备",-1)])),default:t(()=>[(m(!0),U(le,null,se(C.deviceIdOptions,F=>(m(),R(i,{key:F.value,value:F.value},{default:t(()=>[b(te(F.label)+" ("+te(F.value)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onSearch"]),e($,{onClick:l[1]||(l[1]=()=>f(h)(C.lastSearchFilter))},{default:t(()=>l[4]||(l[4]=[b("刷新")])),_:1})])]),_:1})}}}),It=pe(kl,[["__scopeId","data-v-248238bd"]]),_l={class:"space-between v-center mb-12px flex"},wl={class:"products"},bl={class:"v-center mb-6px flex gap-8px"},yl=["onClick"],hl={class:"v-center flex gap-8px"},Cl={class:"products-image"},xl={class:"products-body"},Al={class:"sku"},Il={class:"mb-6px"},Sl={class:"v-center flex gap-8px"},$l={class:"v-center num-container flex gap-8px"},Tl={class:"v-center del-btn flex gap-6px"},Pl={class:"text-center"},Ul={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Fl={class:"flex-1"},Rl={class:"w-full flex-y-center justify-end gap-12px"},Bl=ie({__name:"again-product-select",props:me({shopId:{default:""}},{products:{default:[]},productsModifiers:{},multiple:{type:Boolean,default:!1},multipleModifiers:{}}),emits:me(["submitted","shopValidate"],["update:products","update:multiple"]),setup(E,{expose:D,emit:C}){const h=ue(E,"products"),p=ue(E,"multiple"),l=ae(M()),{tableWrapperRef:i,scrollConfig:B}=qe(),{columns:$,data:H,getData:F,getDataByPage:J,loading:A,mobilePagination:I,searchParams:O,resetSearchParams:d}=Qe({apiFn:S,apiParams:{platform:40,shopId:"",url:"",title:"",itemId:"",pageIndex:1,pageSize:10},columns:Q}),{checkedRowKeys:L,rowSelection:o}=Xe(H,F),v=E,G=C;fe(()=>l.value.visible,s=>{s||w()}),fe(L,s=>{if(!p.value&&s.length>1){const r=L.value.at(-1);L.value.splice(0,L.value.length,...r!==""?[r]:[]),o.value.selectedRowKeys=[r],o.value.selectedRows=o.value.selectedRows.filter(u=>u.id===r)}}),fe(()=>l.value.products,s=>{var u;for(const c of s){const a=h.value.findIndex(T=>T.id===c.id);a>-1?(h.value[a].skuList=c.selectedSkuMap?JSON.parse(c.selectedSkuMap):[],h.value[a].keyword=c.keyword,h.value[a].count=c.count,h.value[a].price=c.price,h.value[a].scope=c.scope,h.value[a].main=c.main):h.value.push({id:c.id,shopName:c.shopName,url:c.url,image:c.image,title:c.title,keyword:c.keyword,skuCount:((u=c.skuMap)==null?void 0:u.length)||0,skuList:c.selectedSkuMap?JSON.parse(c.selectedSkuMap):[],count:c.count,price:c.price,scope:c.scope,main:c.main,comment:c.comment})}const r=s.map(c=>c.id);h.value=h.value.filter(c=>r.includes(c.id)),G("submitted")},{deep:!0}),Ee(()=>{X()});function M(){return{visible:!1,products:[],loading:!0}}async function P(){if(v.shopId===""||v.shopId==="0"){G("shopValidate");return}l.value.visible=!0;try{O.shopId!==v.shopId&&(l.value.loading=!0,O.shopId=v.shopId,await J(1))}finally{l.value.loading&&(l.value.loading=!1)}}function S(s){return l.value.visible?yt({...s}):Promise.resolve({code:0,msg:"",data:{count:0,list:[],pageIndex:1,pageSize:10}})}function Q(){return[{key:"image",dataIndex:"image",title:"商品主图",width:80,customRender({record:r}){return e("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[e(Ae,{width:64,height:64,src:r.image,fallback:xe},null)])}},{key:"title",dataIndex:"title",title:"商品"},{key:"shopName",dataIndex:"shopName",title:"店铺",width:200}]}function N(){var r;if(!O.url)return;const s=new URL(O.url);if(O.itemId=s.searchParams.get("id")||"",!O.itemId){(r=window.$message)==null||r.warning("商品链接解析失败，请核对链接或手动填写商品Id");return}O.url=`${s.protocol}//${s.host}${s.pathname}?id=${l.value.itemId}`}async function X(){try{const{data:s,error:r}=await ut();!r&&s&&s.code===0&&(l.value.shopNameEnum=s.data.list)}catch{}}function _(){ke(()=>{var s;!p.value&&l.value.products.length>1&&((s=window.$message)==null||s.warning("只能保留一个商品，请删除其他商品"),p.value=!0)})}function j(s,r){r.main?l.value.products.forEach((u,c)=>u.main=c===s):l.value.products.filter(u=>u.main).length===0&&(r.main=!0)}function k(){const s=o.value.selectedRows.map((r,u)=>({id:r.id,shopName:r.shopName,url:r.url,image:r.image,title:r.title,keyword:"",skuMap:r.skuMap.map(c=>({sku:c.sku,price:c.price,value:JSON.stringify(c.sku),label:c.sku.join("+")})),selectedSkuMap:null,skuList:[],count:1,price:0,scope:10,main:u===0}));if(p.value)for(const r of s)l.value.products.filter(u=>u.id===r.id).length||(r.main=l.value.products.filter(u=>u.main).length===0,l.value.products.push(r));else(l.value.products.length===0||s[0].id!==l.value.products[0].id)&&(l.value.products=[s[0]]);l.value.visible=!1}function W(s){const r=l.value.products[s].skuMap.filter(u=>u.value===l.value.products[s].selectedSkuMap);r&&r.length?l.value.products[s].price=r[0].price:l.value.products[s].price=0}function q(s){l.value.products=l.value.products.filter((r,u)=>u!==s),l.value.products.length&&!l.value.products.filter(r=>r.main).length&&(l.value.products[0].main=!0)}function w(){L.value=[],o.value.selectedRowKeys=[],o.value.selectedRows=[]}function g(s){var r;s?window.open(s):(r=window.$message)==null||r.warning("该商品没有添加商品链接，无法跳转")}return D({initSelectedProducts:()=>{l.value=M(),w()},setSelectedProducts:(s=[])=>{l.value.products=s.map(r=>({id:r.id,shopName:r.shopName,url:r.url,image:r.image,title:r.title,keyword:r.keyword,skuMap:r.skuMap.map(u=>({sku:u.sku,price:u.price,value:JSON.stringify(u.sku),label:u.sku.join("+")})),selectedSkuMap:r.selectedSkuMap?JSON.parse(r.selectedSkuMap):null,skuList:r.skuList,count:r.count,price:r.price,scope:r.scope,main:r.main,comment:r.comment}))}}),(s,r)=>{const u=je,c=Ae,a=ye,T=re,y=Ve,ee=De,K=ge,Z=oe,_e=Re,ve=de,we=ot,$e=Ge,Te=Je,Pe=Ke,Ue=he,Ce=Ze,We=Ie,Y=Se;return m(),U(le,null,[n("p",_l,[n("span",null,"商品列表(已选 "+te(l.value.products.length)+" 个)",1),e(u,{checked:p.value,"onUpdate:checked":r[0]||(r[0]=z=>p.value=z),onChange:_},{default:t(()=>r[8]||(r[8]=[b("多商品")])),_:1},8,["checked"])]),n("ul",wl,[(m(!0),U(le,null,se(l.value.products,(z,ne)=>(m(),U("li",{key:z.id},[n("div",bl,[p.value?(m(),R(u,{key:0,checked:z.main,"onUpdate:checked":ce=>z.main=ce,onChange:()=>j(ne,z)},{default:t(()=>r[9]||(r[9]=[b(" 主商品 ")])),_:2},1032,["checked","onUpdate:checked","onChange"])):V("",!0),n("p",{class:"title",onClick:ce=>g(z.url)},te(z.title),9,yl)]),n("div",hl,[n("div",Cl,[e(c,{width:100,height:100,src:z.image,fallback:f(xe)},null,8,["src","fallback"])]),n("div",xl,[n("div",Al,[z.skuMap.length?(m(),R(a,{key:0,value:z.selectedSkuMap,"onUpdate:value":ce=>z.selectedSkuMap=ce,options:z.skuMap,placeholder:"请选择商品Sku",onChange:ce=>W(ne)},null,8,["value","onUpdate:value","options","onChange"])):(m(),R(T,{key:1},{default:t(()=>r[10]||(r[10]=[b("该商品无Sku")])),_:1}))]),n("div",Il,[e(y,{value:z.keyword,"onUpdate:value":ce=>z.keyword=ce,placeholder:z.main?"请输入搜索关键词":"没有输入输入关键词则进店查找"},null,8,["value","onUpdate:value","placeholder"])]),n("div",Sl,[n("div",$l,[e(ee,{value:z.price,"onUpdate:value":ce=>z.price=ce,min:0,max:99999,controls:!1,precision:2},{addonBefore:t(()=>r[11]||(r[11]=[n("span",null,"价格",-1)])),addonAfter:t(()=>r[12]||(r[12]=[n("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"]),e(ee,{value:z.count,"onUpdate:value":ce=>z.count=ce,min:1,max:99999,controls:!1,precision:0},{addonBefore:t(()=>r[13]||(r[13]=[n("span",null,"购买",-1)])),addonAfter:t(()=>r[14]||(r[14]=[n("span",null,"件",-1)])),_:2},1032,["value","onUpdate:value"]),e(ee,{value:z.scope,"onUpdate:value":ce=>z.scope=ce,min:0,max:99999,controls:!1,precision:2},{addonBefore:t(()=>[e(K,{placement:"top"},{title:t(()=>r[15]||(r[15]=[n("span",null,"下单商品时商品单价与填写价格相差符合差额范围内才下单",-1)])),default:t(()=>[r[16]||(r[16]=n("span",null,"浮动差额 ±",-1))]),_:1})]),addonAfter:t(()=>r[17]||(r[17]=[n("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"])]),n("div",Tl,[e(_e,{title:"确认删除吗？",placement:"left",onConfirm:()=>q(ne)},{default:t(()=>[e(Z,{danger:"",size:"small"},{default:t(()=>r[18]||(r[18]=[b("删除")])),_:1})]),_:2},1032,["onConfirm"])])])])])]))),128))]),p.value||l.value.products.length===0?(m(),U("div",{key:0,class:"actions mb-12px",onClick:P},[n("p",Pl,[e(f(Ye)),r[19]||(r[19]=b(" 添加商品 "))])])):V("",!0),e(Y,{open:l.value.visible,"onUpdate:open":r[7]||(r[7]=z=>l.value.visible=z),title:"商品选择",width:800},{footer:t(()=>[e(We,{size:16},{default:t(()=>[e(Z,{onClick:r[6]||(r[6]=()=>l.value.visible=!1)},{default:t(()=>r[22]||(r[22]=[b("取消")])),_:1}),e(Z,{type:"primary",disabled:f(L).length===0,onClick:k},{default:t(()=>r[23]||(r[23]=[b("确定")])),_:1},8,["disabled"])]),_:1})]),default:t(()=>[n("div",Ul,[e(Ue,{model:f(O),"label-col":{span:5,md:7}},{default:t(()=>[e(Pe,{class:"row",gutter:[16,16],wrap:""},{default:t(()=>[e(we,{span:12},{default:t(()=>[e(ve,{label:"商品链接",name:"url",class:"m-0"},{default:t(()=>[e(y,{value:f(O).url,"onUpdate:value":r[1]||(r[1]=z=>f(O).url=z),placeholder:"",onBlur:N},null,8,["value"])]),_:1})]),_:1}),e(we,{span:12},{default:t(()=>[e(ve,{label:"商品编号",name:"itemId",class:"m-0"},{default:t(()=>[e(y,{value:f(O).itemId,"onUpdate:value":r[2]||(r[2]=z=>f(O).itemId=z),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e(we,{span:12},{default:t(()=>[e(ve,{label:"商品名称",name:"title",class:"m-0"},{default:t(()=>[e(y,{value:f(O).title,"onUpdate:value":r[3]||(r[3]=z=>f(O).title=z),placeholder:""},null,8,["value"])]),_:1})]),_:1}),n("div",Fl,[e(ve,{class:"m-0"},{default:t(()=>[n("div",Rl,[e(Z,{onClick:r[4]||(r[4]=z=>f(d)())},{icon:t(()=>[e($e,{class:"align-sub text-icon"})]),default:t(()=>[r[20]||(r[20]=n("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(Z,{type:"primary",ghost:"",onClick:r[5]||(r[5]=z=>f(J)(1))},{icon:t(()=>[e(Te,{class:"align-sub text-icon"})]),default:t(()=>[r[21]||(r[21]=n("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"]),e(Ce,{ref_key:"tableWrapperRef",ref:i,columns:f($),"data-source":f(H),size:"small","row-selection":f(o),scroll:f(B),loading:f(A),"row-key":"id",pagination:f(I),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(st,{loading:l.value.loading},null,8,["loading"])])]),_:1},8,["open"])],64)}}}),Dl=pe(Bl,[["__scopeId","data-v-ad0ebd83"]]),Ml={class:"v-center flex gap-8px"},Hl={class:"actions"},El={key:0,class:"text-danger"},Ll={class:"popover-content"},Ol=ie({name:"PlanTaskActions",__name:"actions",props:{actions:{default:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0}},actionsModifiers:{}},emits:["update:actions"],setup(E){const D=ue(E,"actions"),C=ae([{key:"addCart",label:"商品加购",content:[{text:"将商品添加至购物车，不勾选则根据随机进行购物车或立即购买流程"},{text:"注意：多链接商品只能走加购流程"}]},{key:"favorite",label:"商品收藏",content:[{text:"收藏商品，不勾选不收藏"},{text:"注意：多链接情况下，该行为只会在主商品下生效"}]},{key:"useFirstBrowse",label:"随机搜索浏览多次",content:[{text:"根据关键词搜索相关推荐词进行浏览，不勾选不进行"},{text:"注意：推荐词不一定是当前商品类目,多链接情况下，该行为只会在主商品下生效"}]},{key:"lookComment",label:"随机看商品评价",extra:"（3-10次动态）",content:[{text:"浏览商品评价随机页数，不勾选则不进行"},{text:"注意：多链接情况下，该行为只会在主商品下生效"}]},{key:"useWaitForBuy",label:"浏览后随机等待分钟数付款",content:[{text:"去往购物车付款之前会返回桌面等待1-3分钟后进行购买,不勾选不进行"},{text:"注意：必须勾选商品加购流程才会触发，如果是多链接情况下，该行为只会在主商品下生效"}]},{key:"useFindBrowse",label:"找到指定商品后不购买，再次随机浏览后下单",content:[{text:"找到目标商品后，继续向下随机浏览多次再返回下单，不勾选不进行"},{text:"注意：多链接情况下，该行为只会在主商品下生效"}]}]);return(h,p)=>{const l=De,i=de,B=je;return m(),U(le,null,[e(i,null,{label:t(()=>p[3]||(p[3]=[n("p",null,[b(" 货比三家 "),n("small",{class:"text-danger ml-1"},"* 都为0不进行货比")],-1)])),default:t(()=>[n("div",Ml,[e(l,{value:D.value.shopAround.min,"onUpdate:value":p[0]||(p[0]=$=>D.value.shopAround.min=$),min:0,controls:!1,precision:0},{addonBefore:t(()=>p[4]||(p[4]=[n("span",null,"最少",-1)])),addonAfter:t(()=>p[5]||(p[5]=[n("span",null,"次",-1)])),_:1},8,["value"]),e(l,{value:D.value.shopAround.max,"onUpdate:value":p[1]||(p[1]=$=>D.value.shopAround.max=$),min:0,controls:!1,precision:0},{addonBefore:t(()=>p[6]||(p[6]=[n("span",null,"最多",-1)])),addonAfter:t(()=>p[7]||(p[7]=[n("span",null,"次",-1)])),_:1},8,["value"])])]),_:1}),e(i,{label:"商品互动"},{default:t(()=>[n("ul",Hl,[(m(!0),U(le,null,se(C.value,$=>(m(),U("li",{key:$.key},[e(B,{checked:D.value[$.key],"onUpdate:checked":H=>D.value[$.key]=H},{default:t(()=>[b(te($.label)+" ",1),$.extra?(m(),U("span",El,te($.extra),1)):V("",!0),e(f(Rt),null,{content:t(()=>[n("div",Ll,[(m(!0),U(le,null,se($.content,(H,F)=>(m(),U("p",{key:F,class:Bt({"text-bold":H.text.includes("注意")})},te(H.text),3))),128))])]),default:t(()=>[e(f(Nt),{class:"small-icon",onClick:p[2]||(p[2]=et(H=>{H.preventDefault()},["stop"]))})]),_:2},1024)]),_:2},1032,["checked","onUpdate:checked"])]))),128))])]),_:1})],64)}}}),St=pe(Ol,[["__scopeId","data-v-76078a15"]]),Nl={class:"grid-2 grid"},zl=ie({name:"PlanTaskTimePicler",__name:"time-picker",props:{beginTime:{default:""},beginTimeModifiers:{},endTime:{default:""},endTimeModifiers:{}},emits:["update:beginTime","update:endTime"],setup(E,{expose:D}){const C=ue(E,"beginTime"),h=ue(E,"endTime");function p(i,B){const $=be().startOf("day");if(B===0){const F=$.add(7,"days");return i.isBefore($)?!0:!!i.isAfter(F)}if(i.isBefore($))return i.isBefore($);const H=C.value?be(C):null;if(H!==null){const F=H.add(3,"days");if(i.isBefore(C))return!0;if(i.isAfter(F))return!0}return!1}function l(i){(!h.value||be(h).isBefore(i))&&(h.value=be(i).endOf("day").format("YYYY-MM-DD HH:mm:ss"))}return D({initDateRange:()=>{const i=be();C.value=i.format("YYYY-MM-DD HH:mm:ss"),h.value=i.endOf("day").format("YYYY-MM-DD HH:mm:ss")}}),(i,B)=>{const $=nl,H=de;return m(),U("div",Nl,[e(H,{label:"开始时间",name:"beginTime"},{default:t(()=>[e($,{value:C.value,"onUpdate:value":B[0]||(B[0]=F=>C.value=F),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"","disabled-date":F=>p(F,0),onChange:l},null,8,["value","disabled-date"])]),_:1}),e(H,{label:"结束时间",name:"endTime"},{default:t(()=>[e($,{value:h.value,"onUpdate:value":B[1]||(B[1]=F=>h.value=F),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"","disabled-date":F=>p(F,1)},null,8,["value","disabled-date"])]),_:1})])}}}),$t=pe(zl,[["__scopeId","data-v-9f21b820"]]),Vl={class:"mb-12px"},jl={key:0},Yl={class:"mb-8px"},Wl={class:"wrap flex gap-8px"},Kl={key:0},Gl={key:1},Jl={key:2,class:"comment-preview"},ql=["src"],Ql={class:"wrap v-center center flex gap-8px"},Xl=["onClick"],Zl={key:3,class:"comment-preview"},ea=["src"],ta={class:"wrap v-center center flex gap-8px"},la=["onClick"],aa={class:"wrap flex gap-8px"},na=["src"],oa={class:"wrap v-center center flex gap-8px"},sa={key:1,class:"stop"},ua={class:"text-center"},ia={class:"video"},ra=["src","type"],da=ie({name:"PlanTaskComment",__name:"again-product-comment",props:{products:{default:[]},productsModifiers:{}},emits:["update:products"],setup(E,{expose:D}){const C=ae(null),{formRef:h,resetFields:p}=Be(),l=ue(E,"products"),i=ae($()),B=vt(()=>i.value.images.length+i.value.videos.length===6);fe(l,o=>{if(o&&o.length){const v=o.map(M=>{const P={...M};return(!P.comment||!P.comment.hasComment)&&(P.comment=H()),P}),G=o.map(M=>M.id);i.value.products=i.value.products.filter(M=>G.includes(M.id));for(const M of v){const P=i.value.products.findIndex(S=>S.id===M.id);P>-1?Object.assign(i.value.products[P],M):i.value.products.push(M)}}else i.value.products=[]},{deep:!0});function $(){return{products:[],visible:!1,index:-1,title:"",text:"",images:[],videos:[],preview:{visible:!1,src:"",type:""}}}function H(){return{hasComment:!1,text:"",images:[],videos:[]}}function F(o,v){i.value.index=o,i.value.title=`商品：${v.title}`,i.value.visible=!0}function J(o){i.value.products[o].comment=H()}function A(){var o;!B.value&&i.value.videos.length<6&&((o=C.value)==null||o.click())}function I(o){try{if(o.target.files&&o.target.files.length)for(const v of o.target.files){if(B.value)break;const G={src:URL.createObjectURL(v),file:v,visible:!1};i.value.images.push(G)}}finally{C.value.value=""}}function O(o){i.value.images.splice(o,1)}function d({src:o,type:v}){i.value.preview.visible=!0,i.value.preview.src=o,i.value.preview.type=v}async function L(){l.value[i.value.index].comment={hasComment:!0,mode:0,text:i.value.text,images:i.value.images.map(o=>({file:o.file,src:o.src})),videos:i.value.videos.map(o=>({file:o.file,preview:o.preview,src:o.src,type:o.type}))},i.value.visible=!1,ke(()=>{i.value.text="",i.value.images=[],i.value.videos=[]})}return D({initComment:()=>{p(),i.value=$()}}),(o,v)=>{const G=re,M=Ae,P=xt,S=oe,Q=Re,N=Ct,X=ht,_=at,j=de,k=he,W=Ie,q=Se;return m(),U(le,null,[n("div",Vl,[v[10]||(v[10]=n("p",{class:"form-label mb-12px"},"商品评价",-1)),e(X,{"item-layout":"vertical","data-source":i.value.products},{renderItem:t(({item:w,index:g})=>[(m(),R(N,{key:w.id},{actions:t(()=>[w.comment.hasComment?(m(),R(Q,{key:0,title:"确认删除吗？",placement:"top",onConfirm:()=>J(g)},{default:t(()=>[e(S,{size:"small",danger:""},{default:t(()=>v[8]||(v[8]=[b("删除评价")])),_:1})]),_:2},1032,["onConfirm"])):(m(),R(S,{key:1,size:"small",onClick:s=>F(g,w)},{default:t(()=>v[9]||(v[9]=[b("添加评价")])),_:2},1032,["onClick"]))]),default:t(()=>[e(P,{description:w.skuList.join(";")||"-"},{title:t(()=>[n("p",null,[w.main?(m(),R(G,{key:0,color:"purple"},{default:t(()=>v[5]||(v[5]=[b("主商品")])),_:1})):V("",!0),b(" "+te(w.title),1)])]),avatar:t(()=>[e(M,{height:"60px",width:"60px",src:w.image,fallback:f(xe)},null,8,["src","fallback"])]),_:2},1032,["description"]),w.comment.hasComment?(m(),U("div",jl,[n("p",Yl,te(w.comment.text),1),n("div",Wl,[w.comment.images&&w.comment.images.length?(m(),U("div",Kl,[(m(!0),U(le,null,se(w.comment.images,s=>(m(),U("div",{key:s,class:"comment-preview"},[e(M,{src:s.src,height:80,width:80},null,8,["src"])]))),128))])):w.comment.imageUrls&&w.comment.imageUrls.length?(m(),U("div",Gl,[(m(!0),U(le,null,se(w.comment.imageUrls,s=>(m(),U("div",{key:s,class:"comment-preview"},[e(M,{src:s,height:80,width:80},null,8,["src"])]))),128))])):V("",!0),w.comment.videos&&w.comment.videos.length?(m(),U("div",Jl,[n("img",{src:w.comment.videos[0].preview,height:80,width:80},null,8,ql),n("div",Ql,[n("p",{onClick:()=>d(w.comment.videos[0])},[e(f(Me)),v[6]||(v[6]=b(" 预览 "))],8,Xl)])])):w.comment.videoUrls&&w.comment.videoUrls.length?(m(),U("div",Zl,[n("img",{src:w.comment.videoUrls[0],height:80,width:80},null,8,ea),n("div",ta,[n("p",{onClick:()=>d(w.comment.videoUrls[0])},[e(f(Me)),v[7]||(v[7]=b(" 预览 "))],8,la)])])):V("",!0)])])):V("",!0)]),_:2},1024))]),_:1},8,["data-source"])]),e(q,{open:i.value.visible,"onUpdate:open":v[2]||(v[2]=w=>i.value.visible=w),title:i.value.title,width:800},{footer:t(()=>[e(W,{size:16},{default:t(()=>[e(S,{onClick:v[1]||(v[1]=()=>i.value.visible=!1)},{default:t(()=>v[13]||(v[13]=[b("取消")])),_:1}),e(S,{type:"primary",onClick:L},{default:t(()=>v[14]||(v[14]=[b("确定")])),_:1})]),_:1})]),default:t(()=>[e(k,{ref_key:"formRef",ref:h,name:"operate",layout:"vertical",model:i.value},{default:t(()=>[e(j,{label:"文字",name:"text"},{default:t(()=>[e(_,{value:i.value.text,"onUpdate:value":v[0]||(v[0]=w=>i.value.text=w),"auto-size":{minRows:6},"show-count":"",maxlength:300,placeholder:"请输入文字评价"},null,8,["value"])]),_:1}),e(j,null,{label:t(()=>v[11]||(v[11]=[n("p",null,[b(" 图片 "),n("small",{class:"text-danger ml-4px"},"* 图片+视频最多6个，且图片必须小于3M")],-1)])),default:t(()=>[n("input",{ref_key:"imageUploadRef",ref:C,type:"file",accept:"image/jpeg,image/png",class:"upload-hidden",multiple:"",onChange:I},null,544),n("div",aa,[i.value.images.length?(m(),R(ft,{key:0,tag:"ul",name:"list",class:"wrap flex gap-8px"},{default:t(()=>[(m(!0),U(le,null,se(i.value.images,(w,g)=>(m(),U("li",{key:w.src,class:"preview uploder"},[e(M,{width:200,preview:{visible:w.visible,onVisibleChange:s=>w.visible=s},src:w.src},null,8,["preview","src"]),n("img",{src:w.src},null,8,na),n("div",oa,[e(f(Me),{onClick:s=>w.visible=!0},null,8,["onClick"]),e(f(Ne),{onClick:s=>O(g)},null,8,["onClick"])])]))),128))]),_:1})):V("",!0),i.value.images.length<6&&!B.value?(m(),U("div",{key:1,class:"uploder center v-center flex",onClick:A},[i.value.images.length<6&&!B.value?(m(),R(f(Ye),{key:0})):i.value.images.length<6?(m(),U("div",sa,[n("p",ua,[e(f(_t))]),v[12]||(v[12]=n("p",{class:"text-center"},"数量已上限",-1))])):V("",!0)])):V("",!0)])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),(m(),R(gt,{to:"body"},[e(tt,{name:"fade",mode:"out-in"},{default:t(()=>[i.value.preview.visible?(m(),U("div",{key:0,class:"file-preview center v-center flex",onClick:v[4]||(v[4]=w=>i.value.preview.visible=!1)},[n("div",ia,[n("video",{controls:"",autoplay:"",onClick:v[3]||(v[3]=et(()=>{},["stop"]))},[n("source",{src:i.value.preview.src,type:i.value.preview.type},null,8,ra)])])])):V("",!0)]),_:1})]))],64)}}}),pa=pe(da,[["__scopeId","data-v-ffa7bf85"]]),ca={key:0,class:"line"},ma={class:"line"},va={class:"line"},fa=ie({name:"PlanTaskAgreement",__name:"agreement",props:{platform:{}},setup(E){const D=E,C=He({dayLimit:2,dayLimitChecked:!0,freeTimeBehaviorChecked:!0,aiScrollChecked:!0,common:!0}),h=p=>{C[p]=!0};return(p,l)=>{const i=je,B=de;return m(),R(B,{label:"友情提示"},{default:t(()=>[n("div",null,[D.platform===0?(m(),U("div",ca,[n("p",null,[e(i,{checked:C.aiScrollChecked,"onUpdate:checked":l[0]||(l[0]=$=>C.aiScrollChecked=$),onChange:l[1]||(l[1]=()=>h("aiScrollChecked"))},{default:t(()=>l[12]||(l[12]=[b(" 本月牛气值＞450 ")])),_:1},8,["checked"])]),n("p",null,[e(i,{checked:C.aiScrollChecked,"onUpdate:checked":l[2]||(l[2]=$=>C.aiScrollChecked=$),onChange:l[3]||(l[3]=()=>h("aiScrollChecked"))},{default:t(()=>l[13]||(l[13]=[b(" 上月牛气值＞350 ")])),_:1},8,["checked"])])])):V("",!0),n("div",ma,[n("p",null,[e(i,{checked:C.dayLimitChecked,"onUpdate:checked":l[4]||(l[4]=$=>C.dayLimitChecked=$),onChange:l[5]||(l[5]=()=>h("dayLimitChecked"))},{default:t(()=>[b(" 组网限制日均"+te(C.dayLimit)+"单 ",1)]),_:1},8,["checked"])]),n("p",null,[e(i,{checked:C.freeTimeBehaviorChecked,"onUpdate:checked":l[6]||(l[6]=$=>C.freeTimeBehaviorChecked=$),onChange:l[7]||(l[7]=()=>h("freeTimeBehaviorChecked"))},{default:t(()=>l[14]||(l[14]=[b(" 闲暇时光做动态浏览 ")])),_:1},8,["checked"])])]),n("div",va,[n("p",null,[e(i,{checked:C.aiScrollChecked,"onUpdate:checked":l[8]||(l[8]=$=>C.aiScrollChecked=$),onChange:l[9]||(l[9]=()=>h("aiScrollChecked"))},{default:t(()=>l[15]||(l[15]=[b(" AI 判断手指不同滑动 ")])),_:1},8,["checked"])]),n("p",null,[e(i,{checked:C.common,"onUpdate:checked":l[10]||(l[10]=$=>C.common=$),onChange:l[11]||(l[11]=()=>h("common"))},{default:t(()=>l[16]||(l[16]=[b(" 请保持手机常亮，它要每天学习不同使用手机的习惯 ")])),_:1},8,["checked"])])])])]),_:1})}}}),Tt=pe(fa,[["__scopeId","data-v-54e5607c"]]),Pt=ie({name:"PlanTaskExcludeAreaSelect",__name:"exclude-area-select",props:me({label:{default:"排除地区"},name:{default:"excludeArea"},allowClear:{type:Boolean,default:!0},placeholder:{default:"不排除"}},{value:{default:[]},valueModifiers:{}}),emits:["update:value"],setup(E){const D=dt.SHOW_PARENT,{chinaArea:C}=Yt(),h=ue(E,"value"),p=E;return(l,i)=>{const B=dt,$=de;return m(),R($,{label:p.label,name:p.name},{default:t(()=>[e(B,{value:h.value,"onUpdate:value":i[0]||(i[0]=H=>h.value=H),"tree-data":f(C),"tree-checkable":"","allow-clear":l.allowClear,"show-checked-strategy":f(D),"search-placeholder":p.allowClear,placeholder:p.placeholder},null,8,["value","tree-data","allow-clear","show-checked-strategy","search-placeholder","placeholder"])]),_:1},8,["label","name"])}}}),ga={class:"body"},ka={class:"space-between v-center flex"},_a={key:0,class:"option-disabled"},wa={key:1},ba={class:"info"},ya={class:"v-center form-inline flex"},ha={key:3,class:"v-center form-inline flex"},Ca=ie({name:"PlanTaskAgainDrawer",__name:"again-drawer",props:me({rowData:{default:null},userInfo:{},mode:{default:()=>[]},platform:{default:40}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:me(["submitted"],["update:visible"]),setup(E,{emit:D}){const C=wt(),h=ue(E,"visible"),p=ae(null),l=ae(null),i=ae(null),{formRef:B,validate:$,resetFields:H,validateFields:F}=Be(),{defaultRequiredRule:J,createRequiredRule:A}=lt(),I=He({loading:!1,spinLoading:!1}),O=E,d=ae(v()),L=D,o={mode:J,shopId:A("请选择店铺"),count:J,price:J,pairScope:J,pairMultiple:J};fe(h,async X=>{if(X){if(H(),d.value=v(),O.rowData){I.spinLoading=!0;try{const{data:_,error:j}=await Wt(O.rowData.id);if(j||!(_&&_.code===0)){Q();return}_.data.products&&_.data.products.length&&(d.value.multiple=_.data.products.length>1),Object.keys(d.value).forEach(k=>{Object.keys(_.data).includes(k)&&(k==="products"?(d.value.selectedProducts=_.data[k],p.value.setSelectedProducts(_.data[k])):d.value[k]=_.data[k])})}finally{I.spinLoading=!1}}ke(()=>{window.scrollTo(0,0),i.value.initDateRange()})}else ke(()=>{l.value.initComment(),p.value.initSelectedProducts()})});function v(){return{mode:10,friendId:null,deviceId:null,shopId:"",multiple:!1,multiplePlatform:[O.platform],products:[],price:0,count:1,pairScope:0,calculatePairScope:0,pairMultiple:0,maxPairProductCount:0,actions:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,lookPlantingGrass:!0,lookAskEveryone:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0},excludeArea:[],beginTime:"",endTime:""}}function G(){}function M(){d.value.products=[],ke(()=>{p.value.initSelectedProducts()})}function P(){F("shopId")}function S(){d.value.products.length||(d.value.price=0);const X=C.createCalculator(0);for(const _ of d.value.products){const j=C.createCalculator(_.count).multiply(_.price).getResult();X.add(j)}d.value.price=X.multiply(d.value.count).getResult(),(d.value.pairScope===0||d.value.pairScope===d.value.calculatePairScope)&&(d.value.calculatePairScope=C.createCalculator(d.value.price).multiply(.1).getResult(),d.value.calculatePairScope<10&&(d.value.calculatePairScope=10),d.value.pairScope=d.value.calculatePairScope)}function Q(){h.value=!1}async function N(){var k,W,q,w,g,s,r;if(await $(),d.value.products.length===0){(k=window.$message)==null||k.warning("请选择要下发任务的商品");return}for(const u of d.value.products)if(u.skuCount>0&&u.skuList.length===0){(W=window.$message)==null||W.warning(`${u.title} 未选择Sku`);return}else if(u.main&&!u.keyword){(q=window.$message)==null||q.warning(`${u.title} 商品关键词未填写`);return}else if(u.price===0){(w=window.$message)==null||w.warning(`${u.title} 商品价格必须大于0`);return}else if(u.count===0){(g=window.$message)==null||g.warning(`${u.title} 件数必须大于0`);return}else if(u.scope===0){(s=window.$message)==null||s.warning(`${u.title} 购买差额必须大于0`);return}const X={oldTaskId:O.rowData.id,mode:d.value.mode,shopId:d.value.shopId,shopName:d.value.products[0].shopName,friendId:d.value.friendId,deviceId:d.value.deviceId,multiplePlatform:d.value.multiplePlatform,products:d.value.products.map(u=>{var T,y,ee;let c=((T=u.comment)==null?void 0:T.hasComment)||!1;c&&!u.comment.text&&(!u.comment.images||!u.comment.images.length)&&(!u.comment.videos||!u.comment.videos.length)&&(!u.comment.videoUrls||!u.comment.videoUrls.length)&&(!u.comment.imageUrls||!u.comment.imageUrls.length)&&(c=!1);const a=c?{mode:u.comment.mode,text:u.comment.text||"",imageUrls:u.comment.imageUrls,images:(y=u.comment.images)==null?void 0:y.map(K=>K.file),videoUrls:u.comment.videoUrls,videos:(ee=u.comment.videos)==null?void 0:ee.map(K=>K.file)}:null;return{id:u.id,title:u.title,url:u.url,image:u.image,keyword:u.keyword,price:u.price,scope:u.scope,count:u.count,skuList:u.skuList,comment:a,main:u.main}}),pairScope:d.value.pairScope,price:d.value.price,count:d.value.count,maxPairProductCount:d.value.maxPairProductCount,actions:{addCart:d.value.actions.addCart,favorite:d.value.actions.favorite,lookAskEveryone:d.value.actions.lookAskEveryone,lookComment:d.value.actions.lookComment,lookPlantingGrass:d.value.actions.lookPlantingGrass,shopAround:{...d.value.actions.shopAround},useFindBrowse:d.value.actions.useFindBrowse,useFirstBrowse:d.value.actions.useFirstBrowse,useWaitForBuy:d.value.actions.useWaitForBuy},excludeArea:[...d.value.excludeArea],beginTime:d.value.beginTime,endTime:d.value.endTime},{data:_,error:j}=await Kt(X);I.loading=!0;try{!j&&_&&_.code===0&&((r=window.$message)==null||r.success("保存成功"),L("submitted"),Q())}finally{I.loading=!1}}return(X,_)=>{const j=ze,k=ye,W=de,q=De,w=he,g=oe,s=Ie,r=Se;return m(),R(r,{open:h.value,"onUpdate:open":_[16]||(_[16]=u=>h.value=u),title:"快速发布",width:750,push:!1},{footer:t(()=>[e(s,{size:16},{default:t(()=>[e(g,{onClick:Q},{default:t(()=>_[27]||(_[27]=[b("取消")])),_:1}),e(g,{type:"primary",disabled:I.spinLoading,loading:I.loading,onClick:N},{default:t(()=>_[28]||(_[28]=[b(" 保存 ")])),_:1},8,["disabled","loading"])]),_:1})]),default:t(()=>[n("div",ga,[e(w,{ref_key:"formRef",ref:B,name:"operate",layout:"vertical",model:d.value,rules:o},{default:t(()=>[e(W,{name:"mode",label:"任务模式"},{default:t(()=>[e(k,{value:d.value.mode,"onUpdate:value":_[0]||(_[0]=u=>d.value.mode=u),disabled:"",onChange:G},{default:t(()=>[(m(!0),U(le,null,se(O.mode,u=>(m(),R(j,{key:u.value,value:u.value},{default:t(()=>[n("p",ka,[n("span",null,te(u.label),1),!O.userInfo.isSettlement&&(u.value===0||u.value===1)?(m(),U("span",_a," 设置结算收款码后，才可以使用联网配对 ")):(m(),U("span",wa,[n("span",ba,te(O.mode.filter(c=>c.value===u.value)[0].info),1)]))])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),d.value.mode===0||d.value.mode===1?(m(),R(W,{key:0,name:"multiplePlatform"},{label:t(()=>_[17]||(_[17]=[n("p",null,[b(" 匹配平台 "),n("small",{class:"text-danger ml-1"},"* 可选择多平台匹配")],-1)])),default:t(()=>[e(k,{value:d.value.multiplePlatform,"onUpdate:value":_[1]||(_[1]=u=>d.value.multiplePlatform=u),mode:"multiple",placeholder:"请选择平台"},{default:t(()=>[(m(!0),U(le,null,se(f(Oe),u=>(m(),R(j,{key:u.value,value:u.value},{default:t(()=>[b(te(u.label)+"联盟 ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):V("",!0),d.value.mode===1?(m(),R(At,{key:1,value:d.value.friend,"onUpdate:value":_[2]||(_[2]=u=>d.value.friend=u)},null,8,["value"])):d.value.mode===20?(m(),R(It,{key:2,value:d.value.deviceId,"onUpdate:value":_[3]||(_[3]=u=>d.value.deviceId=u)},null,8,["value"])):V("",!0),e(W,{name:"shopId",label:"任务店铺"},{default:t(()=>[e(nt,{value:d.value.shopId,"onUpdate:value":_[4]||(_[4]=u=>d.value.shopId=u),platform:1,remote:!0,"allow-clear":!0,"show-search":!0,onChange:M},null,8,["value"])]),_:1}),e(Dl,{ref_key:"productSelectRef",ref:p,products:d.value.products,"onUpdate:products":_[5]||(_[5]=u=>d.value.products=u),multiple:d.value.multiple,"onUpdate:multiple":_[6]||(_[6]=u=>d.value.multiple=u),"shop-id":d.value.shopId,onShopValidate:P,onSubmitted:S},null,8,["products","multiple","shop-id"]),n("div",ya,[e(W,{name:"count",label:"任务单数"},{default:t(()=>[e(q,{value:d.value.count,"onUpdate:value":_[7]||(_[7]=u=>d.value.count=u),min:1,max:100,controls:!1,precision:0,onChange:S},{addonAfter:t(()=>_[18]||(_[18]=[n("span",null,"单",-1)])),_:1},8,["value"])]),_:1}),e(W,{name:"price"},{label:t(()=>_[19]||(_[19]=[n("p",null,[b(" 任务总价 "),n("small",{class:"text-danger ml-1"},"* 系统自动计算无需填写")],-1)])),default:t(()=>[e(q,{value:d.value.price,"onUpdate:value":_[8]||(_[8]=u=>d.value.price=u),min:0,max:99999,controls:!1,precision:2,readonly:""},{addonAfter:t(()=>_[20]||(_[20]=[n("span",null,"元",-1)])),_:1},8,["value"])]),_:1})]),d.value.mode===0||d.value.mode===1?(m(),U("div",ha,[e(W,{name:"pairScope"},{label:t(()=>_[21]||(_[21]=[n("p",null,[b(" 配对差额 "),n("small",{class:"text-danger ml-1"},"* 与好友任务的价格相差上下浮动值")],-1)])),default:t(()=>[e(q,{value:d.value.pairScope,"onUpdate:value":_[9]||(_[9]=u=>d.value.pairScope=u),min:0,controls:!1,precision:2},{addonBefore:t(()=>_[22]||(_[22]=[n("span",null,"±",-1)])),addonAfter:t(()=>_[23]||(_[23]=[n("span",null,"元",-1)])),_:1},8,["value"])]),_:1}),e(W,{name:"maxPairProductCount"},{label:t(()=>_[24]||(_[24]=[n("p",null,[b(" 多链接匹配 "),n("small",{class:"text-danger ml-1"},"*范围：0-5，为 0 不限制")],-1)])),default:t(()=>[e(q,{value:d.value.maxPairProductCount,"onUpdate:value":_[10]||(_[10]=u=>d.value.maxPairProductCount=u),min:0,max:5,controls:!1,precision:0},{addonBefore:t(()=>_[25]||(_[25]=[n("span",null,"允许最大",-1)])),addonAfter:t(()=>_[26]||(_[26]=[n("span",null,"链接数",-1)])),_:1},8,["value"])]),_:1})])):V("",!0),e(St,{actions:d.value.actions,"onUpdate:actions":_[11]||(_[11]=u=>d.value.actions=u)},null,8,["actions"]),e(pa,{ref_key:"planTaskCommentRef",ref:l,products:d.value.products,"onUpdate:products":_[12]||(_[12]=u=>d.value.products=u)},null,8,["products"]),e(Pt,{value:d.value.excludeArea,"onUpdate:value":_[13]||(_[13]=u=>d.value.excludeArea=u)},null,8,["value"]),e($t,{ref_key:"planTaskTimePickerRef",ref:i,"begin-time":d.value.beginTime,"onUpdate:beginTime":_[14]||(_[14]=u=>d.value.beginTime=u),"end-time":d.value.endTime,"onUpdate:endTime":_[15]||(_[15]=u=>d.value.endTime=u)},null,8,["begin-time","end-time"]),e(Tt,{platform:0})]),_:1},8,["model"]),e(st,{loading:I.spinLoading},null,8,["loading"])])]),_:1},8,["open"])}}}),xa=pe(Ca,[["__scopeId","data-v-f4ca376e"]]),Aa={class:"space-between v-center mb-12px flex"},Ia={class:"products"},Sa={class:"v-center mb-6px flex gap-8px"},$a=["onClick"],Ta={class:"v-center flex gap-8px"},Pa={class:"products-image"},Ua={class:"products-body"},Fa={class:"sku"},Ra={class:"mb-6px"},Ba={class:"v-center flex gap-8px"},Da={class:"v-center num-container flex gap-8px"},Ma={class:"v-center del-btn flex gap-6px"},Ha={class:"text-center"},Ea={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},La={class:"flex-1"},Oa={class:"w-full flex-y-center justify-end gap-12px"},Na=ie({__name:"product-select",props:me({shopId:{default:""}},{products:{default:[]},productsModifiers:{}}),emits:me(["submitted","shopValidate"],["update:products"]),setup(E,{expose:D,emit:C}){const h=ue(E,"products"),p=ae(G()),{tableWrapperRef:l,scrollConfig:i}=qe(),{columns:B,data:$,getData:H,getDataByPage:F,loading:J,mobilePagination:A,searchParams:I,resetSearchParams:O}=Qe({apiFn:P,apiParams:{platform:40,shopId:"",url:"",title:"",itemId:"",pageIndex:1,pageSize:10},columns:S}),{checkedRowKeys:d,rowSelection:L}=Xe($,H),o=E,v=C;fe(()=>p.value.visible,g=>{g||q()}),fe(d,g=>{if(!p.value.multiple&&g.length>1){const s=d.value.at(-1);d.value.splice(0,d.value.length,...s!==void 0?[s]:[]),L.value.selectedRowKeys=[s],L.value.selectedRows=L.value.selectedRows.filter(r=>r.id===s)}}),fe(()=>p.value.products,g=>{var r;for(const u of g){const c=h.value.findIndex(a=>a.id===u.id);c>-1?(h.value[c].skuList=u.selectedSkuMap?JSON.parse(u.selectedSkuMap):[],h.value[c].keyword=u.keyword,h.value[c].count=u.count,h.value[c].price=u.price,h.value[c].scope=u.scope,h.value[c].main=u.main):h.value.push({id:u.id,shopName:u.shopName,url:u.url,image:u.image,title:u.title,keyword:u.keyword,skuCount:((r=u.skuMap)==null?void 0:r.length)||0,skuList:u.selectedSkuMap?JSON.parse(x.selectedSkuMap):[],count:u.count,price:u.price,scope:u.scope,main:u.main})}const s=g.map(u=>u.id);h.value=h.value.filter(u=>s.includes(u.id)),v("submitted")},{deep:!0}),Ee(()=>{N()});function G(g=!1){return{multiple:g,visible:!1,products:[],loading:!0}}async function M(){if(o.shopId===""||o.shopId==="0"){v("shopValidate");return}p.value.visible=!0;try{I.shopId!==o.shopId&&(p.value.loading=!0,I.shopId=o.shopId,await F(1))}finally{p.value.loading&&(p.value.loading=!1)}}function P(g){return p.value.visible?yt({...g}):Promise.resolve({code:0,msg:"",data:{count:0,list:[],pageIndex:1,pageSize:10}})}function S(){return[{key:"image",dataIndex:"image",title:"商品主图",width:80,customRender({record:s}){return e("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[e(Ae,{width:64,height:64,src:s.image,fallback:xe},null)])}},{key:"title",dataIndex:"title",title:"商品"},{key:"shopName",dataIndex:"shopName",title:"店铺",width:200}]}function Q(){var s;if(!I.url)return;const g=new URL(I.url);if(I.itemId=g.searchParams.get("id")||"",!I.itemId){(s=window.$message)==null||s.warning("商品链接解析失败，请核对链接或手动填写商品Id");return}I.url=`${g.protocol}//${g.host}${g.pathname}?id=${p.value.itemId}`}async function N(){try{const{data:g,error:s}=await ut();!s&&g&&g.code===0&&(p.value.shopNameEnum=g.data.list)}catch{}}function X(){!p.value.multiple&&p.value.products.length>1&&(p.value.products=[p.value.products[0]],d.value=[p.value.products[0].id],L.value.selectedRowKeys=[p.value.products[0].id],L.value.selectedRows=L.value.selectedRows.filter(g=>g.id===p.value.products[0].id))}function _(g,s){s.main?p.value.products.forEach((r,u)=>r.main=u===g):p.value.products.filter(r=>r.main).length===0&&(s.main=!0)}function j(){const g=L.value.selectedRows.map((s,r)=>({id:s.id,shopName:s.shopName,url:s.url,image:s.image,title:s.title,keyword:"",skuMap:s.skuMap.map(u=>({sku:u.sku,price:u.price,value:JSON.stringify(u.sku),label:u.sku.join("+")})),selectedSkuMap:null,skuList:[],count:1,price:0,scope:10,main:r===0}));if(p.value.multiple)for(const s of g)p.value.products.filter(r=>r.id===s.id).length||(s.main=p.value.products.filter(r=>r.main).length===0,p.value.products.push(s));else(p.value.products.length===0||g[0].id!==p.value.products[0].id)&&(p.value.products=[g[0]]);p.value.visible=!1}function k(g){const s=p.value.products[g].skuMap.filter(r=>r.value===p.value.products[g].selectedSkuMap);s&&s.length?p.value.products[g].price=s[0].price:p.value.products[g].price=0}function W(g){p.value.products=p.value.products.filter((s,r)=>r!==g),p.value.products.length&&!p.value.products.filter(s=>s.main).length&&(p.value.products[0].main=!0)}function q(){d.value=[],L.value.selectedRowKeys=[],L.value.selectedRows=[]}function w(g){var s;g?window.open(g):(s=window.$message)==null||s.warning("该商品没有添加商品链接，无法跳转")}return D({initSelectedProducts:()=>{var g;p.value=G(((g=p.value)==null?void 0:g.multiple)||!1),q()}}),(g,s)=>{const r=je,u=Ae,c=ye,a=re,T=Ve,y=De,ee=ge,K=oe,Z=Re,_e=de,ve=ot,we=Ge,$e=Je,Te=Ke,Pe=he,Ue=Ze,Ce=Ie,We=Se;return m(),U(le,null,[n("p",Aa,[n("span",null,"商品列表(已选 "+te(p.value.products.length)+" 个)",1),e(r,{checked:p.value.multiple,"onUpdate:checked":s[0]||(s[0]=Y=>p.value.multiple=Y),onChange:X},{default:t(()=>s[8]||(s[8]=[b("多商品")])),_:1},8,["checked"])]),n("ul",Ia,[(m(!0),U(le,null,se(p.value.products,(Y,z)=>(m(),U("li",{key:Y.id},[n("div",Sa,[p.value.multiple?(m(),R(r,{key:0,checked:Y.main,"onUpdate:checked":ne=>Y.main=ne,onChange:()=>_(z,Y)},{default:t(()=>s[9]||(s[9]=[b(" 主商品 ")])),_:2},1032,["checked","onUpdate:checked","onChange"])):V("",!0),n("p",{class:"title",onClick:ne=>w(Y.url)},te(Y.title),9,$a)]),n("div",Ta,[n("div",Pa,[e(u,{width:100,height:100,src:Y.image,fallback:f(xe)},null,8,["src","fallback"])]),n("div",Ua,[n("div",Fa,[Y.skuMap.length?(m(),R(c,{key:0,value:Y.selectedSkuMap,"onUpdate:value":ne=>Y.selectedSkuMap=ne,options:Y.skuMap,placeholder:"请选择商品Sku",onChange:ne=>k(z)},null,8,["value","onUpdate:value","options","onChange"])):(m(),R(a,{key:1},{default:t(()=>s[10]||(s[10]=[b("该商品无Sku")])),_:1}))]),n("div",Ra,[e(T,{value:Y.keyword,"onUpdate:value":ne=>Y.keyword=ne,placeholder:Y.main?"请输入搜索关键词":"没有输入输入关键词则进店查找"},null,8,["value","onUpdate:value","placeholder"])]),n("div",Ba,[n("div",Da,[e(y,{value:Y.price,"onUpdate:value":ne=>Y.price=ne,min:0,max:99999,controls:!1,precision:2},{addonBefore:t(()=>s[11]||(s[11]=[n("span",null,"价格",-1)])),addonAfter:t(()=>s[12]||(s[12]=[n("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"]),e(y,{value:Y.count,"onUpdate:value":ne=>Y.count=ne,min:1,max:99999,controls:!1,precision:0},{addonBefore:t(()=>s[13]||(s[13]=[n("span",null,"购买",-1)])),addonAfter:t(()=>s[14]||(s[14]=[n("span",null,"件",-1)])),_:2},1032,["value","onUpdate:value"]),e(y,{value:Y.scope,"onUpdate:value":ne=>Y.scope=ne,min:0,max:99999,controls:!1,precision:2},{addonBefore:t(()=>[e(ee,{placement:"top"},{title:t(()=>s[15]||(s[15]=[n("span",null,"下单商品时商品单价与填写价格相差符合差额范围内才下单",-1)])),default:t(()=>[s[16]||(s[16]=n("span",null,"浮动差额 ±",-1))]),_:1})]),addonAfter:t(()=>s[17]||(s[17]=[n("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"])]),n("div",Ma,[e(Z,{title:"确认删除吗？",placement:"left",onConfirm:()=>W(z)},{default:t(()=>[e(K,{danger:"",size:"small"},{default:t(()=>s[18]||(s[18]=[b("删除")])),_:1})]),_:2},1032,["onConfirm"])])])])])]))),128))]),p.value.multiple||p.value.products.length===0?(m(),U("div",{key:0,class:"actions mb-12px",onClick:M},[n("p",Ha,[e(f(Ye)),s[19]||(s[19]=b(" 添加商品 "))])])):V("",!0),e(We,{open:p.value.visible,"onUpdate:open":s[7]||(s[7]=Y=>p.value.visible=Y),title:"商品选择",width:800},{footer:t(()=>[e(Ce,{size:16},{default:t(()=>[e(K,{onClick:s[6]||(s[6]=()=>p.value.visible=!1)},{default:t(()=>s[22]||(s[22]=[b("取消")])),_:1}),e(K,{type:"primary",disabled:f(d).length===0,onClick:j},{default:t(()=>s[23]||(s[23]=[b("确定")])),_:1},8,["disabled"])]),_:1})]),default:t(()=>[n("div",Ea,[e(Pe,{model:f(I),"label-col":{span:5,md:7}},{default:t(()=>[e(Te,{class:"row",gutter:[16,16],wrap:""},{default:t(()=>[e(ve,{span:12},{default:t(()=>[e(_e,{label:"商品链接",name:"url",class:"m-0"},{default:t(()=>[e(T,{value:f(I).url,"onUpdate:value":s[1]||(s[1]=Y=>f(I).url=Y),placeholder:"",onBlur:Q},null,8,["value"])]),_:1})]),_:1}),e(ve,{span:12},{default:t(()=>[e(_e,{label:"商品编号",name:"itemId",class:"m-0"},{default:t(()=>[e(T,{value:f(I).itemId,"onUpdate:value":s[2]||(s[2]=Y=>f(I).itemId=Y),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e(ve,{span:12},{default:t(()=>[e(_e,{label:"商品名称",name:"title",class:"m-0"},{default:t(()=>[e(T,{value:f(I).title,"onUpdate:value":s[3]||(s[3]=Y=>f(I).title=Y),placeholder:""},null,8,["value"])]),_:1})]),_:1}),n("div",La,[e(_e,{class:"m-0"},{default:t(()=>[n("div",Oa,[e(K,{onClick:s[4]||(s[4]=Y=>f(O)())},{icon:t(()=>[e(we,{class:"align-sub text-icon"})]),default:t(()=>[s[20]||(s[20]=n("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(K,{type:"primary",ghost:"",onClick:s[5]||(s[5]=Y=>f(F)(1))},{icon:t(()=>[e($e,{class:"align-sub text-icon"})]),default:t(()=>[s[21]||(s[21]=n("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"]),e(Ue,{ref_key:"tableWrapperRef",ref:l,columns:f(B),"data-source":f($),size:"small","row-selection":f(L),scroll:f(i),loading:f(J),"row-key":"id",pagination:f(A),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(st,{loading:p.value.loading},null,8,["loading"])])]),_:1},8,["open"])],64)}}}),za=pe(Na,[["__scopeId","data-v-46b47fdd"]]),Va={class:"mb-12px"},ja={key:0},Ya={class:"mb-8px"},Wa={class:"wrap flex gap-8px"},Ka={key:0,class:"comment-preview"},Ga=["src"],Ja={class:"wrap v-center center flex gap-8px"},qa=["onClick"],Qa={class:"wrap flex gap-8px"},Xa=["src"],Za={class:"wrap v-center center flex gap-8px"},en={key:1,class:"stop"},tn={class:"text-center"},ln={class:"video"},an=["src","type"],nn=ie({name:"AliPlanTaskComment",__name:"product-comment",props:{products:{default:[]},productsModifiers:{}},emits:["update:products"],setup(E,{expose:D}){const C=ae(null),{formRef:h,resetFields:p}=Be(),l=ue(E,"products"),i=ae($()),B=vt(()=>i.value.images.length+i.value.videos.length===6);fe(l,o=>{if(o&&o.length){const v=o.map(M=>{const P={...M};return(!P.comment||!P.comment.hasComment)&&(P.comment=H()),P}),G=o.map(M=>M.id);i.value.products=i.value.products.filter(M=>G.includes(M.id));for(const M of v){const P=i.value.products.findIndex(S=>S.id===M.id);P>-1?Object.assign(i.value.products[P],M):i.value.products.push(M)}}else i.value.products=[]},{deep:!0});function $(){return{products:[],visible:!1,index:-1,title:"",text:"",images:[],videos:[],preview:{visible:!1,src:"",type:""}}}function H(){return{hasComment:!1,text:"",images:[],videos:[]}}function F(o,v){i.value.index=o,i.value.title=`商品：${v.title}`,i.value.visible=!0}function J(o){i.value.products[o].comment=H()}function A(){var o;!B.value&&i.value.videos.length<6&&((o=C.value)==null||o.click())}function I(o){try{if(o.target.files&&o.target.files.length)for(const v of o.target.files){if(B.value)break;const G={src:URL.createObjectURL(v),file:v,visible:!1};i.value.images.push(G)}}finally{C.value.value=""}}function O(o){i.value.images.splice(o,1)}function d({src:o,type:v}){i.value.preview.visible=!0,i.value.preview.src=o,i.value.preview.type=v}async function L(){l.value[i.value.index].comment={hasComment:!0,mode:0,text:i.value.text,images:i.value.images.map(o=>({file:o.file,src:o.src})),videos:i.value.videos.map(o=>({file:o.file,preview:o.preview,src:o.src,type:o.type}))},i.value.visible=!1,ke(()=>{i.value.text="",i.value.images=[],i.value.videos=[]})}return D({initComment:()=>{p(),i.value=$()}}),(o,v)=>{const G=re,M=Ae,P=xt,S=oe,Q=Re,N=Ct,X=ht,_=at,j=de,k=he,W=Ie,q=Se;return m(),U(le,null,[n("div",Va,[v[9]||(v[9]=n("p",{class:"form-label mb-12px"},"商品评价",-1)),e(X,{"item-layout":"vertical","data-source":i.value.products},{renderItem:t(({item:w,index:g})=>[(m(),R(N,{key:w.id},{actions:t(()=>[w.comment.hasComment?(m(),R(Q,{key:0,title:"确认删除吗？",placement:"top",onConfirm:()=>J(g)},{default:t(()=>[e(S,{size:"small",danger:""},{default:t(()=>v[7]||(v[7]=[b("删除评价")])),_:1})]),_:2},1032,["onConfirm"])):(m(),R(S,{key:1,size:"small",onClick:s=>F(g,w)},{default:t(()=>v[8]||(v[8]=[b("添加评价")])),_:2},1032,["onClick"]))]),default:t(()=>[e(P,{description:w.skuList.join(";")||"-"},{title:t(()=>[n("p",null,[w.main?(m(),R(G,{key:0,color:"purple"},{default:t(()=>v[5]||(v[5]=[b("主商品")])),_:1})):V("",!0),b(" "+te(w.title),1)])]),avatar:t(()=>[e(M,{height:"60px",width:"60px",src:w.image,fallback:f(xe)},null,8,["src","fallback"])]),_:2},1032,["description"]),w.comment.hasComment?(m(),U("div",ja,[n("p",Ya,te(w.comment.text),1),n("div",Wa,[(m(!0),U(le,null,se(w.comment.images,s=>(m(),U("div",{key:s,class:"comment-preview"},[e(M,{src:s.src,height:80,width:80},null,8,["src"])]))),128)),w.comment.videos.length?(m(),U("div",Ka,[n("img",{src:w.comment.videos[0].preview,height:80,width:80},null,8,Ga),n("div",Ja,[n("p",{onClick:()=>d(w.comment.videos[0])},[e(f(Me)),v[6]||(v[6]=b(" 预览 "))],8,qa)])])):V("",!0)])])):V("",!0)]),_:2},1024))]),_:1},8,["data-source"])]),e(q,{open:i.value.visible,"onUpdate:open":v[2]||(v[2]=w=>i.value.visible=w),title:i.value.title,width:800},{footer:t(()=>[e(W,{size:16},{default:t(()=>[e(S,{onClick:v[1]||(v[1]=()=>i.value.visible=!1)},{default:t(()=>v[12]||(v[12]=[b("取消")])),_:1}),e(S,{type:"primary",onClick:L},{default:t(()=>v[13]||(v[13]=[b("确定")])),_:1})]),_:1})]),default:t(()=>[e(k,{ref_key:"formRef",ref:h,name:"operate",layout:"vertical",model:i.value},{default:t(()=>[e(j,{label:"文字",name:"text"},{default:t(()=>[e(_,{value:i.value.text,"onUpdate:value":v[0]||(v[0]=w=>i.value.text=w),"auto-size":{minRows:6},"show-count":"",maxlength:300,placeholder:"请输入文字评价"},null,8,["value"])]),_:1}),e(j,null,{label:t(()=>v[10]||(v[10]=[n("p",null,[b(" 图片 "),n("small",{class:"text-danger ml-4px"},"* 图片+视频最多6个，且图片必须小于3M")],-1)])),default:t(()=>[n("input",{ref_key:"imageUploadRef",ref:C,type:"file",accept:"image/jpeg,image/png",class:"upload-hidden",multiple:"",onChange:I},null,544),n("div",Qa,[i.value.images.length?(m(),R(ft,{key:0,tag:"ul",name:"list",class:"wrap flex gap-8px"},{default:t(()=>[(m(!0),U(le,null,se(i.value.images,(w,g)=>(m(),U("li",{key:w.src,class:"preview uploder"},[e(M,{width:200,preview:{visible:w.visible,onVisibleChange:s=>w.visible=s},src:w.src},null,8,["preview","src"]),n("img",{src:w.src},null,8,Xa),n("div",Za,[e(f(Me),{onClick:s=>w.visible=!0},null,8,["onClick"]),e(f(Ne),{onClick:s=>O(g)},null,8,["onClick"])])]))),128))]),_:1})):V("",!0),i.value.images.length<6&&!B.value?(m(),U("div",{key:1,class:"uploder center v-center flex",onClick:A},[i.value.images.length<6&&!B.value?(m(),R(f(Ye),{key:0})):i.value.images.length<6?(m(),U("div",en,[n("p",tn,[e(f(_t))]),v[11]||(v[11]=n("p",{class:"text-center"},"数量已上限",-1))])):V("",!0)])):V("",!0)])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),(m(),R(gt,{to:"body"},[e(tt,{name:"fade",mode:"out-in"},{default:t(()=>[i.value.preview.visible?(m(),U("div",{key:0,class:"file-preview center v-center flex",onClick:v[4]||(v[4]=w=>i.value.preview.visible=!1)},[n("div",ln,[n("video",{controls:"",autoplay:"",onClick:v[3]||(v[3]=et(()=>{},["stop"]))},[n("source",{src:i.value.preview.src,type:i.value.preview.type},null,8,an)])])])):V("",!0)]),_:1})]))],64)}}}),on=pe(nn,[["__scopeId","data-v-2822f1bb"]]),sn={class:"body"},un={class:"space-between v-center flex"},rn={key:0,class:"option-disabled"},dn={key:1},pn={class:"info"},cn={class:"v-center form-inline flex"},mn={key:0,class:"v-center form-inline flex"},vn=ie({name:"PlanTaskCreateDrawer",__name:"create-drawer",props:me({userInfo:{},mode:{default:()=>[]},platform:{default:0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:me(["submitted"],["update:visible"]),setup(E,{emit:D}){const C=Dt(),h=kt(),p=wt(),l=ue(E,"visible"),i=E,{formRef:B,validate:$,resetFields:H,validateFields:F}=Be(),{defaultRequiredRule:J,createRequiredRule:A}=lt(),I=ae(null),O=ae(null),d=ae(null),L=ae(!1),o=ae(M()),v=D,G={mode:J,shopId:A("请选择店铺"),friendId:A("请选择好友"),deviceId:A("请选择设备"),count:J,price:J,pairScope:J,pairMultiple:J,multiplePlatform:A("请至少选择一个平台")};fe(l,j=>{j?(H(),o.value=M(),ke(()=>{d.value.initDateRange()})):ke(()=>{I.value.initSelectedProducts(),O.value.initComment()})});function M(){return{mode:10,friendId:null,deviceId:null,shopId:"",multiple:!1,multiplePlatform:[i.platform],products:[],price:0,count:1,pairScope:0,calculatePairScope:0,pairMultiple:0,maxPairProductCount:0,actions:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,lookPlantingGrass:!0,lookAskEveryone:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0},excludeArea:[],beginTime:"",endTime:""}}function P(j){(j===0||j===1)&&(h.userInfo.isSettlement||(window.$modal.confirm({title:"提示",content:"需要先设置结算收款码，现在去设置吗？",okText:"去设置",cancelText:"取消",onOk:()=>{C.push({name:"user-center",hash:"#settlement"})}}),o.value.mode=10))}function S(){o.value.products=[],ke(()=>{I.value.initSelectedProducts()})}function Q(){o.value.products.length||(o.value.price=0);const j=p.createCalculator(0);for(const k of o.value.products){const W=p.createCalculator(k.count).multiply(k.price).getResult();j.add(W)}o.value.price=j.multiply(o.value.count).getResult(),(o.value.pairScope===0||o.value.pairScope===o.value.calculatePairScope)&&(o.value.calculatePairScope=p.createCalculator(o.value.price).multiply(.1).getResult(),o.value.calculatePairScope<10&&(o.value.calculatePairScope=10),o.value.pairScope=o.value.calculatePairScope)}function N(){F("shopId")}function X(){l.value=!1}async function _(){var q,w,g,s,r,u,c,a,T;if(await $(),o.value.products.length===0){(q=window.$message)==null||q.warning("请选择要下发任务的商品");return}for(const y of o.value.products){if(y.skuCount>0&&y.skuList.length===0){(w=window.$message)==null||w.warning(`${y.title} 未选择Sku`);return}else if(y.main&&!y.keyword){(g=window.$message)==null||g.warning(`${y.title} 商品关键词未填写`);return}else if(y.price===0){(s=window.$message)==null||s.warning(`${y.title} 商品价格必须大于0`);return}else if(y.count===0){(r=window.$message)==null||r.warning(`${y.title} 件数必须大于0`);return}else if(y.scope===0){(u=window.$message)==null||u.warning(`${y.title} 购买差额必须大于0`);return}if((c=y.comment)!=null&&c.hasComment&&!(y.comment.text||y.comment.images&&y.comment.images.length>0||y.comment.videos&&y.comment.videos.length>0)){(a=window.$message)==null||a.warning(`${y.title} 评论内容不能为空（文本/图片/视频至少选一项）`);return}}const j={mode:o.value.mode,platform:40,shopId:o.value.shopId,shopName:o.value.products[0].shopName,friendId:o.value.friendId,deviceId:o.value.deviceId,multiplePlatform:o.value.multiplePlatform,products:o.value.products.map(y=>{var ve,we,$e,Te,Pe,Ue;const ee=((ve=y.comment)==null?void 0:ve.hasComment)||!1,K=((we=y.comment)==null?void 0:we.text)||(($e=y.comment)==null?void 0:$e.images)&&y.comment.images.length>0||((Te=y.comment)==null?void 0:Te.videos)&&y.comment.videos.length>0,_e=ee&&K?{hasComment:!0,mode:y.comment.mode,text:y.comment.text||"",images:(Pe=y.comment.images)==null?void 0:Pe.map(Ce=>Ce.file),videos:(Ue=y.comment.videos)==null?void 0:Ue.map(Ce=>Ce.file)}:null;return{id:y.id,title:y.title,url:y.url,image:y.image,keyword:y.keyword,price:y.price,scope:y.scope,count:y.count,skuList:y.skuList,comment:_e,main:y.main}}),pairScope:o.value.pairScope,price:o.value.price,count:o.value.count,maxPairProductCount:o.value.maxPairProductCount,actions:{addCart:o.value.actions.addCart,favorite:o.value.actions.favorite,lookAskEveryone:o.value.actions.lookAskEveryone,lookComment:o.value.actions.lookComment,lookPlantingGrass:o.value.actions.lookPlantingGrass,shopAround:{...o.value.actions.shopAround},useFindBrowse:o.value.actions.useFindBrowse,useFirstBrowse:o.value.actions.useFirstBrowse,useWaitForBuy:o.value.actions.useWaitForBuy},excludeArea:[...o.value.excludeArea],beginTime:o.value.beginTime,endTime:o.value.endTime},{data:k,error:W}=await Gt(j);L.value=!0;try{!W&&k&&k.code===0&&((T=window.$message)==null||T.success("保存成功"),v("submitted"),X())}finally{L.value=!1}}return(j,k)=>{const W=ze,q=ye,w=de,g=De,s=he,r=oe,u=Ie,c=Se;return m(),R(c,{open:l.value,"onUpdate:open":k[16]||(k[16]=a=>l.value=a),title:"新增任务",width:750,push:!1},{footer:t(()=>[e(u,{size:16},{default:t(()=>[e(r,{onClick:X},{default:t(()=>k[27]||(k[27]=[b("取消")])),_:1}),e(r,{type:"primary",loading:L.value,onClick:_},{default:t(()=>k[28]||(k[28]=[b("保存")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[n("div",sn,[e(s,{ref_key:"formRef",ref:B,name:"operate",layout:"vertical",model:o.value,rules:G},{default:t(()=>[e(w,{name:"mode",label:"任务模式"},{default:t(()=>[e(q,{value:o.value.mode,"onUpdate:value":k[0]||(k[0]=a=>o.value.mode=a),onChange:P},{default:t(()=>[(m(!0),U(le,null,se(i.mode,a=>(m(),R(W,{key:a.value,value:a.value},{default:t(()=>[n("p",un,[n("span",null,te(a.label),1),!i.userInfo.isSettlement&&(a.value===0||a.value===1)?(m(),U("span",rn," 设置结算收款码后，才可以使用组网配对 ")):(m(),U("span",dn,[n("span",pn,te(i.mode.filter(T=>T.value===a.value)[0].info),1)]))])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(tt,{name:"flip",mode:"out-in"},{default:t(()=>[o.value.mode===1?(m(),R(At,{key:0,value:o.value.friendId,"onUpdate:value":k[1]||(k[1]=a=>o.value.friendId=a)},null,8,["value"])):o.value.mode===20?(m(),R(It,{key:1,value:o.value.deviceId,"onUpdate:value":k[2]||(k[2]=a=>o.value.deviceId=a)},null,8,["value"])):V("",!0)]),_:1}),e(w,{name:"shopId",label:"任务店铺"},{default:t(()=>[e(nt,{value:o.value.shopId,"onUpdate:value":k[3]||(k[3]=a=>o.value.shopId=a),platform:1,remote:!0,"allow-clear":!0,"show-search":!0,onChange:S},null,8,["value"])]),_:1}),e(za,{ref_key:"productSelectRef",ref:I,products:o.value.products,"onUpdate:products":k[4]||(k[4]=a=>o.value.products=a),multiple:o.value.multiple,"onUpdate:multiple":k[5]||(k[5]=a=>o.value.multiple=a),"shop-id":o.value.shopId,onShopValidate:N,onSubmitted:Q},null,8,["products","multiple","shop-id"]),n("div",cn,[e(w,{name:"count",label:"任务单数"},{default:t(()=>[e(g,{value:o.value.count,"onUpdate:value":k[6]||(k[6]=a=>o.value.count=a),min:1,max:100,controls:!1,precision:0,onChange:Q},{addonAfter:t(()=>k[17]||(k[17]=[n("span",null,"单",-1)])),_:1},8,["value"])]),_:1}),e(w,{name:"price"},{label:t(()=>k[18]||(k[18]=[n("p",null,[b(" 任务总价 "),n("small",{class:"text-danger ml-1"},"* 系统自动计算无需填写")],-1)])),default:t(()=>[e(g,{value:o.value.price,"onUpdate:value":k[7]||(k[7]=a=>o.value.price=a),min:0,max:99999,controls:!1,precision:2,readonly:""},{addonAfter:t(()=>k[19]||(k[19]=[n("span",null,"元",-1)])),_:1},8,["value"])]),_:1})]),o.value.mode===0||o.value.mode===1?(m(),U("div",mn,[e(w,{name:"pairScope"},{label:t(()=>k[20]||(k[20]=[n("p",null,[b(" 配对差额 "),n("small",{class:"text-danger ml-1"},"* 与好友任务的价格相差上下浮动值")],-1)])),default:t(()=>[e(g,{value:o.value.pairScope,"onUpdate:value":k[8]||(k[8]=a=>o.value.pairScope=a),min:0,controls:!1,precision:2},{addonBefore:t(()=>k[21]||(k[21]=[n("span",null,"±",-1)])),addonAfter:t(()=>k[22]||(k[22]=[n("span",null,"元",-1)])),_:1},8,["value"])]),_:1}),o.value.multiple?(m(),R(w,{key:0,name:"maxPairProductCount"},{label:t(()=>k[23]||(k[23]=[n("p",null,[b(" 多链接匹配 "),n("small",{class:"text-danger ml-1"},"*范围：0-5，为 0 不限制")],-1)])),default:t(()=>[e(g,{value:o.value.maxPairProductCount,"onUpdate:value":k[9]||(k[9]=a=>o.value.maxPairProductCount=a),min:0,max:5,controls:!1,precision:0},{addonBefore:t(()=>k[24]||(k[24]=[n("span",null,"允许最大",-1)])),addonAfter:t(()=>k[25]||(k[25]=[n("span",null,"链接数",-1)])),_:1},8,["value"])]),_:1})):V("",!0)])):V("",!0),o.value.mode===0||o.value.mode===1?(m(),R(w,{key:1,name:"multiplePlatform"},{label:t(()=>k[26]||(k[26]=[n("p",null,[b(" 匹配平台 "),n("small",{class:"text-danger ml-1"},"* 可选择多平台匹配")],-1)])),default:t(()=>[e(q,{value:o.value.multiplePlatform,"onUpdate:value":k[10]||(k[10]=a=>o.value.multiplePlatform=a),mode:"multiple",placeholder:"请选择平台"},{default:t(()=>[(m(!0),U(le,null,se(f(Oe),a=>(m(),R(W,{key:a.value,value:a.value},{default:t(()=>[b(te(a.label)+"联盟 ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):V("",!0),e(St,{actions:o.value.actions,"onUpdate:actions":k[11]||(k[11]=a=>o.value.actions=a)},null,8,["actions"]),e(on,{ref_key:"planTaskCommentRef",ref:O,products:o.value.products,"onUpdate:products":k[12]||(k[12]=a=>o.value.products=a)},null,8,["products"]),e(Pt,{value:o.value.excludeArea,"onUpdate:value":k[13]||(k[13]=a=>o.value.excludeArea=a)},null,8,["value"]),e($t,{ref_key:"planTaskTimePickerRef",ref:d,"begin-time":o.value.beginTime,"onUpdate:beginTime":k[14]||(k[14]=a=>o.value.beginTime=a),"end-time":o.value.endTime,"onUpdate:endTime":k[15]||(k[15]=a=>o.value.endTime=a)},null,8,["begin-time","end-time"]),e(Tt,{platform:0})]),_:1},8,["model"])])]),_:1},8,["open"])}}}),fn=pe(vn,[["__scopeId","data-v-c65e2065"]]),gn={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function kn(E){return typeof E=="function"||Object.prototype.toString.call(E)==="[object Object]"&&!Lt(E)}const _n=ie({name:"alibaba_task",__name:"index",setup(E){const D=kt(),C=Ot(),{tableWrapperRef:h,scrollConfig:p}=qe(),l=He({switch:{id:"",loading:!1},createVisible:!1,againLoading:!1,detailVisible:!1,againVisible:!1,completionVisible:!1,editRow:{},exportLoading:!1,shopNameEnum:[]}),{columns:i,columnChecks:B,data:$,getData:H,getDataByPage:F,loading:J,mobilePagination:A,searchParams:I,resetSearchParams:O}=Qe({apiFn:(...c)=>Zt(...c),apiParams:{pageIndex:1,pageSize:10},columns:Q}),{onBatchDeleted:d,onDeleted:L,checkedRowKeys:o,rowSelection:v}=Xe($,H);Ee(()=>{I.platform=40,M()});async function G(c){const{data:a,error:T}=await ct([c]);!T&&a&&a.code===0&&L()}async function M(){try{const{data:c,error:a}=await ut();!a&&c&&c.code===0&&(l.shopNameEnum=c.data.list)}catch{}}async function P(){const c=o.value;if(c&&c.length){const{data:a,error:T}=await ct(c);!T&&a&&a.code===0&&d()}}function S(c){l.editRow=c,l.againVisible=!0}function Q(){const c=[{key:"title",dataIndex:"title",title:"任务商品",width:500,ellipsis:!0,customRender:({record:a})=>{let T=Le.filter(K=>K.value===a.mode);T=T.length?T[0]:{label:"未知",value:a.mode,color:""};let y=Oe.filter(K=>K.value===a.platform);y=y.length?y[0]:{label:"未知",value:a.platform,color:""};function ee(){return a.mode===0||a.mode!==20&&(a.status===0||a.status===10)?"":a.deviceName&&a.deviceId!=="0"?e(re,{color:"cyan",onClick:()=>rt(a.deviceId),style:"cursor:pointer;"},{default:()=>[b("执行设备："),a.deviceName,b(" ("),a.deviceId,b(")")]}):e(re,{color:"error"},{default:()=>[b("执行设备：设备已删除")]})}return e("div",{class:"plantask-product"},[e("div",{class:"v-center flex gap-10px"},[e(re,{color:"default",style:"cursor:pointer;",onClick:()=>rt(a.id)},{default:()=>[b("任务编号："),a.id]}),e(re,{color:T.color},{default:()=>[b("任务模式："),T.label]}),ee()]),e("div",{class:"flex"},[e("div",{class:"plantask-image"},[e(Ae,{width:120,height:120,src:a.image,fallback:xe},null)]),e("div",{class:"plantask-info"},[e("div",{class:"plantask-title v-center flex"},[e(re,{color:y.color},{default:()=>[b("1688联盟")]}),e(ge,{placement:"top",title:a.title},{default:()=>[e("a",{href:a.productUrl,target:"_blank"},[a.title])]})]),e("p",{class:"plantask-shop"},[e("span",{class:"label"},[b("店铺名称：")]),a.shopName]),e("p",{class:"plantask-sku v-center flex"},[e("span",{class:"label"},[b("任务SKU：")]),k(a.skuList)]),e("div",{class:"v-center flex gap-10px"},[e("p",{class:"plantask-price f-12px"},[e("span",{class:"label"},[b("商品单价：")]),e("span",null,[W(a.price)])]),e("p",{class:"f-12px"},[e("span",{class:"label"},[b("购买件数：")]),e("span",null,[b("x "),a.count])]),e("p",{class:"plantask-price f-12px"},[e("span",{class:"label"},[b("商品总价：")]),e("span",null,[W(a.totalPrice,!0)])])]),e("p",{class:"plantask-keyword f-12px"},[e("span",{class:"text-right"},[b("宝贝排名：")]),e("span",{title:a.ranking||"-"},[a.ranking>0?a.ranking:"-"])]),e("p",{class:"plantask-keyword f-12px",title:`关键词：${a.keyword||""}`},[e("span",{class:"label"},[b("关键词：")]),a.keyword])])])])}},{key:"account",dataIndex:"account",title:"任务信息",width:300,ellipsis:!0,customRender:({record:a})=>{let T=a.ip;return T&&a.ipAddress&&(T=`${T} (${a.ipAddress})`),e("div",{style:"font-size:14px"},[e("p",{class:"info mb-6px"},[e("span",{class:"text-right"},[b("1688号：")]),e("span",{title:a.account||"-"},[a.account||"-"])]),e("p",{class:"info mb-6px"},[e("span",{class:"text-right"},[b("订单号：")]),e("span",{title:a.orderId||"-"},[a.orderId||"-"])]),e("p",{class:"info mb-6px"},[e("span",{class:"text-right"},[b("下单IP：")]),e("span",{title:T||"-"},[T||"-"])])," ",e("p",{class:"info mb-6px"},[e("span",{class:"text-right"},[b("本月牛气值：")]),e("span",{title:a.currentMonth||"-"},[a.currentMonth||"-"])]),e("p",{class:"info mb-6px"},[e("span",{class:"text-right"},[b("上月牛气值：")]),e("span",{title:a.lastMonth||"-"},[a.lastMonth||"-"])]),e("p",{class:"info mb-6px"},[e("span",{class:"text-right"},[b("收货地址：")]),e("span",{title:a.address||"-"},[a.address||"-"])])])}},{key:"status",dataIndex:"status",title:"状态",width:100,align:"center",customRender:({record:a})=>{if(a.status===20){const y=ll.filter(ee=>ee.value===a.step);if(y&&y.length)return e(re,{color:y[0].color},{default:()=>[y[0].label]})}let T=pt.filter(y=>y.value===a.status);return T=T.length?T[0]:{label:"未知",value:a.platform,color:"error"},a.status===31||a.status===41?e(ge,{placement:"top",title:e("span",null,[a.remark||"程序执行异常"])},{default:()=>[e(re,{color:T.color},{default:()=>[T.label]})]}):e(re,{color:T.color},{default:()=>[T.label]})}},{key:"note",dataIndex:"note",title:"任务备注",width:200,ellipsis:!0},{key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200}];return D.userInfo.isTenant?D.userInfo.isTenant&&!D.userInfo.isTenantUser&&c.push({key:"creator",dataIndex:"creator",title:"创建人",align:"center",width:130}):c.push({key:"creator",dataIndex:"creator",title:"所属商户",align:"center",width:130}),c.push({key:"operate",title:"操作",align:"center",width:140,fixed:"right",customRender:({record:a})=>e("div",{class:"flex-center gap-4px"},[N(a),j(a),_(a),X(a)])}),c}function N(c){return c.status>11?e(ge,{placement:"top",title:"任务详情"},{default:()=>[e(oe,{type:"link",size:"small",onClick:()=>w(c)},{default:()=>[e(Ht("EyeOutlined"),null,null)]})]}):(C.hasOne(Fe.Ali1688.Task.UPDATE),"")}function X(c){if(C.hasOne(Fe.Ali1688.Task.DELETE)&&D.userInfo.isTenant){if([30,31,40,41,11,20].includes(c.status))return"";if(c.status===0||c.status===10||c.status===100)return e(Re,{title:"确认删除吗？",onConfirm:()=>G(c.id)},{default:()=>[e(ge,{placement:"top",title:"删除"},{default:()=>[e(oe,{danger:!0,size:"small",type:"link"},{default:()=>[e(Ne,null,null)]})]})]});if(c.mode===10||c.mode===20)return e(Re,{title:"确认删除吗？",onConfirm:()=>G(c.id)},{default:()=>[e(ge,{placement:"top",title:"删除"},{default:()=>[e(oe,{danger:!0,size:"small",type:"link"},{default:()=>[e(Ne,null,null)]})]})]})}return""}function _(c){return C.hasOne(Fe.Ali1688.Task.UPDATE)&&D.userInfo.isTenant&&[20,21].includes(c.status)?e(ge,{placement:"top",title:"停止任务"},{default:()=>[e(oe,{danger:!0,size:"small",type:"link",onClick:()=>u(c.id)},{default:()=>[e(Et,null,null)]})]}):""}function j(c){return C.hasOne(Fe.Ali1688.Task.CREATE)&&D.userInfo.isTenant?e(ge,{placement:"top",title:"快速发布"},{default:()=>[e(oe,{loading:l.againLoading,type:"link",size:"small",onClick:()=>S(c)},{default:()=>[e(el,null,null)]})]}):""}function k(c){return!c||!c.length?e(re,null,{default:()=>[b("无SKU")]}):c.map(a=>e(re,{key:a,color:"processing"},kn(a)?a:{default:()=>[a]}))}function W(c,a=!1){return e("span",{class:"cny",style:a?"font-weight:600;letter-spacing: 1px;":""},[c])}function q(){l.createVisible=!0}function w(c){l.editRow=c,l.detailVisible=!0}async function g(){var c,a;if(!I.beginTime||!I.endTime){(c=window.$message)==null||c.warning("请选择要下载的订单报表的时间范围");return}if(await F(1),!($.value.length<=0)){(a=window.$message)==null||a.success("正在生成报表"),l.exportLoading=!0;try{const{data:T,error:y}=await Qt(I);!y&&T&&T.code===0&&s(T.data)}catch{l.exportLoading=!1}}}function s(c){let a=0;const T=setInterval(async()=>{var K;if(a>100){(K=window.$message)==null||K.error("报表导出失败，请稍后再试"),clearInterval(T),l.exportLoading=!1;return}const{data:y,error:ee}=await Xt(c);if(!ee&&y&&y.code===0&&y.data.complete){l.exportLoading=!1,clearInterval(T),r(c);return}a+=1},3e3)}async function r(c){var a,T;try{const y=await fetch(`${Mt}/api/plantask/excel/${c}`,{mode:"cors"});y.ok||(a=window.$message)==null||a.error("下载异常");const ee=await y.blob(),K=document.createElement("a");K.href=URL.createObjectURL(ee),K.download=`订单信息报表_${new Date().getTime()}.xlsx`,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(K.href)}catch(y){(T=window.$message)==null||T.error(`下载失败:${y}`)}}function u(c){var a;(a=window.$modal)==null||a.confirm({title:"停止提示",cancelText:"取消",okText:"确定",content:"停止任务后无法恢复，确定要停止当前任务吗？",async onOk(){const{data:T,error:y}=await tl(c);!y&&T&&T.code===0&&(window.$message.success("停止指令已发送，请耐心等待！"),F())}})}return(c,a)=>{const T=oe,y=Ut,ee=Ze,K=ul;return m(),U("div",gn,[e(ml,{model:f(I),"onUpdate:model":a[0]||(a[0]=Z=>it(I)?I.value=Z:null),"user-info":f(D).userInfo,platform:f(Oe),status:f(pt),mode:f(Le),"shop-name-enum":l.shopNameEnum,onReset:f(O),onSearch:a[1]||(a[1]=Z=>f(F)(1))},null,8,["model","user-info","platform","status","mode","shop-name-enum","onReset"]),e(K,{title:"任务列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"plantask flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:t(()=>[e(y,{columns:f(B),"onUpdate:columns":a[3]||(a[3]=Z=>it(B)?B.value=Z:null),"disabled-delete":f(o).length===0,loading:f(J),"add-btn":f(D).userInfo.isTenant&&f(C).hasOne(f(Fe).Ali1688.Task.CREATE),"delete-btn":f(D).userInfo.isTenant&&f(C).hasOne(f(Fe).Ali1688.Task.DELETE),"delete-confirm-text":"仅会删除未开始与配对中的任务，确认删除吗？",onAdd:q,onDelete:P},{default:t(()=>[e(T,{size:"small",ghost:"",type:"primary",class:"v-center flex",disabled:!f($).length,onClick:a[2]||(a[2]=()=>f(F)())},{icon:t(()=>[e(f(Jt))]),default:t(()=>[a[9]||(a[9]=n("span",{class:"ml-6px"},"任务进度刷新",-1))]),_:1},8,["disabled"]),e(T,{size:"small",ghost:"",type:"primary",class:"v-center flex",disabled:!f($).length,loading:l.exportLoading,onClick:g},{icon:t(()=>[e(f(qt))]),default:t(()=>[a[10]||(a[10]=n("span",{class:"ml-6px"},"下载订单报表",-1))]),_:1},8,["disabled","loading"])]),_:1},8,["columns","disabled-delete","loading","add-btn","delete-btn"])]),default:t(()=>[e(ee,{ref_key:"tableWrapperRef",ref:h,"expanded-row-keys":l.expandedRowKeys,"onUpdate:expandedRowKeys":a[4]||(a[4]=Z=>l.expandedRowKeys=Z),columns:f(i),"data-source":f($),size:"small",scroll:f(p),loading:f(J),"row-key":"id","row-selection":f(v),pagination:f(A),class:"h-full"},null,8,["expanded-row-keys","columns","data-source","scroll","loading","row-selection","pagination"])]),_:1}),e(fn,{visible:l.createVisible,"onUpdate:visible":a[5]||(a[5]=Z=>l.createVisible=Z),"user-info":f(D).userInfo,mode:f(Le),onSubmitted:f(F)},null,8,["visible","user-info","mode","onSubmitted"]),e(xa,{visible:l.againVisible,"onUpdate:visible":a[6]||(a[6]=Z=>l.againVisible=Z),"row-data":l.editRow,"user-info":f(D).userInfo,mode:f(Le),onSubmitted:a[7]||(a[7]=Z=>f(F)(1))},null,8,["visible","row-data","user-info","mode"]),e(rl,{visible:l.completionVisible,"onUpdate:visible":a[8]||(a[8]=Z=>l.completionVisible=Z),"row-data":l.editRow,onSubmitted:f(F)},null,8,["visible","row-data","onSubmitted"])])}}}),qn=pe(_n,[["__scopeId","data-v-3c96d508"]]);export{qn as default};
