import{_ as he}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as De}from"./cny-BwVJSoTC.js";import{_ as Re,S as ve,a as Ae,b as Ie,T as Ce,F as Se,g as Ue,u as Fe,c as Ne,d as Pe,e as Ee,f as Be}from"./table-search-filter-oeJAv4cw.js";import{aP as ne,m as K,d as Q,D as V,E as oe,c as U,o as T,w as n,f as e,e as H,B as M,a as G,s as se,r as _e,F as be,z as Oe,b as q,H as W,P as J,g as F,t as Y,q as He,h as r,a8 as te,a9 as ae}from"./index-C4fDvJn1.js";import{u as Me,A as z}from"./app.permissions-eEP3QY97.js";import{p as pe,b as me}from"./index-DiqUFypO.js";import{u as re,F as ue,_ as ie,I as Te,a as ge,w as Ve}from"./form-C4lsPmD3.js";import{_ as $e}from"./index-Bgjt1Cd5.js";import{S as we}from"./index-DjcmxpZa.js";import{T as E}from"./index-Cd0TkKik.js";import{_ as ke}from"./index-BbA-ww4S.js";import{_ as xe}from"./index-B0OEq9ON.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as le,t as ce}from"./enum-map-user-BJSgMiaF.js";import{C as ze}from"./index-CfF1NG6B.js";import{E as qe}from"./EditOutlined-CFKuvutP.js";import{D as Ke}from"./DeleteOutlined-vV5-dJ7B.js";import{f as fe}from"./enum-map-device-i1knBcFt.js";import"./index-BSgdO99v.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";function Le(a){const{pageIndex:c,pageSize:s}=a,x={pageIndex:c,pageSize:s};return a.email&&(x.email=a.email),typeof a.status=="number"&&(x.status=a.status),K({url:"/api/tenant/list",params:{...x}})}function je(a){const{email:c,password:s,nickName:x,payType:h,deviceType:i,tenantType:u,platformType:g}=a,D={email:c,password:s,nickName:x,payType:h,deviceType:i,tenantType:u,platformType:g};return typeof a.days=="number"&&(D.days=a.days),K({url:"/api/tenant",method:"post",data:{...D}})}function Ge(a){const{id:c}=a,s={id:c};return a.email&&(s.email=a.email),a.password&&(s.password=a.password),a.nickName&&(s.nickName=a.nickName),a.status=Number.parseInt(a.status,10),Number.isNaN(a.status)||(s.status=a.status),a.payType&&a.payType.length&&(s.payType=a.payType),a.deviceType&&a.deviceType.length&&(s.deviceType=a.deviceType),a.platformType&&a.platformType.length&&(s.platformType=a.platformType),typeof a.tenantType=="number"&&(s.tenantType=a.tenantType),Object.keys(s).length===1?ne():K({url:"/api/tenant",method:"put",data:{...s}})}function ye(a){return!a||!a.length?ne():K({url:"/api/tenant",method:"delete",params:{ids:a}})}function We(a){const{id:c}=a,s={id:c};return typeof a.days=="number"&&(s.days=a.days),typeof a.months=="number"&&(s.months=a.months),typeof a.quarters=="number"&&(s.quarters=a.quarters),typeof a.years=="number"&&(s.years=a.years),Object.keys(s).length===1?ne():K({url:"/api/tenant/recharge",method:"post",data:{...s}})}const Je={class:"flex-1"},Ye={class:"w-full flex-y-center justify-end gap-12px"},Qe=Q({name:"PlatformVipListSearch",__name:"search-filter",props:V({status:{default:()=>[]}},{model:{required:!0},modelModifiers:{}}),emits:V(["reset","search"],["update:model"]),setup(a,{emit:c}){const{formRef:s,validate:x,resetFields:h}=re(),i=oe(a,"model"),u=a,g=c;async function D(){await h(),g("reset")}async function B(){await x(),g("search")}return(w,f)=>{const o=Te,R=ie,A=$e,N=ve,P=Ae,y=M,I=Ie,O=Re,d=ue;return T(),U(Ce,null,{default:n(()=>[e(d,{ref_key:"formRef",ref:s,name:"filer",model:i.value,"label-col":{span:5,md:7}},{default:n(()=>[e(O,{gutter:[16,16],wrap:""},{default:n(()=>[e(A,{span:24,md:12,lg:6},{default:n(()=>[e(R,{label:"邮箱",name:"email",class:"m-0"},{default:n(()=>[e(o,{value:i.value.email,"onUpdate:value":f[0]||(f[0]=l=>i.value.email=l),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),e(A,{span:24,md:12,lg:6},{default:n(()=>[e(R,{label:"状态",name:"status"},{default:n(()=>[e(N,{value:i.value.status,"onUpdate:value":f[1]||(f[1]=l=>i.value.status=l),placeholder:"- 全部 -",options:u.status,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),H("div",Je,[e(R,{class:"m-0"},{default:n(()=>[H("div",Ye,[e(y,{onClick:D},{icon:n(()=>[e(P,{class:"align-sub text-icon"})]),default:n(()=>[f[2]||(f[2]=H("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(y,{type:"primary",ghost:"",onClick:B},{icon:n(()=>[e(I,{class:"align-sub text-icon"})]),default:n(()=>[f[3]||(f[3]=H("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),Xe={class:"body"},Ze=Q({name:"TenantOperateDrawer",__name:"operate-drawer",props:V({operateType:{default:"add"},rowData:{default:null},status:{default:()=>[]},userInfo:{},payType:{},deviceType:{},tenantType:{},platformType:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(a,{emit:c}){const{formRef:s,validate:x,resetFields:h}=re(),i=oe(a,"visible"),u=a,g=G(()=>[{label:"TB联盟",children:u.payType.filter(l=>l.value<10)},{label:"JD联盟",children:u.payType.filter(l=>l.value>=10&&l.value<20)},{label:"PDD联盟",children:u.payType.filter(l=>l.value>=20&&l.value<30)},{label:"DY联盟",children:u.payType.filter(l=>l.value>=30&&l.value<40)},{label:"1688联盟",children:u.payType.filter(l=>l.value>=40&&l.value<50)}]),D=se({submit:!1}),B=c,w=G(()=>({add:"新增商户",edit:"编辑商户"})[u.operateType]),f=G(()=>u.operateType==="edit"),o=_e(A()),R=G(()=>{const{formRules:d,defaultRequiredRule:l}=ge();return{email:d.email,nickName:d.userName,password:f.value?[{validator(S,v){return v&&v.trim()&&!Ve.test(v)?Promise.reject(new Error("密码格式不正确，6-18位字符，英文字母、数字及@#_!")):Promise.resolve()},trigger:"blur"}]:d.pwd,status:l,payType:l,deviceType:l,platfromType:l}});be(i,async()=>{i.value&&(h(),N())});function A(){return{id:"",email:"",password:"",nickName:"",tenantType:0,status:0,days:0,payType:[0],deviceType:[10],platformType:[0]}}function N(){o.value=A(),f.value&&u.rowData&&Object.keys(o.value).forEach(d=>{u.rowData[d]&&(o.value[d]=u.rowData[d])})}function P(){var d;o.value.email&&(o.value.email=(d=o.value.email)==null?void 0:d.toLowerCase())}function y(){o.value.tenantType===10&&o.value.days===0&&(o.value.days=99999999)}function I(){i.value=!1}async function O(){var d;await x(),D.submit=!0;try{const{data:l,error:S}=f.value?await Ge({...o.value}):await je({...o.value});!S&&l&&l.code===0&&((d=window.$message)==null||d.success("保存成功"),I(),B("submitted"))}finally{D.submit=!1}}return(d,l)=>{const S=Te,v=ie,C=ve,X=E,$=Ue,Z=Se,ee=ke,L=ue,j=M,p=we,m=xe;return T(),U(m,{open:i.value,"onUpdate:open":l[9]||(l[9]=t=>i.value=t),title:w.value,width:550},{footer:n(()=>[e(p,{size:16},{default:n(()=>[e(j,{onClick:I},{default:n(()=>l[10]||(l[10]=[F("取消")])),_:1}),e(j,{type:"primary",loading:D.submit,onClick:O},{default:n(()=>l[11]||(l[11]=[F("保存")])),_:1},8,["loading"])]),_:1})]),default:n(()=>[H("div",Xe,[e(L,{ref_key:"formRef",ref:s,name:"operate",layout:"vertical",model:o.value,rules:R.value},{default:n(()=>[e(v,{label:"邮箱",name:"email"},{default:n(()=>[e(S,{value:o.value.email,"onUpdate:value":l[0]||(l[0]=t=>o.value.email=t),autocomplete:"off",placeholder:"请输入邮箱",onBlur:P},null,8,["value"])]),_:1}),e(v,{label:"密码",name:"password"},{default:n(()=>[e(S,{value:o.value.password,"onUpdate:value":l[1]||(l[1]=t=>o.value.password=t),autocomplete:"off",placeholder:"请输入密码",type:"password"},null,8,["value"])]),_:1}),e(v,{label:"昵称",name:"nickName"},{default:n(()=>[e(S,{value:o.value.nickName,"onUpdate:value":l[2]||(l[2]=t=>o.value.nickName=t),autocomplete:"off",placeholder:"请输入昵称"},null,8,["value"])]),_:1}),f.value?(T(),U(v,{key:1,label:"状态",name:"status"},{default:n(()=>[e(C,{value:o.value.status,"onUpdate:value":l[4]||(l[4]=t=>o.value.status=t),options:u.status},null,8,["value","options"])]),_:1})):(T(),U(v,{key:0,label:"商户类型",name:"tenantType"},{default:n(()=>[e(C,{value:o.value.tenantType,"onUpdate:value":l[3]||(l[3]=t=>o.value.tenantType=t),options:u.tenantType,onChange:y},null,8,["value","options"])]),_:1})),e(v,{label:"支付配置",name:"payType"},{default:n(()=>[e(C,{value:o.value.payType,"onUpdate:value":l[5]||(l[5]=t=>o.value.payType=t),mode:"multiple"},{default:n(()=>[(T(!0),q(W,null,J(g.value,t=>(T(),U(Z,{key:t.label},{label:n(()=>[e(X,{color:t.children[0].color},{default:n(()=>[F(Y(t.label),1)]),_:2},1032,["color"])]),default:n(()=>[(T(!0),q(W,null,J(t.children,_=>(T(),U($,{key:_.value,value:_.value},{default:n(()=>[F(Y(_.label),1)]),_:2},1032,["value"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1}),e(v,{label:"平台权限",name:"platformType"},{default:n(()=>[e(C,{value:o.value.platformType,"onUpdate:value":l[6]||(l[6]=t=>o.value.platformType=t),mode:"multiple"},{default:n(()=>[(T(!0),q(W,null,J(u.platformType,t=>(T(),U($,{key:t.value,value:t.value},{default:n(()=>[F(Y(t.label)+"联盟 ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(v,{label:"设备配置",name:"deviceType"},{default:n(()=>[e(C,{value:o.value.deviceType,"onUpdate:value":l[7]||(l[7]=t=>o.value.deviceType=t),mode:"multiple"},{default:n(()=>[(T(!0),q(W,null,J(u.deviceType,t=>(T(),U($,{key:t.value,value:t.value},{default:n(()=>[F(Y(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),u.userInfo.isTenant?Oe("",!0):(T(),U(v,{key:2,label:"预充天数",name:"days"},{default:n(()=>[e(ee,{value:o.value.days,"onUpdate:value":l[8]||(l[8]=t=>o.value.days=t),class:"input-number","addon-before":"+","addon-after":"天",controls:!1,min:0,max:999999999,step:1,precision:0},null,8,["value"])]),_:1}))]),_:1},8,["model","rules"])])]),_:1},8,["open","title"])}}}),et=de(Ze,[["__scopeId","data-v-b9efac8e"]]),tt={class:"body"},at=Q({name:"SystemUserOperateDrawer",__name:"recharge-drawer",props:V({tenantId:{default:""}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(a,{emit:c}){const{formRef:s,validate:x,resetFields:h}=re(),{defaultRequiredRule:i}=ge(),u=oe(a,"visible"),g=se({submit:!1}),D=a,B=c,w=_e(o()),f={days:i};be(u,()=>{u.value&&(R(),h())});function o(){return{tenantId:"",days:0}}function R(){w.value=o(),w.value.id=D.tenantId}function A(){u.value=!1}async function N(){var P;if(await x(),w.value.days<=0){A();return}g.submit=!0;try{const{data:y,error:I}=await We({...w.value});!I&&y&&y.code===0&&((P=window.$message)==null||P.success("使用成功"),A(),B("submitted"))}finally{g.submit=!1}}return(P,y)=>{const I=ke,O=ie,d=ue,l=M,S=we,v=xe;return T(),U(v,{open:u.value,"onUpdate:open":y[1]||(y[1]=C=>u.value=C),title:"会员使用",width:450},{footer:n(()=>[e(S,{size:16},{default:n(()=>[e(l,{onClick:A},{default:n(()=>y[2]||(y[2]=[F("取消")])),_:1}),e(l,{type:"primary",loading:g.submit,onClick:N},{default:n(()=>y[3]||(y[3]=[F("保存")])),_:1},8,["loading"])]),_:1})]),default:n(()=>[H("div",tt,[e(d,{ref_key:"formRef",ref:s,name:"operate",layout:"vertical",model:w.value,rules:f},{default:n(()=>[e(O,{name:"days",label:"使用数"},{default:n(()=>[e(I,{value:w.value.days,"onUpdate:value":y[0]||(y[0]=C=>w.value.days=C),class:"input-number","addon-after":"天",controls:!1,min:0,max:999999999,step:1,precision:0},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])}}}),lt=de(at,[["__scopeId","data-v-fdc1c8ab"]]),nt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ot=Q({name:"platform_tenant",__name:"index",setup(a){const c=He(),{tableWrapperRef:s,scrollConfig:x}=Fe(),h=Me(),i=se({rechargeVisible:!1,tenantId:"",rowDetail:{},expandedRowKeys:[]}),{columns:u,columnChecks:g,data:D,getData:B,getDataByPage:w,loading:f,mobilePagination:o,searchParams:R,resetSearchParams:A}=Ne({apiFn:p=>(i.expandedRowKeys=[],i.rowDetail=[],Le(p)),apiParams:{pageIndex:1,pageSize:10},columns:Z}),{drawerVisible:N,editingData:P,operateType:y,checkedRowKeys:I,rowSelection:O,onBatchDeleted:d,onDeleted:l,handleAdd:S,handleEdit:v}=Pe(D,B);async function C(){const p=I.value;if(p&&p.length){const{data:m,error:t}=await ye(p);!t&&m&&m.code===0&&d()}}function X(p){i.tenantId=p,i.rechargeVisible=!0}async function $(p){const{data:m,error:t}=await ye([p]);!t&&m&&m.code===0&&l()}function Z(){const p=[{key:"email",dataIndex:"email",title:"邮箱",align:"center"},{key:"nickName",dataIndex:"nickName",title:"昵称",align:"center"},{key:"tenantType",dataIndex:"tenantType",title:"商户类型",align:"center",customRender:({record:t})=>{const _=ce.filter(k=>k.value===t.tenantType)[0];return e(E,{color:_.color},{default:()=>[_.label]})}},{key:"payType",dataIndex:"payType",title:"支付方式",customRender:({record:t})=>e("div",{style:"display:flex;gap:5px;flex-wrap:wrap;"},[t.payType.map(_=>{const k=me.filter(b=>b.value===_)[0];return e(E,{color:k.color},{default:()=>[k.label]})})])},{key:"platformType",dataIndex:"platformType",title:"平台权限",customRender:({record:t})=>e("div",{style:"display:flex;gap:5px;flex-wrap:wrap;"},[t.platformType.map(_=>{const k=pe.filter(b=>b.value===_)[0];return e(E,{color:k.color},{default:()=>[k.label,F("联盟")]})})])},{key:"deviceType",dataIndex:"deviceType",title:"设备类型",customRender:({record:t})=>e("div",{style:"display:flex;gap:5px;flex-wrap:wrap;"},[t.deviceType.map(_=>{const k=fe.filter(b=>b.value===_)[0];return e(E,{color:k.color},{default:()=>[k.label]})})])}];c.userInfo.isTenant||(p.push({key:"deviceCount",dataIndex:"deviceCount",title:"设备数",align:"center",width:150,customRender:({record:t})=>e(E,{color:t.deviceCount>0?"success":"error"},{default:()=>[t.deviceCount]})}),p.push({key:"unUseDays",dataIndex:"unUseDays",title:"剩余使用数",align:"center",width:150,customRender:({record:t})=>e(E,{color:t.unUseDays>0?"success":"error"},{default:()=>[t.unUseDays,F(" 天")]})}));const m=[{key:"status",dataIndex:"status",title:"状态",align:"center",width:100,customRender:({record:t})=>{const _=le.filter(k=>k.value===t.status)[0];return e(E,{color:_.color},{default:()=>[_.label]})}},{key:"createTime",dataIndex:"createTime",title:c.userInfo.isTenant?"添加时间":"注册时间",align:"center",width:200},{key:"operate",title:"操作",align:"center",width:100,customRender:({record:t})=>t.permission?e("div",{class:"flex-center gap-4px"},[ee(t),L(t),j(t)]):L(t)}];return[...p,...m]}function ee(p){return h.hasOne(z.Platform.Tenant.UPDATE)?e(ae,{placement:"top",title:"编辑"},{default:()=>[e(M,{size:"small",type:"link",onClick:()=>v(p.id)},{default:()=>[e(qe,null,null)]})]}):""}function L(p){return c.userInfo.isTenant?"":h.hasOne(z.Platform.Tenant.UPDATE)?e(ae,{placement:"top",title:"使用"},{default:()=>[e(M,{size:"small",type:"link",onClick:()=>X(p.id)},{default:()=>[e(De,null,null)]})]}):""}function j(p){return h.hasOne(z.Platform.Tenant.DELETE)?e(Be,{title:"确认删除吗？",onConfirm:()=>$(p.id)},{default:()=>[e(ae,{placement:"top",title:"删除"},{default:()=>[e(M,{danger:!0,size:"small",type:"link"},{default:()=>[e(Ke,null,null)]})]})]}):""}return(p,m)=>{const t=he,_=Ee,k=ze;return T(),q("div",nt,[e(Qe,{model:r(R),"onUpdate:model":m[0]||(m[0]=b=>te(R)?R.value=b:null),status:r(le),onReset:r(A),onSearch:m[1]||(m[1]=b=>r(w)(1))},null,8,["model","status","onReset"]),e(k,{title:"商户列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:n(()=>[e(t,{columns:r(g),"onUpdate:columns":m[2]||(m[2]=b=>te(g)?g.value=b:null),"disabled-delete":r(I).length===0,loading:r(f),"add-btn":r(h).hasOne(r(z).Platform.Tenant.CREATE),"delete-btn":r(h).hasOne(r(z).Platform.Tenant.DELETE),onAdd:r(S),onDelete:C},null,8,["columns","disabled-delete","loading","add-btn","delete-btn","onAdd"])]),default:n(()=>[e(_,{ref_key:"tableWrapperRef",ref:s,"expanded-row-keys":i.expandedRowKeys,"onUpdate:expandedRowKeys":m[3]||(m[3]=b=>i.expandedRowKeys=b),columns:r(u),"data-source":r(D),size:"small","row-selection":r(O),scroll:r(x),loading:r(f),"row-key":"id",pagination:r(o),class:"h-full"},null,8,["expanded-row-keys","columns","data-source","row-selection","scroll","loading","pagination"]),e(et,{visible:r(N),"onUpdate:visible":m[4]||(m[4]=b=>te(N)?N.value=b:null),"operate-type":r(y),"row-data":r(P),status:r(le),"pay-type":r(me),"device-type":r(fe),"user-info":r(c).userInfo,"tenant-type":r(ce),"platform-type":r(pe),onSubmitted:r(w)},null,8,["visible","operate-type","row-data","status","pay-type","device-type","user-info","tenant-type","platform-type","onSubmitted"]),e(lt,{visible:i.rechargeVisible,"onUpdate:visible":m[5]||(m[5]=b=>i.rechargeVisible=b),"tenant-id":i.tenantId,onSubmitted:r(w)},null,8,["visible","tenant-id","onSubmitted"])]),_:1})])}}}),Ut=de(ot,[["__scopeId","data-v-2f6c90e7"]]);export{Ut as default};
