import{_ as Vs}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{_ as Ge,S as De,r as js,s as Gs,a as it,b as ut,T as Ys,g as Ye,u as We,c as Ke,d as qe,e as Ve,f as Le,A as xs,L as Ws}from"./table-search-filter-DgS7ifzw.js";import{f as t,O as rt,d as me,D as fe,E as ce,c as x,o as i,w as l,e,b as I,H as le,P as re,z as R,g as r,t as M,h as v,M as dt,s as Oe,F as ge,a9 as _e,B as ue,r as de,a7 as Se,ab as we,i as Je,ac as ze,C as Ks,a as st,ad as hs,ae as Cs,T as pt,af as qs,q as $s,aa as He,a8 as vs,ai as Js}from"./index-CZVtSjPQ.js";import{u as Qs,A as Te}from"./app.permissions-B_pV7apU.js";import{b as Zs,p as et}from"./index-DiqUFypO.js";import{c as nt}from"./helper-sl_fDmSa.js";import{I as Fe,i as Me}from"./empty-DqSXm535.js";import{L as Qe}from"./index-Y4HE4_-c.js";import{T as pe}from"./index-DMMLrYUn.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{t as Xs,o as ea,u as ta,f as la,a as sa,S as tt,_ as fs,b as aa,c as Ps,q as oa,y as na,z as ia,B as ua,A as ct,C as ra,D as da,E as pa,G as ca,H as ma,p as Xe,R as va,h as gs,I as _s,J as fa,K as ga,k as _a,L as ka,n as ba,F as ya}from"./calculate-Ca1jGS_Q.js";import{u as Ee,F as xe,_ as ke,I as Ze,a as mt,d as vt,Q as As}from"./form-ZxLsforZ.js";import{_ as ks}from"./index.vue_vue_type_script_setup_true_lang-pVOlQRHe.js";import{_ as wa,v as Is,B as xa}from"./video-wSl1O1Uf.js";import{_ as ft}from"./index.vue_vue_type_script_setup_true_lang-DfKPtv9S.js";import{_ as gt}from"./index-DOEbmRvB.js";import{R as ha,D as Ca}from"./dayjs-AyO5q5yK.js";import{_ as $a,a as Pa}from"./index-Dc37eOQW.js";import{S as $e}from"./index-BWb-9rJv.js";import{P as Re,C as Ts}from"./index-ClUX1lZP.js";import{v as Aa,a as Ia,b as Ta,n as Ss,c as Us}from"./enums-XBoEbamp.js";import{_ as je}from"./index-CMROBQfz.js";import{_ as Pe}from"./index-BVBn8Dpq.js";import{d as Fs}from"./debounce-BsWDECm-.js";import{C as at}from"./index-CQCXu6T9.js";import{L as Ms,_ as Rs,a as Ds}from"./index-C3lI4CWL.js";import{E as Ue}from"./EyeOutlined-B3DWie8W.js";import{D as Be}from"./DeleteOutlined-CShsKEiR.js";import{I as Sa}from"./InboxOutlined-DqN1pcZJ.js";import{U as Ua}from"./index-CENDnRYG.js";import{_ as Fa}from"./index-CblUf4ME.js";import{_ as Ma}from"./index-XLX1VXh_.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";import"./responsiveObserve-CdtC9r70.js";import"./china.area-DOOnik0V.js";import"./isSymbol-DgABtkrl.js";var Ra={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm47.7-395.2l-25.4-5.9V348.6c38 5.2 61.5 29 65.5 58.2.5 4 3.9 6.9 7.9 6.9h44.9c4.7 0 8.4-4.1 8-8.8-6.1-62.3-57.4-102.3-125.9-109.2V263c0-4.4-3.6-8-8-8h-28.1c-4.4 0-8 3.6-8 8v33c-70.8 6.9-126.2 46-126.2 119 0 67.6 49.8 100.2 102.1 112.7l24.7 6.3v142.7c-44.2-5.9-69-29.5-74.1-61.3-.6-3.8-4-6.6-7.9-6.6H363c-4.7 0-8.4 4-8 8.7 4.5 55 46.2 105.6 135.2 112.1V761c0 4.4 3.6 8 8 8h28.4c4.4 0 8-3.6 8-8.1l-.2-31.7c78.3-6.9 134.3-48.8 134.3-124-.1-69.4-44.2-100.4-109-116.4zm-68.6-16.2c-5.6-1.6-10.3-3.1-15-5-33.8-12.2-49.5-31.9-49.5-57.3 0-36.3 27.5-57 64.5-61.7v124zM534.3 677V543.3c3.1.9 5.9 1.6 8.8 2.2 47.3 14.4 63.2 34.4 63.2 65.1 0 39.1-29.4 62.6-72 66.4z"}}]},name:"dollar",theme:"outlined"};function bs(F){for(var $=1;$<arguments.length;$++){var h=arguments[$]!=null?Object(arguments[$]):{},n=Object.keys(h);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(h).filter(function(f){return Object.getOwnPropertyDescriptor(h,f).enumerable}))),n.forEach(function(f){Da(F,f,h[f])})}return F}function Da(F,$,h){return $ in F?Object.defineProperty(F,$,{value:h,enumerable:!0,configurable:!0,writable:!0}):F[$]=h,F}var _t=function($,h){var n=bs({},$,h.attrs);return t(rt,bs({},n,{icon:Ra}),null)};_t.displayName="DollarOutlined";_t.inheritAttrs=!1;var La={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"};function ys(F){for(var $=1;$<arguments.length;$++){var h=arguments[$]!=null?Object(arguments[$]):{},n=Object.keys(h);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(h).filter(function(f){return Object.getOwnPropertyDescriptor(h,f).enumerable}))),n.forEach(function(f){Ba(F,f,h[f])})}return F}function Ba(F,$,h){return $ in F?Object.defineProperty(F,$,{value:h,enumerable:!0,configurable:!0,writable:!0}):F[$]=h,F}var kt=function($,h){var n=ys({},$,h.attrs);return t(rt,ys({},n,{icon:La}),null)};kt.displayName="ImportOutlined";kt.inheritAttrs=!1;var Oa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"};function ws(F){for(var $=1;$<arguments.length;$++){var h=arguments[$]!=null?Object(arguments[$]):{},n=Object.keys(h);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(h).filter(function(f){return Object.getOwnPropertyDescriptor(h,f).enumerable}))),n.forEach(function(f){Ea(F,f,h[f])})}return F}function Ea(F,$,h){return $ in F?Object.defineProperty(F,$,{value:h,enumerable:!0,configurable:!0,writable:!0}):F[$]=h,F}var lt=function($,h){var n=ws({},$,h.attrs);return t(rt,ws({},n,{icon:Oa}),null)};lt.displayName="PlayCircleOutlined";lt.inheritAttrs=!1;const Na={class:"products"},Ha={class:"v-center mb-6px flex gap-8px"},za=["onClick"],Va={class:"v-center flex gap-8px"},ja={class:"products-image"},Ga={class:"products-body"},Ya={class:"sku"},Wa={key:0,class:"wrap v-center flex gap-5px"},Ka={key:1,class:"wrap v-center flex gap-5px"},qa={class:"mb-6px"},Ja={class:"v-center flex gap-8px"},Qa={class:"v-center num-container flex gap-8px"},Za={class:"display-item"},Xa={class:"value highlight"},eo={class:"display-item"},to={class:"value"},lo={class:"display-item"},so={class:"value highlight"},ao=me({__name:"sub-products-modal",props:fe({subProductsData:{default:()=>[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(F){const $=F,h=ce(F,"visible");function n(f){var o;f?window.open(f):(o=window.$message)==null||o.warning("该商品没有添加商品链接，无法跳转")}return(f,o)=>{const w=pe,d=Fe,T=dt;return i(),x(T,{open:h.value,"onUpdate:open":o[0]||(o[0]=s=>h.value=s),title:"商品详情",width:800,footer:null},{default:l(()=>[e("ul",Na,[(i(!0),I(le,null,re($.subProductsData,s=>{var y;return i(),I("li",{key:s.id},[e("div",Ha,[s.main?(i(),x(w,{key:0},{default:l(()=>o[1]||(o[1]=[r("主商品")])),_:1})):R("",!0),e("p",{class:"title",onClick:Y=>n(s.url)},M(s.title),9,za)]),e("div",Va,[e("div",ja,[t(d,{width:100,height:100,src:s.image,fallback:v(Me)},null,8,["src","fallback"])]),e("div",Ga,[e("div",Ya,[s.skuList&&((y=s.skuList)!=null&&y.length)?(i(),I("div",Wa,[o[2]||(o[2]=r(" 商品SKU: ")),(i(!0),I(le,null,re(s.skuList,Y=>(i(),x(w,{key:Y},{default:l(()=>[r(M(Y),1)]),_:2},1024))),128))])):(i(),I("div",Ka,[o[4]||(o[4]=r(" 商品SKU: ")),t(w,null,{default:l(()=>o[3]||(o[3]=[r("该商品无Sku")])),_:1})]))]),e("div",qa,[e("p",null,"商品关键词:"+M(s.keyword??"—"),1)]),e("div",Ja,[e("div",Qa,[e("span",Za,[o[5]||(o[5]=e("span",{class:"prefix"},"价格",-1)),e("span",Xa,M(s.price),1),o[6]||(o[6]=e("span",{class:"suffix"},"元",-1))]),e("span",eo,[o[7]||(o[7]=e("span",{class:"prefix"},"购买",-1)),e("span",to,M(s.count),1),o[8]||(o[8]=e("span",{class:"suffix"},"件",-1))]),e("span",lo,[o[9]||(o[9]=e("span",{class:"prefix"},"浮动差额 ±",-1)),e("span",so,M(s.scope),1),o[10]||(o[10]=e("span",{class:"suffix"},"元",-1))])])])])])])}),128))])]),_:1},8,["open"])}}}),oo=ve(ao,[["__scopeId","data-v-16d6fe4c"]]),no={class:"body"},io={key:0,class:"detail grid-mode grid"},uo={class:"descriptions"},ro={class:"grid"},po={class:"item"},co={class:"content"},mo={class:"item"},vo={class:"content"},fo={class:"item"},go={class:"content"},_o={class:"item"},ko={class:"content"},bo={key:0,class:"wrap v-center flex gap-5px"},yo={key:1},wo={class:"grid-2 grid"},xo={class:"item"},ho={class:"content"},Co={class:"item"},$o={class:"content"},Po={class:"cny"},Ao={class:"grid-2 grid"},Io={class:"item"},To={class:"content"},So={key:1},Uo={class:"item"},Fo={class:"content"},Mo={class:"cny"},Ro={class:"grid-2 grid"},Do={class:"item"},Lo={class:"content"},Bo={class:"cny"},Oo={class:"item"},Eo={class:"content"},No={class:"cny"},Ho={class:"grid"},zo={class:"item"},Vo={class:"content"},jo={class:"item"},Go={key:0,class:"content"},Yo={key:1,class:"content"},Wo={class:"grid-2 grid"},Ko={class:"item"},qo={class:"content"},Jo={class:"item"},Qo={class:"content"},Zo={class:"grid-2 grid"},Xo={class:"item"},en={class:"content"},tn={class:"item"},ln={class:"content"},sn={key:0,class:"cny"},an={class:"item"},on={class:"content"},nn={class:"item"},un={class:"content"},rn={key:0},dn={key:0},pn={class:"descriptions"},cn={class:"grid"},mn={class:"item"},vn={class:"content"},fn={class:"item"},gn={class:"content"},_n={class:"item"},kn={class:"content"},bn={class:"item"},yn={class:"content"},wn={key:0,class:"wrap v-center flex gap-5px"},xn={key:1},hn={class:"grid-2 grid"},Cn={class:"item"},$n={class:"content"},Pn={class:"item"},An={class:"content"},In={class:"cny"},Tn={class:"grid-2 grid"},Sn={class:"item"},Un={class:"content"},Fn={key:1},Mn={class:"item"},Rn={class:"content"},Dn={class:"cny"},Ln={class:"grid-2 grid"},Bn={class:"item"},On={class:"content"},En={class:"item"},Nn={class:"content"},Hn={class:"grid-2 grid"},zn={class:"item"},Vn={class:"content"},jn={key:0},Gn={class:"item"},Yn={class:"content"},Wn={key:0,class:"cny"},Kn={class:"item"},qn={class:"content"},Jn={class:"item"},Qn={class:"content"},Zn={key:0},Xn={class:"grid"},ei={class:"item"},ti={class:"content"},li={class:"grid"},si={class:"item item-border-hide"},ai={class:"content"},oi={key:0},ni={class:"cny"},ii={key:1,class:"detail"},ui={class:"descriptions"},ri={class:"grid"},di={class:"item"},pi={class:"content"},ci={class:"item"},mi={class:"content"},vi={class:"item"},fi={class:"content"},gi={class:"item"},_i={class:"content"},ki={key:0,class:"wrap v-center flex gap-5px"},bi={key:1},yi={class:"grid-2 grid"},wi={class:"item"},xi={class:"content"},hi={class:"item"},Ci={class:"content"},$i={class:"cny"},Pi={class:"grid-2 grid"},Ai={class:"item"},Ii={class:"content"},Ti={key:1},Si={class:"item"},Ui={class:"content"},Fi={class:"cny"},Mi={class:"grid-2 grid"},Ri={class:"item"},Di={class:"content"},Li={class:"cny"},Bi={class:"item"},Oi={class:"content"},Ei={class:"grid"},Ni={class:"item"},Hi={class:"content"},zi={class:"item"},Vi={key:0,class:"content"},ji={key:1,class:"content"},Gi={class:"grid-2 grid"},Yi={class:"item"},Wi={class:"content"},Ki={class:"item"},qi={class:"content"},Ji={class:"grid-2 grid"},Qi={class:"item"},Zi={class:"content"},Xi={key:0},eu={class:"item"},tu={class:"content"},lu={key:0,class:"cny"},su={class:"item"},au={class:"content"},ou={class:"item"},nu={class:"content"},iu={key:0},uu={class:"grid"},ru={class:"item item-border-hide"},du={class:"content"},pu=me({name:"PlanTaskDetailDrawer",__name:"detail-modal",props:fe({id:{default:""},planTaskStatus:{default:()=>[]},mode:{default:()=>{}}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(F){const $=ce(F,"visible"),h=F,n=Oe({id:"",owner:{},pair:{},loading:!0,subProductsVisible:!1,subProductsData:[]});ge($,async T=>{T&&await f()});async function f(){var T,s,y,Y;n.loading=!0;try{const{data:C,error:D}=await Xs(h.id);if(D||!C||C.code!==0)return;Object.assign(n.owner,C.data.owner),n.owner.statusMap=o((T=n.owner)==null?void 0:T.status),n.owner.payTypeMap=w((s=n.owner)==null?void 0:s.payType),h.mode===0&&(Object.assign(n.pair,C.data.pair),n.pair.statusMap=o((y=n.pair)==null?void 0:y.status),n.pair.payTypeMap=w((Y=n.pair)==null?void 0:Y.payType)),n.id=h.id}catch{$.value=!1}finally{n.loading=!1}}function o(T){const s=h.planTaskStatus.find(y=>y.value===T);return{label:(s==null?void 0:s.label)||"未知异常",color:(s==null?void 0:s.color)||"error"}}function w(T){const s=Zs.find(y=>y.value===T);return{label:(s==null?void 0:s.label)||"未知",color:(s==null?void 0:s.color)||"error"}}function d(T){n.subProductsVisible=!0,n.subProductsData=T?n.owner.products:n.pair.products}return(T,s)=>{const y=pe,Y=ue,C=_e,D=dt;return i(),I(le,null,[t(D,{open:$.value,"onUpdate:open":s[4]||(s[4]=E=>$.value=E),title:"任务详情",width:h.mode===0?"70vw":"40vw",footer:null},{default:l(()=>{var E,_,O,b,K,S,p,g,B,U,V,ee,N,m,G,A,J,Z,q,P,a,L,u,Q,j,ie,k,c,z,X,ne,ae,be,ye,te,Ae,Ie,he,Ne,H,Ce,se,bt,yt,wt,xt,ht,Ct,$t,Pt,At,It,Tt,St,Ut,Ft,Mt,Rt,Dt,Lt,Bt,Ot,Et,Nt,Ht,zt,Vt,jt,Gt,Yt,Wt,Kt,qt,Jt,Qt,Zt,Xt,el,tl,ll,sl,al,ol,nl,il,ul,rl,dl,pl,cl,ml,vl,fl,gl,_l,kl,bl,yl,wl,xl,hl,Cl,$l,Pl,Al,Il,Tl,Sl,Ul,Fl,Ml,Rl,Dl,Ll,Bl,Ol,El,Nl,Hl,zl,Vl,jl,Gl,Yl,Wl,Kl,ql,Jl,Ql,Zl,Xl,es,ts,ls,ss,as,os,ns,is,us,rs,ds,ps,cs,ms;return[e("div",no,[h.mode===0?(i(),I("div",io,[e("div",null,[s[40]||(s[40]=e("p",{class:"title"},"我方任务详情",-1)),e("div",uo,[e("div",ro,[e("div",po,[s[6]||(s[6]=e("div",{class:"label"},[e("p",null,"商品标题")],-1)),e("div",co,[e("p",null,M(((_=(E=n.owner.products)==null?void 0:E[0])==null?void 0:_.title)??"—"),1)])]),e("div",mo,[s[7]||(s[7]=e("div",{class:"label"},[e("p",null,"店铺名称")],-1)),e("div",vo,[e("p",null,M(((b=(O=n.owner.products)==null?void 0:O[0])==null?void 0:b.shopName)??"—"),1)])]),e("div",fo,[s[8]||(s[8]=e("div",{class:"label"},[e("p",null,"关键词")],-1)),e("div",go,[e("p",null,M(((S=(K=n.owner.products)==null?void 0:K[0])==null?void 0:S.keyword)??"—"),1)])]),e("div",_o,[s[9]||(s[9]=e("div",{class:"label"},[e("p",null,"商品SKU")],-1)),e("div",ko,[(B=(g=(p=n.owner.products)==null?void 0:p[0])==null?void 0:g.skuList)!=null&&B.length?(i(),I("div",bo,[(i(!0),I(le,null,re((V=(U=n.owner.products)==null?void 0:U[0])==null?void 0:V.skuList,W=>(i(),x(y,{key:W},{default:l(()=>[r(M(W),1)]),_:2},1024))),128))])):(i(),I("p",yo,"无SKU商品"))])])]),e("div",wo,[e("div",xo,[s[10]||(s[10]=e("div",{class:"label"},[e("p",null,"购买件数")],-1)),e("div",ho,[e("p",null,"x "+M(((N=(ee=n.owner.products)==null?void 0:ee[0])==null?void 0:N.count)??1),1)])]),e("div",Co,[s[11]||(s[11]=e("div",{class:"label"},[e("p",null,"购买单价")],-1)),e("div",$o,[e("p",Po,M(((G=(m=n.owner.products)==null?void 0:m[0])==null?void 0:G.price)??0),1)])])]),e("div",Ao,[e("div",Io,[s[12]||(s[12]=e("div",{class:"label"},[e("p",null,"商品总数")],-1)),e("div",To,[n.owner.products&&n.owner.products.length>1?(i(),x(C,{key:0,title:"点击查看商品详情"},{default:l(()=>[t(Y,{onClick:s[0]||(s[0]=W=>d(!0))},{default:l(()=>{var W;return[r(M((W=n.owner)==null?void 0:W.productCount)+"个",1)]}),_:1})]),_:1})):(i(),I("p",So,M((A=n.owner)==null?void 0:A.productCount),1))])]),e("div",Uo,[s[13]||(s[13]=e("div",{class:"label"},[e("p",null,"商品总价")],-1)),e("div",Fo,[e("p",Mo,M((J=n.owner)==null?void 0:J.totalPrice),1)])])]),e("div",Ro,[e("div",Do,[s[14]||(s[14]=e("div",{class:"label"},[e("p",null,"购买差额")],-1)),e("div",Lo,[e("p",Bo,M(((q=(Z=n.owner.products)==null?void 0:Z[0])==null?void 0:q.scope)??0),1)])]),e("div",Oo,[s[15]||(s[15]=e("div",{class:"label"},[e("p",null,"配对差额")],-1)),e("div",Eo,[e("p",No,M((P=n.owner)==null?void 0:P.pairScope),1)])])]),e("div",Ho,[e("div",zo,[s[25]||(s[25]=e("div",{class:"label"},[e("p",null,"商品互动")],-1)),e("div",Vo,[(L=(a=n.owner)==null?void 0:a.actions)!=null&&L.addCart?(i(),x(y,{key:0,color:"orange"},{default:l(()=>s[16]||(s[16]=[r("加购")])),_:1})):R("",!0),(Q=(u=n.owner)==null?void 0:u.actions)!=null&&Q.favorite?(i(),x(y,{key:1,color:"red"},{default:l(()=>s[17]||(s[17]=[r("收藏")])),_:1})):R("",!0),(ie=(j=n.owner)==null?void 0:j.actions)!=null&&ie.lookComment?(i(),x(y,{key:2,color:"blue"},{default:l(()=>s[18]||(s[18]=[r("随机看评价")])),_:1})):R("",!0),(c=(k=n.owner)==null?void 0:k.actions)!=null&&c.lookPlantingGrass?(i(),x(y,{key:3,color:"green"},{default:l(()=>s[19]||(s[19]=[r("随机看种草")])),_:1})):R("",!0),(X=(z=n.owner)==null?void 0:z.actions)!=null&&X.lookAskEveryone?(i(),x(y,{key:4,color:"cyan"},{default:l(()=>s[20]||(s[20]=[r("随机看问大家")])),_:1})):R("",!0),(ae=(ne=n.owner)==null?void 0:ne.actions)!=null&&ae.useFirstBrowse?(i(),x(y,{key:5,color:"geekblue"},{default:l(()=>s[21]||(s[21]=[r("第一次搜索")])),_:1})):R("",!0),(ye=(be=n.owner)==null?void 0:be.actions)!=null&&ye.useFindBrowse?(i(),x(y,{key:6,color:"purple"},{default:l(()=>s[22]||(s[22]=[r("继续浏览")])),_:1})):R("",!0),(Ae=(te=n.owner)==null?void 0:te.actions)!=null&&Ae.useWaitForBuy?(i(),x(y,{key:7,color:"volcano"},{default:l(()=>s[23]||(s[23]=[r("返回首页等待三分钟")])),_:1})):R("",!0),!((Ie=n.owner)!=null&&Ie.actions)||Object.entries(n.owner.actions).filter(([W,oe])=>typeof oe=="boolean").every(([W,oe])=>!oe)?(i(),x(y,{key:8},{default:l(()=>s[24]||(s[24]=[r(" 无 ")])),_:1})):R("",!0)])]),e("div",jo,[s[27]||(s[27]=e("div",{class:"label"},[e("p",null,"排除区域")],-1)),(he=n.owner)!=null&&he.excludeArea&&n.owner.excludeArea.length?(i(),I("div",Go,[(i(!0),I(le,null,re((Ne=n.owner)==null?void 0:Ne.excludeArea,W=>(i(),x(y,{key:W},{default:l(()=>[r(M(W),1)]),_:2},1024))),128))])):R("",!0),!((H=n.owner)!=null&&H.excludeArea)||!((Ce=n.owner)!=null&&Ce.excludeArea.length)?(i(),I("div",Yo,[t(y,null,{default:l(()=>s[26]||(s[26]=[r("无")])),_:1})])):R("",!0)])]),e("div",Wo,[e("div",Ko,[s[31]||(s[31]=e("div",{class:"label"},[e("p",null,"购买状态")],-1)),e("div",qo,[(se=n.owner)!=null&&se.success?(i(),x(y,{key:0,color:"success"},{default:l(()=>s[28]||(s[28]=[r("购买成功")])),_:1})):((bt=n.owner)==null?void 0:bt.status)>=30?(i(),x(y,{key:1,color:"error"},{default:l(()=>s[29]||(s[29]=[r("购买失败")])),_:1})):(i(),x(y,{key:2},{default:l(()=>s[30]||(s[30]=[r("-")])),_:1}))])]),e("div",Jo,[s[32]||(s[32]=e("div",{class:"label"},[e("p",null,"任务状态")],-1)),e("div",Qo,[(yt=n.owner)!=null&&yt.statusMap?(i(),x(C,{key:0,title:(wt=n.owner)!=null&&wt.status?"购买成功":((xt=n.owner)==null?void 0:xt.remark)||"程序执行异常"},{default:l(()=>{var W;return[t(y,{color:(W=n.owner)==null?void 0:W.statusMap.color},{default:l(()=>{var oe;return[r(M((oe=n.owner)==null?void 0:oe.statusMap.label),1)]}),_:1},8,["color"])]}),_:1},8,["title"])):R("",!0)])])]),e("div",Zo,[e("div",Xo,[s[34]||(s[34]=e("div",{class:"label"},[e("p",null,"订单号")],-1)),e("div",en,[(ht=n.owner)!=null&&ht.success?(i(),x(y,{key:0,onClick:s[1]||(s[1]=W=>{var oe;return v(nt)((oe=n.owner)==null?void 0:oe.orderId)})},{default:l(()=>{var W;return[r(M((W=n.owner)==null?void 0:W.orderId),1)]}),_:1})):(i(),x(y,{key:1},{default:l(()=>s[33]||(s[33]=[r("-")])),_:1}))])]),e("div",tn,[s[36]||(s[36]=e("div",{class:"label"},[e("p",null,"支付金额")],-1)),e("div",ln,[(Ct=n.owner)!=null&&Ct.success?(i(),I("p",sn,M(($t=n.owner)==null?void 0:$t.payPrice),1)):(i(),x(y,{key:1},{default:l(()=>s[35]||(s[35]=[r("-")])),_:1}))])]),e("div",an,[s[37]||(s[37]=e("div",{class:"label"},[e("p",null,"支付方式")],-1)),e("div",on,[t(y,{color:(At=(Pt=n.owner)==null?void 0:Pt.payTypeMap)==null?void 0:At.color},{default:l(()=>{var W,oe;return[r(M((oe=(W=n.owner)==null?void 0:W.payTypeMap)==null?void 0:oe.label),1)]}),_:1},8,["color"])])]),e("div",nn,[s[39]||(s[39]=e("div",{class:"label"},[e("p",null,"支付时间")],-1)),e("div",un,[(It=n.owner)!=null&&It.success?(i(),I("p",rn,M((Tt=n.owner)==null?void 0:Tt.completeTime),1)):(i(),x(y,{key:1},{default:l(()=>s[38]||(s[38]=[r("-")])),_:1}))])])])])]),n.pair?(i(),I("div",dn,[s[64]||(s[64]=e("p",{class:"title"},"对方任务详情",-1)),e("div",pn,[e("div",cn,[e("div",mn,[s[41]||(s[41]=e("div",{class:"label"},[e("p",null,"商品标题")],-1)),e("div",vn,[e("p",null,M(((Ut=(St=n.pair.products)==null?void 0:St[0])==null?void 0:Ut.title)??"—"),1)])]),e("div",fn,[s[42]||(s[42]=e("div",{class:"label"},[e("p",null,"店铺名称")],-1)),e("div",gn,[e("p",null,M(((Mt=(Ft=n.pair.products)==null?void 0:Ft[0])==null?void 0:Mt.shopName)??"—"),1)])]),e("div",_n,[s[43]||(s[43]=e("div",{class:"label"},[e("p",null,"关键词")],-1)),e("div",kn,[e("p",null,M(((Dt=(Rt=n.pair.products)==null?void 0:Rt[0])==null?void 0:Dt.keyword)??"—"),1)])]),e("div",bn,[s[44]||(s[44]=e("div",{class:"label"},[e("p",null,"商品SKU")],-1)),e("div",yn,[(Ot=(Bt=(Lt=n.pair.products)==null?void 0:Lt[0])==null?void 0:Bt.skuList)!=null&&Ot.length?(i(),I("div",wn,[(i(!0),I(le,null,re((Nt=(Et=n.pair.products)==null?void 0:Et[0])==null?void 0:Nt.skuList,W=>(i(),x(y,{key:W},{default:l(()=>[r(M(W),1)]),_:2},1024))),128))])):(i(),I("p",xn,"无SKU商品"))])])]),e("div",hn,[e("div",Cn,[s[45]||(s[45]=e("div",{class:"label"},[e("p",null,"购买件数")],-1)),e("div",$n,[e("p",null,"x "+M(((zt=(Ht=n.pair.products)==null?void 0:Ht[0])==null?void 0:zt.count)??1),1)])]),e("div",Pn,[s[46]||(s[46]=e("div",{class:"label"},[e("p",null,"购买单价")],-1)),e("div",An,[e("p",In,M(((jt=(Vt=n.pair.products)==null?void 0:Vt[0])==null?void 0:jt.price)??0),1)])])]),e("div",Tn,[e("div",Sn,[s[47]||(s[47]=e("div",{class:"label"},[e("p",null,"商品总数")],-1)),e("div",Un,[n.pair.products&&n.pair.products.length>1?(i(),x(C,{key:0,title:"点击查看商品详情"},{default:l(()=>[t(Y,{onClick:s[2]||(s[2]=W=>d(!1))},{default:l(()=>{var W;return[r(M((W=n.pair)==null?void 0:W.productCount)+"个",1)]}),_:1})]),_:1})):(i(),I("p",Fn,M((Gt=n.pair)==null?void 0:Gt.productCount),1))])]),e("div",Mn,[s[48]||(s[48]=e("div",{class:"label"},[e("p",null,"商品总价")],-1)),e("div",Rn,[e("p",Dn,M((Yt=n.pair)==null?void 0:Yt.totalPrice),1)])])]),e("div",Ln,[e("div",Bn,[s[52]||(s[52]=e("div",{class:"label"},[e("p",null,"购买状态")],-1)),e("div",On,[(Wt=n.pair)!=null&&Wt.success?(i(),x(y,{key:0,color:"success"},{default:l(()=>s[49]||(s[49]=[r("购买成功")])),_:1})):((Kt=n.pair)==null?void 0:Kt.status)>=30?(i(),x(y,{key:1,color:"error"},{default:l(()=>s[50]||(s[50]=[r("购买失败")])),_:1})):(i(),x(y,{key:2},{default:l(()=>s[51]||(s[51]=[r("-")])),_:1}))])]),e("div",En,[s[53]||(s[53]=e("div",{class:"label"},[e("p",null,"任务状态")],-1)),e("div",Nn,[(qt=n.pair)!=null&&qt.statusMap?(i(),x(C,{key:0,title:(Jt=n.pair)!=null&&Jt.status?"购买成功":((Qt=n.pair)==null?void 0:Qt.remark)||"程序执行异常"},{default:l(()=>{var W;return[t(y,{color:(W=n.pair)==null?void 0:W.statusMap.color},{default:l(()=>{var oe;return[r(M((oe=n.pair)==null?void 0:oe.statusMap.label),1)]}),_:1},8,["color"])]}),_:1},8,["title"])):R("",!0)])])]),e("div",Hn,[e("div",zn,[s[55]||(s[55]=e("div",{class:"label"},[e("p",null,"订单号")],-1)),e("div",Vn,[(Zt=n.pair)!=null&&Zt.success?(i(),I("p",jn,M((Xt=n.pair)==null?void 0:Xt.orderId),1)):(i(),x(y,{key:1},{default:l(()=>s[54]||(s[54]=[r("-")])),_:1}))])]),e("div",Gn,[s[57]||(s[57]=e("div",{class:"label"},[e("p",null,"支付金额")],-1)),e("div",Yn,[(el=n.pair)!=null&&el.success?(i(),I("p",Wn,M((tl=n.pair)==null?void 0:tl.payPrice),1)):(i(),x(y,{key:1},{default:l(()=>s[56]||(s[56]=[r("-")])),_:1}))])]),e("div",Kn,[s[58]||(s[58]=e("div",{class:"label"},[e("p",null,"支付方式")],-1)),e("div",qn,[t(y,{color:(sl=(ll=n.pair)==null?void 0:ll.payTypeMap)==null?void 0:sl.color},{default:l(()=>{var W,oe;return[r(M((oe=(W=n.pair)==null?void 0:W.payTypeMap)==null?void 0:oe.label),1)]}),_:1},8,["color"])])]),e("div",Jn,[s[60]||(s[60]=e("div",{class:"label"},[e("p",null,"支付时间")],-1)),e("div",Qn,[(al=n.pair)!=null&&al.success?(i(),I("p",Zn,M((ol=n.pair)==null?void 0:ol.completeTime),1)):(i(),x(y,{key:1},{default:l(()=>s[59]||(s[59]=[r("-")])),_:1}))])])]),e("div",Xn,[e("div",ei,[s[61]||(s[61]=e("div",{class:"label"},[e("p",null,"执行设备")],-1)),e("div",ti,M(`${(nl=n.pair)!=null&&nl.deviceName?(il=n.pair)==null?void 0:il.deviceName:"设备已被删除"} ( ${(ul=n.pair)!=null&&ul.deviceName?(rl=n.pair)==null?void 0:rl.deviceId:"设备已被删除"} )`),1)])]),e("div",li,[e("div",si,[s[63]||(s[63]=e("div",{class:"label"},[e("p",null,"任务差额")],-1)),e("div",ai,[(dl=n.owner)!=null&&dl.diffPrice&&Number.parseFloat(n.owner.diffPrice)!==0?(i(),I("p",oi,[r(M(n.owner.diffPrice.includes("-")?"我方需补差额 ":"对方需补差额 ")+" ",1),e("span",ni,M(n.owner.diffPrice.replace("-","")),1)])):(i(),x(y,{key:1,type:"success"},{default:l(()=>s[62]||(s[62]=[r("无需补差价")])),_:1}))])])])])])):R("",!0)])):(i(),I("div",ii,[e("div",ui,[e("div",ri,[e("div",di,[s[65]||(s[65]=e("div",{class:"label"},[e("p",null,"商品标题")],-1)),e("div",pi,[e("p",null,M(((cl=(pl=n.owner.products)==null?void 0:pl[0])==null?void 0:cl.title)??"—"),1)])]),e("div",ci,[s[66]||(s[66]=e("div",{class:"label"},[e("p",null,"店铺名称")],-1)),e("div",mi,[e("p",null,M(((vl=(ml=n.owner.products)==null?void 0:ml[0])==null?void 0:vl.shopName)??"—"),1)])]),e("div",vi,[s[67]||(s[67]=e("div",{class:"label"},[e("p",null,"关键词")],-1)),e("div",fi,[e("p",null,M(((gl=(fl=n.owner.products)==null?void 0:fl[0])==null?void 0:gl.keyword)??"—"),1)])]),e("div",gi,[s[68]||(s[68]=e("div",{class:"label"},[e("p",null,"商品SKU")],-1)),e("div",_i,[(bl=(kl=(_l=n.owner.products)==null?void 0:_l[0])==null?void 0:kl.skuList)!=null&&bl.length?(i(),I("div",ki,[(i(!0),I(le,null,re((wl=(yl=n.owner.products)==null?void 0:yl[0])==null?void 0:wl.skuList,W=>(i(),x(y,{key:W},{default:l(()=>[r(M(W),1)]),_:2},1024))),128))])):(i(),I("p",bi,"无SKU商品"))])])]),e("div",yi,[e("div",wi,[s[69]||(s[69]=e("div",{class:"label"},[e("p",null,"购买件数")],-1)),e("div",xi,[e("p",null,"x "+M(((hl=(xl=n.owner.products)==null?void 0:xl[0])==null?void 0:hl.count)??1),1)])]),e("div",hi,[s[70]||(s[70]=e("div",{class:"label"},[e("p",null,"购买单价")],-1)),e("div",Ci,[e("p",$i,M((($l=(Cl=n.owner.products)==null?void 0:Cl[0])==null?void 0:$l.price)??0),1)])])]),e("div",Pi,[e("div",Ai,[s[71]||(s[71]=e("div",{class:"label"},[e("p",null,"商品总数")],-1)),e("div",Ii,[n.owner.products&&n.owner.products.length>1?(i(),x(C,{key:0,title:"点击查看商品详情"},{default:l(()=>[t(Y,{onClick:s[3]||(s[3]=W=>d(!0))},{default:l(()=>{var W;return[r(M((W=n.owner)==null?void 0:W.productCount)+"个",1)]}),_:1})]),_:1})):(i(),I("p",Ti,M((Pl=n.owner)==null?void 0:Pl.productCount),1))])]),e("div",Si,[s[72]||(s[72]=e("div",{class:"label"},[e("p",null,"商品总价")],-1)),e("div",Ui,[e("p",Fi,M((Al=n.owner)==null?void 0:Al.totalPrice),1)])])]),e("div",Mi,[e("div",Ri,[s[73]||(s[73]=e("div",{class:"label"},[e("p",null,"购买差额")],-1)),e("div",Di,[e("p",Li,M(((Tl=(Il=n.owner.products)==null?void 0:Il[0])==null?void 0:Tl.scope)??0),1)])]),e("div",Bi,[s[75]||(s[75]=e("div",{class:"label"},[e("p",null,"配对差额")],-1)),e("div",Oi,[e("p",null,[t(y,null,{default:l(()=>s[74]||(s[74]=[r("-")])),_:1})])])])]),e("div",Ei,[e("div",Ni,[s[85]||(s[85]=e("div",{class:"label"},[e("p",null,"商品互动")],-1)),e("div",Hi,[(Ul=(Sl=n.owner)==null?void 0:Sl.actions)!=null&&Ul.addCart?(i(),x(y,{key:0,color:"orange"},{default:l(()=>s[76]||(s[76]=[r("加购")])),_:1})):R("",!0),(Ml=(Fl=n.owner)==null?void 0:Fl.actions)!=null&&Ml.favorite?(i(),x(y,{key:1,color:"red"},{default:l(()=>s[77]||(s[77]=[r("收藏")])),_:1})):R("",!0),(Dl=(Rl=n.owner)==null?void 0:Rl.actions)!=null&&Dl.lookComment?(i(),x(y,{key:2,color:"blue"},{default:l(()=>s[78]||(s[78]=[r("随机看评价")])),_:1})):R("",!0),(Bl=(Ll=n.owner)==null?void 0:Ll.actions)!=null&&Bl.lookPlantingGrass?(i(),x(y,{key:3,color:"green"},{default:l(()=>s[79]||(s[79]=[r("随机看种草")])),_:1})):R("",!0),(El=(Ol=n.owner)==null?void 0:Ol.actions)!=null&&El.lookAskEveryone?(i(),x(y,{key:4,color:"cyan"},{default:l(()=>s[80]||(s[80]=[r("随机看问大家")])),_:1})):R("",!0),(Hl=(Nl=n.owner)==null?void 0:Nl.actions)!=null&&Hl.useFirstBrowse?(i(),x(y,{key:5,color:"geekblue"},{default:l(()=>s[81]||(s[81]=[r("第一次搜索")])),_:1})):R("",!0),(Vl=(zl=n.owner)==null?void 0:zl.actions)!=null&&Vl.useFindBrowse?(i(),x(y,{key:6,color:"purple"},{default:l(()=>s[82]||(s[82]=[r("继续浏览")])),_:1})):R("",!0),(Gl=(jl=n.owner)==null?void 0:jl.actions)!=null&&Gl.useWaitForBuy?(i(),x(y,{key:7,color:"volcano"},{default:l(()=>s[83]||(s[83]=[r("返回首页等待三分钟")])),_:1})):R("",!0),!((Yl=n.owner)!=null&&Yl.actions)||Object.entries(n.owner.actions).filter(([W,oe])=>typeof oe=="boolean").every(([W,oe])=>!oe)?(i(),x(y,{key:8},{default:l(()=>s[84]||(s[84]=[r(" 无 ")])),_:1})):R("",!0)])]),e("div",zi,[s[87]||(s[87]=e("div",{class:"label"},[e("p",null,"排除区域")],-1)),(Wl=n.owner)!=null&&Wl.excludeArea&&n.owner.excludeArea.length?(i(),I("div",Vi,[(i(!0),I(le,null,re((Kl=n.owner)==null?void 0:Kl.excludeArea,W=>(i(),x(y,{key:W},{default:l(()=>[r(M(W),1)]),_:2},1024))),128))])):R("",!0),!((ql=n.owner)!=null&&ql.excludeArea)||!((Jl=n.owner)!=null&&Jl.excludeArea.length)?(i(),I("div",ji,[t(y,null,{default:l(()=>s[86]||(s[86]=[r("无")])),_:1})])):R("",!0)])]),e("div",Gi,[e("div",Yi,[s[91]||(s[91]=e("div",{class:"label"},[e("p",null,"购买状态")],-1)),e("div",Wi,[(Ql=n.owner)!=null&&Ql.success?(i(),x(y,{key:0,color:"success"},{default:l(()=>s[88]||(s[88]=[r("购买成功")])),_:1})):((Zl=n.owner)==null?void 0:Zl.status)>=30?(i(),x(y,{key:1,color:"error"},{default:l(()=>s[89]||(s[89]=[r("购买失败")])),_:1})):(i(),x(y,{key:2},{default:l(()=>s[90]||(s[90]=[r("-")])),_:1}))])]),e("div",Ki,[s[92]||(s[92]=e("div",{class:"label"},[e("p",null,"任务状态")],-1)),e("div",qi,[(Xl=n.owner)!=null&&Xl.statusMap?(i(),x(C,{key:0,title:(es=n.owner)!=null&&es.status?"购买成功":((ts=n.owner)==null?void 0:ts.remark)||"程序执行异常"},{default:l(()=>{var W;return[t(y,{color:(W=n.owner)==null?void 0:W.statusMap.color},{default:l(()=>{var oe;return[r(M((oe=n.owner)==null?void 0:oe.statusMap.label),1)]}),_:1},8,["color"])]}),_:1},8,["title"])):R("",!0)])])]),e("div",Ji,[e("div",Qi,[s[94]||(s[94]=e("div",{class:"label"},[e("p",null,"订单号")],-1)),e("div",Zi,[(ls=n.owner)!=null&&ls.success?(i(),I("p",Xi,M((ss=n.owner)==null?void 0:ss.orderId),1)):(i(),x(y,{key:1},{default:l(()=>s[93]||(s[93]=[r("-")])),_:1}))])]),e("div",eu,[s[96]||(s[96]=e("div",{class:"label"},[e("p",null,"支付金额")],-1)),e("div",tu,[(as=n.owner)!=null&&as.success?(i(),I("p",lu,M((os=n.owner)==null?void 0:os.payPrice),1)):(i(),x(y,{key:1},{default:l(()=>s[95]||(s[95]=[r("-")])),_:1}))])]),e("div",su,[s[97]||(s[97]=e("div",{class:"label"},[e("p",null,"支付方式")],-1)),e("div",au,[t(y,{color:(is=(ns=n.owner)==null?void 0:ns.payTypeMap)==null?void 0:is.color},{default:l(()=>{var W,oe;return[r(M((oe=(W=n.owner)==null?void 0:W.payTypeMap)==null?void 0:oe.label),1)]}),_:1},8,["color"])])]),e("div",ou,[s[99]||(s[99]=e("div",{class:"label"},[e("p",null,"支付时间")],-1)),e("div",nu,[(us=n.owner)!=null&&us.success?(i(),I("p",iu,M((rs=n.owner)==null?void 0:rs.completeTime),1)):(i(),x(y,{key:1},{default:l(()=>s[98]||(s[98]=[r("-")])),_:1}))])])]),e("div",uu,[e("div",ru,[s[100]||(s[100]=e("div",{class:"label"},[e("p",null,"执行设备")],-1)),e("div",du,M(`${(ds=n.owner)!=null&&ds.deviceName?(ps=n.owner)==null?void 0:ps.deviceName:"设备已被删除"} ( ${(cs=n.owner)!=null&&cs.deviceName?(ms=n.owner)==null?void 0:ms.deviceId:"设备已被删除"} )`),1)])])])])),t(Qe,{loading:n.loading},null,8,["loading"])])]}),_:1},8,["open","width"]),t(oo,{visible:n.subProductsVisible,"onUpdate:visible":s[5]||(s[5]=E=>n.subProductsVisible=E),"sub-products-data":n.subProductsData},null,8,["visible","sub-products-data"])],64)}}}),cu=ve(pu,[["__scopeId","data-v-ebfe1b5a"]]),mu={class:"flex-1"},vu={class:"w-full flex-y-center justify-end gap-12px"},fu={class:"v-center center flex"},gu={class:"ml-8px"},_u=me({name:"PlanTaskListSearch",__name:"search-filter",props:fe({userInfo:{},mode:{}},{model:{required:!0},modelModifiers:{}}),emits:fe(["reset","search"],["update:model"]),setup(F,{emit:$}){const{formRef:h,resetFields:n}=Ee(),f=ce(F,"model"),o=F,w=de(!1),d=$;async function T(){await n(),d("reset")}async function s(){d("search")}function y(C,D){f.value.beginTime=D[0],f.value.endTime=D[1]}const Y=C=>C&&C>=Se().endOf("day");return(C,D)=>{const E=De,_=ke,O=gt,b=Ze,K=ha,S=ue,p=it,g=ut,B=Ge,U=xe;return i(),x(Ys,null,{default:l(()=>[t(U,{ref_key:"formRef",ref:h,class:"search-filter",model:f.value,"label-col":{span:5,md:7}},{default:l(()=>[t(B,{gutter:[16,16],wrap:""},{default:l(()=>[t(O,{span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"任务模式",name:"mode",class:"m-0"},{default:l(()=>[t(E,{value:f.value.mode,"onUpdate:value":D[0]||(D[0]=V=>f.value.mode=V),placeholder:"- 全部 -",options:o.mode,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),t(O,{span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"商品标题",name:"title",class:"m-0"},{default:l(()=>[t(b,{value:f.value.title,"onUpdate:value":D[1]||(D[1]=V=>f.value.title=V),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),o.userInfo.tenantType===20||!o.userInfo.isTenant?(i(),x(O,{key:0,span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"店铺名称",name:"shopName",class:"m-0"},{default:l(()=>[t(b,{value:f.value.shopName,"onUpdate:value":D[2]||(D[2]=V=>f.value.shopName=V),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1})):o.userInfo.tenantType!==20||!o.userInfo.isTenant?(i(),x(O,{key:1,span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"店铺名称",name:"shopName",class:"m-0"},{default:l(()=>[t(ft,{value:f.value.shopName,"onUpdate:value":D[3]||(D[3]=V=>f.value.shopName=V),platform:0},null,8,["value"])]),_:1})]),_:1})):R("",!0),t(O,{span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"订单编号",name:"orderId",class:"m-0"},{default:l(()=>[t(b,{value:f.value.orderId,"onUpdate:value":D[4]||(D[4]=V=>f.value.orderId=V),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),w.value?(i(),x(O,{key:2,span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"执行设备",name:"deviceId",class:"m-0"},{default:l(()=>[t(wa,{value:f.value.deviceId,"onUpdate:value":D[5]||(D[5]=V=>f.value.deviceId=V)},null,8,["value"])]),_:1})]),_:1})):R("",!0),w.value?(i(),x(O,{key:3,span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"购买状态",name:"success",class:"m-0"},{default:l(()=>[t(E,{value:f.value.success,"onUpdate:value":D[6]||(D[6]=V=>f.value.success=V),placeholder:"- 全部 -",options:[{value:!0,label:"成功"},{value:!1,label:"失败"}],"allow-clear":""},null,8,["value"])]),_:1})]),_:1})):R("",!0),w.value?(i(),x(O,{key:4,span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"任务状态",name:"status",class:"m-0"},{default:l(()=>[t(E,{value:f.value.status,"onUpdate:value":D[7]||(D[7]=V=>f.value.status=V),placeholder:"- 全部 -",options:v(ea),"allow-clear":"",mode:"multiple","max-tag-count":"responsive"},null,8,["value","options"])]),_:1})]),_:1})):R("",!0),w.value?(i(),x(O,{key:5,span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"创建时间",name:"createTimeRange",class:"m-0"},{default:l(()=>[t(K,{value:f.value.createTimeRange,"onUpdate:value":D[8]||(D[8]=V=>f.value.createTimeRange=V),"show-time":{hideDisabledOptions:!0,defaultValue:[v(Se)("00:00:00","HH:mm:ss"),v(Se)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],"disabled-date":Y,onChange:y},null,8,["value","show-time"])]),_:1})]),_:1})):R("",!0),w.value&&!o.userInfo.isTenant?(i(),x(O,{key:6,span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"创建商户",name:"userId",class:"m-0"},{default:l(()=>[t(ks,{value:f.value.userId,"onUpdate:value":D[9]||(D[9]=V=>f.value.userId=V),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})):w.value&&!o.userInfo.isTenantUser?(i(),x(O,{key:7,span:24,md:12,lg:6},{default:l(()=>[t(_,{label:"创建员工",name:"userId",class:"m-0"},{default:l(()=>[t(ks,{value:f.value.userId,"onUpdate:value":D[10]||(D[10]=V=>f.value.userId=V),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})]),_:1})):R("",!0),e("div",mu,[t(_,{class:"m-0"},{default:l(()=>[e("div",vu,[t(S,{onClick:D[11]||(D[11]=()=>w.value=!w.value)},{default:l(()=>[e("div",fu,[w.value?(i(),x(v(js),{key:0})):(i(),x(v(Gs),{key:1})),e("span",gu,M(w.value?"收起筛选":"展开更多"),1)])]),_:1}),t(S,{onClick:T},{icon:l(()=>[t(p,{class:"align-sub text-icon"})]),default:l(()=>[D[12]||(D[12]=e("span",{class:"ml-8px"},"重置",-1))]),_:1}),t(S,{type:"primary",ghost:"",onClick:s},{icon:l(()=>[t(g,{class:"align-sub text-icon"})]),default:l(()=>[D[13]||(D[13]=e("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),ku=ve(_u,[["__scopeId","data-v-b866dd70"]]),bu=me({name:"PlanTaskCompletionDrawer",__name:"completion-drawer",props:fe({rowData:{default:()=>({})}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:fe(["submitted"],["update:visible"]),setup(F,{emit:$}){const h=ce(F,"visible"),n=F,{provinceOptions:f,useCity:o}=ta(),{formRef:w,validate:d,resetFields:T}=Ee(),{defaultRequiredRule:s}=mt(),y=$,Y={orderId:s,payPrice:s,lovePayId:[{required:!0,message:"请选择亲情卡"}]},C=de(_()),D=de([]),E=de(null);ge(h,async N=>{N&&(T(),C.value=_(),n.rowData.success||(C.value.success=0),await S())});function _(){return{id:"",success:1,orderId:"",payPrice:0,province:"",city:"",address:"",name:"",phone:"",addressContent:"",note:"",isLovePay:!1,lovePayId:"",lovePayName:"",lovePayEnum:[],newLovePayName:"",loading:!1}}function O(){D.value=o(C.value.province),C.value.city=D.value[0].value}async function b(N){const{data:m,error:G}=await Aa(N);!G&&m&&m.code===0?(C.value.lovePayEnum=m.data.list,(!C.value.lovePayEnum||!C.value.lovePayEnum.length)&&(C.value.isLovePay=!1)):p()}const K=(N,m)=>m.value.toLowerCase().includes(N.toLowerCase());async function S(){const{data:N,error:m}=await la(n.rowData.id);!m&&N&&N.code===0?(C.value.id=N.data.id,N.data.success&&(C.value.orderId=N.data.orderId,C.value.payPrice=N.data.payPrice,C.value.province=N.data.province,C.value.city=N.data.city,C.value.address=N.data.address,C.value.name=N.data.name,C.value.phone=N.data.phone,C.value.lovePayName=N.data.lovePayName),C.value.isLovePay=N.data.isLovePay,C.value.note=N.data.note||"",C.value.isLovePay&&await b(N.data.id)):p()}function p(){h.value=!1}async function g(){var N;if(await d(),C.value.success===0){await B();return}(N=window.$modal)==null||N.confirm({title:"订单补全信息提示",cancelText:"取消",okText:"确定",content:"请确认商品信息是否填写正确，提交后将无法修改，确定要提交吗？",async onOk(){await B()}})}async function B(){var N;C.value.loading=!0;try{C.value.province;const{data:m,error:G}=await sa({...C.value});!G&&m&&m.code===0&&((N=window.$message)==null||N.success("保存成功"),y("submitted"),p())}finally{C.value.loading=!1}}function U(N){if(N.preventDefault(),!C.value.newLovePayName)return;C.value.newLovePayName=C.value.newLovePayName.trim();const m=-1*Date.now();C.value.lovePayEnum.filter(G=>G.value===m).length||C.value.lovePayEnum.push({text:C.value.newLovePayName,value:m}),C.value.lovePayId=m,C.value.lovePayName=C.value.newLovePayName,we(()=>{var G;C.value.newLovePayName="",(G=E.value)==null||G.focus()})}function V(){C.value.lovePayId<-1&&(C.value.lovePayName=C.value.lovePayEnum.filter(N=>N.value===C.value.lovePayId)[0].text)}function ee(N,m){return C.value.lovePayEnum.filter(G=>G.text.includes(N)).filter(G=>G.value===m.value).length>0}return(N,m)=>{const G=De,A=ke,J=Ye,Z=$a,q=Pa,P=Ze,a=ue,L=$e,u=je,Q=vt,j=xe,ie=Pe;return i(),x(ie,{open:h.value,"onUpdate:open":m[12]||(m[12]=k=>h.value=k),title:"任务信息",width:550},{footer:l(()=>[t(L,{size:16},{default:l(()=>[t(a,{onClick:p},{default:l(()=>m[17]||(m[17]=[r("取消")])),_:1}),t(a,{type:"primary",loading:C.value.loading,onClick:g},{default:l(()=>m[18]||(m[18]=[r("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(j,{ref_key:"formRef",ref:w,name:"operate",layout:"vertical",model:C.value,rules:Y},{default:l(()=>[t(A,{label:"购买结果",name:"success"},{default:l(()=>[t(G,{value:C.value.success,"onUpdate:value":m[0]||(m[0]=k=>C.value.success=k),options:[{value:0,label:"购买失败"},{value:1,label:"购买成功"}],disabled:n.rowData.success},null,8,["value","disabled"])]),_:1}),C.value.success===1&&C.value.isLovePay?(i(),x(A,{key:0,label:"亲情卡",name:"lovePayId"},{default:l(()=>[n.rowData.success?(i(),x(P,{key:1,value:C.value.lovePayName,"onUpdate:value":m[3]||(m[3]=k=>C.value.lovePayName=k),disabled:""},null,8,["value"])):(i(),x(G,{key:0,value:C.value.lovePayId,"onUpdate:value":m[2]||(m[2]=k=>C.value.lovePayId=k),placeholder:"请选择亲情卡","show-search":"","filter-option":ee,onChange:V},{dropdownRender:l(({menuNode:k})=>[t(Z,{vnodes:k},null,8,["vnodes"]),t(q,{class:"mb-4px mt-4px"}),t(L,{class:"select-action"},{default:l(()=>[t(P,{ref_key:"inputRef",ref:E,value:C.value.newLovePayName,"onUpdate:value":m[1]||(m[1]=c=>C.value.newLovePayName=c),placeholder:"新亲情卡"},null,8,["value"]),t(a,{ghost:"",size:"small",type:"primary",onClick:U},{icon:l(()=>[t(v(Re))]),default:l(()=>[m[13]||(m[13]=r(" 添加新亲情卡 "))]),_:1})]),_:1})]),default:l(()=>[(i(!0),I(le,null,re(C.value.lovePayEnum,k=>(i(),x(J,{key:k.value,value:k.value},{default:l(()=>[r(M(k.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1})):R("",!0),C.value.success===1?(i(),x(A,{key:1,label:"订单号",name:"orderId"},{default:l(()=>[t(P,{value:C.value.orderId,"onUpdate:value":m[4]||(m[4]=k=>C.value.orderId=k),autocomplete:"off",placeholder:"请输入订单号",disabled:n.rowData.success},null,8,["value","disabled"])]),_:1})):R("",!0),C.value.success===1?(i(),x(A,{key:2,label:"支付金额",name:"payPrice"},{default:l(()=>[t(u,{value:C.value.payPrice,"onUpdate:value":m[5]||(m[5]=k=>C.value.payPrice=k),min:0,controls:!1,precision:2,disabled:n.rowData.success},{addonBefore:l(()=>m[14]||(m[14]=[e("span",null,"￥",-1)])),addonAfter:l(()=>m[15]||(m[15]=[e("span",null,"元",-1)])),_:1},8,["value","disabled"])]),_:1})):R("",!0),C.value.success===1?(i(),x(A,{key:3,label:"省份",name:"province"},{default:l(()=>[t(G,{value:C.value.province,"onUpdate:value":m[6]||(m[6]=k=>C.value.province=k),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,options:v(f),"filter-option":K,disabled:n.rowData.success,onChange:O},null,8,["value","options","disabled"])]),_:1})):R("",!0),C.value.success===1?(i(),x(A,{key:4,label:"市区",name:"city"},{default:l(()=>[t(G,{value:C.value.city,"onUpdate:value":m[7]||(m[7]=k=>C.value.city=k),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,options:D.value,"filter-option":K,disabled:n.rowData.success},{notFoundContent:l(()=>m[16]||(m[16]=[e("p",null,"没有找到匹配的市区",-1)])),_:1},8,["value","options","disabled"])]),_:1})):R("",!0),C.value.success===1?(i(),x(A,{key:5,label:"详细地址",name:"address"},{default:l(()=>[t(Q,{value:C.value.address,"onUpdate:value":m[8]||(m[8]=k=>C.value.address=k),autocomplete:"off",placeholder:"请输入详细地址","auto-size":{minRows:5},disabled:n.rowData.success},null,8,["value","disabled"])]),_:1})):R("",!0),C.value.success===1?(i(),x(A,{key:6,label:"收货人",name:"name"},{default:l(()=>[t(P,{value:C.value.name,"onUpdate:value":m[9]||(m[9]=k=>C.value.name=k),autocomplete:"off",placeholder:"请输入收货人名称",disabled:n.rowData.success},null,8,["value","disabled"])]),_:1})):R("",!0),C.value.success===1?(i(),x(A,{key:7,label:"联系方式",name:"phone"},{default:l(()=>[t(P,{value:C.value.phone,"onUpdate:value":m[10]||(m[10]=k=>C.value.phone=k),autocomplete:"off",placeholder:"请输入联系方式",disabled:n.rowData.success},null,8,["value","disabled"])]),_:1})):R("",!0),t(A,{label:"任务备注"},{default:l(()=>[t(Q,{value:C.value.note,"onUpdate:value":m[11]||(m[11]=k=>C.value.note=k),"auto-size":{minRows:3},maxlength:300},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),yu=ve(bu,[["__scopeId","data-v-07b7c837"]]),wu={class:"v-center flex gap-8px"},xu=me({name:"PlanTaskFriendsSelect",__name:"friends-select",props:{value:{default:""},valueModifiers:{}},emits:["update:value"],setup(F){const $=ce(F,"value"),h=Oe({lastSearchFilter:"",friendsOptions:[]}),n=Fs(async f=>{h.lastSearchFilter=f;const{data:o,error:w}=await Ia(f);!w&&o&&o.code===0&&o.data&&o.data.list&&o.data.list.length&&(h.friendsOptions=o.data.list.map(d=>({value:d.value,label:d.text})),h.friendsOptions.length===1&&($.value=h.friendsOptions[0].value))});return Je(()=>{n()}),(f,o)=>{const w=Ye,d=De,T=ue,s=ke;return i(),x(s,{name:"friend"},{label:l(()=>o[2]||(o[2]=[e("p",null,[r(" 指定好友 "),e("small",{class:"info"},"* 如未找到好友，请核好友列表是否已添加且已有审核过的店铺")],-1)])),default:l(()=>[e("div",wu,[t(d,{value:$.value,"onUpdate:value":o[0]||(o[0]=y=>$.value=y),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,onSearch:v(n)},{notFoundContent:l(()=>o[3]||(o[3]=[e("p",null,"没有可分配的好友",-1)])),default:l(()=>[(i(!0),I(le,null,re(h.friendsOptions,y=>(i(),x(w,{key:y.value,value:y.value},{default:l(()=>[r(M(y.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onSearch"]),t(T,{onClick:o[1]||(o[1]=()=>v(n)(h.lastSearchFilter))},{default:l(()=>o[4]||(o[4]=[r("刷新")])),_:1})])]),_:1})}}}),Ls=ve(xu,[["__scopeId","data-v-fbca66f0"]]),hu={class:"v-center flex gap-8px"},Cu=me({name:"PlanTaskDeviceSelect",__name:"device-select",props:{value:{default:""},valueModifiers:{}},emits:["update:value"],setup(F){const $=ce(F,"value"),h=Oe({lastSearchFilter:"",deviceIdOptions:[]}),n=Fs(async f=>{h.lastSearchFilter=f;const{data:o,error:w}=await Ta(f);!w&&o&&o.code===0&&o.data&&o.data.list&&o.data.list.length&&(h.deviceIdOptions=o.data.list.map(d=>({value:d.value,label:d.text})),h.deviceIdOptions.length===1&&($.value=h.deviceIdOptions[0].value))});return Je(()=>{n("")}),(f,o)=>{const w=Ye,d=De,T=ue,s=ke;return i(),x(s,{name:"deviceId"},{label:l(()=>o[2]||(o[2]=[e("p",null,[r(" 指定设备 "),e("small",{class:"info"},"* 如未找到设备，请核对设备剩余使用数")],-1)])),default:l(()=>[e("div",hu,[t(d,{value:$.value,"onUpdate:value":o[0]||(o[0]=y=>$.value=y),placeholder:"- 请选择 -","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,onSearch:v(n)},{notFoundContent:l(()=>o[3]||(o[3]=[e("p",null,"没有可分配的设备",-1)])),default:l(()=>[(i(!0),I(le,null,re(h.deviceIdOptions,y=>(i(),x(w,{key:y.value,value:y.value},{default:l(()=>[r(M(y.label)+" ("+M(y.value)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onSearch"]),t(T,{onClick:o[1]||(o[1]=()=>v(n)(h.lastSearchFilter))},{default:l(()=>o[4]||(o[4]=[r("刷新")])),_:1})])]),_:1})}}}),Bs=ve(Cu,[["__scopeId","data-v-eb74d4ea"]]),$u={class:"space-between v-center mb-12px flex"},Pu={class:"products"},Au={class:"v-center mb-6px flex gap-8px"},Iu=["onClick"],Tu={class:"v-center flex gap-8px"},Su={class:"products-image"},Uu={class:"products-body"},Fu={class:"sku"},Mu={class:"mb-6px"},Ru={class:"v-center flex gap-8px"},Du={class:"v-center num-container flex gap-8px"},Lu={class:"v-center del-btn flex gap-6px"},Bu={class:"text-center"},Ou={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Eu={class:"flex-1"},Nu={class:"w-full flex-y-center justify-end gap-12px"},Hu=me({__name:"again-product-select",props:fe({shopId:{default:""}},{products:{default:[]},productsModifiers:{},multiple:{type:Boolean,default:!1},multipleModifiers:{}}),emits:fe(["submitted","shopValidate"],["update:products","update:multiple"]),setup(F,{expose:$,emit:h}){const n=ce(F,"products"),f=ce(F,"multiple"),o=de(p()),{tableWrapperRef:w,scrollConfig:d}=We(),{columns:T,data:s,getData:y,getDataByPage:Y,loading:C,mobilePagination:D,searchParams:E,resetSearchParams:_}=Ke({apiFn:B,apiParams:{platform:0,shopId:"",url:"",title:"",itemId:"",pageIndex:1,pageSize:10},columns:U}),{checkedRowKeys:O,rowSelection:b}=qe(s,y),K=F,S=h;ge(()=>o.value.visible,P=>{P||Z()}),ge(O,P=>{if(!f.value&&P.length>1){const a=O.value.at(-1);O.value.splice(0,O.value.length,...a!==void 0?[a]:[]),b.value.selectedRowKeys=[a],b.value.selectedRows=b.value.selectedRows.filter(L=>L.id===a)}}),ge(()=>o.value.products,P=>{var L;for(const u of P){const Q=n.value.findIndex(j=>j.id===u.id);Q>-1?(n.value[Q].skuList=u.selectedSkuMap?JSON.parse(u.selectedSkuMap):[],n.value[Q].keyword=u.keyword,n.value[Q].count=u.count,n.value[Q].price=u.price,n.value[Q].scope=u.scope,n.value[Q].main=u.main):n.value.push({id:u.id,shopName:u.shopName,url:u.url,image:u.image,title:u.title,keyword:u.keyword,skuCount:((L=u.skuMap)==null?void 0:L.length)||0,skuList:u.selectedSkuMap?JSON.parse(u.selectedSkuMap):[],count:u.count,price:u.price,scope:u.scope,main:u.main,comment:u.comment})}const a=P.map(u=>u.id);n.value=n.value.filter(u=>a.includes(u.id)),S("submitted")},{deep:!0}),Je(()=>{ee()});function p(){return{visible:!1,products:[],loading:!0}}async function g(){if(K.shopId===""||K.shopId==="0"){S("shopValidate");return}o.value.visible=!0;try{E.shopId!==K.shopId&&(o.value.loading=!0,E.shopId=K.shopId,await Y(1))}finally{o.value.loading&&(o.value.loading=!1)}}function B(P){return o.value.visible?Us({...P}):Promise.resolve({code:0,msg:"",data:{count:0,list:[],pageIndex:1,pageSize:10}})}function U(){return[{key:"image",dataIndex:"image",title:"商品主图",width:80,customRender({record:a}){return t("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[t(Fe,{width:64,height:64,src:a.image,fallback:Me},null)])}},{key:"title",dataIndex:"title",title:"商品"},{key:"shopName",dataIndex:"shopName",title:"店铺",width:200}]}function V(){var a;if(!E.url)return;const P=new URL(E.url);if(E.itemId=P.searchParams.get("id")||"",!E.itemId){(a=window.$message)==null||a.warning("商品链接解析失败，请核对链接或手动填写商品Id");return}E.url=`${P.protocol}//${P.host}${P.pathname}?id=${o.value.itemId}`}async function ee(){try{const{data:P,error:a}=await Ss();!a&&P&&P.code===0&&(o.value.shopNameEnum=P.data.list)}catch{}}function N(){we(()=>{var P;!f.value&&o.value.products.length>1&&((P=window.$message)==null||P.warning("只能保留一个商品，请删除其他商品"),f.value=!0)})}function m(P,a){a.main?o.value.products.forEach((L,u)=>L.main=u===P):o.value.products.filter(L=>L.main).length===0&&(a.main=!0)}function G(){const P=b.value.selectedRows.map((a,L)=>({id:a.id,shopName:a.shopName,url:a.url,image:a.image,title:a.title,keyword:"",skuMap:a.skuMap.map(u=>({sku:u.sku,price:u.price,value:JSON.stringify(u.sku),label:u.sku.join("+")})),selectedSkuMap:null,skuList:[],count:1,price:0,scope:10,main:L===0}));if(f.value)for(const a of P)o.value.products.filter(L=>L.id===a.id).length||(a.main=o.value.products.filter(L=>L.main).length===0,o.value.products.push(a));else(o.value.products.length===0||P[0].id!==o.value.products[0].id)&&(o.value.products=[P[0]]);o.value.visible=!1}function A(P){const a=o.value.products[P].skuMap.filter(L=>L.value===o.value.products[P].selectedSkuMap);a&&a.length?o.value.products[P].price=a[0].price:o.value.products[P].price=0}function J(P){o.value.products=o.value.products.filter((a,L)=>L!==P),o.value.products.length&&!o.value.products.filter(a=>a.main).length&&(o.value.products[0].main=!0)}function Z(){O.value=[],b.value.selectedRowKeys=[],b.value.selectedRows=[]}function q(P){var a;P?window.open(P):(a=window.$message)==null||a.warning("该商品没有添加商品链接，无法跳转")}return $({initSelectedProducts:()=>{o.value=p(),Z()},setSelectedProducts:(P=[])=>{o.value.products=P.map(a=>({id:a.id,shopName:a.shopName,url:a.url,image:a.image,title:a.title,keyword:a.keyword,skuMap:a.skuMap?a.skuMap.map(L=>({sku:L.sku,price:L.price,value:JSON.stringify(L.sku),label:L.sku.join("+")})):[],selectedSkuMap:a.selectedSkuMap?JSON.parse(a.selectedSkuMap):null,skuList:a.skuList,count:a.count,price:a.price,scope:a.scope,main:a.main,comment:a.comment}))}}),(P,a)=>{const L=at,u=Fe,Q=De,j=pe,ie=Ze,k=je,c=_e,z=ue,X=Le,ne=ke,ae=gt,be=it,ye=ut,te=Ge,Ae=xe,Ie=Ve,he=$e,Ne=Pe;return i(),I(le,null,[e("p",$u,[e("span",null,"商品列表(已选 "+M(o.value.products.length)+" 个)",1),t(L,{checked:f.value,"onUpdate:checked":a[0]||(a[0]=H=>f.value=H),onChange:N},{default:l(()=>a[8]||(a[8]=[r("多商品")])),_:1},8,["checked"])]),e("ul",Pu,[(i(!0),I(le,null,re(o.value.products,(H,Ce)=>(i(),I("li",{key:H.id},[e("div",Au,[f.value?(i(),x(L,{key:0,checked:H.main,"onUpdate:checked":se=>H.main=se,onChange:()=>m(Ce,H)},{default:l(()=>a[9]||(a[9]=[r(" 主商品 ")])),_:2},1032,["checked","onUpdate:checked","onChange"])):R("",!0),e("p",{class:"title",onClick:se=>q(H.url)},M(H.title),9,Iu)]),e("div",Tu,[e("div",Su,[t(u,{width:100,height:100,src:H.image,fallback:v(Me)},null,8,["src","fallback"])]),e("div",Uu,[e("div",Fu,[H.skuMap.length?(i(),x(Q,{key:0,value:H.selectedSkuMap,"onUpdate:value":se=>H.selectedSkuMap=se,options:H.skuMap,placeholder:"请选择商品Sku",onChange:se=>A(Ce)},null,8,["value","onUpdate:value","options","onChange"])):(i(),x(j,{key:1},{default:l(()=>a[10]||(a[10]=[r("该商品无Sku")])),_:1}))]),e("div",Mu,[t(ie,{value:H.keyword,"onUpdate:value":se=>H.keyword=se,placeholder:H.main?"请输入搜索关键词":"没有输入输入关键词则进店查找"},null,8,["value","onUpdate:value","placeholder"])]),e("div",Ru,[e("div",Du,[t(k,{value:H.price,"onUpdate:value":se=>H.price=se,min:0,max:99999,controls:!1,precision:2},{addonBefore:l(()=>a[11]||(a[11]=[e("span",null,"价格",-1)])),addonAfter:l(()=>a[12]||(a[12]=[e("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"]),t(k,{value:H.count,"onUpdate:value":se=>H.count=se,min:1,max:99999,controls:!1,precision:0},{addonBefore:l(()=>a[13]||(a[13]=[e("span",null,"购买",-1)])),addonAfter:l(()=>a[14]||(a[14]=[e("span",null,"件",-1)])),_:2},1032,["value","onUpdate:value"]),t(k,{value:H.scope,"onUpdate:value":se=>H.scope=se,min:0,max:99999,controls:!1,precision:2},{addonBefore:l(()=>[t(c,{placement:"top"},{title:l(()=>a[15]||(a[15]=[e("span",null,"下单商品时商品单价与填写价格相差符合差额范围内才下单",-1)])),default:l(()=>[a[16]||(a[16]=e("span",null,"浮动差额 ±",-1))]),_:1})]),addonAfter:l(()=>a[17]||(a[17]=[e("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"])]),e("div",Lu,[t(X,{title:"确认删除吗？",placement:"left",onConfirm:()=>J(Ce)},{default:l(()=>[t(z,{danger:"",size:"small"},{default:l(()=>a[18]||(a[18]=[r("删除")])),_:1})]),_:2},1032,["onConfirm"])])])])])]))),128))]),f.value||o.value.products.length===0?(i(),I("div",{key:0,class:"actions mb-12px",onClick:g},[e("p",Bu,[t(v(Re)),a[19]||(a[19]=r(" 添加商品 "))])])):R("",!0),t(Ne,{open:o.value.visible,"onUpdate:open":a[7]||(a[7]=H=>o.value.visible=H),title:"商品选择",width:800},{footer:l(()=>[t(he,{size:16},{default:l(()=>[t(z,{onClick:a[6]||(a[6]=()=>o.value.visible=!1)},{default:l(()=>a[22]||(a[22]=[r("取消")])),_:1}),t(z,{type:"primary",disabled:v(O).length===0,onClick:G},{default:l(()=>a[23]||(a[23]=[r("确定")])),_:1},8,["disabled"])]),_:1})]),default:l(()=>[e("div",Ou,[t(Ae,{model:v(E),"label-col":{span:5,md:7}},{default:l(()=>[t(te,{class:"row",gutter:[16,16],wrap:""},{default:l(()=>[t(ae,{span:12},{default:l(()=>[t(ne,{label:"商品链接",name:"url",class:"m-0"},{default:l(()=>[t(ie,{value:v(E).url,"onUpdate:value":a[1]||(a[1]=H=>v(E).url=H),placeholder:"",onBlur:V},null,8,["value"])]),_:1})]),_:1}),t(ae,{span:12},{default:l(()=>[t(ne,{label:"商品编号",name:"itemId",class:"m-0"},{default:l(()=>[t(ie,{value:v(E).itemId,"onUpdate:value":a[2]||(a[2]=H=>v(E).itemId=H),placeholder:""},null,8,["value"])]),_:1})]),_:1}),t(ae,{span:12},{default:l(()=>[t(ne,{label:"商品名称",name:"title",class:"m-0"},{default:l(()=>[t(ie,{value:v(E).title,"onUpdate:value":a[3]||(a[3]=H=>v(E).title=H),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e("div",Eu,[t(ne,{class:"m-0"},{default:l(()=>[e("div",Nu,[t(z,{onClick:a[4]||(a[4]=H=>v(_)())},{icon:l(()=>[t(be,{class:"align-sub text-icon"})]),default:l(()=>[a[20]||(a[20]=e("span",{class:"ml-8px"},"重置",-1))]),_:1}),t(z,{type:"primary",ghost:"",onClick:a[5]||(a[5]=H=>v(Y)(1))},{icon:l(()=>[t(ye,{class:"align-sub text-icon"})]),default:l(()=>[a[21]||(a[21]=e("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"]),t(Ie,{ref_key:"tableWrapperRef",ref:w,columns:v(T),"data-source":v(s),size:"small","row-selection":v(b),scroll:v(d),loading:v(C),"row-key":"id",pagination:v(D),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),t(Qe,{loading:o.value.loading},null,8,["loading"])])]),_:1},8,["open"])],64)}}}),zu=ve(Hu,[["__scopeId","data-v-a0f62a0d"]]),Vu={class:"v-center flex gap-8px"},ju={class:"actions"},Gu={key:0,class:"text-danger"},Yu={class:"popover-content"},Wu=me({name:"PlanTaskActions",__name:"actions",props:{actions:{default:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,lookPlantingGrass:!0,lookAskEveryone:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0}},actionsModifiers:{}},emits:["update:actions"],setup(F){const $=ce(F,"actions"),h=de([{key:"addCart",label:"商品加购",content:[{text:"将商品添加至购物车，不勾选则根据随机进行购物车或立即购买流程"},{text:"注意：多链接商品只能走加购流程"}]},{key:"favorite",label:"商品收藏",content:[{text:"收藏商品，不勾选不收藏"},{text:"注意：多链接情况下，该行为只会在主商品下生效"}]},{key:"useFirstBrowse",label:"随机搜索浏览多次",content:[{text:"根据关键词搜索相关推荐词进行浏览，不勾选不进行"},{text:"注意：推荐词不一定是当前商品类目,多链接情况下，该行为只会在主商品下生效"}]},{key:"lookAskEveryone",label:"随机看问大家",extra:"（3-10次动态）",content:[{text:"浏览商品页问大家随机页数，如果商品有的情况下进行浏览，不勾选不进行"},{text:"注意：多链接情况下，该行为只会在主商品下生效"}]},{key:"lookComment",label:"随机看商品评价",extra:"（3-10次动态）",content:[{text:"浏览商品评价随机页数，不勾选则不进行"},{text:"注意：多链接情况下，该行为只会在主商品下生效"}]},{key:"lookPlantingGrass",label:"随机看种草信息",extra:"（3-10次动态）",content:[{text:"浏览商品种草随机页数，如果商品有的情况下进行浏览，不勾选不进行"},{text:"注意：多链接情况下，该行为只会在主商品下生效"}]},{key:"useWaitForBuy",label:"浏览后随机等待分钟数付款",content:[{text:"去往购物车付款之前会返回桌面等待1-3分钟后进行购买,不勾选不进行"},{text:"注意：必须勾选商品加购流程才会触发，如果是多链接情况下，该行为只会在主商品下生效"}]},{key:"useFindBrowse",label:"找到指定商品后不购买，再次随机浏览后下单",content:[{text:"找到目标商品后，继续向下随机浏览多次再返回下单，不勾选不进行"},{text:"注意：多链接情况下，该行为只会在主商品下生效"}]}]);return(n,f)=>{const o=je,w=ke,d=at;return i(),I(le,null,[t(w,null,{label:l(()=>f[3]||(f[3]=[e("p",null,[r(" 货比三家 "),e("small",{class:"text-danger ml-1"},"* 都为0不进行货比")],-1)])),default:l(()=>[e("div",Vu,[t(o,{value:$.value.shopAround.min,"onUpdate:value":f[0]||(f[0]=T=>$.value.shopAround.min=T),min:0,controls:!1,precision:0},{addonBefore:l(()=>f[4]||(f[4]=[e("span",null,"最少",-1)])),addonAfter:l(()=>f[5]||(f[5]=[e("span",null,"次",-1)])),_:1},8,["value"]),t(o,{value:$.value.shopAround.max,"onUpdate:value":f[1]||(f[1]=T=>$.value.shopAround.max=T),min:0,controls:!1,precision:0},{addonBefore:l(()=>f[6]||(f[6]=[e("span",null,"最多",-1)])),addonAfter:l(()=>f[7]||(f[7]=[e("span",null,"次",-1)])),_:1},8,["value"])])]),_:1}),t(w,{label:"商品互动"},{default:l(()=>[e("ul",ju,[(i(!0),I(le,null,re(h.value,T=>(i(),I("li",{key:T.key},[t(d,{checked:$.value[T.key],"onUpdate:checked":s=>$.value[T.key]=s},{default:l(()=>[r(M(T.label)+" ",1),T.extra?(i(),I("span",Gu,M(T.extra),1)):R("",!0),t(v(xs),null,{content:l(()=>[e("div",Yu,[(i(!0),I(le,null,re(T.content,(s,y)=>(i(),I("p",{key:y,class:Ks({"text-bold":s.text.includes("注意")})},M(s.text),3))),128))])]),default:l(()=>[t(v(As),{class:"small-icon",onClick:f[2]||(f[2]=ze(s=>{s.preventDefault()},["stop"]))})]),_:2},1024)]),_:2},1032,["checked","onUpdate:checked"])]))),128))])]),_:1})],64)}}}),Os=ve(Wu,[["__scopeId","data-v-6ec65824"]]),Ku={class:"grid-2 grid"},qu=me({name:"PlanTaskTimePicler",__name:"time-picker",props:{beginTime:{default:""},beginTimeModifiers:{},endTime:{default:""},endTimeModifiers:{}},emits:["update:beginTime","update:endTime"],setup(F,{expose:$}){const h=ce(F,"beginTime"),n=ce(F,"endTime");function f(w,d){const T=Se().startOf("day");if(d===0){const y=T.add(7,"days");return w.isBefore(T)?!0:!!w.isAfter(y)}if(w.isBefore(T))return!0;const s=h.value?Se(h.value):null;if(s!==null){const y=s.add(3,"days");if(w.isBefore(s)||!w.isAfter(s)||!w.isBefore(y))return!0}return!1}function o(w){(!n.value||Se(n.value).isBefore(w))&&(n.value=Se(w).endOf("day").format("YYYY-MM-DD HH:mm:ss"))}return $({initDateRange:()=>{const w=Se();h.value=w.format("YYYY-MM-DD HH:mm:ss"),n.value=w.endOf("day").format("YYYY-MM-DD HH:mm:ss")}}),(w,d)=>{const T=Ca,s=ke;return i(),I("div",Ku,[t(s,{label:"开始时间",name:"beginTime"},{default:l(()=>[t(T,{value:h.value,"onUpdate:value":d[0]||(d[0]=y=>h.value=y),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"","disabled-date":y=>f(y,0),onChange:o},null,8,["value","disabled-date"])]),_:1}),t(s,{label:"结束时间",name:"endTime"},{default:l(()=>[t(T,{value:n.value,"onUpdate:value":d[1]||(d[1]=y=>n.value=y),"show-time":"","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"","disabled-date":y=>f(y,1)},null,8,["value","disabled-date"])]),_:1})])}}}),Es=ve(qu,[["__scopeId","data-v-455cfbbe"]]),Ju={class:"mb-12px"},Qu={key:0},Zu={class:"mb-8px"},Xu={class:"wrap flex gap-8px"},er={key:0},tr={key:1},lr={key:2,class:"comment-preview"},sr=["src"],ar={class:"wrap v-center center flex gap-8px"},or=["onClick"],nr={key:3,class:"comment-preview"},ir=["src"],ur={class:"wrap v-center center flex gap-8px"},rr=["onClick"],dr={class:"wrap flex gap-8px"},pr=["src"],cr={class:"wrap v-center center flex gap-8px"},mr={key:1,class:"stop"},vr={class:"text-center"},fr={key:0,class:"preview uploder"},gr=["src"],_r={class:"wrap v-center center flex gap-8px"},kr={key:1,class:"stop"},br={class:"text-center"},yr={class:"video"},wr=["src","type"],xr=me({name:"PlanTaskComment",__name:"again-product-comment",props:{products:{default:[]},productsModifiers:{}},emits:["update:products"],setup(F,{expose:$}){const h=de(null),n=de(null),{formRef:f,resetFields:o}=Ee(),w=ce(F,"products"),d=de(s()),T=st(()=>d.value.images.length+d.value.videos.length===9);ge(w,p=>{if(p&&p.length){const g=p.map(U=>{const V={...U};return(!V.comment||!V.comment.hasComment)&&(V.comment=y()),V}),B=p.map(U=>U.id);d.value.products=d.value.products.filter(U=>B.includes(U.id));for(const U of g){const V=d.value.products.findIndex(ee=>ee.id===U.id);V>-1?Object.assign(d.value.products[V],U):d.value.products.push(U)}}else d.value.products=[]},{deep:!0});function s(){return{products:[],visible:!1,index:-1,title:"",text:"",images:[],videos:[],preview:{visible:!1,src:"",type:""}}}function y(){return{hasComment:!1,text:"",images:[],videos:[]}}function Y(p,g){d.value.index=p,d.value.title=`商品：${g.title}`,d.value.visible=!0}function C(p){d.value.products[p].comment=y()}function D(){var p;!T.value&&d.value.videos.length<9&&((p=h.value)==null||p.click())}function E(){var p;!T.value&&d.value.videos.length===0&&((p=n.value)==null||p.click())}function _(p){try{if(p.target.files&&p.target.files.length)for(const g of p.target.files){if(T.value)break;const B={src:URL.createObjectURL(g),file:g,visible:!1};d.value.images.push(B)}}finally{h.value.value=""}}async function O(p){var g,B;if(p.target.files&&p.target.files.length)try{const U=await Is(p.target.files[0]);if(U.isFileSizeOver(5)){(g=window.$message)==null||g.warning("文件过大，请更换文件"),U.dispose();return}if(U.duration>15){(B=window.$message)==null||B.warning("视频时长不能超过15秒"),U.dispose();return}d.value.videos.push({file:U.file,size:U.sizeText,preview:U.thumbnail,src:U.src})}finally{n.value.value=""}}function b(p){d.value.images.splice(p,1)}function K({src:p,type:g}){d.value.preview.visible=!0,d.value.preview.src=p,d.value.preview.type=g}async function S(){w.value[d.value.index].comment={hasComment:!0,mode:0,text:d.value.text,images:d.value.images.map(p=>({file:p.file,src:p.src})),videos:d.value.videos.map(p=>({file:p.file,preview:p.preview,src:p.src,type:p.type}))},d.value.visible=!1,we(()=>{d.value.text="",d.value.images=[],d.value.videos=[]})}return $({initComment:()=>{o(),d.value=s()}}),(p,g)=>{const B=pe,U=Fe,V=Ds,ee=ue,N=Le,m=Rs,G=Ms,A=vt,J=ke,Z=xe,q=$e,P=Pe;return i(),I(le,null,[e("div",Ju,[g[12]||(g[12]=e("p",{class:"form-label mb-12px"},"商品评价",-1)),t(G,{"item-layout":"vertical","data-source":d.value.products},{renderItem:l(({item:a,index:L})=>[(i(),x(m,{key:a.id},{actions:l(()=>[a.comment.hasComment?(i(),x(N,{key:0,title:"确认删除吗？",placement:"top",onConfirm:()=>C(L)},{default:l(()=>[t(ee,{size:"small",danger:""},{default:l(()=>g[10]||(g[10]=[r("删除评价")])),_:1})]),_:2},1032,["onConfirm"])):(i(),x(ee,{key:1,size:"small",onClick:u=>Y(L,a)},{default:l(()=>g[11]||(g[11]=[r("添加评价")])),_:2},1032,["onClick"]))]),default:l(()=>[t(V,{description:a.skuList.join(";")||"-"},{title:l(()=>[e("p",null,[a.main?(i(),x(B,{key:0,color:"purple"},{default:l(()=>g[7]||(g[7]=[r("主商品")])),_:1})):R("",!0),r(" "+M(a.title),1)])]),avatar:l(()=>[t(U,{height:"60px",width:"60px",src:a.image,fallback:v(Me)},null,8,["src","fallback"])]),_:2},1032,["description"]),a.comment.hasComment?(i(),I("div",Qu,[e("p",Zu,M(a.comment.text),1),e("div",Xu,[a.comment.images&&a.comment.images.length?(i(),I("div",er,[(i(!0),I(le,null,re(a.comment.images,u=>(i(),I("div",{key:u,class:"comment-preview"},[t(U,{src:u.src,height:80,width:80},null,8,["src"])]))),128))])):a.comment.imageUrls&&a.comment.imageUrls.length?(i(),I("div",tr,[(i(!0),I(le,null,re(a.comment.imageUrls,u=>(i(),I("div",{key:u,class:"comment-preview"},[t(U,{src:u,height:80,width:80},null,8,["src"])]))),128))])):R("",!0),a.comment.videos&&a.comment.videos.length?(i(),I("div",lr,[e("img",{src:a.comment.videos[0].preview,height:80,width:80},null,8,sr),e("div",ar,[e("p",{onClick:()=>K(a.comment.videos[0])},[t(v(Ue)),g[8]||(g[8]=r(" 预览 "))],8,or)])])):a.comment.videoUrls&&a.comment.videoUrls.length?(i(),I("div",nr,[e("img",{src:a.comment.videoUrls[0],height:80,width:80},null,8,ir),e("div",ur,[e("p",{onClick:()=>K(a.comment.videoUrls[0])},[t(v(Ue)),g[9]||(g[9]=r(" 预览 "))],8,rr)])])):R("",!0)])])):R("",!0)]),_:2},1024))]),_:1},8,["data-source"])]),t(P,{open:d.value.visible,"onUpdate:open":g[4]||(g[4]=a=>d.value.visible=a),title:d.value.title,width:800},{footer:l(()=>[t(q,{size:16},{default:l(()=>[t(ee,{onClick:g[3]||(g[3]=()=>d.value.visible=!1)},{default:l(()=>g[17]||(g[17]=[r("取消")])),_:1}),t(ee,{type:"primary",onClick:S},{default:l(()=>g[18]||(g[18]=[r("确定")])),_:1})]),_:1})]),default:l(()=>[t(Z,{ref_key:"formRef",ref:f,name:"operate",layout:"vertical",model:d.value},{default:l(()=>[t(J,{label:"文字",name:"text"},{default:l(()=>[t(A,{value:d.value.text,"onUpdate:value":g[0]||(g[0]=a=>d.value.text=a),"auto-size":{minRows:6},"show-count":"",maxlength:300,placeholder:"请输入文字评价"},null,8,["value"])]),_:1}),t(J,null,{label:l(()=>g[13]||(g[13]=[e("p",null,[r(" 图片 "),e("small",{class:"text-danger ml-4px"},"* 图片+视频最多9个，且图片必须小于2.1M")],-1)])),default:l(()=>[e("input",{ref_key:"imageUploadRef",ref:h,type:"file",accept:"image/jpeg,image/png",class:"upload-hidden",multiple:"",onChange:_},null,544),e("div",dr,[d.value.images.length?(i(),x(hs,{key:0,tag:"ul",name:"list",class:"wrap flex gap-8px"},{default:l(()=>[(i(!0),I(le,null,re(d.value.images,(a,L)=>(i(),I("li",{key:a.src,class:"preview uploder"},[t(U,{width:200,preview:{visible:a.visible,onVisibleChange:u=>a.visible=u},src:a.src},null,8,["preview","src"]),e("img",{src:a.src},null,8,pr),e("div",cr,[t(v(Ue),{onClick:u=>a.visible=!0},null,8,["onClick"]),t(v(Be),{onClick:u=>b(L)},null,8,["onClick"])])]))),128))]),_:1})):R("",!0),d.value.images.length<9&&!T.value?(i(),I("div",{key:1,class:"uploder center v-center flex",onClick:D},[d.value.images.length<9&&!T.value?(i(),x(v(Re),{key:0})):d.value.images.length<9?(i(),I("div",mr,[e("p",vr,[t(v(tt))]),g[14]||(g[14]=e("p",{class:"text-center"},"数量已上限",-1))])):R("",!0)])):R("",!0)])]),_:1}),t(J,{name:"videos"},{label:l(()=>g[15]||(g[15]=[e("p",null,[r(" 视频 "),e("small",{class:"text-danger ml-4px"},"* 视频最多一个，且视频时长不能超过15秒")],-1)])),default:l(()=>[e("input",{ref_key:"videoUploadRef",ref:n,type:"file",accept:"video/*",class:"upload-hidden",onChange:O},null,544),d.value.videos.length?(i(),I("div",fr,[e("img",{src:d.value.videos[0].preview},null,8,gr),e("div",_r,[t(v(Ue),{onClick:g[1]||(g[1]=()=>K(d.value.videos[0]))}),t(v(Be),{onClick:g[2]||(g[2]=()=>d.value.videos=[])})])])):R("",!0),d.value.videos.length?R("",!0):(i(),I("div",{key:1,class:"uploder center v-center flex",onClick:E},[d.value.videos.length===0&&!T.value?(i(),x(v(Re),{key:0})):d.value.videos.length===0?(i(),I("div",kr,[e("p",br,[t(v(tt))]),g[16]||(g[16]=e("p",{class:"text-center"},"数量已上限",-1))])):R("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),(i(),x(Cs,{to:"body"},[t(pt,{name:"fade",mode:"out-in"},{default:l(()=>[d.value.preview.visible?(i(),I("div",{key:0,class:"file-preview center v-center flex",onClick:g[6]||(g[6]=a=>d.value.preview.visible=!1)},[e("div",yr,[e("video",{controls:"",autoplay:"",onClick:g[5]||(g[5]=ze(()=>{},["stop"]))},[e("source",{src:d.value.preview.src,type:d.value.preview.type},null,8,wr)])])])):R("",!0)]),_:1})]))],64)}}}),hr=ve(xr,[["__scopeId","data-v-5a3e5a41"]]),Cr={key:0,class:"line"},$r={class:"line"},Pr={class:"line"},Ar=me({name:"PlanTaskAgreement",__name:"agreement",props:{platform:{}},setup(F){const $=F,h=Oe({dayLimit:2,dayLimitChecked:!0,freeTimeBehaviorChecked:!0,aiScrollChecked:!0,common:!0}),n=f=>{h[f]=!0};return(f,o)=>{const w=at,d=ke;return i(),x(d,{label:"友情提示"},{default:l(()=>[e("div",null,[$.platform===0?(i(),I("div",Cr,[e("p",null,[t(w,{checked:h.aiScrollChecked,"onUpdate:checked":o[0]||(o[0]=T=>h.aiScrollChecked=T),onChange:o[1]||(o[1]=()=>n("aiScrollChecked"))},{default:l(()=>o[12]||(o[12]=[r(" 淘气值＞450 ")])),_:1},8,["checked"])]),e("p",null,[t(w,{checked:h.aiScrollChecked,"onUpdate:checked":o[2]||(o[2]=T=>h.aiScrollChecked=T),onChange:o[3]||(o[3]=()=>n("aiScrollChecked"))},{default:l(()=>o[13]||(o[13]=[r(" 淘龄＞180天 ")])),_:1},8,["checked"])])])):R("",!0),e("div",$r,[e("p",null,[t(w,{checked:h.dayLimitChecked,"onUpdate:checked":o[4]||(o[4]=T=>h.dayLimitChecked=T),onChange:o[5]||(o[5]=()=>n("dayLimitChecked"))},{default:l(()=>[r(" 组网限制日均"+M(h.dayLimit)+"单 ",1)]),_:1},8,["checked"])]),e("p",null,[t(w,{checked:h.freeTimeBehaviorChecked,"onUpdate:checked":o[6]||(o[6]=T=>h.freeTimeBehaviorChecked=T),onChange:o[7]||(o[7]=()=>n("freeTimeBehaviorChecked"))},{default:l(()=>o[14]||(o[14]=[r(" 闲暇时光做动态浏览 ")])),_:1},8,["checked"])])]),e("div",Pr,[e("p",null,[t(w,{checked:h.aiScrollChecked,"onUpdate:checked":o[8]||(o[8]=T=>h.aiScrollChecked=T),onChange:o[9]||(o[9]=()=>n("aiScrollChecked"))},{default:l(()=>o[15]||(o[15]=[r(" AI 判断手指不同滑动 ")])),_:1},8,["checked"])]),e("p",null,[t(w,{checked:h.common,"onUpdate:checked":o[10]||(o[10]=T=>h.common=T),onChange:o[11]||(o[11]=()=>n("common"))},{default:l(()=>o[16]||(o[16]=[r(" 请保持手机常亮，它要每天学习不同使用手机的习惯 ")])),_:1},8,["checked"])])])])]),_:1})}}}),Ns=ve(Ar,[["__scopeId","data-v-a385cc68"]]),Hs=me({name:"PlanTaskExcludeAreaSelect",__name:"exclude-area-select",props:fe({label:{default:"排除地区"},name:{default:"excludeArea"},allowClear:{type:Boolean,default:!0},placeholder:{default:"不排除"}},{value:{default:[]},valueModifiers:{}}),emits:["update:value"],setup(F){const $=fs.SHOW_PARENT,{chinaArea:h}=aa(),n=ce(F,"value"),f=F;return(o,w)=>{const d=fs,T=ke;return i(),x(T,{label:f.label,name:f.name},{default:l(()=>[t(d,{value:n.value,"onUpdate:value":w[0]||(w[0]=s=>n.value=s),"tree-data":v(h),"tree-checkable":"","allow-clear":o.allowClear,"show-checked-strategy":v($),"search-placeholder":f.allowClear,placeholder:f.placeholder},null,8,["value","tree-data","allow-clear","show-checked-strategy","search-placeholder","placeholder"])]),_:1},8,["label","name"])}}}),Ir={class:"chat-panel"},Tr={class:"top-bar"},Sr={class:"section-title"},Ur={class:"message-list"},Fr={class:"message-content"},Mr=me({__name:"fakechat-model",props:{chatMessages:{}},emits:["update:chat-messages"],setup(F,{emit:$}){const h=F,n=$,f=de([...h.chatMessages]);ge(()=>h.chatMessages,s=>{f.value=[...s]});function o(s,y){var D;const Y=s.target,C=Y.value;if(C.length>80){Y.value=f.value[y],Y.dispatchEvent(new Event("input")),(D=window.$message)==null||D.error("每条聊天信息最多不能超过80个字");return}f.value[y]=C,w()}function w(){n("update:chat-messages",[...f.value])}function d(){var s;if(f.value.length>=10){(s=window.$message)==null||s.error("假聊语句最多允许添加十句");return}f.value.push(""),w()}function T(s){f.value.splice(s,1),w()}return(s,y)=>{const Y=ue,C=Ze;return i(),I("div",Ir,[e("div",Tr,[e("p",Sr,[y[2]||(y[2]=r(" 聊天互动 ")),t(v(xs),{placement:"top",trigger:"hover"},{content:l(()=>y[1]||(y[1]=[e("p",{class:"popover-text"},"假聊语句最多允许添加十句每句最多不超过80个字。",-1)])),default:l(()=>[t(v(As),{class:"info-icon",onClick:y[0]||(y[0]=ze(()=>{},["stop","prevent"]))})]),_:1})]),t(Y,{size:"small",type:"primary",ghost:"",class:"add-btn",onClick:d},{icon:l(()=>[t(v(Re))]),default:l(()=>[y[3]||(y[3]=r(" 添加聊天信息 "))]),_:1})]),e("div",Ur,[(i(!0),I(le,null,re(f.value,(D,E)=>(i(),I("div",{key:E,class:"message-item"},[e("div",Fr,[t(C,{value:f.value[E],placeholder:"请输入聊天信息",class:"wide-input",onChange:w,onInput:_=>o(_,E)},null,8,["value","onInput"]),t(Y,{danger:"",size:"small",type:"text",class:"delete-btn",onClick:_=>T(E)},{default:l(()=>[t(v(Be))]),_:2},1032,["onClick"])])]))),128))])])}}}),zs=ve(Mr,[["__scopeId","data-v-85972bf0"]]),Rr={class:"body"},Dr={class:"space-between v-center flex"},Lr={key:0,class:"option-disabled"},Br={key:1},Or={class:"info"},Er={class:"v-center form-inline flex"},Nr={key:3,class:"v-center form-inline flex"},Hr=me({name:"PlanTaskAgainDrawer",__name:"again-drawer",props:fe({rowData:{default:null},userInfo:{},mode:{default:()=>[]},platform:{default:0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:fe(["submitted"],["update:visible"]),setup(F,{emit:$}){const h=Ps(),n=ce(F,"visible"),f=de(null),o=de(null),w=de(null),{formRef:d,validate:T,resetFields:s,validateFields:y}=Ee(),{defaultRequiredRule:Y,createRequiredRule:C}=mt(),D=Oe({loading:!1,spinLoading:!1}),E=F,_=de(S()),O=st({get:()=>_.value.chatMessages,set:N=>{_.value.chatMessages=N}}),b=$,K={mode:Y,shopId:C("请选择店铺"),count:Y,price:Y,pairScope:Y,maxPairProductCount:Y};ge(n,async N=>{if(N){if(s(),_.value=S(),E.rowData){D.spinLoading=!0;try{const{data:m,error:G}=await oa(E.rowData.id);if(G||!(m&&m.code===0)){V();return}m.data.products&&m.data.products.length&&(_.value.multiple=m.data.products.length>1),Object.keys(_.value).forEach(A=>{Object.keys(m.data).includes(A)&&(A==="products"?(_.value.selectedProducts=m.data[A],f.value.setSelectedProducts(m.data[A])):_.value[A]=m.data[A])})}finally{D.spinLoading=!1}}we(()=>{window.scrollTo(0,0),w.value.initDateRange()})}else we(()=>{o.value.initComment(),f.value.initSelectedProducts()})});function S(){return{mode:10,friendId:null,deviceId:null,shopId:"",multiple:!1,multiplePlatform:[E.platform],products:[],chatMessages:[],price:0,count:1,pairScope:0,calculatePairScope:0,maxPairProductCount:0,actions:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,lookPlantingGrass:!0,lookAskEveryone:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0},excludeArea:[],beginTime:"",endTime:""}}function p(){}function g(){_.value.products=[],we(()=>{f.value.initSelectedProducts()})}function B(){y("shopId")}function U(){_.value.products.length||(_.value.price=0);const N=h.createCalculator(0);for(const m of _.value.products){const G=h.createCalculator(m.count).multiply(m.price).getResult();N.add(G)}_.value.price=N.multiply(_.value.count).getResult(),(_.value.pairScope===0||_.value.pairScope===_.value.calculatePairScope)&&(_.value.calculatePairScope=h.createCalculator(_.value.price).multiply(.1).getResult(),_.value.calculatePairScope<10&&(_.value.calculatePairScope=10),_.value.pairScope=_.value.calculatePairScope)}function V(){n.value=!1}async function ee(){var A,J,Z,q,P,a,L;if(await T(),_.value.products.length===0){(A=window.$message)==null||A.warning("请选择要下发任务的商品");return}for(const u of _.value.products)if(u.skuCount>0&&u.skuList.length===0){(J=window.$message)==null||J.warning(`${u.title} 未选择Sku`);return}else if(u.main&&!u.keyword){(Z=window.$message)==null||Z.warning(`${u.title} 商品关键词未填写`);return}else if(u.price===0){(q=window.$message)==null||q.warning(`${u.title} 商品价格必须大于0`);return}else if(u.count===0){(P=window.$message)==null||P.warning(`${u.title} 件数必须大于0`);return}else if(u.scope===0){(a=window.$message)==null||a.warning(`${u.title} 购买差额必须大于0`);return}const N={oldTaskId:E.rowData.id,mode:_.value.mode,shopId:_.value.shopId,shopName:_.value.products[0].shopName,chatMessages:_.value.chatMessages,friendId:_.value.friendId,deviceId:_.value.deviceId,multiplePlatform:_.value.multiplePlatform,products:_.value.products.map(u=>{var ie,k,c;let Q=((ie=u.comment)==null?void 0:ie.hasComment)||!1;Q&&!u.comment.text&&(!u.comment.images||!u.comment.images.length)&&(!u.comment.videos||!u.comment.videos.length)&&(!u.comment.videoUrls||!u.comment.videoUrls.length)&&(!u.comment.imageUrls||!u.comment.imageUrls.length)&&(Q=!1);const j=Q?{mode:u.comment.mode,text:u.comment.text||"",imageUrls:u.comment.imageUrls,images:(k=u.comment.images)==null?void 0:k.map(z=>z.file),videoUrls:u.comment.videoUrls,videos:(c=u.comment.videos)==null?void 0:c.map(z=>z.file)}:null;return{id:u.id,title:u.title,url:u.url,image:u.image,keyword:u.keyword,price:u.price,scope:u.scope,count:u.count,skuList:u.skuList,comment:j,main:u.main}}),pairScope:_.value.pairScope,price:_.value.price,count:_.value.count,maxPairProductCount:_.value.maxPairProductCount,actions:{addCart:_.value.actions.addCart,favorite:_.value.actions.favorite,lookAskEveryone:_.value.actions.lookAskEveryone,lookComment:_.value.actions.lookComment,lookPlantingGrass:_.value.actions.lookPlantingGrass,shopAround:{..._.value.actions.shopAround},useFindBrowse:_.value.actions.useFindBrowse,useFirstBrowse:_.value.actions.useFirstBrowse,useWaitForBuy:_.value.actions.useWaitForBuy},excludeArea:[..._.value.excludeArea],beginTime:_.value.beginTime,endTime:_.value.endTime},{data:m,error:G}=await na(N);D.loading=!0;try{!G&&m&&m.code===0&&((L=window.$message)==null||L.success("保存成功"),b("submitted"),V())}finally{D.loading=!1}}return(N,m)=>{const G=Ye,A=De,J=ke,Z=je,q=xe,P=ue,a=$e,L=Pe;return i(),x(L,{open:n.value,"onUpdate:open":m[17]||(m[17]=u=>n.value=u),title:"快速发布",width:750,push:!1},{footer:l(()=>[t(a,{size:16},{default:l(()=>[t(P,{onClick:V},{default:l(()=>m[28]||(m[28]=[r("取消")])),_:1}),t(P,{type:"primary",disabled:D.spinLoading,loading:D.loading,onClick:ee},{default:l(()=>m[29]||(m[29]=[r(" 保存 ")])),_:1},8,["disabled","loading"])]),_:1})]),default:l(()=>[e("div",Rr,[t(q,{ref_key:"formRef",ref:d,name:"operate",layout:"vertical",model:_.value,rules:K},{default:l(()=>[t(J,{name:"mode",label:"任务模式"},{default:l(()=>[t(A,{value:_.value.mode,"onUpdate:value":m[0]||(m[0]=u=>_.value.mode=u),disabled:"",onChange:p},{default:l(()=>[(i(!0),I(le,null,re(E.mode,u=>(i(),x(G,{key:u.value,value:u.value},{default:l(()=>[e("p",Dr,[e("span",null,M(u.label),1),!E.userInfo.isSettlement&&(u.value===0||u.value===1)?(i(),I("span",Lr," 设置结算收款码后，才可以使用联网配对 ")):(i(),I("span",Br,[e("span",Or,M(E.mode.filter(Q=>Q.value===u.value)[0].info),1)]))])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),_.value.mode===0||_.value.mode===1?(i(),x(J,{key:0,name:"multiplePlatform"},{label:l(()=>m[18]||(m[18]=[e("p",null,[r(" 匹配平台 "),e("small",{class:"text-danger ml-1"},"* 可选择多平台匹配")],-1)])),default:l(()=>[t(A,{value:_.value.multiplePlatform,"onUpdate:value":m[1]||(m[1]=u=>_.value.multiplePlatform=u),mode:"multiple",placeholder:"请选择平台"},{default:l(()=>[(i(!0),I(le,null,re(v(et),u=>(i(),x(G,{key:u.value,value:u.value},{default:l(()=>[r(M(u.label)+"联盟 ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):R("",!0),_.value.mode===1?(i(),x(Ls,{key:1,value:_.value.friend,"onUpdate:value":m[2]||(m[2]=u=>_.value.friend=u)},null,8,["value"])):_.value.mode===20?(i(),x(Bs,{key:2,value:_.value.deviceId,"onUpdate:value":m[3]||(m[3]=u=>_.value.deviceId=u)},null,8,["value"])):R("",!0),t(J,{name:"shopId",label:"任务店铺"},{default:l(()=>[t(ft,{value:_.value.shopId,"onUpdate:value":m[4]||(m[4]=u=>_.value.shopId=u),platform:0,remote:!0,"allow-clear":!0,"show-search":!0,onChange:g},null,8,["value"])]),_:1}),t(zu,{ref_key:"productSelectRef",ref:f,products:_.value.products,"onUpdate:products":m[5]||(m[5]=u=>_.value.products=u),multiple:_.value.multiple,"onUpdate:multiple":m[6]||(m[6]=u=>_.value.multiple=u),"shop-id":_.value.shopId,onShopValidate:B,onSubmitted:U},null,8,["products","multiple","shop-id"]),e("div",Er,[t(J,{name:"count",label:"任务单数"},{default:l(()=>[t(Z,{value:_.value.count,"onUpdate:value":m[7]||(m[7]=u=>_.value.count=u),min:1,max:100,controls:!1,precision:0,onChange:U},{addonAfter:l(()=>m[19]||(m[19]=[e("span",null,"单",-1)])),_:1},8,["value"])]),_:1}),t(J,{name:"price"},{label:l(()=>m[20]||(m[20]=[e("p",null,[r(" 任务总价 "),e("small",{class:"text-danger ml-1"},"* 系统自动计算无需填写")],-1)])),default:l(()=>[t(Z,{value:_.value.price,"onUpdate:value":m[8]||(m[8]=u=>_.value.price=u),min:0,max:99999,controls:!1,precision:2,readonly:""},{addonAfter:l(()=>m[21]||(m[21]=[e("span",null,"元",-1)])),_:1},8,["value"])]),_:1})]),_.value.mode===0||_.value.mode===1?(i(),I("div",Nr,[t(J,{name:"pairScope"},{label:l(()=>m[22]||(m[22]=[e("p",null,[r(" 配对差额 "),e("small",{class:"text-danger ml-1"},"* 与好友任务的价格相差上下浮动值")],-1)])),default:l(()=>[t(Z,{value:_.value.pairScope,"onUpdate:value":m[9]||(m[9]=u=>_.value.pairScope=u),min:0,controls:!1,precision:2},{addonBefore:l(()=>m[23]||(m[23]=[e("span",null,"±",-1)])),addonAfter:l(()=>m[24]||(m[24]=[e("span",null,"元",-1)])),_:1},8,["value"])]),_:1}),t(J,{name:"maxPairProductCount"},{label:l(()=>m[25]||(m[25]=[e("p",null,[r(" 多链接匹配 "),e("small",{class:"text-danger ml-1"},"*范围：0-5，为 0 不限制")],-1)])),default:l(()=>[t(Z,{value:_.value.maxPairProductCount,"onUpdate:value":m[10]||(m[10]=u=>_.value.maxPairProductCount=u),min:0,max:5,controls:!1,precision:0},{addonBefore:l(()=>m[26]||(m[26]=[e("span",null,"允许最大",-1)])),addonAfter:l(()=>m[27]||(m[27]=[e("span",null,"链接数",-1)])),_:1},8,["value"])]),_:1})])):R("",!0),t(Os,{actions:_.value.actions,"onUpdate:actions":m[11]||(m[11]=u=>_.value.actions=u)},null,8,["actions"]),t(zs,{"chat-messages":O.value,"onUpdate:chatMessages":m[12]||(m[12]=u=>O.value=u)},null,8,["chat-messages"]),t(hr,{ref_key:"planTaskCommentRef",ref:o,products:_.value.products,"onUpdate:products":m[13]||(m[13]=u=>_.value.products=u)},null,8,["products"]),t(Hs,{value:_.value.excludeArea,"onUpdate:value":m[14]||(m[14]=u=>_.value.excludeArea=u)},null,8,["value"]),t(Es,{ref_key:"planTaskTimePickerRef",ref:w,"begin-time":_.value.beginTime,"onUpdate:beginTime":m[15]||(m[15]=u=>_.value.beginTime=u),"end-time":_.value.endTime,"onUpdate:endTime":m[16]||(m[16]=u=>_.value.endTime=u)},null,8,["begin-time","end-time"]),t(Ns,{platform:0})]),_:1},8,["model"]),t(Qe,{loading:D.spinLoading},null,8,["loading"])])]),_:1},8,["open"])}}}),zr=ve(Hr,[["__scopeId","data-v-bc487e5c"]]),Vr={class:"space-between v-center mb-12px flex"},jr={class:"products"},Gr={class:"v-center mb-6px flex gap-8px"},Yr=["onClick"],Wr={class:"v-center flex gap-8px"},Kr={class:"products-image"},qr={class:"products-body"},Jr={class:"sku"},Qr={class:"mb-6px"},Zr={class:"v-center flex gap-8px"},Xr={class:"v-center num-container flex gap-8px"},ed={class:"v-center del-btn flex gap-6px"},td={class:"text-center"},ld={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},sd={class:"flex-1"},ad={class:"w-full flex-y-center justify-end gap-12px"},od=me({__name:"product-select",props:fe({shopId:{default:""}},{products:{default:[]},productsModifiers:{},multiple:{type:Boolean,default:!1},multipleModifiers:{}}),emits:fe(["submitted","shopValidate"],["update:products","update:multiple"]),setup(F,{expose:$,emit:h}){const n=ce(F,"products"),f=ce(F,"multiple"),o=de(p()),{tableWrapperRef:w,scrollConfig:d}=We(),{columns:T,data:s,getData:y,getDataByPage:Y,loading:C,mobilePagination:D,searchParams:E,resetSearchParams:_}=Ke({apiFn:B,apiParams:{platform:0,shopId:"",url:"",title:"",itemId:"",pageIndex:1,pageSize:10},columns:U}),{checkedRowKeys:O,rowSelection:b}=qe(s,y),K=F,S=h;ge(()=>o.value.visible,P=>{P||Z()}),ge(O,P=>{if(!f.value&&P.length>1){const a=O.value.at(-1);O.value.splice(0,O.value.length,...a!==void 0?[a]:[]),b.value.selectedRowKeys=[a],b.value.selectedRows=b.value.selectedRows.filter(L=>L.id===a)}}),ge(()=>o.value.products,P=>{var L;for(const u of P){const Q=n.value.findIndex(j=>j.id===u.id);Q>-1?(n.value[Q].skuList=u.selectedSkuMap?JSON.parse(u.selectedSkuMap):[],n.value[Q].keyword=u.keyword,n.value[Q].count=u.count,n.value[Q].price=u.price,n.value[Q].scope=u.scope,n.value[Q].main=u.main):n.value.push({id:u.id,shopName:u.shopName,url:u.url,image:u.image,title:u.title,keyword:u.keyword,skuCount:((L=u.skuMap)==null?void 0:L.length)||0,skuList:u.selectedSkuMap?JSON.parse(u.selectedSkuMap):[],count:u.count,price:u.price,scope:u.scope,main:u.main})}const a=P.map(u=>u.id);n.value=n.value.filter(u=>a.includes(u.id)),S("submitted")},{deep:!0}),Je(()=>{ee()});function p(){return{visible:!1,products:[],loading:!0}}async function g(){if(K.shopId===""||K.shopId==="0"){S("shopValidate");return}o.value.visible=!0;try{E.shopId!==K.shopId&&(o.value.loading=!0,E.shopId=K.shopId,await Y(1))}finally{o.value.loading&&(o.value.loading=!1)}}function B(P){return o.value.visible?Us({...P}):Promise.resolve({code:0,msg:"",data:{count:0,list:[],pageIndex:1,pageSize:10}})}function U(){return[{key:"image",dataIndex:"image",title:"商品主图",width:80,customRender({record:a}){return t("div",{style:"height:64px;width:64px;border-radius:3px;overflow:hidden;"},[t(Fe,{width:64,height:64,src:a.image,fallback:Me},null)])}},{key:"title",dataIndex:"title",title:"商品"},{key:"shopName",dataIndex:"shopName",title:"店铺",width:200}]}function V(){var a;if(!E.url)return;const P=new URL(E.url);if(E.itemId=P.searchParams.get("id")||"",!E.itemId){(a=window.$message)==null||a.warning("商品链接解析失败，请核对链接或手动填写商品Id");return}E.url=`${P.protocol}//${P.host}${P.pathname}?id=${o.value.itemId}`}async function ee(){try{const{data:P,error:a}=await Ss();!a&&P&&P.code===0&&(o.value.shopNameEnum=P.data.list)}catch{}}function N(){we(()=>{var P;!f.value&&o.value.products.length>1&&((P=window.$message)==null||P.warning("只能保留一个商品，请删除其他商品"),f.value=!0)})}function m(P,a){a.main?o.value.products.forEach((L,u)=>L.main=u===P):o.value.products.filter(L=>L.main).length===0&&(a.main=!0)}function G(){const P=b.value.selectedRows.map((a,L)=>({id:a.id,shopName:a.shopName,url:a.url,image:a.image,title:a.title,keyword:"",skuMap:a.skuMap.map(u=>({sku:u.sku,price:u.price,value:JSON.stringify(u.sku),label:u.sku.join("+")})),selectedSkuMap:null,skuList:[],count:1,price:0,scope:10,main:L===0}));if(f.value)for(const a of P)o.value.products.filter(L=>L.id===a.id).length||(a.main=o.value.products.filter(L=>L.main).length===0,o.value.products.push(a));else(o.value.products.length===0||P[0].id!==o.value.products[0].id)&&(o.value.products=[P[0]]);o.value.visible=!1}function A(P){const a=o.value.products[P].skuMap.filter(L=>L.value===o.value.products[P].selectedSkuMap);a&&a.length?o.value.products[P].price=a[0].price:o.value.products[P].price=0}function J(P){o.value.products=o.value.products.filter((a,L)=>L!==P),o.value.products.length&&!o.value.products.filter(a=>a.main).length&&(o.value.products[0].main=!0)}function Z(){O.value=[],b.value.selectedRowKeys=[],b.value.selectedRows=[]}function q(P){var a;P?window.open(P):(a=window.$message)==null||a.warning("该商品没有添加商品链接，无法跳转")}return $({initSelectedProducts:()=>{o.value=p(),Z()}}),(P,a)=>{const L=at,u=Fe,Q=De,j=pe,ie=Ze,k=je,c=_e,z=ue,X=Le,ne=ke,ae=gt,be=it,ye=ut,te=Ge,Ae=xe,Ie=Ve,he=$e,Ne=Pe;return i(),I(le,null,[e("p",Vr,[e("span",null,"商品列表(已选 "+M(o.value.products.length)+" 个)",1),t(L,{checked:f.value,"onUpdate:checked":a[0]||(a[0]=H=>f.value=H),onChange:N},{default:l(()=>a[8]||(a[8]=[r("多商品")])),_:1},8,["checked"])]),e("ul",jr,[(i(!0),I(le,null,re(o.value.products,(H,Ce)=>(i(),I("li",{key:H.id},[e("div",Gr,[f.value?(i(),x(L,{key:0,checked:H.main,"onUpdate:checked":se=>H.main=se,onChange:()=>m(Ce,H)},{default:l(()=>a[9]||(a[9]=[r(" 主商品 ")])),_:2},1032,["checked","onUpdate:checked","onChange"])):R("",!0),e("p",{class:"title",onClick:se=>q(H.url)},M(H.title),9,Yr)]),e("div",Wr,[e("div",Kr,[t(u,{width:100,height:100,src:H.image,fallback:v(Me)},null,8,["src","fallback"])]),e("div",qr,[e("div",Jr,[H.skuMap.length?(i(),x(Q,{key:0,value:H.selectedSkuMap,"onUpdate:value":se=>H.selectedSkuMap=se,options:H.skuMap,placeholder:"请选择商品Sku",onChange:se=>A(Ce)},null,8,["value","onUpdate:value","options","onChange"])):(i(),x(j,{key:1},{default:l(()=>a[10]||(a[10]=[r("该商品无Sku")])),_:1}))]),e("div",Qr,[t(ie,{value:H.keyword,"onUpdate:value":se=>H.keyword=se,placeholder:H.main?"请输入搜索关键词":"没有输入输入关键词则进店查找"},null,8,["value","onUpdate:value","placeholder"])]),e("div",Zr,[e("div",Xr,[t(k,{value:H.price,"onUpdate:value":se=>H.price=se,min:0,max:99999,controls:!1,precision:2},{addonBefore:l(()=>a[11]||(a[11]=[e("span",null,"价格",-1)])),addonAfter:l(()=>a[12]||(a[12]=[e("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"]),t(k,{value:H.count,"onUpdate:value":se=>H.count=se,min:1,max:99999,controls:!1,precision:0},{addonBefore:l(()=>a[13]||(a[13]=[e("span",null,"购买",-1)])),addonAfter:l(()=>a[14]||(a[14]=[e("span",null,"件",-1)])),_:2},1032,["value","onUpdate:value"]),t(k,{value:H.scope,"onUpdate:value":se=>H.scope=se,min:0,max:99999,controls:!1,precision:2},{addonBefore:l(()=>[t(c,{placement:"top"},{title:l(()=>a[15]||(a[15]=[e("span",null,"下单商品时商品单价与填写价格相差符合差额范围内才下单",-1)])),default:l(()=>[a[16]||(a[16]=e("span",null,"浮动差额 ±",-1))]),_:1})]),addonAfter:l(()=>a[17]||(a[17]=[e("span",null,"元",-1)])),_:2},1032,["value","onUpdate:value"])]),e("div",ed,[t(X,{title:"确认删除吗？",placement:"left",onConfirm:()=>J(Ce)},{default:l(()=>[t(z,{danger:"",size:"small"},{default:l(()=>a[18]||(a[18]=[r("删除")])),_:1})]),_:2},1032,["onConfirm"])])])])])]))),128))]),f.value||o.value.products.length===0?(i(),I("div",{key:0,class:"actions mb-12px",onClick:g},[e("p",td,[t(v(Re)),a[19]||(a[19]=r(" 添加商品 "))])])):R("",!0),t(Ne,{open:o.value.visible,"onUpdate:open":a[7]||(a[7]=H=>o.value.visible=H),title:"商品选择",width:800},{footer:l(()=>[t(he,{size:16},{default:l(()=>[t(z,{onClick:a[6]||(a[6]=()=>o.value.visible=!1)},{default:l(()=>a[22]||(a[22]=[r("取消")])),_:1}),t(z,{type:"primary",disabled:v(O).length===0,onClick:G},{default:l(()=>a[23]||(a[23]=[r("确定")])),_:1},8,["disabled"])]),_:1})]),default:l(()=>[e("div",ld,[t(Ae,{model:v(E),"label-col":{span:5,md:7}},{default:l(()=>[t(te,{class:"row",gutter:[16,16],wrap:""},{default:l(()=>[t(ae,{span:12},{default:l(()=>[t(ne,{label:"商品链接",name:"url",class:"m-0"},{default:l(()=>[t(ie,{value:v(E).url,"onUpdate:value":a[1]||(a[1]=H=>v(E).url=H),placeholder:"",onBlur:V},null,8,["value"])]),_:1})]),_:1}),t(ae,{span:12},{default:l(()=>[t(ne,{label:"商品编号",name:"itemId",class:"m-0"},{default:l(()=>[t(ie,{value:v(E).itemId,"onUpdate:value":a[2]||(a[2]=H=>v(E).itemId=H),placeholder:""},null,8,["value"])]),_:1})]),_:1}),t(ae,{span:12},{default:l(()=>[t(ne,{label:"商品名称",name:"title",class:"m-0"},{default:l(()=>[t(ie,{value:v(E).title,"onUpdate:value":a[3]||(a[3]=H=>v(E).title=H),placeholder:""},null,8,["value"])]),_:1})]),_:1}),e("div",sd,[t(ne,{class:"m-0"},{default:l(()=>[e("div",ad,[t(z,{onClick:a[4]||(a[4]=H=>v(_)())},{icon:l(()=>[t(be,{class:"align-sub text-icon"})]),default:l(()=>[a[20]||(a[20]=e("span",{class:"ml-8px"},"重置",-1))]),_:1}),t(z,{type:"primary",ghost:"",onClick:a[5]||(a[5]=H=>v(Y)(1))},{icon:l(()=>[t(ye,{class:"align-sub text-icon"})]),default:l(()=>[a[21]||(a[21]=e("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"]),t(Ie,{ref_key:"tableWrapperRef",ref:w,columns:v(T),"data-source":v(s),size:"small","row-selection":v(b),scroll:v(d),loading:v(C),"row-key":"id",pagination:v(D),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),t(Qe,{loading:o.value.loading},null,8,["loading"])])]),_:1},8,["open"])],64)}}}),nd=ve(od,[["__scopeId","data-v-2864bd6e"]]),id={class:"mb-12px"},ud={key:0},rd={class:"mb-8px"},dd={class:"wrap flex gap-8px"},pd={key:0,class:"comment-preview"},cd=["src"],md={class:"wrap v-center center flex gap-8px"},vd=["onClick"],fd={class:"wrap flex gap-8px"},gd=["src"],_d={class:"wrap v-center center flex gap-8px"},kd={key:1,class:"stop"},bd={class:"text-center"},yd={key:0,class:"preview uploder"},wd=["src"],xd={class:"wrap v-center center flex gap-8px"},hd={key:1,class:"stop"},Cd={class:"text-center"},$d={class:"video"},Pd=["src","type"],Ad=me({name:"PlanTaskComment",__name:"product-comment",props:{products:{default:[]},productsModifiers:{}},emits:["update:products"],setup(F,{expose:$}){const h=de(null),n=de(null),{formRef:f,resetFields:o}=Ee(),w=ce(F,"products"),d=de(s()),T=st(()=>d.value.images.length+d.value.videos.length===6);ge(w,p=>{if(p&&p.length){const g=p.map(U=>{const V={...U};return(!V.comment||!V.comment.hasComment)&&(V.comment=y()),V}),B=p.map(U=>U.id);d.value.products=d.value.products.filter(U=>B.includes(U.id));for(const U of g){const V=d.value.products.findIndex(ee=>ee.id===U.id);V>-1?Object.assign(d.value.products[V],U):d.value.products.push(U)}}else d.value.products=[]},{deep:!0});function s(){return{products:[],visible:!1,index:-1,title:"",text:"",images:[],videos:[],preview:{visible:!1,src:"",type:""}}}function y(){return{hasComment:!1,text:"",images:[],videos:[]}}function Y(p,g){d.value.index=p,d.value.title=`商品：${g.title}`,d.value.visible=!0}function C(p){d.value.products[p].comment=y()}function D(){var p;!T.value&&d.value.videos.length<6&&((p=h.value)==null||p.click())}function E(){var p;!T.value&&d.value.videos.length===0&&((p=n.value)==null||p.click())}function _(p){try{if(p.target.files&&p.target.files.length)for(const g of p.target.files){if(T.value)break;const B={src:URL.createObjectURL(g),file:g,visible:!1};d.value.images.push(B)}}finally{h.value.value=""}}async function O(p){var g,B;if(p.target.files&&p.target.files.length)try{const U=await Is(p.target.files[0]);if(U.isFileSizeOver(5)){(g=window.$message)==null||g.warning("文件过大，请更换文件"),U.dispose();return}if(U.duration<5||U.duration>15){(B=window.$message)==null||B.warning("视频时长需要在5-15秒之间"),U.dispose();return}d.value.videos.push({file:U.file,size:U.sizeText,preview:U.thumbnail,src:U.src})}finally{n.value.value=""}}function b(p){d.value.images.splice(p,1)}function K({src:p,type:g}){d.value.preview.visible=!0,d.value.preview.src=p,d.value.preview.type=g}async function S(){w.value[d.value.index].comment={hasComment:!0,mode:0,text:d.value.text,images:d.value.images.map(p=>({file:p.file,src:p.src})),videos:d.value.videos.map(p=>({file:p.file,preview:p.preview,src:p.src,type:p.type}))},d.value.visible=!1,we(()=>{d.value.text="",d.value.images=[],d.value.videos=[]})}return $({initComment:()=>{o(),d.value=s()}}),(p,g)=>{const B=pe,U=Fe,V=Ds,ee=ue,N=Le,m=Rs,G=Ms,A=vt,J=ke,Z=xe,q=$e,P=Pe;return i(),I(le,null,[e("div",id,[g[11]||(g[11]=e("p",{class:"form-label mb-12px"},"商品评价",-1)),t(G,{"item-layout":"vertical","data-source":d.value.products},{renderItem:l(({item:a,index:L})=>[(i(),x(m,{key:a.id},{actions:l(()=>[a.comment.hasComment?(i(),x(N,{key:0,title:"确认删除吗？",placement:"top",onConfirm:()=>C(L)},{default:l(()=>[t(ee,{size:"small",danger:""},{default:l(()=>g[9]||(g[9]=[r("删除评价")])),_:1})]),_:2},1032,["onConfirm"])):(i(),x(ee,{key:1,size:"small",onClick:u=>Y(L,a)},{default:l(()=>g[10]||(g[10]=[r("添加评价")])),_:2},1032,["onClick"]))]),default:l(()=>[t(V,{description:a.skuList.join(";")||"-"},{title:l(()=>[e("p",null,[a.main?(i(),x(B,{key:0,color:"purple"},{default:l(()=>g[7]||(g[7]=[r("主商品")])),_:1})):R("",!0),r(" "+M(a.title),1)])]),avatar:l(()=>[t(U,{height:"60px",width:"60px",src:a.image,fallback:v(Me)},null,8,["src","fallback"])]),_:2},1032,["description"]),a.comment.hasComment?(i(),I("div",ud,[e("p",rd,M(a.comment.text),1),e("div",dd,[(i(!0),I(le,null,re(a.comment.images,u=>(i(),I("div",{key:u,class:"comment-preview"},[t(U,{src:u.src,height:80,width:80},null,8,["src"])]))),128)),a.comment.videos.length?(i(),I("div",pd,[e("img",{src:a.comment.videos[0].preview,height:80,width:80},null,8,cd),e("div",md,[e("p",{onClick:()=>K(a.comment.videos[0])},[t(v(Ue)),g[8]||(g[8]=r(" 预览 "))],8,vd)])])):R("",!0)])])):R("",!0)]),_:2},1024))]),_:1},8,["data-source"])]),t(P,{open:d.value.visible,"onUpdate:open":g[4]||(g[4]=a=>d.value.visible=a),title:d.value.title,width:800},{footer:l(()=>[t(q,{size:16},{default:l(()=>[t(ee,{onClick:g[3]||(g[3]=()=>d.value.visible=!1)},{default:l(()=>g[16]||(g[16]=[r("取消")])),_:1}),t(ee,{type:"primary",onClick:S},{default:l(()=>g[17]||(g[17]=[r("确定")])),_:1})]),_:1})]),default:l(()=>[t(Z,{ref_key:"formRef",ref:f,name:"operate",layout:"vertical",model:d.value},{default:l(()=>[t(J,{label:"文字",name:"text"},{default:l(()=>[t(A,{value:d.value.text,"onUpdate:value":g[0]||(g[0]=a=>d.value.text=a),"auto-size":{minRows:6},"show-count":"",maxlength:300,placeholder:"请输入文字评价"},null,8,["value"])]),_:1}),t(J,null,{label:l(()=>g[12]||(g[12]=[e("p",null,[r(" 图片 "),e("small",{class:"text-danger ml-4px"},"* 图片+视频最多6个，且图片必须小于3M")],-1)])),default:l(()=>[e("input",{ref_key:"imageUploadRef",ref:h,type:"file",accept:"image/jpeg,image/png",class:"upload-hidden",multiple:"",onChange:_},null,544),e("div",fd,[d.value.images.length?(i(),x(hs,{key:0,tag:"ul",name:"list",class:"wrap flex gap-8px"},{default:l(()=>[(i(!0),I(le,null,re(d.value.images,(a,L)=>(i(),I("li",{key:a.src,class:"preview uploder"},[t(U,{width:200,preview:{visible:a.visible,onVisibleChange:u=>a.visible=u},src:a.src},null,8,["preview","src"]),e("img",{src:a.src},null,8,gd),e("div",_d,[t(v(Ue),{onClick:u=>a.visible=!0},null,8,["onClick"]),t(v(Be),{onClick:u=>b(L)},null,8,["onClick"])])]))),128))]),_:1})):R("",!0),d.value.images.length<6&&!T.value?(i(),I("div",{key:1,class:"uploder center v-center flex",onClick:D},[d.value.images.length<6&&!T.value?(i(),x(v(Re),{key:0})):d.value.images.length<6?(i(),I("div",kd,[e("p",bd,[t(v(tt))]),g[13]||(g[13]=e("p",{class:"text-center"},"数量已上限",-1))])):R("",!0)])):R("",!0)])]),_:1}),t(J,{name:"videos"},{label:l(()=>g[14]||(g[14]=[e("p",null,[r(" 视频 "),e("small",{class:"text-danger ml-4px"},"* 视频最多一个，且视频时长必须5-15秒之间")],-1)])),default:l(()=>[e("input",{ref_key:"videoUploadRef",ref:n,type:"file",accept:"video/*",class:"upload-hidden",onChange:O},null,544),d.value.videos.length?(i(),I("div",yd,[e("img",{src:d.value.videos[0].preview},null,8,wd),e("div",xd,[t(v(Ue),{onClick:g[1]||(g[1]=()=>K(d.value.videos[0]))}),t(v(Be),{onClick:g[2]||(g[2]=()=>d.value.videos=[])})])])):R("",!0),d.value.videos.length?R("",!0):(i(),I("div",{key:1,class:"uploder center v-center flex",onClick:E},[d.value.videos.length===0&&!T.value?(i(),x(v(Re),{key:0})):d.value.videos.length===0?(i(),I("div",hd,[e("p",Cd,[t(v(tt))]),g[15]||(g[15]=e("p",{class:"text-center"},"数量已上限",-1))])):R("",!0)]))]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),(i(),x(Cs,{to:"body"},[t(pt,{name:"fade",mode:"out-in"},{default:l(()=>[d.value.preview.visible?(i(),I("div",{key:0,class:"file-preview center v-center flex",onClick:g[6]||(g[6]=a=>d.value.preview.visible=!1)},[e("div",$d,[e("video",{controls:"",autoplay:"",onClick:g[5]||(g[5]=ze(()=>{},["stop"]))},[e("source",{src:d.value.preview.src,type:d.value.preview.type},null,8,Pd)])])])):R("",!0)]),_:1})]))],64)}}}),Id=ve(Ad,[["__scopeId","data-v-5d421f89"]]),Td={class:"body"},Sd={class:"space-between v-center flex"},Ud={key:0,class:"option-disabled"},Fd={key:1},Md={class:"info"},Rd={class:"v-center form-inline flex"},Dd={key:0,class:"v-center form-inline flex"},Ld=me({name:"PlanTaskCreateDrawer",__name:"create-drawer",props:fe({userInfo:{},mode:{default:()=>[]},platform:{default:0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:fe(["submitted"],["update:visible"]),setup(F,{emit:$}){const h=qs(),n=$s(),f=Ps(),o=ce(F,"visible"),w=F,{formRef:d,validate:T,resetFields:s,validateFields:y}=Ee(),{defaultRequiredRule:Y,createRequiredRule:C}=mt(),D=de(null),E=de(null),_=de(null),O=de(!1),b=de(g()),K=st({get:()=>b.value.chatMessages,set:G=>{b.value.chatMessages=G}}),S=$,p={mode:Y,shopId:C("请选择店铺"),friendId:C("请选择好友"),deviceId:C("请选择设备"),count:Y,price:Y,pairScope:Y,maxPairProductCount:Y,multiplePlatform:C("请至少选择一个平台")};ge(o,G=>{G?(s(),b.value=g(),we(()=>{_.value.initDateRange()})):we(()=>{D.value.initSelectedProducts(),E.value.initComment()})});function g(){return{mode:10,friendId:null,deviceId:null,shopId:"",multiple:!1,multiplePlatform:[w.platform],chatMessages:[],products:[],price:0,count:1,pairScope:0,calculatePairScope:0,maxPairProductCount:0,actions:{shopAround:{min:3,max:5},addCart:!1,favorite:!1,lookComment:!0,lookPlantingGrass:!0,lookAskEveryone:!0,useFirstBrowse:!0,useFindBrowse:!0,useWaitForBuy:!0},excludeArea:[],beginTime:"",endTime:""}}function B(G){(G===0||G===1)&&(n.userInfo.isSettlement||(window.$modal.confirm({title:"提示",content:"需要先设置结算收款码，现在去设置吗？",okText:"去设置",cancelText:"取消",onOk:()=>{h.push({name:"user-center",hash:"#settlement"})}}),b.value.mode=10))}function U(){b.value.products=[],we(()=>{D.value.initSelectedProducts()})}function V(){b.value.products.length||(b.value.price=0);const G=f.createCalculator(0);for(const A of b.value.products){const J=f.createCalculator(A.count).multiply(A.price).getResult();G.add(J)}b.value.price=G.multiply(b.value.count).getResult(),(b.value.pairScope===0||b.value.pairScope===b.value.calculatePairScope)&&(b.value.calculatePairScope=f.createCalculator(b.value.price).multiply(.1).getResult(),b.value.calculatePairScope<10&&(b.value.calculatePairScope=10),b.value.pairScope=b.value.calculatePairScope)}function ee(){y("shopId")}function N(){o.value=!1}async function m(){var Z,q,P,a,L,u,Q,j,ie;if(await T(),b.value.products.length===0){(Z=window.$message)==null||Z.warning("请选择要下发任务的商品");return}for(const k of b.value.products){if(k.skuCount>0&&k.skuList.length===0){(q=window.$message)==null||q.warning(`${k.title} 未选择Sku`);return}else if(k.main&&!k.keyword){(P=window.$message)==null||P.warning(`${k.title} 商品关键词未填写`);return}else if(k.price===0){(a=window.$message)==null||a.warning(`${k.title} 商品价格必须大于0`);return}else if(k.count===0){(L=window.$message)==null||L.warning(`${k.title} 件数必须大于0`);return}else if(k.scope===0){(u=window.$message)==null||u.warning(`${k.title} 购买差额必须大于0`);return}if((Q=k.comment)!=null&&Q.hasComment&&!(k.comment.text||k.comment.images&&k.comment.images.length>0||k.comment.videos&&k.comment.videos.length>0)){(j=window.$message)==null||j.warning(`${k.title} 评论内容不能为空（文本/图片/视频至少选一项）`);return}}const G={mode:b.value.mode,platform:0,shopId:b.value.shopId,shopName:b.value.products[0].shopName,friendId:b.value.friendId,deviceId:b.value.deviceId,chatMessages:b.value.chatMessages,multiplePlatform:b.value.multiplePlatform,products:b.value.products.map(k=>{var ae,be,ye,te,Ae,Ie;const c=((ae=k.comment)==null?void 0:ae.hasComment)||!1,z=((be=k.comment)==null?void 0:be.text)||((ye=k.comment)==null?void 0:ye.images)&&k.comment.images.length>0||((te=k.comment)==null?void 0:te.videos)&&k.comment.videos.length>0,ne=c&&z?{hasComment:!0,mode:k.comment.mode,text:k.comment.text||"",images:(Ae=k.comment.images)==null?void 0:Ae.map(he=>he.file),videos:(Ie=k.comment.videos)==null?void 0:Ie.map(he=>he.file)}:null;return{id:k.id,title:k.title,url:k.url,image:k.image,keyword:k.keyword,price:k.price,scope:k.scope,count:k.count,skuList:k.skuList,comment:ne,main:k.main}}),pairScope:b.value.pairScope,price:b.value.price,count:b.value.count,maxPairProductCount:b.value.maxPairProductCount,actions:{addCart:b.value.actions.addCart,favorite:b.value.actions.favorite,lookAskEveryone:b.value.actions.lookAskEveryone,lookComment:b.value.actions.lookComment,lookPlantingGrass:b.value.actions.lookPlantingGrass,shopAround:{...b.value.actions.shopAround},useFindBrowse:b.value.actions.useFindBrowse,useFirstBrowse:b.value.actions.useFirstBrowse,useWaitForBuy:b.value.actions.useWaitForBuy},excludeArea:[...b.value.excludeArea],beginTime:b.value.beginTime,endTime:b.value.endTime,chatMessages:b.value.chatMessages},{data:A,error:J}=await ia(G);O.value=!0;try{!J&&A&&A.code===0&&((ie=window.$message)==null||ie.success("保存成功"),S("submitted"),N())}finally{O.value=!1}}return(G,A)=>{const J=Ye,Z=De,q=ke,P=je,a=xe,L=ue,u=$e,Q=Pe;return i(),x(Q,{open:o.value,"onUpdate:open":A[17]||(A[17]=j=>o.value=j),title:"新增任务",width:750,push:!1},{footer:l(()=>[t(u,{size:16},{default:l(()=>[t(L,{onClick:N},{default:l(()=>A[28]||(A[28]=[r("取消")])),_:1}),t(L,{type:"primary",loading:O.value,onClick:m},{default:l(()=>A[29]||(A[29]=[r("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[e("div",Td,[t(a,{ref_key:"formRef",ref:d,name:"operate",layout:"vertical",model:b.value,rules:p},{default:l(()=>[t(q,{name:"mode",label:"任务模式"},{default:l(()=>[t(Z,{value:b.value.mode,"onUpdate:value":A[0]||(A[0]=j=>b.value.mode=j),onChange:B},{default:l(()=>[(i(!0),I(le,null,re(w.mode,j=>(i(),x(J,{key:j.value,value:j.value},{default:l(()=>[e("p",Sd,[e("span",null,M(j.label),1),!w.userInfo.isSettlement&&(j.value===0||j.value===1)?(i(),I("span",Ud," 设置结算收款码后，才可以使用组网配对 ")):(i(),I("span",Fd,[e("span",Md,M(w.mode.filter(ie=>ie.value===j.value)[0].info),1)]))])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(pt,{name:"flip",mode:"out-in"},{default:l(()=>[b.value.mode===1?(i(),x(Ls,{key:0,value:b.value.friendId,"onUpdate:value":A[1]||(A[1]=j=>b.value.friendId=j)},null,8,["value"])):b.value.mode===20?(i(),x(Bs,{key:1,value:b.value.deviceId,"onUpdate:value":A[2]||(A[2]=j=>b.value.deviceId=j)},null,8,["value"])):R("",!0)]),_:1}),t(q,{name:"shopId",label:"任务店铺"},{default:l(()=>[t(ft,{value:b.value.shopId,"onUpdate:value":A[3]||(A[3]=j=>b.value.shopId=j),platform:0,remote:!0,"allow-clear":!0,"show-search":!0,onChange:U},null,8,["value"])]),_:1}),t(nd,{ref_key:"productSelectRef",ref:D,products:b.value.products,"onUpdate:products":A[4]||(A[4]=j=>b.value.products=j),multiple:b.value.multiple,"onUpdate:multiple":A[5]||(A[5]=j=>b.value.multiple=j),"shop-id":b.value.shopId,onShopValidate:ee,onSubmitted:V},null,8,["products","multiple","shop-id"]),e("div",Rd,[t(q,{name:"count",label:"任务单数"},{default:l(()=>[t(P,{value:b.value.count,"onUpdate:value":A[6]||(A[6]=j=>b.value.count=j),min:1,max:100,controls:!1,precision:0,onChange:V},{addonAfter:l(()=>A[18]||(A[18]=[e("span",null,"单",-1)])),_:1},8,["value"])]),_:1}),t(q,{name:"price"},{label:l(()=>A[19]||(A[19]=[e("p",null,[r(" 任务总价 "),e("small",{class:"text-danger ml-1"},"* 系统自动计算无需填写")],-1)])),default:l(()=>[t(P,{value:b.value.price,"onUpdate:value":A[7]||(A[7]=j=>b.value.price=j),min:0,max:99999,controls:!1,precision:2,readonly:""},{addonAfter:l(()=>A[20]||(A[20]=[e("span",null,"元",-1)])),_:1},8,["value"])]),_:1})]),b.value.mode===0||b.value.mode===1?(i(),I("div",Dd,[t(q,{name:"pairScope"},{label:l(()=>A[21]||(A[21]=[e("p",null,[r(" 配对差额 "),e("small",{class:"text-danger ml-1"},"* 与好友任务的价格相差上下浮动值")],-1)])),default:l(()=>[t(P,{value:b.value.pairScope,"onUpdate:value":A[8]||(A[8]=j=>b.value.pairScope=j),min:0,controls:!1,precision:2},{addonBefore:l(()=>A[22]||(A[22]=[e("span",null,"±",-1)])),addonAfter:l(()=>A[23]||(A[23]=[e("span",null,"元",-1)])),_:1},8,["value"])]),_:1}),b.value.multiple?(i(),x(q,{key:0,name:"maxPairProductCount"},{label:l(()=>A[24]||(A[24]=[e("p",null,[r(" 多链接匹配 "),e("small",{class:"text-danger ml-1"},"*范围：0-5，为 0 不限制")],-1)])),default:l(()=>[t(P,{value:b.value.maxPairProductCount,"onUpdate:value":A[9]||(A[9]=j=>b.value.maxPairProductCount=j),min:0,max:5,controls:!1,precision:0},{addonBefore:l(()=>A[25]||(A[25]=[e("span",null,"允许最大",-1)])),addonAfter:l(()=>A[26]||(A[26]=[e("span",null,"链接数",-1)])),_:1},8,["value"])]),_:1})):R("",!0)])):R("",!0),b.value.mode===0||b.value.mode===1?(i(),x(q,{key:1,name:"multiplePlatform"},{label:l(()=>A[27]||(A[27]=[e("p",null,[r(" 匹配平台 "),e("small",{class:"text-danger ml-1"},"* 可选择多平台匹配")],-1)])),default:l(()=>[t(Z,{value:b.value.multiplePlatform,"onUpdate:value":A[10]||(A[10]=j=>b.value.multiplePlatform=j),mode:"multiple",placeholder:"请选择平台"},{default:l(()=>[(i(!0),I(le,null,re(v(et),j=>(i(),x(J,{key:j.value,value:j.value},{default:l(()=>[r(M(j.label)+"联盟 ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):R("",!0),t(Os,{actions:b.value.actions,"onUpdate:actions":A[11]||(A[11]=j=>b.value.actions=j)},null,8,["actions"]),t(zs,{"chat-messages":K.value,"onUpdate:chatMessages":A[12]||(A[12]=j=>K.value=j)},null,8,["chat-messages"]),t(Id,{ref_key:"planTaskCommentRef",ref:E,products:b.value.products,"onUpdate:products":A[13]||(A[13]=j=>b.value.products=j)},null,8,["products"]),t(Hs,{value:b.value.excludeArea,"onUpdate:value":A[14]||(A[14]=j=>b.value.excludeArea=j)},null,8,["value"]),t(Es,{ref_key:"planTaskTimePickerRef",ref:_,"begin-time":b.value.beginTime,"onUpdate:beginTime":A[15]||(A[15]=j=>b.value.beginTime=j),"end-time":b.value.endTime,"onUpdate:endTime":A[16]||(A[16]=j=>b.value.endTime=j)},null,8,["begin-time","end-time"]),t(Ns,{platform:0})]),_:1},8,["model"])])]),_:1},8,["open"])}}}),Bd=ve(Ld,[["__scopeId","data-v-363a06c1"]]),Od={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ed=me({__name:"import-error-drawer",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:["update:visible"],setup(F){const $=ce(F,"visible"),{tableWrapperRef:h,scrollConfig:n}=We(),{columns:f,data:o,getData:w,loading:d,searchParams:T,mobilePagination:s}=Ke({apiFn:Y,apiParams:{pageIndex:1,pageSize:10},columns:C}),{rowSelection:y}=qe(o,w);function Y(_){return $.value?ua(_):Promise.resolve({code:0,msg:"",data:{count:0,list:[],pageIndex:1,pageSize:10}})}function C(){const _=[{key:"importFileName",dataIndex:"importFileName",title:"导入文件",align:"center"},{key:"exportFileName",dataIndex:"exportFileName",title:"统计报表",align:"center",ellipsis:!0},{key:"createTime",dataIndex:"createTime",title:"导入时间",align:"center",width:200}];return _.push({key:"operate",title:"操作",align:"center",width:140,fixed:"right",customRender:({record:O})=>t("div",{class:"flex-center gap-4px"},[t(_e,{placement:"top",title:"下载报表"},{default:()=>[t(ue,{type:"link",size:"small",onClick:()=>D(O.exportFilePath,O.exportFileName)},{default:()=>[t(ct,null,null)]})]})])}),_}ge(()=>$.value,_=>{_&&w()});async function D(_,O){var b,K;try{const S=`${He}/api/plantask/excel/importerror?filePath=${_}`,p=await fetch(S,{mode:"cors"});if(!p.ok){(b=window.$message)==null||b.error("下载异常");return}const g=await p.blob(),B=document.createElement("a");B.href=URL.createObjectURL(g),B.download=O,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(B.href)}catch(S){(K=window.$message)==null||K.error(`下载失败: ${S}`)}}function E(){$.value=!1}return(_,O)=>{const b=Ge,K=xe,S=Ve,p=ue,g=$e,B=Pe;return i(),x(B,{open:$.value,"onUpdate:open":O[1]||(O[1]=U=>$.value=U),title:"失败统计报表（仅记录任务数据填写错误，不包含终止任务）",width:1e3},{footer:l(()=>[t(g,{size:16},{default:l(()=>[t(p,{onClick:O[0]||(O[0]=()=>E)},{default:l(()=>O[3]||(O[3]=[r("关闭")])),_:1})]),_:1})]),default:l(()=>[e("div",Od,[t(K,{model:v(T),"label-col":{span:5,md:7}},{default:l(()=>[t(b,{class:"row",gutter:[16,16],wrap:""},{default:l(()=>O[2]||(O[2]=[e("div",{class:"flex-1"},null,-1)])),_:1})]),_:1},8,["model"]),t(S,{ref_key:"tableWrapperRef",ref:h,columns:v(f),"data-source":v(o),size:"small",scroll:v(n),loading:v(d),"row-key":"id","row-selection":v(y),pagination:v(s),class:"h-full"},null,8,["columns","data-source","scroll","loading","row-selection","pagination"])])]),_:1},8,["open"])}}}),Nd=ve(Ed,[["__scopeId","data-v-d61577bf"]]),Hd={class:"body"},zd={key:0,class:"upload-box"},Vd={class:"ant-upload-drag-icon"},jd={key:1,class:"upload-box view v-center flex"},Gd={class:"space-between v-center flex"},Yd={key:0,class:"d-wrap v-center center flex flex-col"},ot=1024*1024*5,Wd=me({__name:"import-drawer",props:fe({userInfo:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:fe(["submitted"],["update:visible"]),setup(F,{emit:$}){const{formRef:h,validate:n}=Ee(),f=Oe({submit:!1,spinLoading:!1}),o=ce(F,"visible"),w=de(s()),d=F,T=$;ge(()=>w.value.fileList,()=>{if(w.value.fileList.length){let S=w.value.fileList[0].name;const p=S.includes(".")?S.split(".").pop().toLowerCase():"";S=S.replace(/\.(xls|xlsx|xlsm)$/i,""),S&&p&&(w.value.fileExtension=p,w.value.name=S)}else w.value.name="",w.value.fileExtension=""});function s(){return{fileList:[],percent:0,isStop:!0,importResultL:()=>{},importErrorVisible:!1}}async function y(){var ee;if(w.value.fileList.length===0)return;const S=w.value.fileList[0].originFileObj,p=S.size,g=Math.ceil(p/ot);let B=0,U="";function V(N){const{loaded:m}=N;B+=m;const G=B/p*100,A=Math.round(G);w.value.percent=A>=100?99:A}try{for(let G=0;G<g;G+=1){const A=G*ot,J=Math.min(S.size,A+ot),Z=S.slice(A,J),q={name:w.value.name,chunk:Z,chunkIndex:G,chunkFolder:U,totalSize:S.size,chunkSize:Z.size,totalChunks:g},{data:P,error:a}=await pa(q,V);if(a||!P||P.code!==0)throw new Error("上传失败");U=P.data}const{data:N,error:m}=await ca({name:w.value.name,chunkFolder:U,totalChunks:g,fileExtension:w.value.fileExtension});!m&&N&&N.code===0&&(w.value.filePath=N.data.filePath,w.value.size=N.data.size,w.value.percent=100)}catch(N){throw(ee=window.$message)==null||ee.error("上传文件失败"),N}}function Y(S){if(S==null)return"0";const p=1024,g=p*1024,B=g*1024;let U;return S<p?U=`${S} B`:S<g?U=`${(S/p).toFixed(2)} KB`:S<B?U=`${(S/g).toFixed(2)} MB`:U=`${(S/B).toFixed(2)} GB`,U}async function C(){var S;if(!w.value.filePath&&(!w.value.fileList||!w.value.fileList.length)){o.value=!1;return}await n(),f.submit=!0;try{await y(),(S=window.$message)==null||S.success("正在填入数据,请耐心等待");const{data:p,error:g}=await ra({filePath:w.value.filePath,isStop:w.value.isStop});!g&&p&&p.code===0?(f.spinLoading=!0,D(p.data)):(f.submit=!1,f.spinLoading=!1)}catch{f.submit=!1,f.spinLoading=!1}}function D(S){let p=0;const g=setInterval(async()=>{var V;if(p>100){(V=window.$message)==null||V.error("填入数据失败，请稍后再试"),clearInterval(g),f.submit=!1,f.spinLoading=!1;return}const{data:B,error:U}=await da(S);if(!U&&B&&B.code===0&&B.data.complete){clearInterval(g),f.submit=!1,f.spinLoading=!1,w.value.importResult=B.data,w.value.fileList=[],w.value.filePath="",T("submitted");return}p+=1},3e3)}async function E(S){let p;S?p=d.userInfo.tenantType===20?"多链接任务模版.xlsx":"多链接任务模版(other).xlsx":p=d.userInfo.tenantType===20?"单链接任务模版.xlsx":"单链接任务模版(other).xlsx";const g=He.endsWith("/")?`${He}exceltemplate/plantask/taobao/${p}`:`${He}/exceltemplate/plantask/taobao/${p}`,B=document.createElement("a");B.href=g,B.style.display="none",document.body.appendChild(B),B.click(),document.body.removeChild(B)}function _(){return[...[{key:"rowIndex",dataIndex:"rowIndex",title:"行数",align:"center",width:100},{key:"message",dataIndex:"message",title:"失败原因",align:"center"}]]}function O(){w.value.fileList=[],o.value=!1,f.submit=!1,f.spinLoading=!1,w.value.importErrorVisible=!1}function b(){w.value.importErrorVisible=!0}function K(S){return S?S!=null&&S.stopCount?`${S.fileName}导入结果：共读取${S.count??0} 条，失败 ${S.errorList&&S.errorList.length?S.errorList.length:0} 条，终止 ${S.stopCount} 条`:`${S.fileName}导入结果：共读取${S.count??0} 条，成功 ${S.successCount} 条，失败 ${S.errorList&&S.errorList.length?S.errorList.length:0} 条`:"导入结果：共读取 0 条，失败 0 条"}return(S,p)=>{const g=ue,B=_e,U=ke,V=Ws,ee=Fa,N=Ua,m=xe,G=Ve,A=Ts,J=$e,Z=Pe;return i(),I(le,null,[t(Z,{open:o.value,"onUpdate:open":p[5]||(p[5]=q=>o.value=q),title:"任务导入",width:750,push:!1},{footer:l(()=>[t(J,{size:16},{default:l(()=>[t(g,{onClick:O},{default:l(()=>p[14]||(p[14]=[r("取消")])),_:1}),t(g,{type:"primary",loading:f.submit,onClick:C},{default:l(()=>p[15]||(p[15]=[r("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[e("div",Hd,[t(m,{ref_key:"formRef",ref:h,name:"operate",layout:"vertical",model:w.value},{default:l(()=>[t(U,{label:"导入模版"},{default:l(()=>[t(B,{placement:"top",title:"下载单链接任务导入模版"},{default:l(()=>[t(g,{type:"link",danger:"",onClick:p[0]||(p[0]=q=>E(!1))},{default:l(()=>p[7]||(p[7]=[r("下载单链接模版")])),_:1})]),_:1}),t(B,{placement:"top",title:"下载多链接任务导入模版"},{default:l(()=>[t(g,{type:"link",danger:"",onClick:p[1]||(p[1]=q=>E(!0))},{default:l(()=>p[8]||(p[8]=[r("下载多链接模版")])),_:1})]),_:1})]),_:1}),t(U,{label:"导入模式"},{default:l(()=>[t(V,{value:w.value.isStop,"onUpdate:value":p[2]||(p[2]=q=>w.value.isStop=q),options:[{value:!0,label:"发现错误数据，停止导入"},{value:!1,label:"跳过错误数据，直接导入"}]},null,8,["value"])]),_:1}),t(U,{label:"导入文件"},{default:l(()=>[t(N,{"file-list":w.value.fileList,"onUpdate:fileList":p[4]||(p[4]=q=>w.value.fileList=q),class:"upload","before-upload":()=>!1,name:"file",accept:".xls,.xlsx,applications/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","show-upload-list":!1},{default:l(()=>[w.value.fileList.length===0?(i(),I("div",zd,[e("p",Vd,[t(v(Sa))]),p[9]||(p[9]=e("p",{class:"ant-upload-text"},"请选择任务文件",-1)),p[10]||(p[10]=e("p",{class:"ant-upload-hint"},"支持拖拽上传，上传期间请不要关闭窗口",-1))])):(i(),I("div",jd,[e("p",Gd,[e("span",null,M(w.value.fileList[0].name),1),e("span",null,M(Y(w.value.fileList[0].size)),1)]),e("div",{class:"d-wrap v-center center del flex",onClick:ze(()=>{},["stop"])},[t(g,{danger:"",onClick:p[3]||(p[3]=ze(()=>w.value.fileList=[],["stop"]))},{default:l(()=>p[11]||(p[11]=[r("删除")])),_:1})]),f.submit?(i(),I("div",Yd,[t(ee,{type:"circle",percent:w.value.percent,size:80},null,8,["percent"]),p[12]||(p[12]=e("p",null,"文件上传中，请勿关闭窗口",-1))])):R("",!0)]))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"]),t(A,{title:K(w.value.importResult),bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"mt-18px flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[t(B,{placement:"top",title:"下载失败报表"},{default:l(()=>[t(g,{onClick:b},{default:l(()=>p[13]||(p[13]=[r("下载失败报表")])),_:1})]),_:1})]),default:l(()=>[w.value.importResult?(i(),x(G,{key:0,columns:_(),pagination:{total:w.value.importResult.errorList.length,showSizeChanger:!0},"data-source":w.value.importResult.errorList,scroll:{y:500}},null,8,["columns","pagination","data-source"])):R("",!0)]),_:1},8,["title"])]),t(Qe,{loading:f.spinLoading,tip:"正在导入数据，请勿关闭窗口"},null,8,["loading"])]),_:1},8,["open"]),t(Nd,{visible:w.value.importErrorVisible,"onUpdate:visible":p[6]||(p[6]=q=>w.value.importErrorVisible=q)},null,8,["visible"])],64)}}}),Kd=ve(Wd,[["__scopeId","data-v-18aa8bc6"]]),qd={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Jd=me({__name:"account-drawer",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:["update:visible"],setup(F){const $=ce(F,"visible"),{tableWrapperRef:h,scrollConfig:n}=We(),{columns:f,data:o,getData:w,loading:d,searchParams:T,mobilePagination:s}=Ke({apiFn:Y,apiParams:{pageIndex:1,pageSize:10},columns:C}),{rowSelection:y}=qe(o,w);function Y(_){return $.value?ma(_):Promise.resolve({code:0,msg:"",data:{count:0,list:[],pageIndex:1,pageSize:10}})}function C(){const _=[{key:"importFileName",dataIndex:"importFileName",title:"导入文件",align:"center"},{key:"exportFileName",dataIndex:"exportFileName",title:"统计报表",align:"center",ellipsis:!0},{key:"createTime",dataIndex:"createTime",title:"导入时间",align:"center",width:200}];return _.push({key:"operate",title:"操作",align:"center",width:140,fixed:"right",customRender:({record:O})=>t("div",{class:"flex-center gap-4px"},[t(_e,{placement:"top",title:"下载报表"},{default:()=>[t(ue,{type:"link",size:"small",onClick:()=>D(O.exportFilePath,O.exportFileName)},{default:()=>[t(ct,null,null)]})]})])}),_}ge(()=>$.value,_=>{_&&w()});async function D(_,O){var b,K;try{const S=`${He}/api/plantask/excel/account?filePath=${_}`,p=await fetch(S,{mode:"cors"});if(!p.ok){(b=window.$message)==null||b.error("下载异常");return}const g=await p.blob(),B=document.createElement("a");B.href=URL.createObjectURL(g),B.download=O,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(B.href)}catch(S){(K=window.$message)==null||K.error(`下载失败: ${S}`)}}function E(){$.value=!1}return(_,O)=>{const b=Ge,K=xe,S=Ve,p=ue,g=$e,B=Pe;return i(),x(B,{open:$.value,"onUpdate:open":O[1]||(O[1]=U=>$.value=U),title:"金额统计报表",width:1e3},{footer:l(()=>[t(g,{size:16},{default:l(()=>[t(p,{onClick:O[0]||(O[0]=()=>E)},{default:l(()=>O[3]||(O[3]=[r("关闭")])),_:1})]),_:1})]),default:l(()=>[e("div",qd,[t(K,{model:v(T),"label-col":{span:5,md:7}},{default:l(()=>[t(b,{class:"row",gutter:[16,16],wrap:""},{default:l(()=>O[2]||(O[2]=[e("div",{class:"flex-1"},null,-1)])),_:1})]),_:1},8,["model"]),t(S,{ref_key:"tableWrapperRef",ref:h,columns:v(f),"data-source":v(o),size:"small",scroll:v(n),loading:v(d),"row-key":"id","row-selection":v(y),pagination:v(s),class:"h-full"},null,8,["columns","data-source","scroll","loading","row-selection","pagination"])])]),_:1},8,["open"])}}}),Qd=ve(Jd,[["__scopeId","data-v-a08002fc"]]),Zd={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Xd={class:"my-12px"},ep={key:0,class:"mb-12px"},tp={key:1,class:"mb-12px"};function lp(F){return typeof F=="function"||Object.prototype.toString.call(F)==="[object Object]"&&!Js(F)}const sp=me({name:"taobao_task",__name:"index",setup(F){const $=$s(),h=Qs(),{tableWrapperRef:n,scrollConfig:f}=We(),o=Oe({switch:{id:"",loading:!1},createVisible:!1,againLoading:!1,detailVisible:!1,againVisible:!1,accountVisible:!1,completionVisible:!1,editRow:{},exportLoading:!1,startConfirmVisible:!1}),{columns:w,columnChecks:d,data:T,getData:s,getDataByPage:y,loading:Y,mobilePagination:C,searchParams:D,resetSearchParams:E}=Ke({apiFn:(...k)=>ka(...k),apiParams:{pageIndex:1,pageSize:10},columns:V}),{onBatchDeleted:_,onDeleted:O,checkedRowKeys:b,rowSelection:K}=qe(T,s);Je(()=>{D.platform=0,S()});async function S(){try{const{data:k,error:c}=await fetchGetALIShopName();!c&&k&&k.code===0&&(o.shopNameEnum=k.data.list)}catch{}}async function p(k){const{data:c,error:z}=await _s([k]);!z&&c&&c.code===0&&O()}async function g(){const k=b.value;if(k&&k.length){const{data:c,error:z}=await _s(k);!z&&c&&c.code===0&&_()}}async function B(k){var ne;let c=[];k&&k.length?c=k:b.value.length>0?c=b.value:c=void 0;const{data:z,error:X}=await fa(c);!X&&z&&z.code===0&&((ne=window.$message)==null||ne.success("任务开始匹配"),await s())}function U(k){o.editRow=k,o.againVisible=!0}function V(){const k=[{key:"title",dataIndex:"title",title:"任务商品",width:500,ellipsis:!0,customRender:({record:c})=>{let z=Xe.filter(ae=>ae.value===c.mode);z=z.length?z[0]:{label:"未知",value:c.mode,color:""};let X=et.filter(ae=>ae.value===c.platform);X=X.length?X[0]:{label:"未知",value:c.platform,color:""};function ne(){return c.mode===0||c.mode!==20&&(c.status===0||c.status===10)?"":c.deviceId!=="0"?c.deviceName?t(pe,{color:"cyan",onClick:()=>nt(c.deviceId),style:"cursor:pointer;"},{default:()=>[r("执行设备："),c.deviceName,r(" ("),c.deviceId,r(")")]}):t(pe,{color:"error"},{default:()=>[r("执行设备：设备已删除")]}):t(pe,{color:"error"},{default:()=>[r("执行设备：未分配")]})}return t("div",{class:"plantask-product"},[t("div",{class:"v-center flex gap-10px"},[t(pe,{color:"default",style:"cursor:pointer;",onClick:()=>nt(c.id)},{default:()=>[r("任务编号："),c.id]}),t(pe,{color:z.color},{default:()=>[r("任务模式："),z.label]}),ne()]),t("div",{class:"flex"},[t("div",{class:"plantask-image"},[t(Fe,{width:120,height:120,src:c.image,fallback:Me},null)]),t("div",{class:"plantask-info"},[t("div",{class:"plantask-title v-center flex"},[t(pe,{color:X.color},{default:()=>[r("TB联盟")]}),t(_e,{placement:"top",title:c.title},{default:()=>[t("a",{href:c.productUrl,target:"_blank"},[c.title])]})]),t("p",{class:"plantask-shop"},[t("span",{class:"label"},[r("店铺名称：")]),c.shopName]),t("p",{class:"plantask-sku v-center flex"},[t("span",{class:"label"},[r("任务SKU：")]),J(c.skuList)]),t("div",{class:"v-center flex gap-10px"},[t("p",{class:"plantask-price f-12px"},[t("span",{class:"label"},[r("商品单价：")]),t("span",null,[Z(c.price)])]),t("p",{class:"f-12px"},[t("span",{class:"label"},[r("购买件数：")]),t("span",null,[r("x "),c.count])]),t("p",{class:"plantask-price f-12px"},[t("span",{class:"label"},[r("商品总价：")]),t("span",null,[Z(c.totalPrice,!0)])])]),t("p",{class:"plantask-keyword f-12px"},[t("span",{class:"label"},[r("宝贝排名：")]),t("span",{title:c.ranking||"-"},[c.ranking>0?c.ranking:"-"])]),t("p",{class:"plantask-keyword f-12px",title:`关键词：${c.keyword||""}`},[t("span",{class:"label"},[r("任务关键词：")]),c.keyword])])])])}},{key:"account",dataIndex:"account",title:"任务信息",width:300,ellipsis:!0,customRender:({record:c})=>{let z=c.ip;return z&&c.ipAddress&&(z=`${z} (${c.ipAddress})`),t("div",{style:"font-size:14px"},[t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[r("TB号：")]),t("span",{title:c.account||"-"},[c.account||"-"])]),t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[r("淘龄：")]),t("span",{title:c.age||"-"},[c.age||"-"])]),t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[r("淘气值：")]),t("span",{title:c.taoQi||"-"},[c.taoQi||"-"])]),t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[r("订单号：")]),t("span",{title:c.orderId||"-"},[c.orderId||"-"])]),t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[r("下单IP：")]),t("span",{title:z||"-"},[z||"-"])]),t("p",{class:"mb-6px",style:"display:grid;grid-template-columns:70px 1fr"},[t("span",{class:"text-right"},[r("收货地址：")]),t("span",{title:c.address||"-"},[c.address||"-"])])])}},{key:"success",dataIndex:"success",title:"购买状态",width:100,align:"center",customRender:({record:c})=>c.status>=30?c.success?t(pe,{color:"success"},{default:()=>[r("购买成功")]}):t(pe,{color:"error"},{default:()=>[r("购买失败")]}):"-"},{key:"status",dataIndex:"status",title:"状态",width:100,align:"center",customRender:({record:c})=>{if(c.status===20){const X=ba.filter(ne=>ne.value===c.step);return X&&X.length?t(pe,{color:X[0].color},{default:()=>[X[0].label]}):t(pe,{color:"error"},{default:()=>[r("异常步骤")]})}let z=gs.filter(X=>X.value===c.status);return z=z.length?z[0]:{label:"未知",value:c.platform,color:"error"},c.status===31||c.status===41?t(_e,{placement:"top",title:t("span",null,[c.remark||"程序执行异常"])},{default:()=>[t(pe,{color:z.color},{default:()=>[z.label]})]}):c.status===120?t(_e,{placement:"top",title:t("span",null,["请等待1-2分钟让程序停止运行指令"])},{default:()=>[t(pe,{color:z.color},{default:()=>[z.label]})]}):t(pe,{color:z.color},{default:()=>[z.label]})}},{key:"note",dataIndex:"note",title:"任务备注",width:200,ellipsis:!0},{key:"beginTime",dataIndex:"beginTime",title:"开始时间",align:"center",width:200}];return $.userInfo.isTenant?$.userInfo.isTenant&&!$.userInfo.isTenantUser&&k.push({key:"creator",dataIndex:"creator",title:"创建人",align:"center",width:130}):k.push({key:"creator",dataIndex:"creator",title:"所属商户",align:"center",width:130}),k.push({key:"operate",title:"操作",align:"center",width:140,fixed:"right",customRender:({record:c})=>t("div",{class:"flex-center gap-4px"},[ee(c),A(c),G(c),m(c),N(c)])}),k}function ee(k){return t(_e,{placement:"top",title:"任务详情"},{default:()=>[t(ue,{type:"link",size:"small",onClick:()=>L(k)},{default:()=>[t(Ue,null,null)]})]})}function N(k){if(h.hasOne(Te.Taobao.Task.DELETE)&&$.userInfo.isTenant){if([30,31,40,41,11,20].includes(k.status))return"";if(k.status===0||k.status===10||k.status===100)return t(Le,{title:"确认删除吗？",onConfirm:()=>p(k.id)},{default:()=>[t(_e,{placement:"top",title:"删除"},{default:()=>[t(ue,{danger:!0,size:"small",type:"link"},{default:()=>[t(Be,null,null)]})]})]});if(k.mode===10||k.mode===20)return t(Le,{title:"确认删除吗？",onConfirm:()=>p(k.id)},{default:()=>[t(_e,{placement:"top",title:"删除"},{default:()=>[t(ue,{danger:!0,size:"small",type:"link"},{default:()=>[t(Be,null,null)]})]})]})}return""}function m(k){return h.hasOne(Te.Taobao.Task.UPDATE)&&$.userInfo.isTenant&&k.status===-1?t(Le,{title:"是否将当前任务开始配对?",onConfirm:()=>B([k.id])},{default:()=>[t(_e,{placement:"top",title:"任务开始"},{default:()=>[t(ue,{loading:o.againLoading,type:"link",size:"small"},{default:()=>[t(lt,null,null)]})]})]}):""}function G(k){return h.hasOne(Te.Taobao.Task.CREATE)&&$.userInfo.isTenant&&$.userInfo.tenantType!==20?t(_e,{placement:"top",title:"快速发布"},{default:()=>[t(ue,{loading:o.againLoading,type:"link",size:"small",onClick:()=>U(k)},{default:()=>[t(ya,null,null)]})]}):""}function A(k){return!$.userInfo.isTenant||![30,31,40,41].includes(k.status)?"":t(_e,{placement:"top",title:"任务信息"},{default:()=>[t(ue,{type:"link",size:"small",onClick:()=>u(k)},{default:()=>[t(xa,null,null)]})]})}function J(k){return!k||!k.length?t(pe,null,{default:()=>[r("无SKU")]}):k.map(c=>t(pe,{key:c,color:"processing"},lp(c)?c:{default:()=>[c]}))}function Z(k,c=!1){return t("span",{class:"cny",style:c?"font-weight:600;letter-spacing: 1px;":""},[k])}function q(){o.createVisible=!0}function P(){o.importVisible=!0}function a(){o.accountVisible=!0}function L(k){o.editRow=k,o.detailVisible=!0}function u(k){o.editRow=k,o.completionVisible=!0}async function Q(){var k,c;if(!D.beginTime||!D.endTime){(k=window.$message)==null||k.warning("请选择要下载的订单报表的时间范围");return}if(await y(1),!(T.value.length<=0)){(c=window.$message)==null||c.success("正在生成报表"),o.exportLoading=!0;try{const{data:z,error:X}=await ga({...D});!X&&z&&z.code===0?j(z.data):o.exportLoading=!1}catch{o.exportLoading=!1}}}function j(k){let c=0;const z=setInterval(async()=>{var ae;if(c>100){(ae=window.$message)==null||ae.error("报表导出失败，请稍后再试"),clearInterval(z),o.exportLoading=!1;return}const{data:X,error:ne}=await _a(k);if(!ne&&X&&X.code===0&&X.data.complete){o.exportLoading=!1,clearInterval(z),ie(k);return}c+=1},3e3)}async function ie(k){var c,z;try{const X=await fetch(`${He}/api/plantask/excel/${k}`,{mode:"cors"});X.ok||(c=window.$message)==null||c.error("下载异常");const ne=await X.blob(),ae=document.createElement("a");ae.href=URL.createObjectURL(ne),ae.download=`订单信息报表_${new Date().getTime()}.xlsx`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(ae.href)}catch(X){(z=window.$message)==null||z.error(`下载失败:${X}`)}}return(k,c)=>{const z=ue,X=Vs,ne=Ve,ae=Ts,be=Ma,ye=dt;return i(),I("div",Zd,[t(ku,{model:v(D),"onUpdate:model":c[0]||(c[0]=te=>vs(D)?D.value=te:null),"user-info":v($).userInfo,platform:v(et),mode:v(Xe),"shop-name-enum":o.shopNameEnum,onReset:v(E),onSearch:c[1]||(c[1]=te=>v(y)(1))},null,8,["model","user-info","platform","mode","shop-name-enum","onReset"]),t(ae,{title:"任务列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"plantask flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[t(X,{columns:v(d),"onUpdate:columns":c[4]||(c[4]=te=>vs(d)?d.value=te:null),"disabled-delete":v(b).length===0,loading:v(Y),"add-btn":v($).userInfo.isTenant&&v(h).hasOne(v(Te).Taobao.Task.CREATE),"delete-btn":v($).userInfo.isTenant&&v(h).hasOne(v(Te).Taobao.Task.DELETE),"delete-confirm-text":"仅会删除未开始与配对中的任务，确认删除吗？",onAdd:q,onDelete:g},{default:l(()=>[t(z,{size:"small",ghost:"",type:"primary",class:"v-center flex",disabled:!v(T).length,onClick:c[2]||(c[2]=()=>v(y)())},{icon:l(()=>[t(v(va))]),default:l(()=>[c[17]||(c[17]=e("span",{class:"ml-6px"},"任务进度刷新",-1))]),_:1},8,["disabled"]),t(z,{size:"small",ghost:"",type:"primary",class:"v-center flex",disabled:!v(T).length,loading:o.exportLoading,onClick:Q},{icon:l(()=>[t(v(ct))]),default:l(()=>[c[18]||(c[18]=e("span",{class:"ml-6px"},"下载订单报表",-1))]),_:1},8,["disabled","loading"]),v($).userInfo.isTenant&&v(h).hasOne(v(Te).Taobao.Task.CREATE)&&v($).userInfo.tenantType===20?(i(),x(z,{key:0,size:"small",ghost:"",type:"primary",class:"v-center flex",onClick:P},{icon:l(()=>[t(v(kt))]),default:l(()=>[c[19]||(c[19]=e("span",{class:"ml-6px"},"导入任务",-1))]),_:1})):R("",!0),v($).userInfo.isTenant&&v(h).hasOne(v(Te).Taobao.Task.UPDATE)&&v($).userInfo.tenantType===20?(i(),x(z,{key:1,size:"small",ghost:"",type:"primary",class:"v-center flex",onClick:c[3]||(c[3]=()=>o.startConfirmVisible=!0)},{icon:l(()=>[t(v(lt))]),default:l(()=>[c[20]||(c[20]=e("span",{class:"ml-6px"},"任务开始",-1))]),_:1})):R("",!0),v($).userInfo.isTenant&&v(h).hasOne(v(Te).Taobao.Task.UPDATE)&&v($).userInfo.tenantType===20?(i(),x(z,{key:2,size:"small",ghost:"",type:"primary",class:"v-center flex",onClick:a},{icon:l(()=>[t(v(_t))]),default:l(()=>[c[21]||(c[21]=e("span",{class:"ml-6px"},"金额统计",-1))]),_:1})):R("",!0)]),_:1},8,["columns","disabled-delete","loading","add-btn","delete-btn"])]),default:l(()=>[t(ne,{ref_key:"tableWrapperRef",ref:n,"expanded-row-keys":o.expandedRowKeys,"onUpdate:expandedRowKeys":c[5]||(c[5]=te=>o.expandedRowKeys=te),columns:v(w),"data-source":v(T),size:"small",scroll:v(f),loading:v(Y),"row-key":"id","row-selection":v(K),pagination:v(C),class:"h-full"},null,8,["expanded-row-keys","columns","data-source","scroll","loading","row-selection","pagination"])]),_:1}),t(Bd,{visible:o.createVisible,"onUpdate:visible":c[6]||(c[6]=te=>o.createVisible=te),"user-info":v($).userInfo,mode:v(Xe),onSubmitted:c[7]||(c[7]=te=>v(y)(1))},null,8,["visible","user-info","mode"]),t(cu,{id:o.editRow.id,visible:o.detailVisible,"onUpdate:visible":c[8]||(c[8]=te=>o.detailVisible=te),mode:o.editRow.mode,"plan-task-status":v(gs)},null,8,["id","visible","mode","plan-task-status"]),t(zr,{visible:o.againVisible,"onUpdate:visible":c[9]||(c[9]=te=>o.againVisible=te),"row-data":o.editRow,"user-info":v($).userInfo,mode:v(Xe),onSubmitted:c[10]||(c[10]=te=>v(y)(1))},null,8,["visible","row-data","user-info","mode"]),t(yu,{visible:o.completionVisible,"onUpdate:visible":c[11]||(c[11]=te=>o.completionVisible=te),"row-data":o.editRow,onSubmitted:v(y)},null,8,["visible","row-data","onSubmitted"]),t(Kd,{visible:o.importVisible,"onUpdate:visible":c[12]||(c[12]=te=>o.importVisible=te),"user-info":v($).userInfo,onSubmitted:c[13]||(c[13]=te=>v(y)(1))},null,8,["visible","user-info"]),t(Qd,{visible:o.accountVisible,"onUpdate:visible":c[14]||(c[14]=te=>o.accountVisible=te)},null,8,["visible"]),t(ye,{open:o.startConfirmVisible,"onUpdate:open":c[16]||(c[16]=te=>o.startConfirmVisible=te),title:"任务开始确认",width:"500px"},{footer:l(()=>[t(z,{type:"primary",onClick:B},{default:l(()=>c[24]||(c[24]=[r("确认开始")])),_:1}),t(z,{onClick:c[15]||(c[15]=()=>o.startConfirmVisible=!1)},{default:l(()=>c[25]||(c[25]=[r("取消")])),_:1})]),default:l(()=>[e("div",Xd,[v(b)&&v(b).length?(i(),x(be,{key:0,message:`已选中 ${v(b).length} 个任务`,type:"warning"},null,8,["message"])):(i(),x(be,{key:1,message:"该操作将下发全部准备中任务启动",type:"error"}))]),v($).userInfo.tenantType===20?(i(),I("div",ep,c[22]||(c[22]=[e("p",null,"请确认您已下载了金额统计报表，并且已经给对应账户准备好资金？",-1),e("p",null,"如果未下载，请先下载统计报表、并确认已经给对应账户准备好资金。",-1)]))):(i(),I("div",tp,c[23]||(c[23]=[e("p",null,"是否确定要将所有准备中任务开始配对",-1)])))]),_:1},8,["open"])])}}}),Hp=ve(sp,[["__scopeId","data-v-8c0a213d"]]);export{Hp as default};
