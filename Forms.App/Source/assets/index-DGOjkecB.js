import{_ as $e}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as Re,S as Se,a as Ue,b as Be,T as Ee,u as Pe,c as Me,d as Ve,e as He,f as ee}from"./table-search-filter-oeJAv4cw.js";import{d as V,D as M,E as j,i as Oe,c as R,o as p,w as n,f as e,z as P,e as g,h as l,a7 as te,B as N,M as Ne,r as S,a as se,F as me,g as $,s as pe,b as x,H as ae,P as ne,t as O,q as ze,a8 as le,a9 as J,aa as oe}from"./index-C4fDvJn1.js";import{u as je,A as X}from"./app.permissions-eEP3QY97.js";import{p as ie}from"./index-DiqUFypO.js";import{I as z,i as A}from"./empty-a1btfWut.js";import{c as re}from"./helper-n1q5wElC.js";import{u as qe,F as Le,_ as Ye,I as We}from"./form-C4lsPmD3.js";import{_ as ue}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{_ as Ge}from"./index-Bgjt1Cd5.js";import{R as Ke}from"./dayjs-BBTQ6xGR.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as fe}from"./index-B0OEq9ON.js";import{f as Qe,p as Z,a as de,b as Je,S as Xe,c as Ze}from"./enum-map-plantask-comment-CYh_5MYR.js";import{S as et}from"./index-tKWHzGWZ.js";import{C as tt}from"./index-CfF1NG6B.js";import{D as st}from"./DeleteOutlined-vV5-dJ7B.js";import{E as at}from"./EyeOutlined-DMOywdMm.js";import{T as ce}from"./index-Cd0TkKik.js";import"./index-BSgdO99v.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";import"./enums-Cr_YM2zq.js";const nt={class:"flex-1"},lt={class:"w-full flex-y-center justify-end gap-12px"},ot=V({name:"PlanTaskCommentListSearch",__name:"search-filter",props:M({status:{},userInfo:{}},{model:{required:!0},modelModifiers:{}}),emits:M(["reset","search"],["update:model"]),setup(w,{emit:o}){const{formRef:f,validate:h,resetFields:I}=qe(),i=j(w,"model");Oe(()=>{i.value.createTimeRange=[]});const v=w,d=o;async function r(){await I(),d("reset")}async function b(){await h(),d("search")}function _(c,u){i.value.beginTime=u[0],i.value.endTime=u[1]}return(c,u)=>{const U=We,T=Ye,F=Ge,L=Se,B=Ke,Y=Ue,E=N,W=Be,G=Re,K=Le;return p(),R(Ee,null,{default:n(()=>[e(K,{ref_key:"formRef",ref:f,class:"search-filter",model:i.value,"label-col":{span:5,md:7}},{default:n(()=>[e(G,{gutter:[16,16],wrap:""},{default:n(()=>[e(F,{span:24,md:12,lg:6},{default:n(()=>[e(T,{label:"任务编号",name:"taskId",class:"m-0"},{default:n(()=>[e(U,{value:i.value.taskId,"onUpdate:value":u[0]||(u[0]=y=>i.value.taskId=y),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),e(F,{span:24,md:12,lg:6},{default:n(()=>[e(T,{label:"任务状态",name:"status",class:"m-0"},{default:n(()=>[e(L,{value:i.value.status,"onUpdate:value":u[1]||(u[1]=y=>i.value.status=y),placeholder:"- 全部 -",options:v.status,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),e(F,{span:24,md:12,lg:6},{default:n(()=>[e(T,{label:"创建时间",name:"createTimeRange",class:"m-0"},{default:n(()=>[e(B,{value:i.value.createTimeRange,"onUpdate:value":u[2]||(u[2]=y=>i.value.createTimeRange=y),"show-time":{defaultValue:[l(te)("00:00:00","HH:mm:ss"),l(te)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],onChange:_},null,8,["value","show-time"])]),_:1})]),_:1}),v.userInfo.isTenant?v.userInfo.isTenantUser?P("",!0):(p(),R(F,{key:1,span:24,md:12,lg:6},{default:n(()=>[e(T,{label:"创建员工",name:"userId",class:"m-0"},{default:n(()=>[e(ue,{value:i.value.userId,"onUpdate:value":u[4]||(u[4]=y=>i.value.userId=y),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})]),_:1})):(p(),R(F,{key:0,span:24,md:12,lg:6},{default:n(()=>[e(T,{label:"创建商户",name:"userId",class:"m-0"},{default:n(()=>[e(ue,{value:i.value.userId,"onUpdate:value":u[3]||(u[3]=y=>i.value.userId=y),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),g("div",nt,[e(T,{class:"m-0"},{default:n(()=>[g("div",lt,[e(E,{onClick:r},{icon:n(()=>[e(Y,{class:"align-sub text-icon"})]),default:n(()=>[u[5]||(u[5]=g("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(E,{type:"primary",ghost:"",onClick:b},{icon:n(()=>[e(W,{class:"align-sub text-icon"})]),default:n(()=>[u[6]||(u[6]=g("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),it=q(ot,[["__scopeId","data-v-f97ca9fe"]]),rt={class:"v-center center flex"},ut=["src"],dt=V({__name:"video-preview-modal",props:M({video:{default:""}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const o=j(w,"visible"),f=w,h=()=>{o.value=!1};return(I,i)=>{const v=Ne;return p(),R(v,{open:o.value,title:"视频查看",width:600,footer:null,onCancel:h},{default:n(()=>[g("div",rt,[g("video",{class:"preview",src:f.video,width:"300",controls:"",loop:"",muted:""},null,8,ut)])]),_:1},8,["open"])}}}),ct=q(dt,[["__scopeId","data-v-62517473"]]),mt=V({name:"PlanTaskCommentOperateDrawer",__name:"operate-drawer",props:M({operateType:{default:"add"},rowData:{default:null}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const o=j(w,"visible"),f=S(v()),h=w,I=se(()=>h.operateType==="edit"),i=se(()=>({add:"新增评价",edit:"编辑评价"})[h.operateType]);me(o,async()=>{var d,r;if(o.value&&(f.value=v(),I.value)){Object.assign(f.value.row,h.rowData||{});let b=0;f.value.imageFiles=(d=f.value.images)==null?void 0:d.map(_=>({uid:b-=1,name:`${b}.png`,status:"done",url:window.$isDbugger?`${apiUrl}${_}`:_,thumbUrl:window.$isDbugger?`${apiUrl}${_}`:_})),f.value.videoFiles=(r=f.value.videos)==null?void 0:r.map(_=>({uid:b-=1,name:`${b}.png`,status:"done",url:window.$isDbugger?`${apiUrl}${_}`:_,thumbUrl:window.$isDbugger?`${apiUrl}${_}`:_}))}});function v(){return{id:"",taskId:"",mode:0,text:"",images:[],imageFiles:[],videos:[],videoFiles:[],loading:!1,row:{}}}return(d,r)=>{const b=fe;return p(),R(b,{open:o.value,"onUpdate:open":r[0]||(r[0]=_=>o.value=_),title:i.value,width:650},{default:n(()=>r[1]||(r[1]=[$("//")])),_:1},8,["open","title"])}}}),pt={key:0,class:"flex items-center justify-center py-10"},ft={key:1,class:"py-10 text-center"},_t={key:2,class:"space-y-6"},vt={class:"flex gap-4"},gt={class:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md"},ht={class:"flex-grow"},bt={class:"mb-1 text-gray-800 font-medium"},wt={class:"mb-2 text-sm text-gray-600"},kt={key:0,class:"block"},yt={class:"mb-2 text-sm text-gray-600"},xt={key:0},It={class:"text-red-500"},Tt={class:"mb-2 text-sm text-gray-600"},Ct={key:0},Ft={key:0,class:"mt-2 flex flex-wrap gap-2"},At=V({__name:"check-products",props:M({taskId:{type:String,required:!0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const o=j(w,"visible"),f=w,h=S(!0),I=pe({list:[]});me(()=>o.value,async v=>{v&&f.taskId&&await i()});async function i(){h.value=!0;try{const v={pageIndex:1,pageSize:10,taskId:f.taskId},{data:d,error:r}=await Qe(v);!r&&d&&d.code===0&&(I.list=d.data.list)}finally{h.value=!1}}return(v,d)=>{const r=et,b=z,_=fe;return p(),R(_,{open:o.value,"onUpdate:open":d[0]||(d[0]=c=>o.value=c),title:"查看商品",width:600,footer:null},{default:n(()=>[h.value?(p(),x("div",pt,[e(r,{size:"large"})])):I.list.length===0?(p(),x("div",ft,d[1]||(d[1]=[g("p",null,"暂无子商品数据",-1)]))):(p(),x("div",_t,[(p(!0),x(ae,null,ne(I.list,c=>(p(),x("div",{key:c.taskId,class:"border rounded-lg p-4 shadow-sm transition-shadow hover:shadow-md"},[g("div",vt,[g("div",gt,[e(b,{src:c.productImage||l(A),fallback:l(A),width:"80",height:"80",class:"object-cover"},null,8,["src","fallback"])]),g("div",ht,[g("h3",bt,O(c.productTitle||"未命名商品"),1),g("p",wt,[c.text?(p(),x("span",kt,"评论："+O(c.text),1)):P("",!0)]),g("p",yt,[c.price!==null?(p(),x("span",xt,[d[2]||(d[2]=$(" 价格： ")),g("span",It,"￥"+O(c.price),1)])):P("",!0)]),g("p",Tt,[c.count!==null?(p(),x("span",Ct,"购买数量："+O(c.count),1)):P("",!0)]),c.images&&c.images.length>0?(p(),x("div",Ft,[(p(!0),x(ae,null,ne(c.images,(u,U)=>(p(),R(b,{key:U,src:u,fallback:l(A),width:"60",height:"60",class:"rounded"},null,8,["src","fallback"]))),128))])):P("",!0)])])]))),128))]))]),_:1},8,["open"])}}}),Dt=q(At,[["__scopeId","data-v-7d5f4b38"]]),$t={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Rt=V({name:"alibaba_comment",__name:"index",setup(w){const o=ze(),f=je(),{tableWrapperRef:h,scrollConfig:I}=Pe(),i=S(!1),v=S("create"),d=S({}),r=pe({videoVisible:!1,video:""}),b=S(new Map),{columns:_,columnChecks:c,data:u,getData:U,getDataByPage:T,loading:F,mobilePagination:L,searchParams:B,resetSearchParams:Y}=Me({apiFn:Je,apiParams:{pageIndex:1,pageSize:10},columns:ve}),{checkedRowKeys:E,rowSelection:W,onBatchDeleted:G,onDeleted:K}=Ve(u,U);async function y(){if(o.userInfo.isTenant){const s=E.value;if(s!=null&&s.length){const{data:a,error:k}=await de(s);!k&&(a==null?void 0:a.code)===0&&G()}}}async function _e(s){const{data:a,error:k}=await de([s]);!k&&(a==null?void 0:a.code)===0&&K()}function ve(){var a,k;const s=[{key:"id",dataIndex:"id",title:"订单详情",width:400,ellipsis:!0,customRender:({record:t})=>{const C=ie.find(H=>H.value===t.platform)||ie[0],m=window.$isDebugger&&t.productImage?`${oe}${t.productImage}`:t.productImage||A,Q=t.count>1,ye=t.count||1,xe=b.value.get(t.id)||!1,Ie=()=>{var H;return!xe||!((H=t.products)!=null&&H.length)?null:e("div",{class:"products-list mt-4 border-t border-gray-100 pt-4"},[t.products.map((D,Te)=>{const Ce=D.imageUrl||D.productImage||A,Fe=D.name||D.productTitle||"未命名商品",Ae=D.sku||D.spec||"无规格",De=D.quantity||1;return e("div",{class:"product-item flex items-center gap-3 py-2",key:Te},[e("div",{class:"product-thumbnail h-10 w-10 flex-shrink-0"},[e(z,{src:Ce,width:40,height:40,fallback:A},null)]),e("div",{class:"product-info flex-grow-1 overflow-hidden"},[e("p",{class:"product-name truncate text-sm font-medium"},[Fe]),e("p",{class:"product-sku text-xs text-gray-500"},[Ae]),e("p",{class:"product-quantity text-xs text-gray-500"},[$("x"),De])])])})])};return e("div",{class:"flex items-start gap-4"},[e("div",{class:"product-image-container h-20 w-20 flex-shrink-0"},[e(z,{width:80,height:80,src:m,fallback:A},null)]),e("div",{class:"flex-1 overflow-hidden"},[e("p",{class:"title truncate text-gray-800 font-medium",title:t.productTitle},[e(ce,{color:C.color},{default:()=>[C.label,$("联盟")]}),t.productTitle]),e("p",{class:"plantask-shop"},[$("店铺名称： "),t.shopName]),e("p",{class:"task-id cursor-pointer text-sm text-gray-500 transition-colors hover:text-primary",onClick:()=>re(t.taskId)},[$("任务编号："),t.taskId]),e("p",{class:"order-id cursor-pointer text-sm text-gray-500 transition-colors hover:text-primary",onClick:()=>t.orderId&&re(t.orderId)},[$("订单号："),t.orderId||"-"]),e("div",{class:"mt-2 flex items-center"},[e("span",{class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-1 text-xs text-blue-800 font-medium"},[Q?`多商品 (${ye}件)`:"单商品"])]),Ie()])])}},{key:"taskId",dataIndex:"taskId",title:"评价详情",width:400,ellipsis:!0,customRender:({record:t})=>{const C=(t.images||[]).map(m=>window.$isDebugger?`${oe}${m}`:m);return e("div",null,[e("p",{class:"comment-text mb-2 text-sm text-gray-700"},[t.text||"无评论内容"]),e("div",{class:"media-container mt-2 flex flex-wrap gap-2"},[C.map((m,Q)=>e("div",{class:"image-container h-24 w-24 overflow-hidden rounded shadow-sm",key:`img-${Q}`},[e(z,{width:100,height:100,src:m,fallback:A},null)]))])])}},{key:"status",dataIndex:"status",title:"状态",align:"center",width:100,customRender:({record:t})=>{const C=Z.find(m=>m.value===t.status)||Z[0];return e(ce,{color:C.color},{default:()=>[C.label]})}}];return(a=o.userInfo)!=null&&a.isTenant?(k=o.userInfo)!=null&&k.isTenantUser||s.push({key:"creator",dataIndex:"creator",title:"创建员工",align:"center",width:200,ellipsis:!0}):s.push({key:"tenantUser",dataIndex:"tenantUser",title:"所属商户",align:"center",width:200,ellipsis:!0}),s.push({key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200},{key:"beginTime",dataIndex:"beginTime",title:"预计评价时间",align:"center",width:200},{key:"operate",title:"操作",align:"center",width:100,customRender:({record:t})=>e("div",{class:"flex justify-center gap-2"},[ge(t),he(t),t.count>1&&e(be,{record:t},null)])}),s}function ge(s){return f.hasOne(X.Ali1688.Comment.CREATE)&&o.userInfo.isTenant&&s.id&&s.status!==1?e(ee,{title:"确认立即发布评价吗？",onConfirm:()=>ke(s.id)},{default:()=>[e(J,{placement:"top",title:"立即发布"},{default:()=>[e(N,{size:"small",type:"link"},{default:()=>[e(Xe,null,null)]})]})]}):""}function he(s){return f.hasOne(X.Ali1688.Comment.DELETE)&&o.userInfo.isTenant&&s.roleId!==1e3&&s.status!==1?e(ee,{title:"确认删除吗？",onConfirm:()=>_e(s.id)},{default:()=>[e(J,{placement:"top",title:"删除"},{default:()=>[e(N,{danger:!0,size:"small",type:"link"},{default:()=>[e(st,null,null)]})]})]}):""}function be({record:s}){if(o.userInfo.isTenant)return e(J,{placement:"top",title:"查看商品"},{default:()=>[e(N,{type:"link",size:"small",onClick:()=>we(s.taskId)},{default:()=>[e(at,null,null)]})]})}function we(s){r.detailVisible=!0,r.taskIdForCheck=s}async function ke(s){var a;try{const{data:k,error:t}=await Ze(s);!t&&(k==null?void 0:k.code)===0&&((a=window.$message)==null||a.success("发布操作成功"),T())}catch{}}return(s,a)=>{const k=$e,t=He,C=tt;return p(),x("div",$t,[e(it,{model:l(B),"onUpdate:model":a[0]||(a[0]=m=>le(B)?B.value=m:null),"user-info":l(o).userInfo,status:l(Z),onReset:l(Y),onSearch:a[1]||(a[1]=m=>l(T)(1))},null,8,["model","user-info","status","onReset"]),e(C,{title:"评价列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"plantaskcomment flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:n(()=>[e(k,{columns:l(c),"onUpdate:columns":a[2]||(a[2]=m=>le(c)?c.value=m:null),"disabled-delete":l(E).length===0,loading:l(F),"delete-btn":l(o).userInfo.isTenant&&l(f).hasOne(l(X).Ali1688.Task.DELETE),onDelete:y},null,8,["columns","disabled-delete","loading","delete-btn"])]),default:n(()=>[e(t,{ref_key:"tableWrapperRef",ref:h,columns:l(_),"data-source":l(u),size:"small","row-selection":l(W),scroll:l(I),loading:l(F),"row-key":"id",pagination:l(L),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(ct,{visible:r.videoVisible,"onUpdate:visible":a[3]||(a[3]=m=>r.videoVisible=m),video:r.video},null,8,["visible","video"])]),_:1}),e(mt,{visible:i.value,"onUpdate:visible":a[4]||(a[4]=m=>i.value=m),"operate-type":v.value,"row-data":d.value,onSubmitted:l(T)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(Dt,{visible:r.detailVisible,"onUpdate:visible":a[5]||(a[5]=m=>r.detailVisible=m),"task-id":r.taskIdForCheck||""},null,8,["visible","task-id"])])}}}),as=q(Rt,[["__scopeId","data-v-947589ac"]]);export{as as default};
