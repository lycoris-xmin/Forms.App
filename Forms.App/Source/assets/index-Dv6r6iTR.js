import{_ as Ae}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as xe,a as Ie}from"./smartphone-Dpn5Nrf2.js";import{_ as Re,S as ee,g as te,a as De,b as Ce,T as ke,u as Se,c as Oe,d as Ee,e as Ue}from"./table-search-filter-oeJAv4cw.js";import{m as W,d as G,D as j,E as ae,c as F,o as O,w as n,f as t,e as M,v as Q,b as ne,H as ve,P as _e,g as C,t as be,B as V,r as B,s as oe,a as le,F as ue,h as y,q as $e,aj as Fe,i as de,j as ce,a8 as J,z as pe,M as Me,a9 as fe}from"./index-C4fDvJn1.js";import{u as Ne,A as X}from"./app.permissions-eEP3QY97.js";import{a as me}from"./index-DiqUFypO.js";import{d as Le}from"./enums-Cr_YM2zq.js";import{u as ie,F as se,_ as re,I as ge,a as we,e as ye,d as qe}from"./form-C4lsPmD3.js";import{_ as je}from"./index-Bgjt1Cd5.js";import{L as Be}from"./index-EP99CXY3.js";import{C as z}from"./china.area-DOOnik0V.js";import{d as Ve}from"./debounce-C-eHgR1J.js";import{S as Pe}from"./index-DjcmxpZa.js";import{_ as he}from"./index-B0OEq9ON.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as Z,c as We}from"./enum-map-device-i1knBcFt.js";import{U as He}from"./UnlockOutlined-DaPYw7sf.js";import{C as Ge}from"./index-CfF1NG6B.js";import{T as Ye}from"./ToolFilled-ZDFYkt8X.js";import{T as q}from"./index-Cd0TkKik.js";import"./index-BSgdO99v.js";import"./LeftOutlined-byKmxFgc.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./responsiveObserve-k0SNxmCv.js";import"./isSymbol-7IJmde0n.js";function Ke(e){const{pageIndex:s,pageSize:i}=e,o={pageIndex:s,pageSize:i};return e.buyPayType!==void 0&&typeof e.buyPayType=="number"&&(o.buyPayType=e.buyPayType),e.init!==void 0&&typeof e.init=="number"&&(o.init=e.init),e.allowPair!==void 0&&typeof e.allowPair=="boolean"&&(o.allowPair=e.allowPair),e.account&&(o.account=e.account),e.userId&&(o.userId=e.userId),e.deviceId&&(o.deviceId=e.deviceId),e.deviceName&&(o.deviceName=e.deviceName),W({url:"/api/device/douyin/list",params:{...o}})}function Qe(e){const s={id:e.id,buyPayType:e.buyPayType,allowPair:e.allowPair,payPhone:e.payPhone||null,payPassword:e.payPassword||null,name:e.name,phone:e.phone,province:e.province,city:e.city,address:e.address};return W({url:"/api/device/douyin",method:"put",data:s})}function Je(e){return W({url:`/api/device/douyin/${e}`})}function Xe(e){return W({url:"/api/device/douyin/init",method:"post",data:{ids:e}})}function Ze(e){return W({url:"/api/device/douyin/allowpair",method:"post",data:{ids:e.ids,allowPair:e.allowPair===1}})}const et={class:"flex-1"},tt={class:"w-full flex-y-center justify-end gap-12px"},at=G({name:"DeviceTaobaoListSearch",__name:"search-filter",props:j({init:{default:()=>[]}},{model:{required:!0},modelModifiers:{}}),emits:j(["reset","search"],["update:model"]),setup(e,{emit:s}){const{formRef:i,validate:o,resetFields:d}=ie(),u=ae(e,"model"),f=e,_=s;async function T(){await d(),_("reset")}async function g(){await o(),_("search")}return(a,v)=>{const w=ge,c=re,P=je,A=te,I=ee,E=De,U=V,N=Ce,k=Re,$=se;return O(),F(ke,null,{default:n(()=>[t($,{ref_key:"formRef",ref:i,name:"filer",model:u.value,"label-col":{span:5,md:7}},{default:n(()=>[t(k,{gutter:[16,16],wrap:""},{default:n(()=>[t(P,{span:24,md:12,lg:6},{default:n(()=>[t(c,{label:"系统编号",name:"deviceId",class:"m-0"},{default:n(()=>[t(w,{value:u.value.deviceId,"onUpdate:value":v[0]||(v[0]=h=>u.value.deviceId=h),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:Q(g,["enter"])},null,8,["value"])]),_:1})]),_:1}),t(P,{span:24,md:12,lg:6},{default:n(()=>[t(c,{label:"设备名称",name:"deviceName",class:"m-0"},{default:n(()=>[t(w,{value:u.value.deviceName,"onUpdate:value":v[1]||(v[1]=h=>u.value.deviceName=h),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:Q(g,["enter"])},null,8,["value"])]),_:1})]),_:1}),t(P,{span:24,md:12,lg:6},{default:n(()=>[t(c,{label:"登录账号",name:"account",class:"m-0"},{default:n(()=>[t(w,{value:u.value.account,"onUpdate:value":v[2]||(v[2]=h=>u.value.account=h),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:Q(g,["enter"])},null,8,["value"])]),_:1})]),_:1}),t(P,{span:24,md:12,lg:6},{default:n(()=>[t(c,{label:"状态",name:"init"},{default:n(()=>[t(I,{value:u.value.init,"onUpdate:value":v[3]||(v[3]=h=>u.value.init=h),placeholder:"- 全部 -","allow-clear":""},{default:n(()=>[(O(!0),ne(ve,null,_e(f.init,h=>(O(),F(A,{key:h.value,value:h.value},{default:n(()=>[C(be(h.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),t(P,{span:24,md:12,lg:6},{default:n(()=>[t(c,{label:"任务分配",name:"allowPair"},{default:n(()=>[t(I,{value:u.value.allowPair,"onUpdate:value":v[4]||(v[4]=h=>u.value.allowPair=h),placeholder:"- 全部 -","allow-clear":""},{default:n(()=>[t(A,{value:!0},{default:n(()=>v[5]||(v[5]=[C("允许任务分配")])),_:1}),t(A,{value:!1},{default:n(()=>v[6]||(v[6]=[C("停止任务分配")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),M("div",et,[t(c,{class:"m-0"},{default:n(()=>[M("div",tt,[t(U,{onClick:T},{icon:n(()=>[t(E,{class:"align-sub text-icon"})]),default:n(()=>[v[7]||(v[7]=M("span",{class:"ml-8px"},"重置",-1))]),_:1}),t(U,{type:"primary",ghost:"",onClick:g},{icon:n(()=>[t(N,{class:"align-sub text-icon"})]),default:n(()=>[v[8]||(v[8]=M("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),nt={香港特别行政区:"香港特别行政区",澳门特别行政区:"澳门特别行政区",香港:"香港特别行政区",澳门:"澳门特别行政区",台湾省:"台湾省",台湾:"台湾省"},ot={北京市:"北京市",上海市:"上海市",天津市:"天津市",重庆市:"重庆市",北京:"北京市",上海:"上海市",天津:"天津市",重庆:"重庆市"},lt={内蒙古自治区:"内蒙古自治区",广西壮族自治区:"广西壮族自治区",宁夏回族自治区:"宁夏回族自治区",西藏自治区:"西藏自治区",新疆维吾尔自治区:"新疆维吾尔自治区",内蒙古:"内蒙古自治区",广西:"广西壮族自治区",宁夏:"宁夏回族自治区",西藏:"西藏自治区",新疆:"新疆维吾尔自治区"};function it(e,s){return Ve(i=>{var o,d,u,f;if(i)try{const _=ft(i);if(!_){(o=window.$message)==null||o.error("地址解析失败，请确认格式");return}e.name=_.name,e.phone=_.phone,e.province=_.province,e.city=_.city,e.address=_.address;const T=Te(_.province,_.city);T.length===2?(s.value=T,(d=window.$message)==null||d.success("解析成功")):(u=window.$message)==null||u.error("无法找到对应的省市选项")}catch{(f=window.$message)==null||f.error("解析地址失败，请检查格式是否正确")}},500)}function st(){return Object.entries(z[86]).map(([e,s])=>{const i=z[e],o=i?Object.entries(i).map(([d,u])=>({value:d,label:u,isLeaf:!0})):[];return{value:e,label:s,children:o}})}function rt(e,s,i){var o;if(e.length===2){const d=i.find(f=>f.value===e[0]),u=(o=d==null?void 0:d.children)==null?void 0:o.find(f=>f.value===e[1]);d&&u&&(s.province=d.label,s.city=u.label)}else s.province="",s.city=""}function ut(e){return{香港特别行政区:"香港",澳门特别行政区:"澳门",台湾省:"台北市"}[e]||""}function dt(e){for(const[s,i]of Object.entries(ot))if(e.includes(s)){const d=e.replace(new RegExp(`${s}${s}`),s).match(new RegExp(`${s}(.+?[区县])`));if(d)return{province:i,city:d[1].trim()}}return null}function ct(e){for(const[s,i]of Object.entries(lt))if(e.startsWith(s)){const d=e.substring(s.length).trim().match(/^(.+?[市州盟])/);if(d)return{province:i,city:d[1].trim()}}return null}function pt(e){var s;for(const[i,o]of Object.entries(nt))if(e.startsWith(i)){const u=e.substring(i.length).trim().match(/^(.+?区)?(.*)$/);if(u){const f=((s=u[1])==null?void 0:s.trim())||ut(o);return{province:o,city:f}}}return null}function ft(e){var w,c,P,A;if(!e)return null;const i=e.replace(/：/g,":").trim().split(/,\s*/),o=(w=i.find(I=>I.startsWith("收货人:")))==null?void 0:w.match(/收货人:\s*(.+)/),d=(c=i.find(I=>I.startsWith("手机号码:")))==null?void 0:c.match(/手机号码:\s*(\d{11})/),u=(P=i.find(I=>I.startsWith("所在地区:")))==null?void 0:P.match(/所在地区:\s*(.+)/),f=(A=i.find(I=>I.startsWith("详细地址:")))==null?void 0:A.match(/详细地址:\s*(.+)/);if(!o||!d||!u||!f)return null;const _=o[1].trim(),T=d[1].trim(),g=u[1].trim(),a=f[1].trim();if(!/^1[3-9]\d{9}$/.test(T)||!_)return null;const v=mt(g);return v?{name:_,phone:T,...v,address:a}:null}function mt(e){const s=dt(e);if(s)return s;const i=ct(e);if(i)return i;const o=pt(e);if(o)return o;const d=e.match(/^(.+?省)(.+?市)(.+)?$/);if(d)return{province:d[1].trim(),city:d[2].trim()};const u=e.match(/^(.+?)(.+?市)(.+)?$/);if(u){const f=u[1].trim(),_=Object.entries(z[86]).find(([T,g])=>g.startsWith(f)||g.replace(/(省|自治区|特别行政区)/,"").startsWith(f));if(_)return{province:_[1],city:u[2].trim()}}return null}function Te(e,s){const i=[],o={香港特别行政区:"香港",澳门特别行政区:"澳门",台湾省:"台北"},d={内蒙古自治区:"内蒙古",广西壮族自治区:"广西",宁夏回族自治区:"宁夏",西藏自治区:"西藏",新疆维吾尔自治区:"新疆"},u={北京市:"北京",上海市:"上海",天津市:"天津",重庆市:"重庆"};let f=e;e in o&&(f=o[e]),e in d&&(f=d[e]),e in u&&(f=u[e]),f=f.replace(/省$/,"");const _=Object.entries(z[86]).find(([T,g])=>g===f||g.startsWith(f));if(_){const[T]=_;i.push(T);const g=z[T];if(g){const a=s.replace(/市$/,""),v=Object.entries(g).find(([w,c])=>c===a||c.startsWith(a));v&&i.push(v[0])}}return i}function yt(e){if(!e)return"";const s=e.split(/,\s*/);return[/^收货人:\s*.+/,/^手机号码:\s*\d{11}/,/^所在地区:\s*.+/,/^详细地址:\s*.+/].every(o=>s.some(d=>o.test(d)))?"":"error"}function vt(e){if(!e)return"";const s=e.split(/,\s*/),o=[{name:"收货人",regex:/^收货人:\s*.+/},{name:"手机号码",regex:/^手机号码:\s*\d{11}/},{name:"所在地区",regex:/^所在地区:\s*.+/},{name:"详细地址",regex:/^详细地址:\s*.+/}].filter(d=>!s.some(u=>d.regex.test(u)));return o.length>0?`地址格式不正确

当前缺少或格式不正确：${o.map(d=>d.name).join("、")}`:""}const _t={class:"body"},bt="收货人: 张三, 手机号码: 13356568989, 所在地区: 广西壮族自治区北海市合浦县白沙镇, 详细地址: 广西送变电建设有限责任公司施工项目部",gt=G({name:"DeviceDouyinEditDrawer",__name:"edit-drawer",props:j({rowData:{},payType:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(e,{emit:s}){const i=ae(e,"visible"),o=B(null),d=B(null),u=B([]),f=B(st()),{formRef:_,validate:T,resetFields:g}=ie(),a=oe({id:"",buyPayType:0,payPassword:"",payPhone:"",loading:!0,submitLoading:!1,oldPayPhone:"",name:"",phone:"",province:"",city:"",address:"",addressText:"",tbAddressText:"",allowPair:!1}),v=le(()=>a.allowPair?"任务分配(允许任务分配后，将自动分配DY联盟任务)":"任务分配(停止任务分配后，DY联盟任务将不再分配)"),w=e,{defaultRequiredRule:c}=we(),P={taoQi:c,age:c,buyPayType:c,payPassword:[{required:a.buyPayType!==2,message:"请输入支付密码",trigger:["change","blur"]}],payPhone:[{required:a.buyPayType===2,message:"请输入代付手机号",trigger:["change","blur"]},{pattern:ye,message:"请输入正确的手机号",trigger:["change","blur"]}],phone:[{validator:(p,r)=>r?ye.test(r)?Promise.resolve():Promise.reject(new Error("请输入正确的手机号")):Promise.resolve(),trigger:["change","blur"]}]},A=it(a,u);ue(()=>a.tbAddressText,async p=>{await A(p)});function I(p){if(a.buyPayType=p.data.buyPayType,a.payPassword=p.data.payPassword,a.payPhone=p.data.payPhone,a.name=p.data.name||"",a.phone=p.data.phone||"",a.province=p.data.province||"",a.city=p.data.city||"",a.address=p.data.address||"",a.allowPair=p.data.allowPair===!0||p.data.allowPair===1||p.data.allowPair==="1",p.data.province&&p.data.city){const r=Te(p.data.province,p.data.city);r&&r.length===2&&(u.value=r)}}ue(i,async(p,r)=>{if(g(),p&&p!==r){a.loading=!0;try{Object.keys(a).forEach(R=>{Object.keys(w.rowData).includes(R)&&(a[R]=w.rowData[R])});const{data:D,error:L}=await Je(w.rowData.id);!L&&D&&D.code===0&&I(D)}finally{a.loading=!1}}});const E=s;async function U(){var p;await((p=_.value)==null?void 0:p.validateFields(["tbAddressText"]))}function N(p){rt(p,a,f.value)}function k(){i.value=!1}async function $(){var p;await T(),a.submitLoading=!0;try{const{data:r,error:D}=await Qe({...a});!D&&r&&r.code===0&&((p=window.$message)==null||p.success("保存成功"),k(),E("submitted"))}finally{a.submitLoading=!1}}async function h(){var p,r,D;a.payPhone=a.oldPayPhone,(p=_.value)==null||p.clearValidate(),await nextTick(),a.buyPayType===2?(r=o.value)==null||r.focus():(D=d.value)==null||D.focus()}return(p,r)=>{const D=te,L=ee,R=re,b=ge,l=xe,x=qe,S=se,H=V,Y=Pe,K=he;return O(),F(K,{open:i.value,"onUpdate:open":r[9]||(r[9]=m=>i.value=m),title:"编辑抖音设备",width:500},{footer:n(()=>[t(Y,{size:16},{default:n(()=>[t(H,{onClick:k},{default:n(()=>r[12]||(r[12]=[C("取消")])),_:1}),t(H,{type:"primary",loading:a.submitLoading,onClick:$},{default:n(()=>r[13]||(r[13]=[C("保存")])),_:1},8,["loading"])]),_:1})]),default:n(()=>[M("div",_t,[t(S,{ref_key:"formRef",ref:_,name:"operate",layout:"vertical",model:a,rules:P},{default:n(()=>[t(R,{label:v.value,name:"allowPair",required:""},{default:n(()=>[t(L,{value:a.allowPair,"onUpdate:value":r[0]||(r[0]=m=>a.allowPair=m)},{default:n(()=>[t(D,{value:!0},{default:n(()=>r[10]||(r[10]=[C("允许任务分配")])),_:1}),t(D,{value:!1},{default:n(()=>r[11]||(r[11]=[C("停止任务分配")])),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(R,{label:"支付方式",name:"buyPayType"},{default:n(()=>[t(L,{value:a.buyPayType,"onUpdate:value":r[1]||(r[1]=m=>a.buyPayType=m),onChange:h},{default:n(()=>[(O(!0),ne(ve,null,_e(w.payType,m=>(O(),F(D,{key:m.value,value:m.value},{default:n(()=>[C(be(m.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a.buyPayType===2?(O(),F(R,{key:0,label:"代付手机",name:"payPhone",required:a.buyPayType===2,class:"required-field"},{default:n(()=>[t(b,{ref_key:"payPhoneRef",ref:o,value:a.payPhone,"onUpdate:value":r[2]||(r[2]=m=>a.payPhone=m),placeholder:"请输入代付手机号"},null,8,["value"])]),_:1},8,["required"])):(O(),F(R,{key:1,label:"支付密码",name:"payPassword",required:a.buyPayType!==2,class:"required-field"},{default:n(()=>[t(b,{ref_key:"payPasswordRef",ref:d,value:a.payPassword,"onUpdate:value":r[3]||(r[3]=m=>a.payPassword=m),placeholder:"请输入支付密码",type:"password"},null,8,["value"])]),_:1},8,["required"])),t(R,{label:"收货人",name:"name"},{default:n(()=>[t(b,{value:a.name,"onUpdate:value":r[4]||(r[4]=m=>a.name=m),placeholder:"请输入收货人姓名(选填)",maxlength:30,"show-count":""},null,8,["value"])]),_:1}),t(R,{label:"联系电话",name:"phone"},{default:n(()=>[t(b,{value:a.phone,"onUpdate:value":r[5]||(r[5]=m=>a.phone=m),placeholder:"请输入联系电话(选填)"},null,8,["value"])]),_:1}),t(R,{label:"所在地区"},{default:n(()=>[t(l,{value:u.value,"onUpdate:value":r[6]||(r[6]=m=>u.value=m),options:f.value,placeholder:"请选择省市",onChange:N},null,8,["value","options"])]),_:1}),t(R,{label:"详细地址",name:"address"},{default:n(()=>[t(x,{value:a.address,"onUpdate:value":r[7]||(r[7]=m=>a.address=m),placeholder:"请输入详细地址",rows:3},null,8,["value"])]),_:1}),t(R,{label:"地址文本解析",name:"tbAddressText","validate-status":y(yt)(a.tbAddressText),help:y(vt)(a.tbAddressText)},{default:n(()=>[t(x,{value:a.tbAddressText,"onUpdate:value":r[8]||(r[8]=m=>a.tbAddressText=m),placeholder:bt,rows:4,"auto-size":{minRows:4,maxRows:6},onInput:U},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["model"]),t(Be,{loading:a.loading},null,8,["loading"])])]),_:1},8,["open"])}}}),wt=ze(gt,[["__scopeId","data-v-4cfbceea"]]),Pt={class:"body"},ht=G({__name:"allow-pair-drawer",props:j({ids:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(e,{emit:s}){const i=ae(e,"visible"),o=oe({allowPair:1,submitLoading:!1}),d=s,u=e,f=()=>{i.value=!1},{formRef:_}=ie(),{defaultRequiredRule:T}=we(),g={allowPair:T},a=le(()=>o.allowPair?"任务分配(允许任务分配后，将自动分配DY联盟任务)":"任务分配(停止任务分配后，DY联盟任务将不再分配)");async function v(){var c;o.submitLoading=!0;const w={ids:u.ids,allowPair:o.allowPair};try{const{data:P,error:A}=await Ze(w);!A&&(P==null?void 0:P.code)===0&&((c=window.$message)==null||c.success("保存成功"),d("submitted"),f())}finally{o.submitLoading=!1}}return(w,c)=>{const P=te,A=ee,I=re,E=se,U=V,N=Pe,k=he;return O(),F(k,{open:i.value,"onUpdate:open":c[1]||(c[1]=$=>i.value=$),title:"任务分配",width:500},{footer:n(()=>[t(N,{size:16},{default:n(()=>[t(U,{type:"default",onClick:f},{default:n(()=>c[4]||(c[4]=[C("取消")])),_:1}),t(U,{type:"primary",loading:o.submitLoading,onClick:v},{default:n(()=>c[5]||(c[5]=[C("保存")])),_:1},8,["loading"])]),_:1})]),default:n(()=>[M("div",Pt,[t(E,{ref_key:"formRef",ref:_,name:"operate",layout:"vertical",model:o,rules:g},{default:n(()=>[t(I,{label:a.value,name:"allowPair"},{default:n(()=>[t(A,{value:o.allowPair,"onUpdate:value":c[0]||(c[0]=$=>o.allowPair=$)},{default:n(()=>[t(P,{value:1},{default:n(()=>c[2]||(c[2]=[C("允许任务分配")])),_:1}),t(P,{value:0},{default:n(()=>c[3]||(c[3]=[C("停止任务分配")])),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["open"])}}}),Tt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Qt=G({name:"device_douyin",__name:"index",setup(e){const s=Ne(),i=$e(),{tableWrapperRef:o,scrollConfig:d}=Se(),u=Fe(),f=B([0]),_=le(()=>i.userInfo.isTenant?Z.filter(b=>f.value.includes(b.value)):Z),{columns:T,columnChecks:g,data:a,getData:v,getDataByPage:w,loading:c,mobilePagination:P,searchParams:A,resetSearchParams:I}=Oe({apiFn:Ke,apiParams:{pageIndex:1,pageSize:10},columns:p}),{drawerVisible:E,editingData:U,handleEdit:N,checkedRowKeys:k,rowSelection:$}=Ee(a,v),h=oe({allowPairVisible:!1});de(()=>{const b=u.getParams();b&&b.deviceId&&(A.deviceId=b.deviceId,setTimeout(()=>w(1),0))}),ce(()=>{const b=u.getParams();b&&b.deviceId&&(A.deviceId=b.deviceId,w(1))});function p(){const b=[{key:"account",dataIndex:"account",title:"账号",width:200,customRender:({record:l})=>l.init!==2?t(q,null,{default:()=>[C("未初始化")]}):l.account},{key:"buyPayType",dataIndex:"buyPayType",title:"支付方式",align:"center",width:100,customRender:({record:l})=>{const x=Z.filter(S=>S.value===l.buyPayType)[0];return t(q,{color:x.color},{default:()=>[x.label]})}},{key:"init",dataIndex:"init",title:"账号初始化",align:"center",width:120,customRender:({record:l})=>{const x=me.filter(S=>S.value===l.init)[0];return l.init===3?t(fe,{placement:"top",title:t("span",null,[l.remark])},{default:()=>[t(q,{color:x.color},{default:()=>[x.label]})]}):t(q,{color:x.color},{default:()=>[x.label]})}},{key:"status",dataIndex:"status",title:"账号状态",align:"center",width:100,customRender:({record:l})=>{const x=We.filter(S=>S.value===l.status)[0];return t(q,{color:x.color},{default:()=>[x.label]})}},{key:"allowPair",dataIndex:"allowPair",title:"任务分配",align:"center",width:100,customRender:({record:l})=>t(q,{color:l.allowPair?"green":"red"},{default:()=>[l.allowPair?"允许":"停止"]})},{key:"dayCount",dataIndex:"dayCount",title:"当日执行任务数",align:"center",width:150,customRender:({record:l})=>t("span",null,[l.dayCount||0])},{key:"monthCount",dataIndex:"monthCount",title:"当月执行任务数",align:"center",width:150,customRender:({record:l})=>t("span",null,[l.monthCount||0])},{key:"nextPairTime",dataIndex:"nextPairTime",title:"下次执行日期",align:"center",width:150,customRender:({record:l})=>t("span",null,[l.nextPairTime||"-"])},{key:"lastInitTime",dataIndex:"lastInitTime",title:"最后同步时间",align:"center",width:200,customRender:({record:l})=>l.lastInitTime||"-"},{key:"device",dataIndex:"device",title:"所属设备",align:"center",width:200,customRender:({record:l})=>`${l.deviceName} (${l.deviceId})`}];return i.userInfo.isTenant||b.push({key:"tenantName",dataIndex:"tenantName",title:"所属商户",align:"center",width:100}),b.push({key:"operate",title:"操作",align:"center",fixed:"right",width:80,customRender:({record:l})=>t("div",{class:"flex-center gap-4px"},[r(l)])}),b}function r(b){return s.hasOne(X.Device.DY.UPDATE)?t(fe,{placement:"top",title:"编辑"},{default:()=>[t(V,{size:"small",type:"link",onClick:()=>N(b.id)},{default:()=>[t(Ye,null,null)]})]}):""}function D(){Me.confirm({title:"提示",content:"初始化设备前，请确认主控设备已返回App主界面，初始化过程中，请不要添加商品及任务！",okText:"确认",cancelText:"取消",onOk:async()=>{var b;try{const l=k.value;if(l&&l.length){const{data:x,error:S}=await Xe(l);!S&&x&&x.code===0&&((b=window.$message)==null||b.success("指令已下发"),w())}}catch{}}})}function L(){h.allowPairVisible=!0}de(async()=>{i.userInfo.isTenant&&await R()}),ce(async()=>{i.userInfo.isTenant&&await R()});async function R(){try{const{data:b,error:l}=await Le();!l&&b&&b.code===0&&(f.value=b.data.list)}catch{}}return(b,l)=>{const x=Ie,S=V,H=Ae,Y=Ue,K=Ge;return O(),ne("div",Tt,[t(at,{model:y(A),"onUpdate:model":l[0]||(l[0]=m=>J(A)?A.value=m:null),"user-info":y(i).userInfo,init:y(me),"buy-pay-type":_.value,onReset:y(I),onSearch:l[1]||(l[1]=m=>y(w)(1))},null,8,["model","user-info","init","buy-pay-type","onReset"]),t(K,{title:"抖音设备",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:n(()=>[t(H,{columns:y(g),"onUpdate:columns":l[3]||(l[3]=m=>J(g)?g.value=m:null),"disabled-delete":y(k).length===0,loading:y(c),"add-btn":!1,"delete-btn":!1},{default:n(()=>[y(s).hasOne(y(X).Device.DY.UPDATE)&&y(i).userInfo.isTenant?(O(),F(S,{key:0,size:"small",ghost:"",type:"primary",disabled:y(k).length===0,onClick:D},{icon:n(()=>[t(x)]),default:n(()=>[l[6]||(l[6]=M("span",{class:"ml-6px"},"初始化",-1))]),_:1},8,["disabled"])):pe("",!0),y(s).hasOne(y(X).Device.DY.UPDATE)&&y(i).userInfo.isTenant?(O(),F(S,{key:1,disabled:y(k).length===0,size:"small",ghost:"",type:"primary",class:"v-center flex",onClick:l[2]||(l[2]=m=>L())},{icon:n(()=>[t(y(He))]),default:n(()=>[l[7]||(l[7]=M("span",{class:"ml-6px"},"任务分配",-1))]),_:1},8,["disabled"])):pe("",!0)]),_:1},8,["columns","disabled-delete","loading"])]),default:n(()=>[t(Y,{ref_key:"tableWrapperRef",ref:o,columns:y(T),"data-source":y(a),size:"small","row-selection":y($),scroll:y(d),loading:y(c),"row-key":"id",pagination:y(P),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),t(wt,{visible:y(E),"onUpdate:visible":l[4]||(l[4]=m=>J(E)?E.value=m:null),"auth-store":y(i),"row-data":y(U),"pay-type":_.value,onSubmitted:y(w)},null,8,["visible","auth-store","row-data","pay-type","onSubmitted"]),t(ht,{visible:h.allowPairVisible,"onUpdate:visible":l[5]||(l[5]=m=>h.allowPairVisible=m),ids:y(k),onSubmitted:y(w)},null,8,["visible","ids","onSubmitted"])]),_:1})])}}});export{Qt as default};
