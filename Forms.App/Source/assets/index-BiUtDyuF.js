import{_ as re}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as ue,S as X,a as ie,b as de,T as me,u as ce,c as fe,d as pe,e as _e,f as ve}from"./table-search-filter-oeJAv4cw.js";import{aP as Y,m as $,d as W,D as P,E as Z,c as q,o as O,w as l,f as e,e as U,B as M,s as ee,a as V,r as be,F as ge,z as ye,h as s,g as G,i as we,b as Ie,a8 as j,a9 as K}from"./index-C4fDvJn1.js";import{u as he,A as B}from"./app.permissions-eEP3QY97.js";import{u as L}from"./enum-map-user-BJSgMiaF.js";import{u as te,F as ae,_ as le,I as oe,a as ke,w as Ne}from"./form-C4lsPmD3.js";import{_ as Re}from"./index-Bgjt1Cd5.js";import{R as xe}from"./RetweetOutlined-BZ1EcIpA.js";import{S as Se}from"./index-DjcmxpZa.js";import{_ as Ae}from"./index-B0OEq9ON.js";import{u as Ue}from"./enums-Cr_YM2zq.js";import{C as De}from"./index-CfF1NG6B.js";import{T as J}from"./index-Cd0TkKik.js";import{E as Ee}from"./EditOutlined-CFKuvutP.js";import{D as Ce}from"./DeleteOutlined-vV5-dJ7B.js";import"./index-BSgdO99v.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Fe(t){const{pageIndex:c,pageSize:r}=t,v={pageIndex:c,pageSize:r};return t.email&&(v.email=t.email),t.roleId=Number.parseInt(t.roleId,10),Number.isNaN(t.roleId)||(v.roleId=t.roleId),t.status=Number.parseInt(t.status,10),Number.isNaN(t.status)||(v.status=t.status),$({url:"/api/user/list",params:{...v}})}function Te(t){const{email:c,password:r,nickName:v,roleId:y}=t;return $({url:"/api/user",method:"post",data:{...{email:c,password:r,nickName:v,roleId:y}}})}function Be(t){const{id:c}=t,r={id:c};return t.email&&(r.email=t.email),t.password&&(r.password=t.password),t.nickName&&(r.nickName=t.nickName),t.roleId=Number.parseInt(t.roleId,10),Number.isNaN(t.roleId)||(r.roleId=t.roleId),t.status=Number.parseInt(t.status,10),Number.isNaN(t.status)||(r.status=t.status),Object.keys(r).length===1?Y():$({url:"/api/user",method:"put",data:{...r}})}function Q(t){return!t||!t.length?Y():$({url:"/api/user",method:"delete",params:{ids:t}})}const Pe={class:"flex-1"},Oe={class:"w-full flex-y-center justify-end gap-12px"},Me=W({name:"SystemUserListSearch",__name:"search-filter",props:P({status:{default:()=>[]},role:{default:()=>[]}},{model:{required:!0},modelModifiers:{}}),emits:P(["reset","search"],["update:model"]),setup(t,{emit:c}){const{formRef:r,validate:v,resetFields:y}=te(),d=Z(t,"model"),p=t,m=c;async function D(){await y(),m("reset")}async function R(){await v(),m("search")}return(h,a)=>{const k=oe,w=le,I=Re,N=X,E=ie,x=M,b=de,o=ue,g=ae;return O(),q(me,null,{default:l(()=>[e(g,{ref_key:"formRef",ref:r,name:"filer",model:d.value,"label-col":{span:5,md:7}},{default:l(()=>[e(o,{gutter:[16,16],wrap:""},{default:l(()=>[e(I,{span:24,md:12,lg:6},{default:l(()=>[e(w,{label:"邮箱",name:"email",class:"m-0"},{default:l(()=>[e(k,{value:d.value.email,"onUpdate:value":a[0]||(a[0]=u=>d.value.email=u),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),e(I,{span:24,md:12,lg:6},{default:l(()=>[e(w,{label:"角色",name:"roleId"},{default:l(()=>[e(N,{value:d.value.roleId,"onUpdate:value":a[1]||(a[1]=u=>d.value.roleId=u),placeholder:"- 全部 -",options:p.role,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),e(I,{span:24,md:12,lg:6},{default:l(()=>[e(w,{label:"状态",name:"status"},{default:l(()=>[e(N,{value:d.value.status,"onUpdate:value":a[2]||(a[2]=u=>d.value.status=u),placeholder:"- 全部 -",options:p.status,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),U("div",Pe,[e(w,{class:"m-0"},{default:l(()=>[U("div",Oe,[e(x,{onClick:D},{icon:l(()=>[e(E,{class:"align-sub text-icon"})]),default:l(()=>[a[3]||(a[3]=U("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(x,{type:"primary",ghost:"",onClick:R},{icon:l(()=>[e(b,{class:"align-sub text-icon"})]),default:l(()=>[a[4]||(a[4]=U("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),$e={class:"body"},ze={class:"v-center center flex gap-8px"},He=W({name:"SystemUserOperateDrawer",__name:"operate-drawer",props:P({operateType:{default:"add"},rowData:{default:null},status:{default:()=>[]},role:{default:()=>[]},refreshRole:{type:Function,default:void 0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(t,{emit:c}){const{formRef:r,validate:v,resetFields:y}=te(),d=Z(t,"visible"),p=ee({roleRefresh:!1,submit:!1}),m=t,D=c,R=V(()=>({add:"新增用户",edit:"编辑用户"})[m.operateType]),h=V(()=>m.operateType==="edit"),a=be(w()),k=V(()=>{const{formRules:b,defaultRequiredRule:o}=ke();return{email:b.email,nickName:b.userName,password:h.value?[{validator(g,u){return u&&u.trim()&&!Ne.test(u)?Promise.reject(new Error("密码格式不正确，6-18位字符，英文字母、数字及@#_!")):Promise.resolve()},trigger:"blur"}]:b.pwd,roleId:[o],status:[o]}});ge(d,()=>{d.value&&(I(),y())});function w(){return{email:"",password:"",nickName:"",roleId:"",status:0}}function I(){a.value=w(),h.value?m.rowData&&Object.assign(a.value,m.rowData):m.role.length&&(a.value.roleId=m.role[0].value)}function N(){d.value=!1}async function E(){var b;await v(),p.submit=!0;try{const{data:o,error:g}=h.value?await Be({...a.value}):await Te({...a.value});!g&&o&&o.code===0&&((b=window.$message)==null||b.success("保存成功"),N(),D("submitted"))}finally{p.submit=!1}}async function x(){if(m.refreshRole){p.roleRefresh=!0;try{await m.refreshRole()}finally{p.roleRefresh=!1}}}return(b,o)=>{const g=oe,u=le,F=X,C=M,z=ae,H=Se,T=Ae;return O(),q(T,{open:d.value,"onUpdate:open":o[5]||(o[5]=_=>d.value=_),title:R.value,width:550},{footer:l(()=>[e(H,{size:16},{default:l(()=>[e(C,{onClick:N},{default:l(()=>o[6]||(o[6]=[G("取消")])),_:1}),e(C,{type:"primary",loading:p.submit,onClick:E},{default:l(()=>o[7]||(o[7]=[G("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[U("div",$e,[e(z,{ref_key:"formRef",ref:r,name:"operate",layout:"vertical",model:a.value,rules:k.value},{default:l(()=>[e(u,{label:"邮箱",name:"email"},{default:l(()=>[e(g,{value:a.value.email,"onUpdate:value":o[0]||(o[0]=_=>a.value.email=_),autocomplete:"off",placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),e(u,{label:"密码",name:"password"},{default:l(()=>[e(g,{value:a.value.password,"onUpdate:value":o[1]||(o[1]=_=>a.value.password=_),autocomplete:"off",placeholder:"请输入密码",type:"password"},null,8,["value"])]),_:1}),e(u,{label:"昵称",name:"nickName"},{default:l(()=>[e(g,{value:a.value.nickName,"onUpdate:value":o[2]||(o[2]=_=>a.value.nickName=_),autocomplete:"off",placeholder:"请输入昵称"},null,8,["value"])]),_:1}),e(u,{label:"角色",name:"roleId"},{default:l(()=>[U("div",ze,[e(F,{value:a.value.roleId,"onUpdate:value":o[3]||(o[3]=_=>a.value.roleId=_),options:m.role},null,8,["value","options"]),e(C,{class:"v-center flex",loading:p.roleRefresh,onClick:x},{default:l(()=>[e(s(xe))]),_:1},8,["loading"])])]),_:1}),h.value?(O(),q(u,{key:0,label:"状态",name:"status"},{default:l(()=>[e(F,{value:a.value.status,"onUpdate:value":o[4]||(o[4]=_=>a.value.status=_),options:m.status},null,8,["value","options"])]),_:1})):ye("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["open","title"])}}}),Ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ct=W({name:"system_user",__name:"index",setup(t){const c=he(),{tableWrapperRef:r,scrollConfig:v}=ce(),y=ee({role:[]});we(async()=>{await T()});const{columns:d,columnChecks:p,data:m,getData:D,getDataByPage:R,loading:h,mobilePagination:a,searchParams:k,resetSearchParams:w}=fe({apiFn:Fe,apiParams:{pageIndex:1,pageSize:10},columns:H}),{drawerVisible:I,operateType:N,editingData:E,handleAdd:x,handleEdit:b,checkedRowKeys:o,rowSelection:g,onBatchDeleted:u,onDeleted:F}=pe(m,D);async function C(){const i=o.value;if(i&&i.length){const{data:n,error:f}=await Q(i);!f&&n&&n.code===0&&u()}}async function z(i){const{data:n,error:f}=await Q([i]);!f&&n&&n.code===0&&F()}function H(){return[{key:"email",dataIndex:"email",title:"邮箱"},{key:"nickName",dataIndex:"nickName",title:"昵称"},{key:"roleName",dataIndex:"roleName",title:"角色",align:"center"},{key:"status",dataIndex:"status",title:"状态",align:"center",width:100,customRender:({record:n})=>{const f=L.filter(S=>S.value===n.status)[0];return e(J,{color:f.color},{default:()=>[f.label]})}},{key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200},{key:"operate",title:"操作",align:"center",width:130,customRender:({record:n})=>{const f=_(n),S=se(n);return e("div",{class:"flex-center gap-4px"},[f,S,f===""&&S===""?e(J,null,{default:()=>[G("无可用操作")]}):""])}}]}async function T(){const{data:i,error:n}=await Ue();!n&&i&&i.code===0&&(y.role=(i.data.list||[]).map(f=>({value:f.value,label:f.text})))}function _(i){if(c.hasOne(B.System.User.UPDATE)){if(i.roleId===1e3)return""}else return"";return e(K,{placement:"top",title:"编辑"},{default:()=>[e(M,{size:"small",type:"link",onClick:()=>b(i.id)},{default:()=>[e(Ee,null,null)]})]})}function se(i){if(c.hasOne(B.System.User.DELETE)){if(i.roleId===1e3)return""}else return"";return e(ve,{title:"确认删除吗？",onConfirm:()=>z(i.id)},{default:()=>[e(K,{placement:"top",title:"删除"},{default:()=>[e(M,{danger:!0,size:"small",type:"link"},{default:()=>[e(Ce,null,null)]})]})]})}return(i,n)=>{const f=re,S=_e,ne=De;return O(),Ie("div",Ve,[e(Me,{model:s(k),"onUpdate:model":n[0]||(n[0]=A=>j(k)?k.value=A:null),role:y.role,status:s(L),onReset:s(w),onSearch:n[1]||(n[1]=A=>s(R)(1))},null,8,["model","role","status","onReset"]),e(ne,{title:"用户列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[e(f,{columns:s(p),"onUpdate:columns":n[2]||(n[2]=A=>j(p)?p.value=A:null),"disabled-delete":s(o).length===0,loading:s(h),"add-btn":s(c).hasOne(s(B).System.User.CREATE),"delete-btn":s(c).hasOne(s(B).System.User.DELETE),onAdd:s(x),onDelete:C},null,8,["columns","disabled-delete","loading","add-btn","delete-btn","onAdd"])]),default:l(()=>[e(S,{ref_key:"tableWrapperRef",ref:r,columns:s(d),"data-source":s(m),size:"small","row-selection":s(g),scroll:s(v),loading:s(h),"row-key":"id",pagination:s(a),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(He,{visible:s(I),"onUpdate:visible":n[3]||(n[3]=A=>j(I)?I.value=A:null),"operate-type":s(N),"row-data":s(E),role:y.role,status:s(L),"refresh-role":T,onSubmitted:s(R)},null,8,["visible","operate-type","row-data","role","status","onSubmitted"])]),_:1})])}}});export{ct as default};
