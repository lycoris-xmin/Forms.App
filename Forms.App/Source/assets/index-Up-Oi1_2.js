import{_ as $e}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as Se,a as De}from"./smartphone-Dpn5Nrf2.js";import{_ as Fe,S as ie,g as re,a as Ce,b as Ee,T as Ue,u as Oe,c as Be,d as Me,e as Le}from"./table-search-filter-oeJAv4cw.js";import{m as z,d as K,D as V,E as ue,c as S,o as A,w as l,f as e,z as W,e as B,v as Z,b as q,H as ne,P as oe,g as I,t as le,B as Q,r as j,s as de,a as ce,F as ye,i as se,h as y,ab as Ne,q as Ve,aj as We,j as ve,a8 as ee,M as je,a9 as be}from"./index-C4fDvJn1.js";import{u as Qe,A as te}from"./app.permissions-eEP3QY97.js";import{a as ge,g as ze}from"./index-DiqUFypO.js";import{u as pe,F as me,_ as fe,I as Te,a as xe,d as He,e as qe}from"./form-C4lsPmD3.js";import{_ as Ge}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{_ as Ke}from"./index-Bgjt1Cd5.js";import{L as Je}from"./index-EP99CXY3.js";import{C as G}from"./china.area-DOOnik0V.js";import{d as Xe}from"./debounce-C-eHgR1J.js";import{S as Ae}from"./index-DjcmxpZa.js";import{_ as Ie}from"./index-B0OEq9ON.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as ae,h as Ye}from"./enum-map-device-i1knBcFt.js";import{U as Ze}from"./UnlockOutlined-DaPYw7sf.js";import{C as et}from"./index-CfF1NG6B.js";import{T as tt}from"./ToolFilled-ZDFYkt8X.js";import{T as N}from"./index-Cd0TkKik.js";import{d as at}from"./enums-Cr_YM2zq.js";import"./index-BSgdO99v.js";import"./LeftOutlined-byKmxFgc.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./responsiveObserve-k0SNxmCv.js";import"./isSymbol-7IJmde0n.js";function nt(t){const{pageIndex:o,pageSize:a}=t,r={pageIndex:o,pageSize:a};return t.buyPayType!==void 0&&typeof t.buyPayType=="number"&&(r.buyPayType=t.buyPayType),t.init!==void 0&&typeof t.init=="number"&&(r.init=t.init),t.allowPair!==void 0&&typeof t.allowPair=="number"&&(r.allowPair=t.allowPair===1),t.account&&(r.account=t.account),t.userId&&(r.userId=t.userId),t.deviceId&&(r.deviceId=t.deviceId),t.deviceName&&(r.deviceName=t.deviceName),z({url:"/api/device/taobao/list",params:{...r}})}function ot(t){const o={id:t.id,buyPayType:t.buyPayType,allowPair:t.allowPair,taoQi:t.taoQi??null,age:t.age||null,payPhone:t.payPhone||null,payPassword:t.payPassword||null,name:t.name,phone:t.phone,province:t.province,city:t.city,address:t.address};return z({url:"/api/device/taobao",method:"put",data:o})}function lt(t){return z({url:`/api/device/taobao/${t}`})}function st(t){return z({url:"/api/device/taobao/init",method:"post",data:{ids:t}})}function it(t){return z({url:"/api/device/taobao/allowPair",method:"post",data:{...t}})}const rt={class:"flex-1"},ut={class:"w-full flex-y-center justify-end gap-12px"},dt=K({name:"DeviceTaobaoListSearch",__name:"search-filter",props:V({buyPayType:{default:()=>[]},init:{default:()=>[]},userInfo:{default:()=>{}}},{model:{required:!0},modelModifiers:{}}),emits:V(["reset","search"],["update:model"]),setup(t,{emit:o}){const{formRef:a,validate:r,resetFields:u}=pe(),d=ue(t,"model"),v=t,P=o;async function n(){await u(),P("reset")}async function k(){await r(),P("search")}return(T,f)=>{const C=Te,c=fe,h=Ke,R=re,D=ie,M=Ce,U=Q,O=Ee,L=Fe,F=me;return A(),S(Ue,null,{default:l(()=>[e(F,{ref_key:"formRef",ref:a,name:"filer",model:d.value,"label-col":{span:5,md:7}},{default:l(()=>[e(L,{gutter:[16,16],wrap:""},{default:l(()=>[e(h,{span:24,md:12,lg:6},{default:l(()=>[e(c,{label:"系统编号",name:"deviceId",class:"m-0"},{default:l(()=>[e(C,{value:d.value.deviceId,"onUpdate:value":f[0]||(f[0]=w=>d.value.deviceId=w),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:Z(k,["enter"])},null,8,["value"])]),_:1})]),_:1}),e(h,{span:24,md:12,lg:6},{default:l(()=>[e(c,{label:"设备名称",name:"deviceName",class:"m-0"},{default:l(()=>[e(C,{value:d.value.deviceName,"onUpdate:value":f[1]||(f[1]=w=>d.value.deviceName=w),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:Z(k,["enter"])},null,8,["value"])]),_:1})]),_:1}),e(h,{span:24,md:12,lg:6},{default:l(()=>[e(c,{label:"登录账号",name:"account",class:"m-0"},{default:l(()=>[e(C,{value:d.value.account,"onUpdate:value":f[2]||(f[2]=w=>d.value.account=w),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:Z(k,["enter"])},null,8,["value"])]),_:1})]),_:1}),v.buyPayType&&v.buyPayType.length>1?(A(),S(h,{key:0,span:24,md:12,lg:6},{default:l(()=>[e(c,{label:"支付方式",name:"buyPayType"},{default:l(()=>[e(D,{value:d.value.buyPayType,"onUpdate:value":f[3]||(f[3]=w=>d.value.buyPayType=w),placeholder:"- 全部 -","allow-clear":""},{default:l(()=>[(A(!0),q(ne,null,oe(v.buyPayType,w=>(A(),S(R,{key:w.value,value:w.value},{default:l(()=>[I(le(w.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})):W("",!0),e(h,{span:24,md:12,lg:6},{default:l(()=>[e(c,{label:"状态",name:"init"},{default:l(()=>[e(D,{value:d.value.init,"onUpdate:value":f[4]||(f[4]=w=>d.value.init=w),placeholder:"- 全部 -","allow-clear":""},{default:l(()=>[(A(!0),q(ne,null,oe(v.init,w=>(A(),S(R,{key:w.value,value:w.value},{default:l(()=>[I(le(w.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),e(h,{span:24,md:12,lg:6},{default:l(()=>[e(c,{label:"任务分配",name:"allowPair"},{default:l(()=>[e(D,{value:d.value.allowPair,"onUpdate:value":f[5]||(f[5]=w=>d.value.allowPair=w),placeholder:"- 全部 -","allow-clear":""},{default:l(()=>[e(R,{value:1},{default:l(()=>f[7]||(f[7]=[I("允许任务分配")])),_:1}),e(R,{value:0},{default:l(()=>f[8]||(f[8]=[I("停止任务分配")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),v.userInfo.isTenant?W("",!0):(A(),S(h,{key:1,span:24,md:12,lg:6},{default:l(()=>[e(c,{label:"所属商户",name:"userId",class:"m-0"},{default:l(()=>[e(Ge,{value:d.value.userId,"onUpdate:value":f[6]||(f[6]=w=>d.value.userId=w),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),B("div",rt,[e(c,{class:"m-0"},{default:l(()=>[B("div",ut,[e(U,{onClick:n},{icon:l(()=>[e(M,{class:"align-sub text-icon"})]),default:l(()=>[f[9]||(f[9]=B("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(U,{type:"primary",ghost:"",onClick:k},{icon:l(()=>[e(O,{class:"align-sub text-icon"})]),default:l(()=>[f[10]||(f[10]=B("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),_e=["北京","上海","天津","重庆"],Pe=["内蒙古自治区","广西壮族自治区","宁夏回族自治区","西藏自治区","新疆维吾尔自治区"],we=["香港特别行政区","澳门特别行政区","台湾省"],ct=Xe((t,o)=>{var a,r,u,d;t||o(void 0);try{const v=bt(t);v||((a=window.$message)==null||a.error("地址解析失败，请确认格式"),o(void 0));const P=ke(v.province,v.city);P.length===2?(v.areaValues=P,(r=window.$message)==null||r.success("解析成功")):(u=window.$message)==null||u.error("无法找到对应的省市选项"),o(v)}catch{(d=window.$message)==null||d.error("解析地址失败，请检查格式是否正确"),o(void 0)}},500),pt=[{type:"municipality",condition:t=>_e.some(o=>t.startsWith(o)),parser:(t,o)=>{const a=_e.find(r=>t.startsWith(r));return a?vt(t,o,a):null}},{type:"autonomous",condition:t=>Pe.some(o=>t.startsWith(o)||t.startsWith(o.replace("自治区",""))),parser:(t,o)=>{const a=Pe.find(r=>t.startsWith(r)||t.startsWith(r.replace("自治区","")));return a?gt(t,o,a):null}},{type:"special",condition:t=>we.some(o=>t.startsWith(o)||t.startsWith(o.replace(/(特别行政区|省)/,""))),parser:(t,o)=>{const a=we.find(r=>t.startsWith(r)||t.startsWith(r.replace(/(特别行政区|省)/,"")));return a?_t(t,o,a):null}},{type:"normal",condition:()=>!0,parser:(t,o)=>Pt(t,o)}],he=G;function mt(t){if(!t)return"";const o=t.split(/[\n\r]+/).map(r=>r.trim());return[/^收件人[:：]?\s*[\u4E00-\u9FA5]{2,}/,/^手机号码[:：]?\s*1[3-9]\d{9}/,/^所在地区[:：]?\s*[\u4E00-\u9FA5]+/,/^详细地址[:：]?\s*.+/].every(r=>o.some(u=>r.test(u)))?"":"error"}function ft(t){if(!t)return"";const o=t.split(/[\n\r]+/).map(u=>u.trim()),r=[{name:"收件人",regex:/^收件人[:：]?\s*[\u4E00-\u9FA5]{2,}/},{name:"手机号码",regex:/^手机号码[:：]?\s*1[3-9]\d{9}/},{name:"所在地区",regex:/^所在地区[:：]?\s*[\u4E00-\u9FA5]+/},{name:"详细地址",regex:/^详细地址[:：]?\s*.+/}].filter(u=>!o.some(d=>u.regex.test(d)));return r.length>0?`地址格式不正确

当前缺少或格式不正确：${r.map(u=>u.name).join("、")}`:""}function yt(t){return new Promise(o=>{ct(t,a=>{o(a)})})}function ke(t,o){var u,d;const a=(u=Object.entries(G[86]).find(([v,P])=>P===t))==null?void 0:u[0];if(!a)return[];const r=(d=Object.entries(G[a]).find(([v,P])=>P===o))==null?void 0:d[0];return r?[a,r]:[]}function vt(t,o,a){const r=`${a}市`;let u=t;u=u.replace(new RegExp(`^${a}${a}市`),a),u=u.replace(new RegExp(`^${a}市${a}市`),`${a}市`),u=u.replace(new RegExp(`^${a}${a}`),a),u=u.replace(new RegExp(`^${a}市`),a),u=u.replace(new RegExp(`^${a}`),a);const d=u.match(new RegExp(`${a}(.+?区|.+?县)(.+)?$`));if(d){const P=d[1],k=(d[2]||"")+(o?` ${o}`:"");return{province:r,city:P,address:k}}const v=u.replace(new RegExp(`^${a}`),"")+(o?` ${o}`:"");return{province:r,city:v,address:""}}function bt(t){const o=t.replace(/：/g,":").replace(/\s+/g," ").trim();if(!["收件人:","手机号码:","所在地区:","详细地址:"].every(h=>o.includes(h)))return null;const u=o.match(/收件人:\s*([\u4E00-\u9FA5]{2,})\s*(?=手机号码:|$)/),d=o.match(/手机号码:\s*(1[3-9]\d{9})\s*(?=所在地区:|$)/),v=o.match(/所在地区:\s*([^\n]+?)(?=详细地址:|$)/),P=o.match(/详细地址:\s*([^\n]+?)(?=$)/);if(!u||!d||!v||!P)return null;const n=u[1].trim(),k=d[1].trim(),T=v[1].trim(),f=P[1].trim();if(!n||!k||!T||!f)return null;const C=T.replace(/\s+/g,""),c=wt(C,f);return!c||!c.province||!c.city?null:{...c,phone:k,name:n}}function gt(t,o,a){const r=a,u=t.slice(t.startsWith(a)?a.length:a.replace("自治区","").length),d=u.match(/^[^市]+市/),v=d?d[0]:"",P=d?u.slice(v.length)+(o?` ${o}`:""):u+(o?` ${o}`:"");return{province:r,city:v,address:P}}function _t(t,o,a){const r=a,u=t.slice(t.startsWith(a)?a.length:a.replace(/(特别行政区|省)/,"").length);return{province:r,city:"",address:u+(o?` ${o}`:"")}}function Pt(t,o){const a=t.match(/^(.*?省)(.*?市)(.*)$/);if(a)return{province:a[1],city:a[2],address:a[3]+(o?` ${o}`:"")};const r=t.match(/^(.*?)(市)(.*)$/);if(r){const u=r[1],d=Object.entries(G[86]).find(([v,P])=>P.startsWith(u)||P.replace(/(省|自治区|特别行政区)/,"").startsWith(u));if(d)return{province:d[1],city:r[1]+r[2],address:r[3]+(o?` ${o}`:"")}}return null}function wt(t,o){for(const{condition:a,parser:r}of pt)if(a(t)){const u=r(t,o);if(u)return u}return null}const ht={class:"body"},Tt=`收件人: 张三
手机号码: 13800138000
所在地区: 浙江省杭州市西湖区
详细地址: xxx路xxx号`,xt=K({name:"DeviceTaobaoEditDrawer",__name:"edit-drawer",props:V({rowData:{},payType:{},authStore:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(t,{emit:o}){const a=ue(t,"visible"),r=j(null),u=j(null),{formRef:d,validate:v,resetFields:P}=pe(),n=de({id:"",taoQi:0,age:"1天",allowPair:0,buyPayType:0,payPassword:"",payPhone:"",loading:!0,submitLoading:!1,oldPayPhone:"",province:"",city:"",address:"",name:"",phone:"",tbAddressText:""}),k=ce(()=>n.allowPair?"任务分配(允许任务分配后，将自动分配TB联盟任务)":"任务分配(停止任务分配后，TB联盟任务将不再分配)"),T=t,{defaultRequiredRule:f}=xe(),C={taoQi:f,age:f,allowPair:f,buyPayType:f,payPassword:[{validator:(g,s)=>!s||n.buyPayType===2?Promise.resolve():s.length!==6||!/^\d+$/.test(s)?Promise.reject(new Error("支付密码应为六位数字")):Promise.resolve(),trigger:"blur"}],payPhone:[f,{validator:(g,s)=>n.buyPayType!==2||!s||qe.test(s)?Promise.resolve():Promise.reject(new Error("代付手机号格式错误")),trigger:"blur"}],name:[{validator:(g,s)=>s&&s.length>30?Promise.reject(new Error("收货人姓名不能超过30个字")):Promise.resolve(),trigger:"blur"}]},c=o,h=j([]),R=j([]);ye(()=>n.tbAddressText,U),ye(a,async g=>{g&&(M(),await D())});async function D(){var g,s;n.loading=!0;try{const{data:p,error:_}=await lt((g=T.rowData)==null?void 0:g.id);if(_||(p==null?void 0:p.code)!==0){(s=window.$message)==null||s.error("获取详情失败");return}if(Object.assign(n,{id:p.data.id,taoQi:T.rowData.taoQi,age:T.rowData.age,allowPair:T.rowData.allowPair?1:0,buyPayType:p.data.buyPayType,payPassword:p.data.payPassword,payPhone:p.data.payPhone,oldPayPhone:p.data.payPhone,name:p.data.name,phone:p.data.phone,province:p.data.province,city:p.data.city,address:p.data.address}),p.data.province&&p.data.city){const $=ke(p.data.province,p.data.city);$.length===2&&(R.value=$)}}finally{n.loading=!1}}function M(){P(),n.id="",n.oldPayPhone="",R.value=[],Object.assign(n,{taoQi:0,age:"1天",buyPayType:0,payPassword:"",payPhone:"",name:"",phone:"",province:"",city:"",address:"",tbAddressText:""})}se(()=>{const g=he[86];h.value=Object.entries(g).map(([s,p])=>{const _=he[s],$=_?Object.entries(_).map(([b,i])=>({value:b,label:i,isLeaf:!0})):[];return{value:s,label:p,children:$}})});async function U(g){if(!g)return;const s=await yt(g);Object.assign(n,s),R.value=s.areaValues}function O(){a.value=!1}async function L(){var g,s;await v();try{n.submitLoading=!0;const p={id:(g=T.rowData)==null?void 0:g.id,buyPayType:n.buyPayType,taoQi:n.taoQi,age:n.age,allowPair:n.allowPair===1,payPhone:n.payPhone,payPassword:n.payPassword,name:n.name,phone:n.phone,province:n.province,city:n.city,address:n.address},{data:_,error:$}=await ot(p);!$&&(_==null?void 0:_.code)===0&&((s=window.$message)==null||s.success("保存成功"),c("submitted"),O())}finally{n.submitLoading=!1}}async function F(){var g,s,p;n.payPhone=n.oldPayPhone,(g=d.value)==null||g.clearValidate(),await Ne(),n.buyPayType===2?(s=r.value)==null||s.focus():(p=u.value)==null||p.focus()}function w(g){var s;if(g&&g.length===2){const p=h.value.find(_=>_.value===g[0]);if(p){n.province=p.label;const _=(s=p.children)==null?void 0:s.find($=>$.value===g[1]);_&&(n.city=_.label)}}else n.province="",n.city=""}async function J(){var g;await((g=d.value)==null?void 0:g.validateFields(["tbAddressText"]))}return(g,s)=>{const p=Te,_=fe,$=re,b=ie,i=Se,x=He,E=me,H=Q,X=Ae,Y=Ie;return A(),S(Y,{open:a.value,"onUpdate:open":s[11]||(s[11]=m=>a.value=m),title:"编辑淘宝设备",width:500},{footer:l(()=>[e(X,{size:16},{default:l(()=>[e(H,{onClick:O},{default:l(()=>s[14]||(s[14]=[I("取消")])),_:1}),e(H,{type:"primary",loading:n.submitLoading,onClick:L},{default:l(()=>s[15]||(s[15]=[I("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[B("div",ht,[e(E,{ref_key:"formRef",ref:d,name:"operate",layout:"vertical",model:n,rules:C},{default:l(()=>[T.authStore.isInternalTenant&&!T.authStore.userInfo.isTenantUser?(A(),S(_,{key:0,label:"淘气值",name:"taoQi"},{default:l(()=>[e(p,{ref_key:"payPasswordRef",ref:u,value:n.taoQi,"onUpdate:value":s[0]||(s[0]=m=>n.taoQi=m),placeholder:"请输入淘气值"},null,8,["value"])]),_:1})):W("",!0),T.authStore.isInternalTenant&&!T.authStore.userInfo.isTenantUser?(A(),S(_,{key:1,label:"淘龄",name:"age"},{default:l(()=>[e(p,{ref_key:"payPasswordRef",ref:u,value:n.age,"onUpdate:value":s[1]||(s[1]=m=>n.age=m),placeholder:"请输入淘龄"},null,8,["value"])]),_:1})):W("",!0),e(_,{label:k.value,name:"allowPair"},{default:l(()=>[e(b,{value:n.allowPair,"onUpdate:value":s[2]||(s[2]=m=>n.allowPair=m)},{default:l(()=>[e($,{value:1},{default:l(()=>s[12]||(s[12]=[I("允许任务分配")])),_:1}),e($,{value:0},{default:l(()=>s[13]||(s[13]=[I("停止任务分配")])),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),e(_,{label:"支付方式",name:"buyPayType"},{default:l(()=>[e(b,{value:n.buyPayType,"onUpdate:value":s[3]||(s[3]=m=>n.buyPayType=m),onChange:F},{default:l(()=>[(A(!0),q(ne,null,oe(T.payType,m=>(A(),S($,{key:m.value,value:m.value},{default:l(()=>[I(le(m.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n.buyPayType===2?(A(),S(_,{key:2,label:"代付手机",name:"payPhone"},{default:l(()=>[e(p,{ref_key:"payPhoneRef",ref:r,value:n.payPhone,"onUpdate:value":s[4]||(s[4]=m=>n.payPhone=m),placeholder:"请输入代付手机号"},null,8,["value"])]),_:1})):(A(),S(_,{key:3,label:"支付密码",name:"payPassword"},{default:l(()=>[e(p,{ref_key:"payPasswordRef",ref:u,value:n.payPassword,"onUpdate:value":s[5]||(s[5]=m=>n.payPassword=m),placeholder:"请输入支付密码"},null,8,["value"])]),_:1})),e(_,{label:"收货人",name:"name"},{default:l(()=>[e(p,{value:n.name,"onUpdate:value":s[6]||(s[6]=m=>n.name=m),placeholder:"请输入收货人姓名（选填）",maxlength:30,"show-count":""},null,8,["value"])]),_:1}),e(_,{label:"联系电话",name:"phone"},{default:l(()=>[e(p,{value:n.phone,"onUpdate:value":s[7]||(s[7]=m=>n.phone=m),placeholder:"请输入联系电话（选填）"},null,8,["value"])]),_:1}),e(_,{label:"所在地区",name:"selectedArea"},{default:l(()=>[e(i,{value:R.value,"onUpdate:value":s[8]||(s[8]=m=>R.value=m),options:h.value,placeholder:"请选择省市",onChange:w},null,8,["value","options"])]),_:1}),e(_,{label:"详细地址",name:"address"},{default:l(()=>[e(x,{value:n.address,"onUpdate:value":s[9]||(s[9]=m=>n.address=m),placeholder:"请输入详细地址",rows:5,maxlength:300,"show-count":""},null,8,["value"])]),_:1}),e(_,{label:"地址文本解析",name:"tbAddressText","validate-status":y(mt)(n.tbAddressText),help:y(ft)(n.tbAddressText)},{default:l(()=>[e(x,{value:n.tbAddressText,"onUpdate:value":s[10]||(s[10]=m=>n.tbAddressText=m),placeholder:Tt,rows:4,"auto-size":{minRows:4,maxRows:6},onInput:J},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["model"]),e(Je,{loading:n.loading},null,8,["loading"])])]),_:1},8,["open"])}}}),At=Re(xt,[["__scopeId","data-v-3e091051"]]),It={class:"body"},Rt=K({__name:"allow-pair-drawer",props:V({ids:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(t,{emit:o}){const a=ue(t,"visible"),r=de({allowPair:1,submitLoading:!1}),u=o,d=t,v=()=>{a.value=!1},{formRef:P}=pe(),{defaultRequiredRule:n}=xe(),k={allowPair:n},T=ce(()=>r.allowPair?"任务分配(允许任务分配后，将自动分配TB联盟任务)":"任务分配(停止任务分配后，TB联盟任务将不再分配)");async function f(){var c;r.submitLoading=!0;const C={ids:d.ids,allowPair:r.allowPair};try{const{data:h,error:R}=await it(C);!R&&(h==null?void 0:h.code)===0&&((c=window.$message)==null||c.success("保存成功"),u("submitted"),v())}finally{r.submitLoading=!1}}return(C,c)=>{const h=re,R=ie,D=fe,M=me,U=Q,O=Ae,L=Ie;return A(),S(L,{open:a.value,"onUpdate:open":c[1]||(c[1]=F=>a.value=F),title:"任务分配",width:500},{footer:l(()=>[e(O,{size:16},{default:l(()=>[e(U,{type:"default",onClick:v},{default:l(()=>c[4]||(c[4]=[I("取消")])),_:1}),e(U,{type:"primary",loading:r.submitLoading,onClick:f},{default:l(()=>c[5]||(c[5]=[I("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[B("div",It,[e(M,{ref_key:"formRef",ref:P,name:"operate",layout:"vertical",model:r,rules:k},{default:l(()=>[e(D,{label:T.value,name:"allowPair"},{default:l(()=>[e(R,{value:r.allowPair,"onUpdate:value":c[0]||(c[0]=F=>r.allowPair=F)},{default:l(()=>[e(h,{value:1},{default:l(()=>c[2]||(c[2]=[I("允许任务分配")])),_:1}),e(h,{value:0},{default:l(()=>c[3]||(c[3]=[I("停止任务分配")])),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["open"])}}}),kt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},$t=K({name:"device_taobao",__name:"index",setup(t){const o=Qe(),a=Ve(),{tableWrapperRef:r,scrollConfig:u}=Oe(),d=We(),v=j([0]),P=ce(()=>a.userInfo.isTenant?ae.filter(b=>v.value.includes(b.value)):ae),n=de({allowPairVisible:!1}),{columns:k,columnChecks:T,data:f,getData:C,getDataByPage:c,loading:h,mobilePagination:R,searchParams:D,resetSearchParams:M}=Be({apiFn:nt,apiParams:{pageIndex:1,pageSize:10},columns:J}),{drawerVisible:U,editingData:O,handleEdit:L,checkedRowKeys:F,rowSelection:w}=Me(f,C);se(()=>{const b=d.getParams();b&&b.deviceId&&(D.deviceId=b.deviceId,setTimeout(()=>c(1),0))}),ve(()=>{const b=d.getParams();b&&b.deviceId&&(D.deviceId=b.deviceId,c(1))});function J(){const b=[{key:"accountInfo",dataIndex:"accountInfo",title:"账号信息",align:"center",width:300,customRender:({record:i})=>e("div",{style:"font-size:14px"},[e("p",{class:"info mb-6px"},[e("span",null,[I("TB号：")]),e("span",{title:i.account||"-"},[i.account||"-"])]),e("p",null,[e("p",{class:"info mb-6px"},[e("span",null,[I("性别：")]),e("span",{title:i.gender||"-"},[$(i.gender)||"-"])])]),e("p",{class:"info mb-6px"},[e("span",null,[I("淘龄：")]),e("span",{title:i.age||"-"},[i.age||"-"])]),e("p",{class:"info mb-6px"},[e("span",null,[I("淘气值：")]),e("span",{title:i.taoQi||"-"},[i.taoQi||"-"])])])},{key:"buyPayType",dataIndex:"buyPayType",title:"支付方式",align:"center",width:100,customRender:({record:i})=>{const x=ae.filter(E=>E.value===i.buyPayType)[0];return e(N,{color:x.color},{default:()=>[x.label]})}},{key:"init",dataIndex:"init",title:"账号初始化",align:"center",width:120,customRender:({record:i})=>{const x=ge.filter(E=>E.value===i.init)[0];return i.init===3?e(be,{placement:"top",title:e("span",null,[i.remark])},{default:()=>[e(N,{color:x.color},{default:()=>[x.label]})]}):e(N,{color:x.color},{default:()=>[x.label]})}},{key:"status",dataIndex:"status",title:"账号状态",align:"center",width:100,customRender:({record:i})=>{const x=Ye.filter(E=>E.value===i.status)[0];return e(N,{color:x.color},{default:()=>[x.label]})}},{key:"allowPair",dataIndex:"allowPair",title:"任务分配",align:"center",width:100,customRender:({record:i})=>e(N,{color:i.allowPair?"green":"red"},{default:()=>[i.allowPair?"允许":"停止"]})},{key:"dayCount",dataIndex:"dayCount",title:"当日执行任务数",align:"center",width:150,customRender:({record:i})=>e("span",null,[i.dayCount||0])},{key:"monthCount",dataIndex:"monthCount",title:"当月执行任务数",align:"center",width:150,customRender:({record:i})=>e("span",null,[i.monthCount||0])},{key:"nextPairTime",dataIndex:"nextPairTime",title:"下次执行日期",align:"center",width:150,customRender:({record:i})=>e("span",null,[i.nextPairTime||"-"])},{key:"lastInitTime",dataIndex:"lastInitTime",title:"最后同步时间",align:"center",width:200,customRender:({record:i})=>i.lastInitTime||"-"},{key:"device",dataIndex:"device",title:"所属设备",align:"center",width:200,customRender:({record:i})=>`${i.deviceName} (${i.deviceId})`}];return a.userInfo.isTenant||b.push({key:"tenantName",dataIndex:"tenantName",title:"所属商户",align:"center",width:100}),b.push({key:"operate",title:"操作",align:"center",fixed:"right",width:80,customRender:({record:i})=>e("div",{class:"flex-center gap-4px"},[g(i)])}),b}function g(b){return o.hasOne(te.Device.Taobao.UPDATE)?e(be,{placement:"top",title:"编辑"},{default:()=>[e(Q,{size:"small",type:"link",onClick:()=>L(b.id)},{default:()=>[e(tt,null,null)]})]}):""}function s(){je.confirm({title:"警告",content:"初始化设备前，请确认主控设备已返回App主界面，初始化过程中，请不要添加商品及任务！",okText:"确认",cancelText:"取消",onOk:async()=>{var b;try{const i=F.value;if(i&&i.length){const{data:x,error:E}=await st(i);!E&&x&&x.code===0&&((b=window.$message)==null||b.success("指令已下发"),c())}}catch{}}})}function p(){n.allowPairVisible=!0}se(async()=>{a.userInfo.isTenant&&await _()}),ve(async()=>{a.userInfo.isTenant&&await _()});async function _(){try{const{data:b,error:i}=await at();!i&&b&&b.code===0&&(v.value=b.data.list)}catch{}}function $(b){const i=ze.filter(x=>x.value===b)[0];return e(N,{color:i.color},{default:()=>[i.label]})}return(b,i)=>{const x=De,E=Q,H=$e,X=Le,Y=et;return A(),q("div",kt,[e(dt,{model:y(D),"onUpdate:model":i[0]||(i[0]=m=>ee(D)?D.value=m:null),"user-info":y(a).userInfo,init:y(ge),"buy-pay-type":P.value,onReset:y(M),onSearch:i[1]||(i[1]=m=>y(c)(1))},null,8,["model","user-info","init","buy-pay-type","onReset"]),e(Y,{title:"淘宝设备",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[e(H,{columns:y(T),"onUpdate:columns":i[3]||(i[3]=m=>ee(T)?T.value=m:null),"disabled-delete":y(F).length===0,loading:y(h),"add-btn":!1,"delete-btn":!1},{default:l(()=>[y(o).hasOne(y(te).Device.Taobao.UPDATE)&&y(a).userInfo.isTenant?(A(),S(E,{key:0,size:"small",ghost:"",type:"primary",disabled:y(F).length===0,onClick:s},{icon:l(()=>[e(x)]),default:l(()=>[i[6]||(i[6]=B("span",{class:"ml-6px"},"初始化",-1))]),_:1},8,["disabled"])):W("",!0),y(o).hasOne(y(te).Device.Taobao.UPDATE)&&y(a).userInfo.isTenant?(A(),S(E,{key:1,disabled:y(F).length===0,size:"small",ghost:"",type:"primary",class:"v-center flex",onClick:i[2]||(i[2]=m=>p())},{icon:l(()=>[e(y(Ze))]),default:l(()=>[i[7]||(i[7]=B("span",{class:"ml-6px"},"任务分配",-1))]),_:1},8,["disabled"])):W("",!0)]),_:1},8,["columns","disabled-delete","loading"])]),default:l(()=>[e(X,{ref_key:"tableWrapperRef",ref:r,columns:y(k),"data-source":y(f),size:"small","row-selection":y(w),scroll:y(u),loading:y(h),"row-key":"id",pagination:y(R),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(Rt,{visible:n.allowPairVisible,"onUpdate:visible":i[4]||(i[4]=m=>n.allowPairVisible=m),ids:y(F),onSubmitted:y(c)},null,8,["visible","ids","onSubmitted"]),e(At,{visible:y(U),"onUpdate:visible":i[5]||(i[5]=m=>ee(U)?U.value=m:null),"auth-store":y(a),"row-data":y(O),"pay-type":P.value,onSubmitted:y(c)},null,8,["visible","auth-store","row-data","pay-type","onSubmitted"])]),_:1})])}}}),na=Re($t,[["__scopeId","data-v-979a8349"]]);export{na as default};
