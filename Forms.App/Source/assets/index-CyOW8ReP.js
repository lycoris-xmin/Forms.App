import{_ as fe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{S as se,g as ue,_ as ye,a as ve,b as _e,T as he,u as ge,c as be,d as Ne,e as Ae,f as Te}from"./table-search-filter-oeJAv4cw.js";import{m as G,d as ae,D as V,r as le,E as re,s as ie,a as te,F as we,c as N,o as v,w as o,e as z,f as e,z as H,b as q,H as X,P as Y,B as j,g as x,h as s,ab as Pe,t as Z,q as Ue,i as Ie,a8 as J,a9 as oe}from"./index-C4fDvJn1.js";import{u as Le,A as $}from"./app.permissions-eEP3QY97.js";import{_ as Se,a as xe}from"./index-DvGwdmYs.js";import{u as pe,a as ke,F as de,_ as me,I as ce}from"./form-C4lsPmD3.js";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{S as De}from"./index-DjcmxpZa.js";import{P as Ee,C as Re}from"./index-CfF1NG6B.js";import{_ as Ce}from"./index-B0OEq9ON.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Oe}from"./index-Bgjt1Cd5.js";import{o as Be}from"./enums-Cr_YM2zq.js";import{T as $e}from"./index-Cd0TkKik.js";import{E as ze}from"./EditOutlined-CFKuvutP.js";import{D as He}from"./DeleteOutlined-vV5-dJ7B.js";import"./index-BSgdO99v.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";function Me(l){const{pageIndex:c,pageSize:u}=l,_={pageIndex:c,pageSize:u};return l.alipayAccount&&(_.alipayAccount=l.alipayAccount),l.alipayName&&(_.alipayName=l.alipayName),l.shopName&&(_.shopName=l.shopName),l.tenantUser&&(_.tenantUser=l.tenantUser),l.userId&&(_.userId=l.userId),l.alipayLovePayType&&(_.alipayLovePayType=l.alipayLovePayType),G({url:"/api/alipay/lovepay/list",params:{..._}})}function Ve(l){const{alipayName:c}=l,u={alipayName:c};return l.alipayAccount&&(u.alipayAccount=l.alipayAccount),l.tenantUser&&(u.tenantUser=l.tenantUser),l.shopName&&(u.shopName=l.shopName),l.alipayLovePayType&&(u.alipayLovePayType=l.alipayLovePayType),G({url:"/api/alipay/lovepay",method:"post",data:{...u}})}function qe(l){const{id:c}=l,u={id:c};return l.alipayAccount&&(u.alipayAccount=l.alipayAccount),l.alipayName&&(u.alipayName=l.alipayName),l.tenantUser&&(u.tenantUser=l.tenantUser),l.shopName&&(u.shopName=l.shopName),Object.keys(u).length===1?baseResp():G({url:"/api/alipay/lovepay",method:"put",data:{...u}})}function ne(l){return!l||!l.length?baseResp():G({url:"/api/alipay/lovepay",method:"delete",params:{ids:l}})}const Q=[{value:1,label:"店铺亲情卡",color:"purple"},{value:2,label:"个人亲情卡",color:"processing"}],je={class:"body"},Ge=ae({name:"RoleOperateDrawer",__name:"operate-drawer",props:V({operateType:{default:"add"},alipayLovePay:{default:()=>[]},rowData:{default:null},userInfo:{default:()=>{}},shopNameEnum:{default:()=>[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(l,{emit:c}){const{formRef:u,validate:_,resetFields:k}=pe(),m=le(null),f=re(l,"visible"),A=ie({submit:!1}),p=l,D=c,E=te(()=>({add:"新增亲情卡",edit:"编辑亲情卡"})[p.operateType]),r=te(()=>p.operateType==="edit"),t=le(P()),{defaultRequiredRule:h}=ke(),b={alipayName:h,alipayAccount:h,shopName:[{required:!0,message:"请选择绑定的店铺"}]};we(f,()=>{f.value&&(k(),T())});function P(){return{id:"",alipayLovePayType:p.userInfo.isTenantUser?2:1,alipayAccount:"",alipayName:"",shopName:"",tenantUser:"",shopNameEnum:p.shopNameEnum,newShopName:""}}function T(){t.value=P(),r.value&&p.rowData&&(p.rowData.alipayLovePayType===1?t.value.shopName=p.rowData.createUserAndShop:t.value.tenantUser=p.rowData.createId,Object.keys(t.value).forEach(y=>{Object.keys(p.rowData).includes(y)&&(t.value[y]=p.rowData[y])}))}function U(){f.value=!1}async function I(){var y;await _(),A.submit=!0;try{const{data:a,error:L}=r.value?await qe({...t.value}):await Ve({...t.value});!L&&a&&a.code===0&&((y=window.$message)==null||y.success("保存成功"),U(),D("submitted"))}finally{A.submit=!1}}async function R(){t.value.shopName="",t.value.tenantUser=""}function C(y){y.preventDefault(),t.value.newShopName&&(t.value.newShopName=t.value.newShopName.trim(),t.value.shopNameEnum.filter(a=>a.value===t.value.newShopName).length||t.value.shopNameEnum.push({text:t.value.newShopName,value:t.value.newShopName}),t.value.shopName=`${t.value.newShopName}`,Pe(()=>{var a;t.value.newShopName="",(a=m.value)==null||a.focus()}))}return(y,a)=>{const L=ue,M=se,w=me,F=ce,W=Se,K=xe,O=j,i=De,d=de,g=Ce;return v(),N(g,{open:f.value,"onUpdate:open":a[6]||(a[6]=n=>f.value=n),title:E.value,width:550},{footer:o(()=>[e(i,{size:16},{default:o(()=>[e(O,{onClick:U},{default:o(()=>a[8]||(a[8]=[x("取消")])),_:1}),e(O,{type:"primary",loading:A.submit,onClick:I},{default:o(()=>a[9]||(a[9]=[x("保存")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[z("div",je,[e(d,{ref_key:"formRef",ref:u,name:"operate",layout:"vertical",model:t.value,rules:b},{default:o(()=>[e(w,{label:"情亲卡类型",name:"alipayLovePay"},{default:o(()=>[e(M,{value:t.value.alipayLovePayType,"onUpdate:value":a[0]||(a[0]=n=>t.value.alipayLovePayType=n),disabled:p.userInfo.isTenant&&p.userInfo.isTenantUser||r.value,onChange:R},{default:o(()=>[(v(!0),q(X,null,Y(p.alipayLovePay,n=>(v(),N(L,{key:n.value,value:n.value},{default:o(()=>[x(Z(n.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1}),e(w,{label:"支付宝账号",name:"alipayAccount"},{default:o(()=>[e(F,{value:t.value.alipayAccount,"onUpdate:value":a[1]||(a[1]=n=>t.value.alipayAccount=n),autocomplete:"off",placeholder:"支付宝账号"},null,8,["value"])]),_:1}),e(w,{label:"亲情卡备注",name:"alipayName"},{default:o(()=>[e(F,{value:t.value.alipayName,"onUpdate:value":a[2]||(a[2]=n=>t.value.alipayName=n),autocomplete:"off",placeholder:"亲情卡备注"},null,8,["value"])]),_:1}),t.value.alipayLovePayType==1?(v(),N(w,{key:0,label:"绑定店铺",name:"shopName"},{default:o(()=>[e(M,{value:t.value.shopName,"onUpdate:value":a[4]||(a[4]=n=>t.value.shopName=n),placeholder:"请选择绑定"},{dropdownRender:o(({menuNode:n})=>[e(W,{vnodes:n},null,8,["vnodes"]),e(K,{class:"mb-4px mt-4px"}),e(i,{class:"select-action"},{default:o(()=>[e(F,{ref_key:"inputRef",ref:m,value:t.value.newShopName,"onUpdate:value":a[3]||(a[3]=B=>t.value.newShopName=B),placeholder:"新绑定店铺"},null,8,["value"]),e(O,{ghost:"",size:"small",type:"primary",onClick:C},{icon:o(()=>[e(s(Ee))]),default:o(()=>[a[7]||(a[7]=x(" 添加新绑定店铺 "))]),_:1})]),_:1})]),default:o(()=>[(v(!0),q(X,null,Y(t.value.shopNameEnum,n=>(v(),N(L,{key:n.value,value:n.text},{default:o(()=>[x(Z(n.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})):H("",!0),t.value.alipayLovePayType==2&&p.userInfo.isTenant&&!p.userInfo.isTenantUser?(v(),N(w,{key:1,label:"绑定员工",name:"tenantUser"},{default:o(()=>[e(ee,{value:t.value.tenantUser,"onUpdate:value":a[5]||(a[5]=n=>t.value.tenantUser=n),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})):H("",!0)]),_:1},8,["model"])])]),_:1},8,["open","title"])}}}),We=Fe(Ge,[["__scopeId","data-v-496ec029"]]),Ke={class:"flex-1"},Je={class:"w-full flex-y-center justify-end gap-12px"},Qe=ae({name:"PlatformAlipayLovePayListSearch",__name:"search-filter",props:V({userInfo:{default:()=>{}},alipayLovePay:{default:()=>{}}},{model:{required:!0},modelModifiers:{}}),emits:V(["reset","search"],["update:model"]),setup(l,{emit:c}){const{formRef:u,validate:_,resetFields:k}=pe(),m=re(l,"model"),f=l,A=c;async function p(){await k(),A("reset")}async function D(){await _(),A("search")}return(E,r)=>{const t=ce,h=me,b=Oe,P=ue,T=se,U=ve,I=j,R=_e,C=ye,y=de;return v(),N(he,null,{default:o(()=>[e(y,{ref_key:"formRef",ref:u,name:"filer",model:m.value,"label-col":{span:5,md:7}},{default:o(()=>[e(C,{gutter:[16,16],wrap:""},{default:o(()=>[e(b,{span:24,md:12,lg:6},{default:o(()=>[e(h,{label:"亲情卡账号",name:"alipayAccount",class:"m-0"},{default:o(()=>[e(t,{value:m.value.alipayAccount,"onUpdate:value":r[0]||(r[0]=a=>m.value.alipayAccount=a),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),e(b,{span:24,md:12,lg:6},{default:o(()=>[e(h,{label:"亲情卡备注",name:"alipayName",class:"m-0"},{default:o(()=>[e(t,{value:m.value.alipayName,"onUpdate:value":r[1]||(r[1]=a=>m.value.alipayName=a),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),f.userInfo.isTenant&&!f.userInfo.isTenantUser?(v(),N(b,{key:0,span:24,md:12,lg:6},{default:o(()=>[e(h,{label:"绑定店铺",name:"shopName",class:"m-0"},{default:o(()=>[e(t,{value:m.value.shopName,"onUpdate:value":r[2]||(r[2]=a=>m.value.shopName=a),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1})):H("",!0),f.userInfo.isTenant&&!f.userInfo.isTenantUser?(v(),N(b,{key:1,span:24,md:12,lg:6},{default:o(()=>[e(h,{label:"亲情卡类型",name:"alipayLovePayType",class:"m-0"},{default:o(()=>[e(T,{value:m.value.alipayLovePayType,"onUpdate:value":r[3]||(r[3]=a=>m.value.alipayLovePayType=a),placeholder:"- 全部 -"},{default:o(()=>[(v(!0),q(X,null,Y(f.alipayLovePay,a=>(v(),N(P,{key:a.value,value:a.value},{default:o(()=>[x(Z(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})):H("",!0),f.userInfo.isTenant?f.userInfo.isTenantUser?H("",!0):(v(),N(b,{key:3,span:24,md:12,lg:6},{default:o(()=>[e(h,{label:"绑定员工",name:"tenantUser",class:"m-0"},{default:o(()=>[e(ee,{value:m.value.tenantUser,"onUpdate:value":r[5]||(r[5]=a=>m.value.tenantUser=a),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})]),_:1})):(v(),N(b,{key:2,span:24,md:12,lg:6},{default:o(()=>[e(h,{label:"所属商户",name:"userId",class:"m-0"},{default:o(()=>[e(ee,{value:m.value.userId,"onUpdate:value":r[4]||(r[4]=a=>m.value.userId=a),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),z("div",Ke,[e(h,{class:"m-0"},{default:o(()=>[z("div",Je,[e(I,{onClick:p},{icon:o(()=>[e(U,{class:"align-sub text-icon"})]),default:o(()=>[r[6]||(r[6]=z("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(I,{type:"primary",ghost:"",onClick:D},{icon:o(()=>[e(R,{class:"align-sub text-icon"})]),default:o(()=>[r[7]||(r[7]=z("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),Xe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Na=ae({name:"platform_alipaylovepay",__name:"index",setup(l){const c=Ue(),u=Le(),_=ie({shopNameEnum:[]}),{tableWrapperRef:k,scrollConfig:m}=ge(),{columns:f,columnChecks:A,searchParams:p,resetSearchParams:D,data:E,getData:r,loading:t,mobilePagination:h,getDataByPage:b,reloadColumns:P}=be({apiFn:Me,apiParams:{pageIndex:1,pageSize:10},columns:W}),{drawerVisible:T,operateType:U,editingData:I,handleAdd:R,handleEdit:C,checkedRowKeys:y,rowSelection:a,onBatchDeleted:L,onDeleted:M}=Ne(E,r);async function w(){const i=y.value;if(i&&i.length){const{data:d,error:g}=await ne(i);!g&&d&&d.code===0&&L()}}async function F(i){const{data:d,error:g}=await ne([i]);!g&&d&&d.code===0&&M()}function W(){const i=[{key:"alipayAccount",dataIndex:"alipayAccount",title:"支付宝账号",align:"center"},{key:"alipayName",dataIndex:"alipayName",title:"亲情卡备注",align:"center"}];c.userInfo.isTenant?c.userInfo.isTenant&&!c.userInfo.isTenantUser&&(i.push({key:"alipayLovePayType",dataIndex:"alipayLovePayType",title:"亲情卡类型",align:"center",customRender:({record:g})=>{const n=Q.filter(B=>B.value===g.alipayLovePayType);return e($e,{color:n[0].color},{default:()=>[n[0].label]})}}),i.push({key:"createUserAndShop",dataIndex:"createUserAndShop",title:"绑定员工/绑定店铺",align:"center"})):i.push({key:"tentName",dataIndex:"tentName",title:"所属商户",align:"center"});const d=[{key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200},{key:"operate",title:"操作",align:"left",width:120,customRender:({record:g})=>e("div",{class:"v-center flex gap-8px"},[K(g),O(g)])}];return[...i,...d]}function K(i){return u.hasOne($.Platform.AlipayLovePay.DELETE)?e(oe,{placement:"top",title:"编辑"},{default:()=>[e(j,{size:"small",type:"link",onClick:()=>C(i.id)},{default:()=>[e(ze,null,null)]})]}):""}function O(i){return u.hasOne($.Platform.AlipayLovePay.DELETE)?e(Te,{title:"确认删除吗？",onConfirm:()=>F(i.id)},{default:()=>[e(oe,{placement:"top",title:"删除"},{default:()=>[e(j,{danger:!0,size:"small",type:"link"},{default:()=>[e(He,null,null)]})]})]}):""}return Ie(async()=>{if(c.userInfo.isTenant&&!c.userInfo.isTenantUser&&u.hasOne($.Platform.AlipayLovePay.CREATE)){const{data:i,error:d}=await Be();!d&&i&&i.code===0&&(_.shopNameEnum=i.data.list,P())}}),(i,d)=>{const g=fe,n=Ae,B=Re;return v(),q("div",Xe,[e(Qe,{model:s(p),"onUpdate:model":d[0]||(d[0]=S=>J(p)?p.value=S:null),"user-info":s(c).userInfo,"alipay-love-pay":s(Q),onReset:s(D),onSearch:d[1]||(d[1]=S=>s(b)(1))},null,8,["model","user-info","alipay-love-pay","onReset"]),e(B,{title:"亲情卡列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:o(()=>[e(g,{columns:s(A),"onUpdate:columns":d[2]||(d[2]=S=>J(A)?A.value=S:null),"disabled-delete":s(y).length===0,loading:s(t),"add-btn":s(u).hasOne(s($).Platform.AlipayLovePay.CREATE),"delete-btn":s(u).hasOne(s($).Platform.AlipayLovePay.DELETE),onAdd:s(R),onDelete:w},null,8,["columns","disabled-delete","loading","add-btn","delete-btn","onAdd"])]),default:o(()=>[e(n,{ref_key:"tableWrapperRef",ref:k,columns:s(f),"data-source":s(E),size:"small","row-selection":s(a),scroll:s(m),loading:s(t),"row-key":"id",pagination:s(h),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(We,{visible:s(T),"onUpdate:visible":d[3]||(d[3]=S=>J(T)?T.value=S:null),"operate-type":s(U),"shop-name-enum":_.shopNameEnum,"row-data":s(I),"user-info":s(c).userInfo,"alipay-love-pay":s(Q),onSubmitted:s(b)},null,8,["visible","operate-type","shop-name-enum","row-data","user-info","alipay-love-pay","onSubmitted"])]),_:1})])}}});export{Na as default};
