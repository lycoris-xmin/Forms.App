import{_ as Se}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as Ue,S as Be,a as Ee,b as Pe,T as Me,u as Ve,c as He,d as Oe,e as Ne,f as le}from"./table-search-filter-oeJAv4cw.js";import{d as O,D as P,E as q,i as je,c as U,o as d,w as o,f as e,z as B,e as g,h as r,a7 as oe,B as z,M as ze,r as E,a as ie,F as ve,g as S,s as _e,b,H as Z,P as ee,t as j,q as Ye,a8 as re,a9 as te,aa as se}from"./index-C4fDvJn1.js";import{u as qe,A as ae}from"./app.permissions-eEP3QY97.js";import{p as ue}from"./index-DiqUFypO.js";import{I as Y,i as A}from"./empty-a1btfWut.js";import{c as de}from"./helper-n1q5wElC.js";import{u as Le,F as We,_ as Ge,I as Ke}from"./form-C4lsPmD3.js";import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{_ as Qe}from"./index-Bgjt1Cd5.js";import{R as Je}from"./dayjs-BBTQ6xGR.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ge}from"./index-B0OEq9ON.js";import{d as Xe,p as ne,e as pe,g as Ze,S as et,h as tt}from"./enum-map-plantask-comment-CYh_5MYR.js";import{S as st}from"./index-tKWHzGWZ.js";import{C as at}from"./index-CfF1NG6B.js";import{D as nt}from"./DeleteOutlined-vV5-dJ7B.js";import{E as me}from"./EyeOutlined-DMOywdMm.js";import{T as fe}from"./index-Cd0TkKik.js";import"./index-BSgdO99v.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";import"./enums-Cr_YM2zq.js";const lt={class:"flex-1"},ot={class:"w-full flex-y-center justify-end gap-12px"},it=O({name:"PlanTaskCommentListSearch",__name:"search-filter",props:P({platform:{},status:{},userInfo:{}},{model:{required:!0},modelModifiers:{}}),emits:P(["reset","search"],["update:model"]),setup(k,{emit:p}){const{formRef:v,validate:m,resetFields:y}=Le(),i=q(k,"model");je(()=>{i.value.createTimeRange=[]});const _=k,c=p;async function u(){await y(),c("reset")}async function h(){await m(),c("search")}function x(t,l){i.value.beginTime=l[0],i.value.endTime=l[1]}return(t,l)=>{const F=Be,T=Ge,C=Qe,W=Ke,M=Je,G=Ee,V=z,K=Pe,Q=Ue,J=We;return d(),U(Me,null,{default:o(()=>[e(J,{ref_key:"formRef",ref:v,class:"search-filter",model:i.value,"label-col":{span:5,md:7}},{default:o(()=>[e(Q,{gutter:[16,16],wrap:""},{default:o(()=>[e(C,{span:24,md:12,lg:6},{default:o(()=>[e(T,{label:"任务平台",name:"platform",class:"m-0"},{default:o(()=>[e(F,{value:i.value.platform,"onUpdate:value":l[0]||(l[0]=w=>i.value.platform=w),placeholder:"- 全部 -",options:_.platform,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),e(C,{span:24,md:12,lg:6},{default:o(()=>[e(T,{label:"任务编号",name:"taskId",class:"m-0"},{default:o(()=>[e(W,{value:i.value.taskId,"onUpdate:value":l[1]||(l[1]=w=>i.value.taskId=w),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),e(C,{span:24,md:12,lg:6},{default:o(()=>[e(T,{label:"任务状态",name:"status",class:"m-0"},{default:o(()=>[e(F,{value:i.value.status,"onUpdate:value":l[2]||(l[2]=w=>i.value.status=w),placeholder:"- 全部 -",options:_.status,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),e(C,{span:24,md:12,lg:6},{default:o(()=>[e(T,{label:"创建时间",name:"createTimeRange",class:"m-0"},{default:o(()=>[e(M,{value:i.value.createTimeRange,"onUpdate:value":l[3]||(l[3]=w=>i.value.createTimeRange=w),"show-time":{defaultValue:[r(oe)("00:00:00","HH:mm:ss"),r(oe)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],onChange:x},null,8,["value","show-time"])]),_:1})]),_:1}),_.userInfo.isTenant?_.userInfo.isTenantUser?B("",!0):(d(),U(C,{key:1,span:24,md:12,lg:6},{default:o(()=>[e(T,{label:"创建员工",name:"userId",class:"m-0"},{default:o(()=>[e(ce,{value:i.value.userId,"onUpdate:value":l[5]||(l[5]=w=>i.value.userId=w),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})]),_:1})):(d(),U(C,{key:0,span:24,md:12,lg:6},{default:o(()=>[e(T,{label:"创建商户",name:"userId",class:"m-0"},{default:o(()=>[e(ce,{value:i.value.userId,"onUpdate:value":l[4]||(l[4]=w=>i.value.userId=w),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),g("div",lt,[e(T,{class:"m-0"},{default:o(()=>[g("div",ot,[e(V,{onClick:u},{icon:o(()=>[e(G,{class:"align-sub text-icon"})]),default:o(()=>[l[6]||(l[6]=g("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(V,{type:"primary",ghost:"",onClick:h},{icon:o(()=>[e(K,{class:"align-sub text-icon"})]),default:o(()=>[l[7]||(l[7]=g("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),rt=L(it,[["__scopeId","data-v-41945b30"]]),ut={class:"v-center center flex"},dt=["src"],ct=O({__name:"video-preview-modal",props:P({video:{default:""}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(k){const p=q(k,"visible"),v=k,m=()=>{p.value=!1};return(y,i)=>{const _=ze;return d(),U(_,{open:p.value,title:"视频查看",width:600,footer:null,onCancel:m},{default:o(()=>[g("div",ut,[g("video",{class:"preview",src:v.video,width:"300",controls:"",loop:"",muted:""},null,8,dt)])]),_:1},8,["open"])}}}),pt=L(ct,[["__scopeId","data-v-5dd700f4"]]),mt=O({name:"PlanTaskCommentOperateDrawer",__name:"operate-drawer",props:P({operateType:{default:"add"},rowData:{default:null}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:P(["submitted"],["update:visible"]),setup(k,{emit:p}){const v=q(k,"visible"),m=E(c()),y=k,i=ie(()=>y.operateType==="edit"),_=ie(()=>({add:"新增评价",edit:"编辑评价"})[y.operateType]);ve(v,async()=>{var u,h;if(v.value&&(m.value=c(),i.value)){Object.assign(m.value.row,y.rowData||{});let x=0;m.value.imageFiles=(u=m.value.images)==null?void 0:u.map(t=>({uid:x-=1,name:`${x}.png`,status:"done",url:window.$isDbugger?`${apiUrl}${t}`:t,thumbUrl:window.$isDbugger?`${apiUrl}${t}`:t})),m.value.videoFiles=(h=m.value.videos)==null?void 0:h.map(t=>({uid:x-=1,name:`${x}.png`,status:"done",url:window.$isDbugger?`${apiUrl}${t}`:t,thumbUrl:window.$isDbugger?`${apiUrl}${t}`:t}))}});function c(){return{id:"",taskId:"",mode:0,text:"",images:[],imageFiles:[],videos:[],videoFiles:[],loading:!1,row:{}}}return(u,h)=>{const x=ge;return d(),U(x,{open:v.value,"onUpdate:open":h[0]||(h[0]=t=>v.value=t),title:_.value,width:650},{default:o(()=>h[1]||(h[1]=[S("//")])),_:1},8,["open","title"])}}}),ft={key:0,class:"flex items-center justify-center py-10"},vt={key:1,class:"py-10 text-center"},_t={key:2,class:"space-y-6"},gt={class:"flex gap-4"},ht={class:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md"},bt={class:"flex-grow"},wt={class:"mb-1 text-gray-800 font-medium"},kt={class:"mb-2 text-sm text-gray-600"},yt={key:0,class:"block"},xt={class:"mb-2 text-sm text-gray-600"},It={key:0},Tt={class:"text-red-500"},Dt={class:"mb-2 text-sm text-gray-600"},Ct={key:0},$t={key:0,class:"mt-2 flex flex-wrap gap-2"},Ft={key:1,class:"mt-2 flex gap-2"},At=["src"],Rt=O({__name:"check-products",props:P({taskId:{type:String,required:!0}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(k){const p=q(k,"visible"),v=k,m=E(!0),y=_e({list:[]});ve(()=>p.value,async _=>{_&&v.taskId&&await i()});async function i(){m.value=!0;try{const _={pageIndex:1,pageSize:10,taskId:v.taskId},{data:c,error:u}=await Xe(_);!u&&c&&c.code===0&&(y.list=c.data.list)}finally{m.value=!1}}return(_,c)=>{const u=st,h=Y,x=ge;return d(),U(x,{open:p.value,"onUpdate:open":c[0]||(c[0]=t=>p.value=t),title:"查看商品",width:600,footer:null},{default:o(()=>[m.value?(d(),b("div",ft,[e(u,{size:"large"})])):y.list.length===0?(d(),b("div",vt,c[1]||(c[1]=[g("p",null,"暂无子商品数据",-1)]))):(d(),b("div",_t,[(d(!0),b(Z,null,ee(y.list,t=>(d(),b("div",{key:t.taskId,class:"border rounded-lg p-4 shadow-sm transition-shadow hover:shadow-md"},[g("div",gt,[g("div",ht,[e(h,{src:t.productImage||r(A),fallback:r(A),width:"80",height:"80",class:"object-cover"},null,8,["src","fallback"])]),g("div",bt,[g("h3",wt,j(t.productTitle||"未命名商品"),1),g("p",kt,[t.text?(d(),b("span",yt,"评论："+j(t.text),1)):B("",!0)]),g("p",xt,[t.price!==null?(d(),b("span",It,[c[2]||(c[2]=S(" 价格： ")),g("span",Tt,"￥"+j(t.price),1)])):B("",!0)]),g("p",Dt,[t.Count!==null?(d(),b("span",Ct,"购买数量："+j(t.count),1)):B("",!0)]),t.images&&t.images.length>0?(d(),b("div",$t,[(d(!0),b(Z,null,ee(t.Images,(l,F)=>(d(),U(h,{key:F,src:l,fallback:r(A),width:"60",height:"60",class:"rounded"},null,8,["src","fallback"]))),128))])):B("",!0),t.videos&&t.videos.length>0?(d(),b("div",Ft,[(d(!0),b(Z,null,ee(t.videos,(l,F)=>(d(),b("video",{key:F,src:l,controls:"",width:"100",height:"80",class:"border rounded"},null,8,At))),128))])):B("",!0)])])]))),128))]))]),_:1},8,["open"])}}}),St=L(Rt,[["__scopeId","data-v-c3e9b361"]]),Ut={class:"page min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Bt=O({name:"douyin_comment",__name:"index",setup(k){const p=Ye(),v=qe(),{tableWrapperRef:m,scrollConfig:y}=Ve(),i=E(!1),_=E("create"),c=E({}),u=_e({videoVisible:!1,video:""}),h=E(new Map),{columns:x,columnChecks:t,data:l,getData:F,getDataByPage:T,loading:C,mobilePagination:W,searchParams:M,resetSearchParams:G}=He({apiFn:Ze,apiParams:{pageIndex:1,pageSize:10},columns:be}),{checkedRowKeys:V,rowSelection:K,onBatchDeleted:Q,onDeleted:J}=Oe(l,F);async function w(){const a=V.value;if(a!=null&&a.length){const{data:n,error:D}=await pe(a);!D&&(n==null?void 0:n.code)===0&&Q()}}async function he(a){const{data:n,error:D}=await pe([a]);!D&&(n==null?void 0:n.code)===0&&J()}function be(){var n,D;const a=[{key:"id",dataIndex:"id",title:"订单详情",width:400,ellipsis:!0,customRender:({record:s})=>{const $=ue.find(N=>N.value===s.platform)||ue[0],f=window.$isDebugger&&s.productImage?`${se}${s.productImage}`:s.productImage||A,I=s.count>1,H=s.count||1,X=h.value.get(s.id)||!1,De=()=>{var N;return!X||!((N=s.products)!=null&&N.length)?null:e("div",{class:"products-list mt-4 border-t border-gray-100 pt-4"},[s.products.map((R,Ce)=>{const $e=R.imageUrl||R.productImage||A,Fe=R.name||R.productTitle||"未命名商品",Ae=R.sku||R.spec||"无规格",Re=R.quantity||1;return e("div",{class:"product-item flex items-center gap-3 py-2",key:Ce},[e("div",{class:"product-thumbnail h-10 w-10 flex-shrink-0"},[e(Y,{src:$e,width:40,height:40,fallback:A},null)]),e("div",{class:"product-info flex-grow-1 overflow-hidden"},[e("p",{class:"product-name truncate text-sm font-medium"},[Fe]),e("p",{class:"product-sku text-xs text-gray-500"},[Ae]),e("p",{class:"product-quantity text-xs text-gray-500"},[S("x"),Re])])])})])};return e("div",{class:"flex items-start gap-4"},[e("div",{class:"product-image-container h-20 w-20 flex-shrink-0"},[e(Y,{width:80,height:80,src:f,fallback:A},null)]),e("div",{class:"flex-1 overflow-hidden"},[e("p",{class:"title truncate text-gray-800 font-medium",title:s.productTitle},[e(fe,{color:$.color},{default:()=>[$.label,S("联盟")]}),s.productTitle]),e("p",{class:"plantask-shop"},[S("店铺名称： "),s.shopName]),e("p",{class:"task-id cursor-pointer text-sm text-gray-500 transition-colors hover:text-primary",onClick:()=>de(s.taskId)},[S("任务编号："),s.taskId]),e("p",{class:"order-id cursor-pointer text-sm text-gray-500 transition-colors hover:text-primary",onClick:()=>s.orderId&&de(s.orderId)},[S("订单号："),s.orderId||"-"]),e("div",{class:"mt-2 flex items-center"},[e("span",{class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-1 text-xs text-blue-800 font-medium"},[I?`多商品 (${H}件)`:"单商品"])]),De()])])}},{key:"taskId",dataIndex:"taskId",title:"评价详情",width:400,ellipsis:!0,customRender:({record:s})=>{const $=(s.images||[]).map(I=>window.$isDebugger?`${se}${I}`:I),f=(s.videos||[]).map(I=>window.$isDebugger?`${se}${I}`:I);return e("div",null,[e("p",{class:"comment-text mb-2 text-sm text-gray-700"},[s.text||"无评论内容"]),e("div",{class:"media-container mt-2 flex flex-wrap gap-2"},[$.map((I,H)=>e("div",{class:"image-container h-24 w-24 overflow-hidden rounded shadow-sm",key:`img-${H}`},[e(Y,{width:100,height:100,src:I,fallback:A},null)])),f.map((I,H)=>e("div",{class:"video-container relative h-24 w-24 cursor-pointer overflow-hidden rounded shadow-sm",key:`vid-${H}`,onClick:X=>ye(X,I)},[e("video",{width:100,height:100,controls:!0,src:I,class:"object-cover"},null),e("div",{class:"absolute inset-0 flex items-center justify-center bg-black/30 text-white"},[e(me,null,null)])]))])])}},{key:"status",dataIndex:"status",title:"状态",align:"center",width:100,customRender:({record:s})=>{const $=ne.find(f=>f.value===s.status)||ne[0];return e(fe,{color:$.color},{default:()=>[$.label]})}}];return(n=p.userInfo)!=null&&n.isTenant?(D=p.userInfo)!=null&&D.isTenantUser||a.push({key:"creator",dataIndex:"creator",title:"创建员工",align:"center",width:200,ellipsis:!0}):a.push({key:"tenantUser",dataIndex:"tenantUser",title:"所属商户",align:"center",width:200,ellipsis:!0}),a.push({key:"createTime",dataIndex:"createTime",title:"添加时间",align:"center",width:200},{key:"beginTime",dataIndex:"beginTime",title:"预计评价时间",align:"center",width:200},{key:"operate",title:"操作",align:"center",width:100,customRender:({record:s})=>e("div",{class:"flex justify-center gap-2"},[we(s),ke(s),s.count>1&&e(xe,{record:s},null)])}),a}function we(a){return v.hasOne(ae.DY.Comment.CREATE)&&p.userInfo.isTenant&&a.id&&a.status!==1?e(le,{title:"确认立即发布评价吗？",onConfirm:()=>Te(a.id)},{default:()=>[e(te,{placement:"top",title:"立即发布"},{default:()=>[e(z,{size:"small",type:"link"},{default:()=>[e(et,null,null)]})]})]}):""}function ke(a){return v.hasOne(ae.DY.Comment.DELETE)&&a.roleId!==1e3&&a.status!==1?e(le,{title:"确认删除吗？",onConfirm:()=>he(a.id)},{default:()=>[e(te,{placement:"top",title:"删除"},{default:()=>[e(z,{danger:!0,size:"small",type:"link"},{default:()=>[e(nt,null,null)]})]})]}):""}function ye(a,n){a.stopPropagation(),a.preventDefault(),u.video=n,u.videoVisible=!0}function xe({record:a}){if(p.userInfo.isTenant)return e(te,{placement:"top",title:"查看商品"},{default:()=>[e(z,{type:"link",size:"small",onClick:()=>Ie(a.taskId)},{default:()=>[e(me,null,null)]})]})}function Ie(a){u.detailVisible=!0,u.taskIdForCheck=a}async function Te(a){var s;const{data:n,error:D}=await tt(a);!D&&(n==null?void 0:n.code)===0&&((s=window.$message)==null||s.success("发布操作成功"),await T(pagination.pageIndex))}return(a,n)=>{const D=Se,s=Ne,$=at;return d(),b("div",Ut,[e(rt,{model:r(M),"onUpdate:model":n[0]||(n[0]=f=>re(M)?M.value=f:null),"user-info":r(p).userInfo,status:r(ne),onReset:r(G),onSearch:n[1]||(n[1]=f=>r(T)(1))},null,8,["model","user-info","status","onReset"]),e($,{title:"评价列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"plantaskcomment flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:o(()=>[e(D,{columns:r(t),"onUpdate:columns":n[2]||(n[2]=f=>re(t)?t.value=f:null),"disabled-delete":r(V).length===0,loading:r(C),"delete-btn":r(p).userInfo.isTenant&&r(v).hasOne(r(ae).DY.Task.DELETE),onDelete:w},null,8,["columns","disabled-delete","loading","delete-btn"])]),default:o(()=>[e(s,{ref_key:"tableWrapperRef",ref:m,columns:r(x),"data-source":r(l),size:"small","row-selection":r(K),scroll:r(y),loading:r(C),"row-key":"id",pagination:r(W),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(pt,{visible:u.videoVisible,"onUpdate:visible":n[3]||(n[3]=f=>u.videoVisible=f),video:u.video},null,8,["visible","video"])]),_:1}),e(mt,{visible:i.value,"onUpdate:visible":n[4]||(n[4]=f=>i.value=f),"operate-type":_.value,"row-data":c.value,onSubmitted:r(T)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(St,{visible:u.detailVisible,"onUpdate:visible":n[5]||(n[5]=f=>u.detailVisible=f),"task-id":u.taskIdForCheck},null,8,["visible","task-id"])])}}}),os=L(Bt,[["__scopeId","data-v-ceb6b436"]]);export{os as default};
