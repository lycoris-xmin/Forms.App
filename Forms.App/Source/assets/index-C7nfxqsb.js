import{_ as W}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{_ as j,S as K,g as J,F as Q,a as X,b as Y,T as Z,u as ee,c as ae,d as te,e as le}from"./table-search-filter-DgS7ifzw.js";import{m as ne,d as z,D,E as oe,s as se,i as re,c as v,o as m,w as t,f as a,z as R,e as w,b as L,H as F,P as C,g as c,t as B,h as u,B as ue,q as ie,a8 as E}from"./index-CZVtSjPQ.js";import{p as G}from"./index-DiqUFypO.js";import{u as de,F as me,_ as pe}from"./form-ZxLsforZ.js";import{_ as $}from"./index.vue_vue_type_script_setup_true_lang-pVOlQRHe.js";import{r as ce,s as fe}from"./enums-XBoEbamp.js";import{U as _e}from"./UserOutlined-Cd3yZI2R.js";import{_ as ye}from"./index-DOEbmRvB.js";import{C as ve}from"./index-ClUX1lZP.js";import{T as O}from"./index-DMMLrYUn.js";import"./index-CQCXu6T9.js";import"./EyeOutlined-B3DWie8W.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";import"./responsiveObserve-CdtC9r70.js";import"./debounce-BsWDECm-.js";import"./isSymbol-DgABtkrl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ge(d){const{pageIndex:g,pageSize:b}=d,f={pageIndex:g,pageSize:b};return Number.isNaN(Number.parseInt(d.platform,10))||(f.platform=d.platform),d.alipayLovePayId&&(f.alipayLovePayId=d.alipayLovePayId),d.userId&&(f.userId=d.userId),Number.isNaN(Number.parseInt(d.platform,10))||(f.settlemented=d.settlemented===1),ne({url:"/api/alipay/lovepay/record/list",params:{...f}})}const Ie={class:"flex-1"},xe={class:"w-full flex-y-center justify-end gap-12px"},be=z({name:"ReportAlipayLovePayRecordListSearch",__name:"search-filter",props:D({platform:{},userInfo:{}},{model:{required:!0},modelModifiers:{}}),emits:D(["reset","search"],["update:model"]),setup(d,{emit:g}){const{formRef:b,validate:f,resetFields:N}=de(),s=oe(d,"model"),_=se({alipayLovePay:[]}),p=d,h=g;re(()=>{T()});async function T(){if(p.userInfo.isTenantUser){const{data:i,error:e}=await ce();!e&&i&&i.code===0&&(_.alipayLovePay=i.data.list)}else if(p.userInfo.isTenant){const{data:i,error:e}=await fe();!e&&i&&i.code===0&&(_.alipayLovePay=i.data.list)}}async function A(){await N(),h("reset")}async function P(){await f(),h("search")}function S(i,e){if(!e||!e.options||!e.options.length)return!1;for(const I of e.options){if(_.alipayLovePay.filter(n=>n.filter(l=>l.text.includes(i)||l.data.includes(i)).length>0).length)return!0;const r=I.children();if(r&&r.length){for(const n of r)if(n.children.toLowerCase().includes(i))return!0}}return!1}return(i,e)=>{const I=K,r=pe,n=ye,l=J,y=Q,k=X,x=ue,M=Y,V=j,q=me;return m(),v(Z,null,{default:t(()=>[a(q,{ref_key:"formRef",ref:b,name:"filer",model:s.value,"label-col":{span:5,md:7}},{default:t(()=>[a(V,{gutter:[16,16],wrap:""},{default:t(()=>[a(n,{span:24,md:12,lg:6},{default:t(()=>[a(r,{label:"支付平台",name:"platform",class:"m-0"},{default:t(()=>[a(I,{value:s.value.platform,"onUpdate:value":e[0]||(e[0]=o=>s.value.platform=o),placeholder:"- 全部 -",options:p.platform,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),p.userInfo.isTenant?(m(),v(n,{key:0,span:24,md:12,lg:6},{default:t(()=>[a(r,{label:"亲情卡",name:"alipayLovePayId",class:"m-0"},{default:t(()=>[p.userInfo.isTenantUser?(m(),v(I,{key:0,value:s.value.alipayLovePayId,"onUpdate:value":e[1]||(e[1]=o=>s.value.alipayLovePayId=o),placeholder:"- 全部 -","allow-clear":""},{default:t(()=>[(m(!0),L(F,null,C(_.alipayLovePay,o=>(m(),v(l,{key:o.value,value:o.value},{default:t(()=>[c(B(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):p.userInfo.isTenant?(m(),v(I,{key:1,value:s.value.alipayLovePayId,"onUpdate:value":e[2]||(e[2]=o=>s.value.alipayLovePayId=o),"show-search":"","option-filter-prop":"children","filter-option":S,placeholder:"- 全部 -","allow-clear":""},{default:t(()=>[(m(!0),L(F,null,C(_.alipayLovePay,(o,H)=>(m(),v(y,{key:H},{label:t(()=>[w("span",null,[a(u(_e)),c(" "+B(o[0].data),1)])]),default:t(()=>[(m(!0),L(F,null,C(o,U=>(m(),v(l,{key:U.value,value:U.value},{default:t(()=>[c(B(U.text),1)]),_:2},1032,["value"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])):R("",!0)]),_:1})]),_:1})):R("",!0),a(n,{span:24,md:12,lg:6},{default:t(()=>[a(r,{label:"结算状态",name:"settlemented",class:"m-0"},{default:t(()=>[a(I,{value:s.value.settlemented,"onUpdate:value":e[3]||(e[3]=o=>s.value.settlemented=o),placeholder:"- 全部 -","allow-clear":""},{default:t(()=>[a(l,{value:1},{default:t(()=>e[6]||(e[6]=[c("已结算")])),_:1}),a(l,{value:0},{default:t(()=>e[7]||(e[7]=[c("未结算")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),p.userInfo.isTenant?p.userInfo.isTenantUser?R("",!0):(m(),v(n,{key:2,span:24,md:12,lg:6},{default:t(()=>[a(r,{label:"使用员工",name:"userId",class:"m-0"},{default:t(()=>[a($,{value:s.value.userId,"onUpdate:value":e[5]||(e[5]=o=>s.value.userId=o),placeholder:"- 全部 -","tenant-user":!0},null,8,["value"])]),_:1})]),_:1})):(m(),v(n,{key:1,span:24,md:12,lg:6},{default:t(()=>[a(r,{label:"所属商户",name:"userId",class:"m-0"},{default:t(()=>[a($,{value:s.value.userId,"onUpdate:value":e[4]||(e[4]=o=>s.value.userId=o),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),w("div",Ie,[a(r,{class:"m-0"},{default:t(()=>[w("div",xe,[a(x,{onClick:A},{icon:t(()=>[a(k,{class:"align-sub text-icon"})]),default:t(()=>[e[8]||(e[8]=w("span",{class:"ml-8px"},"重置",-1))]),_:1}),a(x,{type:"primary",ghost:"",onClick:P},{icon:t(()=>[a(M,{class:"align-sub text-icon"})]),default:t(()=>[e[9]||(e[9]=w("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),he={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Me=z({name:"report_alipaylovepay",__name:"index",setup(d){const g=ie(),{tableWrapperRef:b,scrollConfig:f}=ee(),{columns:N,columnChecks:s,searchParams:_,resetSearchParams:p,data:h,getData:T,getDataByPage:A,loading:P,mobilePagination:S}=ae({apiFn:ge,apiParams:{pageIndex:1,pageSize:10},columns:I}),{checkedRowKeys:i,rowSelection:e}=te(h,T);function I(){const r=[{key:"alipayName",dataIndex:"alipayName",title:"亲情卡",align:"center",customRender:({record:l})=>l.alipayName?l.alipayAccount?a("span",null,[l.alipayAccount,c("("),l.alipayName,c(")")]):a("span",null,[l.alipayName]):a("span",null,[l.unknownLovePayName,c('("未记录")')])},{key:"platform",dataIndex:"platform",title:"支付平台",align:"center",width:100,customRender:({record:l})=>{let y=G.filter(k=>k.value===l.platform);return y=y.length?y[0]:{label:"未知",value:l.platform,color:""},a(O,{color:y.color},{default:()=>[y.label]})}},{key:"orderId",dataIndex:"orderId",title:"支付订单号",align:"center"},{key:"amount",dataIndex:"amount",title:"支付金额",align:"center"}];g.userInfo.isTenantUser||g.userInfo.isTenant&&r.push({key:"userName",dataIndex:"userName",title:"持有者",align:"center"},{key:"usedUserName",dataIndex:"usedUserName",title:"使用人",align:"center"}),g.userInfo.isTenant||r.push({key:"tenantName",dataIndex:"tenantName",title:"所属商户",align:"center"});const n=[{key:"settlemented",dataIndex:"settlemented",title:"结算状态",align:"center",width:100,customRender:({record:l})=>l.settlemented?a(O,{type:"success"},{default:()=>[c("已结算")]}):a(O,{type:"error"},{default:()=>[c("未结算")]})},{key:"createTime",dataIndex:"createTime",title:"支付时间",align:"center",width:200}];return[...r,...n]}return(r,n)=>{const l=W,y=le,k=ve;return m(),L("div",he,[a(be,{model:u(_),"onUpdate:model":n[0]||(n[0]=x=>E(_)?_.value=x:null),"user-info":u(g).userInfo,platform:u(G),onReset:u(p),onSearch:n[1]||(n[1]=x=>u(A)(1))},null,8,["model","user-info","platform","onReset"]),a(k,{title:"亲情卡支付记录",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:t(()=>[a(l,{columns:u(s),"onUpdate:columns":n[2]||(n[2]=x=>E(s)?s.value=x:null),"disabled-delete":u(i).length===0,loading:u(P)},null,8,["columns","disabled-delete","loading"])]),default:t(()=>[a(y,{ref_key:"tableWrapperRef",ref:b,columns:u(N),"data-source":u(h),size:"small","row-selection":u(e),scroll:u(f),loading:u(P),"row-key":"id",pagination:u(S),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"])]),_:1})])}}});export{Me as default};
