import{_ as oe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{_ as ae,S as ie,a as de,b as re,T as ue,u as ce,c as pe,d as me,e as _e}from"./table-search-filter-DgS7ifzw.js";import{d as se,D as X,E as fe,r as ge,c as w,o as u,w as l,f as t,e as o,h as i,a7 as Z,B as ne,s as he,b as S,a8 as ee,z as h,t as b,g as _,H as ve,P as we,ab as xe}from"./index-CZVtSjPQ.js";import{l as te,f as ye,a as ke}from"./enum-map-logger-BVK5jOk3.js";import{L as be}from"./index-Y4HE4_-c.js";import{c as C}from"./helper-sl_fDmSa.js";import{u as Ce,F as Re,_ as Ie,I as Te}from"./form-ZxLsforZ.js";import{_ as qe}from"./index-DOEbmRvB.js";import{R as Se}from"./dayjs-AyO5q5yK.js";import{D as Ae,a as He}from"./index-CmnjSmWG.js";import{C as Me}from"./index-ClUX1lZP.js";import{T as A}from"./index-DMMLrYUn.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CQCXu6T9.js";import"./EyeOutlined-B3DWie8W.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";import"./responsiveObserve-CdtC9r70.js";import"./debounce-BsWDECm-.js";import"./isSymbol-DgABtkrl.js";const De={class:"flex-1"},$e={class:"w-full flex-y-center justify-end gap-12px"},Be=se({name:"LoggerRequestListSearch",__name:"search-filter",props:X({httpMethod:{}},{model:{required:!0},modelModifiers:{}}),emits:X(["reset","search"],["update:model"]),setup(M,{emit:s}){const{formRef:P,resetFields:D}=Ce(),d=fe(M,"model"),I=M,T=s,$=ge({success:[{value:1,label:"成功"},{value:0,label:"失败"}]});async function B(){await D(),T("reset")}async function F(){T("search")}function z(q,a){d.value.beginTime=a[0],d.value.endTime=a[1]}return(q,a)=>{const H=ie,x=Ie,k=qe,R=Te,g=Se,e=de,c=ne,m=re,v=ae,L=Re;return u(),w(ue,null,{default:l(()=>[t(L,{ref_key:"formRef",ref:P,model:d.value,"label-col":{span:5,md:7}},{default:l(()=>[t(v,{gutter:[16,16],wrap:""},{default:l(()=>[t(k,{span:24,md:12,lg:6},{default:l(()=>[t(x,{label:"请求方式",name:"httpMethod",class:"m-0"},{default:l(()=>[t(H,{value:d.value.httpMethod,"onUpdate:value":a[0]||(a[0]=f=>d.value.httpMethod=f),placeholder:"- 全部 -",options:I.httpMethod,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),t(k,{span:24,md:12,lg:6},{default:l(()=>[t(x,{label:"请求地址",name:"url",class:"m-0"},{default:l(()=>[t(R,{value:d.value.url,"onUpdate:value":a[1]||(a[1]=f=>d.value.url=f),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),t(k,{span:24,md:12,lg:6},{default:l(()=>[t(x,{label:"请求标识",name:"traceId",class:"m-0"},{default:l(()=>[t(R,{value:d.value.traceId,"onUpdate:value":a[2]||(a[2]=f=>d.value.traceId=f),autocomplete:"off",placeholder:"精确查询"},null,8,["value"])]),_:1})]),_:1}),t(k,{span:24,md:12,lg:6},{default:l(()=>[t(x,{label:"请求状态",name:"success",class:"m-0"},{default:l(()=>[t(H,{value:d.value.success,"onUpdate:value":a[3]||(a[3]=f=>d.value.success=f),placeholder:"- 全部 -",options:$.value.success,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),t(k,{span:24,md:12,lg:6},{default:l(()=>[t(x,{label:"请求时间",name:"createTimeRange",class:"m-0"},{default:l(()=>[t(g,{value:d.value.timeRange,"onUpdate:value":a[4]||(a[4]=f=>d.value.timeRange=f),"show-time":{defaultValue:[i(Z)("00:00:00","HH:mm:ss"),i(Z)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],onChange:z},null,8,["value","show-time"])]),_:1})]),_:1}),o("div",De,[t(x,{class:"m-0"},{default:l(()=>[o("div",$e,[t(c,{onClick:B},{icon:l(()=>[t(e,{class:"align-sub text-icon"})]),default:l(()=>[a[5]||(a[5]=o("span",{class:"ml-8px"},"重置",-1))]),_:1}),t(c,{type:"primary",ghost:"",onClick:F},{icon:l(()=>[t(m,{class:"align-sub text-icon"})]),default:l(()=>[a[6]||(a[6]=o("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),Fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ze={class:"expand-body"},Le={class:"v-center flex"},Ne={class:"content"},Ue={class:"btn center flex"},Ke={class:"v-center flex"},Oe={class:"content"},je={class:"btn center flex"},Ve={class:"v-center flex"},Ee={class:"content"},Ye={class:"btn center flex"},We={class:"v-center flex"},Je={class:"content"},Ge={key:0},Qe={class:"btn center flex"},Xe={class:"v-center flex"},Ze={class:"content"},et={class:"btn center flex"},tt={class:"v-center flex"},st={class:"content"},nt={key:0},lt={class:"stack-trace"},ot={class:"btn center flex"},at=se({name:"logger_request",__name:"index",setup(M){const s=he({expandedRowKeys:[],row:{}}),{tableWrapperRef:P,scrollConfig:D}=ce(),{columns:d,columnChecks:I,data:T,getData:$,getDataByPage:B,loading:F,mobilePagination:z,searchParams:q,resetSearchParams:a}=pe({apiFn:(...g)=>(s.expandedRowKeys=[],s.row={},ke(...g)),apiParams:{pageIndex:1,pageSize:20},columns:x}),{checkedRowKeys:H}=me(T,$);function x(){return[{key:"httpMethod",dataIndex:"httpMethod",title:"请求方式",align:"center",width:100,customRender:({record:e})=>{const c=te.filter(m=>m.value===e.httpMethod);return c&&c.length?t(A,{color:c[0].color,ghost:!0},{default:()=>[c[0].label]}):t(A,{color:"purple",ghost:!0},{default:()=>[_("未知")]})}},{key:"url",dataIndex:"url",title:"请求地址",ellipsis:!0,customRender:({record:e})=>t("span",{class:"request-url",onClick:()=>C(e.url)},[e.url])},{key:"httpStatusCode",dataIndex:"httpStatusCode",title:"状态码",width:100,align:"center",customRender:({record:e})=>e.httpStatusCode<300?t(A,{color:"success",ghost:!0},{default:()=>[e.httpStatusCode]}):e.httpStatusCode<500?t(A,{color:"warning",ghost:!0},{default:()=>[e.httpStatusCode]}):t(A,{color:"error",ghost:!0},{default:()=>[e.httpStatusCode]})},{key:"requestTime",dataIndex:"requestTime",title:"请求时间",width:200,align:"center"},{key:"responseTime",dataIndex:"responseTime",title:"响应时间",width:200,align:"center"},{key:"milliseconds",dataIndex:"milliseconds",title:"耗时",width:100,align:"right",customRender:({record:e})=>e.milliseconds<=1500?t("span",{class:"text-success"},[e.milliseconds,_("ms")]):e.milliseconds<=3e3?t("span",{class:"text-info"},[e.milliseconds,_("ms")]):e.milliseconds<=1e4?t("span",{class:"text-warn"},[e.milliseconds,_("ms")]):e.milliseconds<=15e3?t("span",{class:"text-purple"},[e.milliseconds,_("ms")]):t("span",{class:"text-danger"},[e.milliseconds,_("ms")])},{key:"requestIP",dataIndex:"requestIP",title:"客户端IP",width:150,align:"center"},{key:"requestIPAddress",dataIndex:"requestIPAddress",title:"归属地",width:160},{key:"userName",dataIndex:"userName",title:"请求用户",width:160}]}async function k(g,e){if(g&&!(s.row[e.id]&&Object.keys(s.row[e.id]).length)){s.row[e.id]={},s.row[e.id].loading=!0;try{const{data:c,error:m}=await ye(e.id);!m&&c&&c.code===0&&(s.row[e.id]=c.data)}finally{xe(()=>{s.row[e.id].loading=!1})}}}function R(g){try{return JSON.stringify(JSON.parse(g))}catch{return g}}return(g,e)=>{const c=oe,m=ne,v=He,L=Ae,f=_e,le=Me;return u(),S("div",Fe,[t(Be,{model:i(q),"onUpdate:model":e[0]||(e[0]=n=>ee(q)?q.value=n:null),"http-method":i(te),onReset:i(a),onSearch:e[1]||(e[1]=n=>i(B)(1))},null,8,["model","http-method","onReset"]),t(le,{title:"日志列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[t(c,{columns:i(I),"onUpdate:columns":e[2]||(e[2]=n=>ee(I)?I.value=n:null),"disabled-delete":i(H).length===0},null,8,["columns","disabled-delete"])]),default:l(()=>[t(f,{ref_key:"tableWrapperRef",ref:P,"expanded-row-keys":s.expandedRowKeys,"onUpdate:expandedRowKeys":e[3]||(e[3]=n=>s.expandedRowKeys=n),columns:i(d),"data-source":i(T),size:"small",scroll:i(D),loading:i(F),"row-key":"id",pagination:i(z),class:"h-full",onExpand:k},{expandedRowRender:l(({record:n})=>{var N,U;return[o("div",ze,[t(L,{bordered:"",column:1},{default:l(()=>{var K,O,j,V,E,Y,W,J,G;return[t(v,{label:"请求标识",span:1},{default:l(()=>{var r;return[o("div",Le,[o("div",Ne,[o("p",null,b(((r=s.row[n.id])==null?void 0:r.traceId)||""),1)]),o("div",Ue,[t(m,{size:"small",type:"primary",ghost:"",onClick:p=>{var y;return i(C)(((y=s.row[n.id])==null?void 0:y.traceId)||"")}},{default:l(()=>e[4]||(e[4]=[_(" 复制 ")])),_:2},1032,["onClick"])])])]}),_:2},1024),(K=s.row[n.id])!=null&&K.requestHeaders&&Object.keys(s.row[n.id].requestHeaders).length?(u(),w(v,{key:0,label:"请求头",span:1},{default:l(()=>[o("div",Ke,[o("div",Oe,[o("p",null,b(R(s.row[n.id].requestHeaders)),1)]),o("div",je,[t(m,{size:"small",type:"primary",ghost:"",onClick:r=>{var p;return i(C)(((p=s.row[n.id])==null?void 0:p.requestHeaders)||"")}},{default:l(()=>e[5]||(e[5]=[_(" 复制 ")])),_:2},1032,["onClick"])])])]),_:2},1024)):h("",!0),(O=s.row[n.id])!=null&&O.request?(u(),w(v,{key:1,label:"请求内容",span:1},{default:l(()=>[o("div",Ve,[o("div",Ee,[o("p",null,b(R(s.row[n.id].request)),1)]),o("div",Ye,[t(m,{size:"small",type:"primary",ghost:"",onClick:r=>{var p;return i(C)(((p=s.row[n.id])==null?void 0:p.request)||"")}},{default:l(()=>e[6]||(e[6]=[_(" 复制 ")])),_:2},1032,["onClick"])])])]),_:2},1024)):h("",!0),(j=s.row[n.id])!=null&&j.response&&n.httpStatusCode<500?(u(),w(v,{key:2,label:"响应内容",span:1},{default:l(()=>{var r,p,y;return[o("div",We,[o("div",Je,[s.row[n.id].response!==((r=s.row[n.id])==null?void 0:r.exception)?(u(),S("p",Ge,b(R(s.row[n.id].response)),1)):h("",!0)]),o("div",Qe,[((p=s.row[n.id])==null?void 0:p.response)!==((y=s.row[n.id])==null?void 0:y.exception)?(u(),w(m,{key:0,size:"small",type:"primary",ghost:"",onClick:it=>{var Q;return i(C)(((Q=s.row[n.id])==null?void 0:Q.response)||"")}},{default:l(()=>e[7]||(e[7]=[_(" 复制 ")])),_:2},1032,["onClick"])):h("",!0)])])]}),_:2},1024)):h("",!0),(V=s.row[n.id])!=null&&V.exception?(u(),w(v,{key:3,label:"异常信息",span:1},{default:l(()=>{var r;return[o("div",Xe,[o("div",Ze,[o("p",null,b(((r=s.row[n.id])==null?void 0:r.exception)||""),1)]),o("div",et,[t(m,{size:"small",type:"primary",ghost:"",onClick:p=>{var y;return i(C)(((y=s.row[n.id])==null?void 0:y.exception)||"")}},{default:l(()=>e[8]||(e[8]=[_(" 复制 ")])),_:2},1032,["onClick"])])])]}),_:2},1024)):h("",!0),(E=s.row[n.id])!=null&&E.stackTrace?(u(),w(v,{key:4,label:"异常堆栈",span:1},{default:l(()=>[o("div",tt,[o("div",st,[s.row[n.id].stackTrace.includes("at ")?h("",!0):(u(),S("p",nt,b(s.row[n.id].stackTrace||""),1)),(u(!0),S(ve,null,we(s.row[n.id].stackTrace.trim().split("at ").filter(Boolean),r=>(u(),S("ul",{key:r},[o("li",lt,"at "+b(r),1)]))),128))]),o("div",ot,[t(m,{size:"small",type:"primary",ghost:"",onClick:r=>{var p;return i(C)(((p=s.row[n.id])==null?void 0:p.stackTrace)||"")}},{default:l(()=>e[9]||(e[9]=[_(" 复制 ")])),_:2},1032,["onClick"])])])]),_:2},1024)):h("",!0),!((Y=s.row[n.id])!=null&&Y.request)&&!((W=s.row[n.id])!=null&&W.response)&&!((J=s.row[n.id])!=null&&J.exception)&&!((G=s.row[n.id])!=null&&G.stackTrace)?(u(),w(v,{key:5},{default:l(()=>e[10]||(e[10]=[o("p",{class:"text-center"},"无其他详细信息",-1)])),_:1})):h("",!0)]}),_:2},1024),(N=s.row[n.id])!=null&&N.loading?(u(),w(be,{key:0,loading:((U=s.row[n.id])==null?void 0:U.loading)||!1},null,8,["loading"])):h("",!0)])]}),_:1},8,["expanded-row-keys","columns","data-source","scroll","loading","pagination"])]),_:1})])}}}),qt=Pe(at,[["__scopeId","data-v-81a7fd7c"]]);export{qt as default};
