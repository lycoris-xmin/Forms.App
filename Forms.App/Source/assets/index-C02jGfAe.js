import{g as he,u as Z,a as J,F as ee,_ as ne,I as ge,d as fe}from"./form-ZxLsforZ.js";import{Y as Se,Z as we,cQ as ve,a0 as H,a1 as _e,bl as be,ax as $e,d as R,V as g,aL as xe,a as O,ds as Ie,r as W,F as Me,U as ye,i as te,ab as ie,f as n,a6 as V,ao as Pe,a3 as Ce,bu as G,d3 as Ae,aG as Q,X as Te,m as z,s as k,b as j,o as q,e as I,w as o,B as X,g as F,M as ze,h as x,a8 as Y,a9 as Ee}from"./index-CZVtSjPQ.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as He}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{u as Fe,c as Re,d as Ue,T as Le,_ as Be,a as De,b as Oe,e as Ve}from"./table-search-filter-DgS7ifzw.js";import{u as We,A as Xe}from"./app.permissions-B_pV7apU.js";import{C as se,T as ke,_ as je}from"./index-ClUX1lZP.js";import{S as qe}from"./index-BWb-9rJv.js";import{E as Ne}from"./EditOutlined-S8fzz_Is.js";import{_ as Ke}from"./index-BVBn8Dpq.js";import"./responsiveObserve-CdtC9r70.js";import"./debounce-BsWDECm-.js";import"./isSymbol-DgABtkrl.js";import"./EyeOutlined-B3DWie8W.js";import"./index-CQCXu6T9.js";import"./index-Ds_LW8Zf.js";import"./LeftOutlined-Cj56myxb.js";const Ge=e=>{const{componentCls:t}=e,a=`${t}-inner`;return{[t]:{[`&${t}-small`]:{minWidth:e.switchMinWidthSM,height:e.switchHeightSM,lineHeight:`${e.switchHeightSM}px`,[`${t}-inner`]:{paddingInlineStart:e.switchInnerMarginMaxSM,paddingInlineEnd:e.switchInnerMarginMinSM,[`${a}-checked`]:{marginInlineStart:`calc(-100% + ${e.switchPinSizeSM+e.switchPadding*2}px - ${e.switchInnerMarginMaxSM*2}px)`,marginInlineEnd:`calc(100% - ${e.switchPinSizeSM+e.switchPadding*2}px + ${e.switchInnerMarginMaxSM*2}px)`},[`${a}-unchecked`]:{marginTop:-e.switchHeightSM,marginInlineStart:0,marginInlineEnd:0}},[`${t}-handle`]:{width:e.switchPinSizeSM,height:e.switchPinSizeSM},[`${t}-loading-icon`]:{top:(e.switchPinSizeSM-e.switchLoadingIconSize)/2,fontSize:e.switchLoadingIconSize},[`&${t}-checked`]:{[`${t}-inner`]:{paddingInlineStart:e.switchInnerMarginMinSM,paddingInlineEnd:e.switchInnerMarginMaxSM,[`${a}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${a}-unchecked`]:{marginInlineStart:`calc(100% - ${e.switchPinSizeSM+e.switchPadding*2}px + ${e.switchInnerMarginMaxSM*2}px)`,marginInlineEnd:`calc(-100% + ${e.switchPinSizeSM+e.switchPadding*2}px - ${e.switchInnerMarginMaxSM*2}px)`}},[`${t}-handle`]:{insetInlineStart:`calc(100% - ${e.switchPinSizeSM+e.switchPadding}px)`}},[`&:not(${t}-disabled):active`]:{[`&:not(${t}-checked) ${a}`]:{[`${a}-unchecked`]:{marginInlineStart:e.marginXXS/2,marginInlineEnd:-e.marginXXS/2}},[`&${t}-checked ${a}`]:{[`${a}-checked`]:{marginInlineStart:-e.marginXXS/2,marginInlineEnd:e.marginXXS/2}}}}}}},Qe=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-loading-icon${e.iconCls}`]:{position:"relative",top:(e.switchPinSize-e.fontSize)/2,color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${t}-checked ${t}-loading-icon`]:{color:e.switchColor}}}},Ye=e=>{const{componentCls:t}=e,a=`${t}-handle`;return{[t]:{[a]:{position:"absolute",top:e.switchPadding,insetInlineStart:e.switchPadding,width:e.switchPinSize,height:e.switchPinSize,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:e.colorWhite,borderRadius:e.switchPinSize/2,boxShadow:e.switchHandleShadow,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${t}-checked ${a}`]:{insetInlineStart:`calc(100% - ${e.switchPinSize+e.switchPadding}px)`},[`&:not(${t}-disabled):active`]:{[`${a}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${t}-checked ${a}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},Ze=e=>{const{componentCls:t}=e,a=`${t}-inner`;return{[t]:{[a]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:e.switchInnerMarginMax,paddingInlineEnd:e.switchInnerMarginMin,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${a}-checked, ${a}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none"},[`${a}-checked`]:{marginInlineStart:`calc(-100% + ${e.switchPinSize+e.switchPadding*2}px - ${e.switchInnerMarginMax*2}px)`,marginInlineEnd:`calc(100% - ${e.switchPinSize+e.switchPadding*2}px + ${e.switchInnerMarginMax*2}px)`},[`${a}-unchecked`]:{marginTop:-e.switchHeight,marginInlineStart:0,marginInlineEnd:0}},[`&${t}-checked ${a}`]:{paddingInlineStart:e.switchInnerMarginMin,paddingInlineEnd:e.switchInnerMarginMax,[`${a}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${a}-unchecked`]:{marginInlineStart:`calc(100% - ${e.switchPinSize+e.switchPadding*2}px + ${e.switchInnerMarginMax*2}px)`,marginInlineEnd:`calc(-100% + ${e.switchPinSize+e.switchPadding*2}px - ${e.switchInnerMarginMax*2}px)`}},[`&:not(${t}-disabled):active`]:{[`&:not(${t}-checked) ${a}`]:{[`${a}-unchecked`]:{marginInlineStart:e.switchPadding*2,marginInlineEnd:-e.switchPadding*2}},[`&${t}-checked ${a}`]:{[`${a}-checked`]:{marginInlineStart:-e.switchPadding*2,marginInlineEnd:e.switchPadding*2}}}}}},Je=e=>{const{componentCls:t}=e;return{[t]:H(H(H(H({},_e(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:e.switchMinWidth,height:e.switchHeight,lineHeight:`${e.switchHeight}px`,verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${t}-disabled)`]:{background:e.colorTextTertiary}}),be(e)),{[`&${t}-checked`]:{background:e.switchColor,[`&:hover:not(${t}-disabled)`]:{background:e.colorPrimaryHover}},[`&${t}-loading, &${t}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${t}-rtl`]:{direction:"rtl"}})}},en=Se("Switch",e=>{const t=e.fontSize*e.lineHeight,a=e.controlHeight/2,c=2,i=t-c*2,d=a-c*2,v=we(e,{switchMinWidth:i*2+c*4,switchHeight:t,switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchInnerMarginMin:i/2,switchInnerMarginMax:i+c+c*2,switchPadding:c,switchPinSize:i,switchBg:e.colorBgContainer,switchMinWidthSM:d*2+c*2,switchHeightSM:a,switchInnerMarginMinSM:d/2,switchInnerMarginMaxSM:d+c+c*2,switchPinSizeSM:d,switchHandleShadow:`0 2px 4px 0 ${new ve("#00230b").setAlpha(.2).toRgbString()}`,switchLoadingIconSize:e.fontSizeIcon*.75,switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[Je(v),Ze(v),Ye(v),Qe(v),Ge(v)]}),nn=Te("small","default"),tn=()=>({id:String,prefixCls:String,size:g.oneOf(nn),disabled:{type:Boolean,default:void 0},checkedChildren:g.any,unCheckedChildren:g.any,tabindex:g.oneOfType([g.string,g.number]),autofocus:{type:Boolean,default:void 0},loading:{type:Boolean,default:void 0},checked:g.oneOfType([g.string,g.number,g.looseBool]),checkedValue:g.oneOfType([g.string,g.number,g.looseBool]).def(!0),unCheckedValue:g.oneOfType([g.string,g.number,g.looseBool]).def(!1),onChange:{type:Function},onClick:{type:Function},onKeydown:{type:Function},onMouseup:{type:Function},"onUpdate:checked":{type:Function},onBlur:Function,onFocus:Function}),an=R({compatConfig:{MODE:3},name:"ASwitch",__ANT_SWITCH:!0,inheritAttrs:!1,props:tn(),slots:Object,setup(e,t){let{attrs:a,slots:c,expose:i,emit:d}=t;const v=he(),b=xe(),_=O(()=>{var l;return(l=e.disabled)!==null&&l!==void 0?l:b.value});Ie(()=>{});const $=W(e.checked!==void 0?e.checked:a.defaultChecked),M=O(()=>$.value===e.checkedValue);Me(()=>e.checked,()=>{$.value=e.checked});const{prefixCls:S,direction:C,size:w}=ye("switch",e),[s,f]=en(S),m=W(),y=()=>{var l;(l=m.value)===null||l===void 0||l.focus()};i({focus:y,blur:()=>{var l;(l=m.value)===null||l===void 0||l.blur()}}),te(()=>{ie(()=>{e.autofocus&&!_.value&&m.value.focus()})});const h=(l,r)=>{_.value||(d("update:checked",l),d("change",l,r),v.onFieldChange())},T=l=>{d("blur",l)},u=l=>{y();const r=M.value?e.unCheckedValue:e.checkedValue;h(r,l),d("click",r,l)},U=l=>{l.keyCode===Q.LEFT?h(e.unCheckedValue,l):l.keyCode===Q.RIGHT&&h(e.checkedValue,l),d("keydown",l)},L=l=>{var r;(r=m.value)===null||r===void 0||r.blur(),d("mouseup",l)},B=O(()=>({[`${S.value}-small`]:w.value==="small",[`${S.value}-loading`]:e.loading,[`${S.value}-checked`]:M.value,[`${S.value}-disabled`]:_.value,[S.value]:!0,[`${S.value}-rtl`]:C.value==="rtl",[f.value]:!0}));return()=>{var l;return s(n(Ae,null,{default:()=>[n("button",V(V(V({},Pe(e,["prefixCls","checkedChildren","unCheckedChildren","checked","autofocus","checkedValue","unCheckedValue","id","onChange","onUpdate:checked"])),a),{},{id:(l=e.id)!==null&&l!==void 0?l:v.id.value,onKeydown:U,onClick:u,onBlur:T,onMouseup:L,type:"button",role:"switch","aria-checked":$.value,disabled:_.value||e.loading,class:[a.class,B.value],ref:m}),[n("div",{class:`${S.value}-handle`},[e.loading?n(Ce,{class:`${S.value}-loading-icon`},null):null]),n("span",{class:`${S.value}-inner`},[n("span",{class:`${S.value}-inner-checked`},[G(c,e,"checkedChildren")]),n("span",{class:`${S.value}-inner-unchecked`},[G(c,e,"unCheckedChildren")])])])]}))}}}),sn=$e(an);function on(){return z({url:"/api/configuration/email"})}function ln(e){return z({url:"/api/configuration/email",method:"put",data:{...e}})}function cn(e){return z({url:"/api/configuration/email/test",method:"post",data:{email:e}})}function rn(e){const{pageIndex:t,pageSize:a}=e;return z({url:"/api/configuration/list",params:{pageIndex:t,pageSize:a}})}function dn(e){const{id:t,value:a}=e;return z({url:"/api/configuration",method:"put",data:{id:t,value:a}})}const un={class:"body"},mn={class:"v-center flex gap-8px"},pn=R({__name:"email-tab",setup(e){const t=W(null),{formRef:a,validate:c}=Z(),i=k({stmpServer:"",stmpPort:"",emailAddress:"",emailPassword:"",emailUser:"",emailSignature:"",useSSL:!1,loading:!1,testEmail:"",testModal:!1}),{defaultRequiredRule:d,formRules:v}=J(),b={stmpServer:d,stmpPort:d,emailAddress:v.email,emailPassword:d,emailUser:d,emailSignature:d,testEmail:v.email};te(async()=>{await _()});async function _(){const{data:w,error:s}=await on();!s&&w&&w.code===0&&Object.assign(i,w.data)}function $(){if(!i.emailAddress||!i.emailAddress.includes("@")){i.stmpServer="",i.stmpPort="";return}const w=[{extensions:"@qq.com",stmpServer:"smtp.qq.com",stmpPort:465},{extensions:"@163.com",stmpServer:"smtp.163.com",stmpPort:465},{extensions:"@gmail.com",stmpServer:"smtp.gmail.com",stmpPort:465},{extensions:"@126.com",stmpServer:"smtp.126.com",stmpPort:465},{extensions:"@139.com",stmpServer:"smtp.139.com",stmpPort:465},{extensions:"@foxmail.com",stmpServer:"smtp.foxmail.com",stmpPort:465},{extensions:"@sina.com",stmpServer:"smtp.sina.com",stmpPort:465},{extensions:"@sohu.com",stmpServer:"smtp.sohu.com",stmpPort:465},{extensions:"@outlook.com",stmpServer:"smtp.office365.com",stmpPort:465},{extensions:"@icloud.com",stmpServer:"smtp.mail.me.com",stmpPort:587}];for(const s of w)if(i.emailAddress.endsWith(s.extensions)){i.stmpServer=s.stmpServer,i.stmpPort=s.stmpPort;break}}function M(){i.testModal=!0}async function S(){var f;await t.value.validate();const{data:w,error:s}=await cn(i.testEmail);!s&&w&&w.code===0&&(i.testModal=!1,(f=window.$message)==null||f.success("邮件发送成功"))}async function C(){var f;await c();const{data:w,error:s}=await ln({...i});!s&&w&&w.code===0&&((f=window.$message)==null||f.success("保存成功"))}return(w,s)=>{const f=ge,m=ne,y=sn,A=ee,h=X,T=ze;return q(),j("div",un,[n(A,{ref_key:"formRef",ref:a,name:"operate",layout:"vertical",model:i,rules:b},{default:o(()=>[n(m,{label:"发件箱地址",name:"emailAddress"},{default:o(()=>[n(f,{value:i.emailAddress,"onUpdate:value":s[0]||(s[0]=u=>i.emailAddress=u),autocomplete:"off",placeholder:"发件箱地址",onChange:$},null,8,["value"])]),_:1}),n(m,{label:"发件箱授权码",name:"emailPassword"},{default:o(()=>[n(f,{value:i.emailPassword,"onUpdate:value":s[1]||(s[1]=u=>i.emailPassword=u),autocomplete:"off",placeholder:"发件箱授权码",type:"password"},null,8,["value"])]),_:1}),n(m,{label:"发件人",name:"emailUser"},{default:o(()=>[n(f,{value:i.emailUser,"onUpdate:value":s[2]||(s[2]=u=>i.emailUser=u),autocomplete:"off",placeholder:"发件人"},null,8,["value"])]),_:1}),n(m,{label:"邮件签名",name:"emailSignature"},{default:o(()=>[n(f,{value:i.emailSignature,"onUpdate:value":s[3]||(s[3]=u=>i.emailSignature=u),autocomplete:"off",placeholder:"邮件签名"},null,8,["value"])]),_:1}),n(m,{label:"STMP服务器",name:"stmpServer"},{default:o(()=>[n(f,{value:i.stmpServer,"onUpdate:value":s[4]||(s[4]=u=>i.stmpServer=u),autocomplete:"off",placeholder:"STMP服务器"},null,8,["value"])]),_:1}),n(m,{label:"STMP端口",name:"stmpPort"},{default:o(()=>[n(f,{value:i.stmpPort,"onUpdate:value":s[5]||(s[5]=u=>i.stmpPort=u),autocomplete:"off",placeholder:"STMP端口"},null,8,["value"])]),_:1}),n(m,{label:"使用SSL",name:"useSSL"},{default:o(()=>[n(y,{checked:i.useSSL,"onUpdate:checked":s[6]||(s[6]=u=>i.useSSL=u)},null,8,["checked"])]),_:1})]),_:1},8,["model"]),I("div",mn,[n(h,{onClick:M},{default:o(()=>s[9]||(s[9]=[F("邮件测试")])),_:1}),n(h,{type:"primary",onClick:C},{default:o(()=>s[10]||(s[10]=[F("保存")])),_:1})]),n(T,{open:i.testModal,"onUpdate:open":s[8]||(s[8]=u=>i.testModal=u),title:"邮件服务测试",onOk:S},{default:o(()=>[n(A,{ref_key:"modalFormRef",ref:t,name:"operate",layout:"vertical",model:i,rules:b},{default:o(()=>[n(m,{label:"测试地址",name:"testEmail"},{default:o(()=>[n(f,{value:i.testEmail,"onUpdate:value":s[7]||(s[7]=u=>i.testEmail=u),autocomplete:"off",placeholder:"测试地址"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}}),hn=ae(pn,[["__scopeId","data-v-15addbce"]]),gn={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},fn={class:"flex-1"},Sn={class:"w-full flex-y-center justify-end gap-12px"},wn={class:"body"},vn=R({__name:"config-tab",setup(e){const t=We(),{formRef:a,resetFields:c}=Z(),{defaultRequiredRule:i}=J(),{tableWrapperRef:d,scrollConfig:v}=Fe(),{columns:b,columnChecks:_,data:$,getData:M,getDataByPage:S,loading:C,mobilePagination:w,searchParams:s,resetSearchParams:f}=Re({apiFn:(...r)=>rn(...r),apiParams:{pageIndex:1,pageSize:10},columns:()=>[{key:"name",dataIndex:"name",title:"配置名称",width:350,ellipsis:!0},{key:"value",dataIndex:"value",title:"配置值"},{key:"operate",title:"操作",align:"center",width:80,customRender:({record:r})=>n("div",{class:"flex-center gap-4px"},[L(r)])}]}),{drawerVisible:m,handleEdit:y,closeDrawer:A}=Ue($,M),h=k({submitLoading:!1,id:"",name:"",value:""}),T={value:i};async function u(){await c(),f()}async function U(){M()}function L(r){return t.hasOne(Xe.System.Setting.UPDATE)?n(Ee,{placement:"top",title:"编辑"},{default:()=>[n(X,{type:"link",size:"small",onClick:()=>B(r)},{default:()=>[n(Ne,null,null)]})]}):""}function B(r){y(r.id),ie(()=>{h.id=r.id,h.name=r.name,h.value=r.value})}async function l(){var r;h.submitLoading=!0;try{const{data:p,error:D}=await dn({...h});!D&&p&&p.code===0&&((r=window.$message)==null||r.success("保存成功"),A(),S())}finally{h.submitLoading=!1}}return(r,p)=>{const D=De,E=X,oe=Oe,N=ne,le=Be,K=ee,ce=He,re=Ve,de=se,ue=fe,me=qe,pe=Ke;return q(),j("div",gn,[n(Le,null,{default:o(()=>[n(K,{ref_key:"formRef",ref:a,name:"filer",model:x(s),"label-col":{span:5,md:7}},{default:o(()=>[n(le,{gutter:[16,16],wrap:""},{default:o(()=>[I("div",fn,[n(N,{class:"m-0"},{default:o(()=>[I("div",Sn,[n(E,{onClick:u},{icon:o(()=>[n(D,{class:"align-sub text-icon"})]),default:o(()=>[p[4]||(p[4]=I("span",{class:"ml-8px"},"重置",-1))]),_:1}),n(E,{type:"primary",ghost:"",onClick:U},{icon:o(()=>[n(oe,{class:"align-sub text-icon"})]),default:o(()=>[p[5]||(p[5]=I("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1}),n(de,{title:"配置列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:o(()=>[n(ce,{columns:x(_),"onUpdate:columns":p[0]||(p[0]=P=>Y(_)?_.value=P:null)},null,8,["columns"])]),default:o(()=>[n(re,{ref_key:"tableWrapperRef",ref:d,columns:x(b),"data-source":x($),size:"small",scroll:x(v),loading:x(C),"row-key":"id",pagination:x(w),class:"h-full"},null,8,["columns","data-source","scroll","loading","pagination"])]),_:1}),n(pe,{open:x(m),"onUpdate:open":p[3]||(p[3]=P=>Y(m)?m.value=P:null),title:`编辑${h.name}配置`,width:650},{footer:o(()=>[n(me,{size:16},{default:o(()=>[n(E,{onClick:p[2]||(p[2]=P=>m.value=!1)},{default:o(()=>p[6]||(p[6]=[F("取消")])),_:1}),n(E,{type:"primary",loading:h.submitLoading,onClick:l},{default:o(()=>p[7]||(p[7]=[F("保存")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[I("div",wn,[n(K,{ref_key:"formRef",ref:a,name:"operate",layout:"vertical",model:h,rules:T},{default:o(()=>[n(N,{label:"配置值",name:"value"},{default:o(()=>[n(ue,{value:h.value,"onUpdate:value":p[1]||(p[1]=P=>h.value=P),"auto-size":{minRows:8}},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","title"])])}}}),_n={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},bn=R({name:"system_setting",__name:"index",setup(e){const t=k({active:"email"});return(a,c)=>{const i=je,d=ke,v=se;return q(),j("div",_n,[n(v,{class:"h-full"},{default:o(()=>[n(d,{"active-key":t.active,"onUpdate:activeKey":c[0]||(c[0]=b=>t.active=b)},{default:o(()=>[n(i,{key:"email"},{tab:o(()=>c[1]||(c[1]=[I("p",{class:"tab-title"},"邮件设置",-1)])),default:o(()=>[n(hn)]),_:1}),n(i,{key:"config"},{tab:o(()=>c[2]||(c[2]=[I("p",{class:"tab-title"},"所有设置",-1)])),default:o(()=>[n(vn)]),_:1})]),_:1},8,["active-key"])]),_:1})])}}}),Dn=ae(bn,[["__scopeId","data-v-c66d9fe5"]]);export{Dn as default};
