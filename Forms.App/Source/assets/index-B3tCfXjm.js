import{_ as we}from"./table-header-operation.vue_vue_type_script_setup_true_lang-C7seoTxq.js";import{_ as Pe,a as Ae}from"./smartphone-HU6l312V.js";import{_ as Ie,S as xe,g as Te,a as Re,b as Me,T as $e,u as ke,c as Ce,d as Se,e as Fe}from"./table-search-filter-DgS7ifzw.js";import{m as G,d as Z,D as V,E as me,c as M,o as I,w as d,f as n,z as L,e as O,v as K,b as Q,H as ee,P as te,g as C,t as ne,B as z,r as B,s as De,F as ae,i as Y,h,q as Ee,aj as Ue,a as Oe,j as se,a8 as X,M as Ne,a9 as oe}from"./index-CZVtSjPQ.js";import{u as We,A as re}from"./app.permissions-B_pV7apU.js";import{a as le,g as je}from"./index-DiqUFypO.js";import{u as fe,F as ve,_ as ye,I as he,a as Be,d as Le,e as ie}from"./form-ZxLsforZ.js";import{_ as Ve}from"./index.vue_vue_type_script_setup_true_lang-pVOlQRHe.js";import{_ as ze}from"./index-DOEbmRvB.js";import{L as qe}from"./index-Y4HE4_-c.js";import{C as q}from"./china.area-DOOnik0V.js";import{d as Ge}from"./debounce-BsWDECm-.js";import{S as He}from"./index-BWb-9rJv.js";import{_ as Ke}from"./index-BVBn8Dpq.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as J,a as Xe}from"./enum-map-device-i1knBcFt.js";import{d as Je}from"./enums-XBoEbamp.js";import{C as Qe}from"./index-ClUX1lZP.js";import{T as Ye}from"./ToolFilled-djzCWACB.js";import{T as j}from"./index-DMMLrYUn.js";import"./index-CQCXu6T9.js";import"./LeftOutlined-Cj56myxb.js";import"./EyeOutlined-B3DWie8W.js";import"./index-Ds_LW8Zf.js";import"./responsiveObserve-CdtC9r70.js";import"./isSymbol-DgABtkrl.js";function Ze(e){const{pageIndex:a,pageSize:t}=e,l={pageIndex:a,pageSize:t};return e.init!==void 0&&typeof e.init=="number"&&(l.init=e.init),e.account&&(l.account=e.account),e.userId&&(l.userId=e.userId),e.deviceId&&(l.deviceId=e.deviceId),e.deviceName&&(l.deviceName=e.deviceName),G({url:"/api/device/alibaba/list",params:{...l}})}function et(e){const{id:a}=e,t={id:a};return e.id&&(t.id=e.id),e.currentMonth&&(t.currentMonth=e.currentMonth),e.lastMonth&&(t.lastMonth=e.lastMonth),e.payPhone&&(t.payPhone=e.payPhone),e.payPassword&&(t.payPassword=e.payPassword),e.address&&(t.address=e.address),e.name&&(t.name=e.name),e.phone&&(t.phone=e.phone),e.province&&(t.province=e.province),e.city&&(t.city=e.city),G({url:"/api/device/alibaba",method:"put",data:t})}function tt(e){return G({url:`/api/device/alibaba/${e}`})}function nt(e){return G({url:"/api/device/alibaba/init",method:"post",data:{ids:e}})}const at={class:"flex-1"},st={class:"w-full flex-y-center justify-end gap-12px"},ot=Z({name:"DeviceAlibabaListSearch",__name:"search-filter",props:V({buyPayType:{default:()=>[]},init:{default:()=>[]},userInfo:{default:()=>{}}},{model:{required:!0},modelModifiers:{}}),emits:V(["reset","search"],["update:model"]),setup(e,{emit:a}){const{formRef:t,validate:l,resetFields:i}=fe(),c=me(e,"model"),f=e,y=a;async function o(){await i(),y("reset")}async function g(){await l(),y("search")}return(k,_)=>{const x=he,P=ye,A=ze,$=Te,E=xe,S=Re,F=z,N=Me,D=Ie,W=ve;return I(),M($e,null,{default:d(()=>[n(W,{ref_key:"formRef",ref:t,name:"filer",model:c.value,"label-col":{span:5,md:7}},{default:d(()=>[n(D,{gutter:[16,16],wrap:""},{default:d(()=>[n(A,{span:24,md:12,lg:6},{default:d(()=>[n(P,{label:"系统编号",name:"deviceId",class:"m-0"},{default:d(()=>[n(x,{value:c.value.deviceId,"onUpdate:value":_[0]||(_[0]=u=>c.value.deviceId=u),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:K(g,["enter"])},null,8,["value"])]),_:1})]),_:1}),n(A,{span:24,md:12,lg:6},{default:d(()=>[n(P,{label:"设备名称",name:"deviceName",class:"m-0"},{default:d(()=>[n(x,{value:c.value.deviceName,"onUpdate:value":_[1]||(_[1]=u=>c.value.deviceName=u),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:K(g,["enter"])},null,8,["value"])]),_:1})]),_:1}),n(A,{span:24,md:12,lg:6},{default:d(()=>[n(P,{label:"登录账号",name:"account",class:"m-0"},{default:d(()=>[n(x,{value:c.value.account,"onUpdate:value":_[2]||(_[2]=u=>c.value.account=u),autocomplete:"off",placeholder:"支持模糊查询",onKeyup:K(g,["enter"])},null,8,["value"])]),_:1})]),_:1}),f.buyPayType&&f.buyPayType.length>1?(I(),M(A,{key:0,span:24,md:12,lg:6},{default:d(()=>[n(P,{label:"支付方式",name:"buyPayType"},{default:d(()=>[n(E,{value:c.value.buyPayType,"onUpdate:value":_[3]||(_[3]=u=>c.value.buyPayType=u),placeholder:"- 全部 -","allow-clear":""},{default:d(()=>[(I(!0),Q(ee,null,te(f.buyPayType,u=>(I(),M($,{key:u.value,value:u.value},{default:d(()=>[C(ne(u.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})):L("",!0),n(A,{span:24,md:12,lg:6},{default:d(()=>[n(P,{label:"状态",name:"init"},{default:d(()=>[n(E,{value:c.value.init,"onUpdate:value":_[4]||(_[4]=u=>c.value.init=u),placeholder:"- 全部 -","allow-clear":""},{default:d(()=>[(I(!0),Q(ee,null,te(f.init,u=>(I(),M($,{key:u.value,value:u.value},{default:d(()=>[C(ne(u.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),f.userInfo.isTenant?L("",!0):(I(),M(A,{key:1,span:24,md:12,lg:6},{default:d(()=>[n(P,{label:"所属商户",name:"userId",class:"m-0"},{default:d(()=>[n(Ve,{value:c.value.userId,"onUpdate:value":_[5]||(_[5]=u=>c.value.userId=u),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),O("div",at,[n(P,{class:"m-0"},{default:d(()=>[O("div",st,[n(F,{onClick:o},{icon:d(()=>[n(S,{class:"align-sub text-icon"})]),default:d(()=>[_[6]||(_[6]=O("span",{class:"ml-8px"},"重置",-1))]),_:1}),n(F,{type:"primary",ghost:"",onClick:g},{icon:d(()=>[n(N,{class:"align-sub text-icon"})]),default:d(()=>[_[7]||(_[7]=O("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),ue=["北京","上海","天津","重庆"],de=["内蒙古自治区","广西壮族自治区","宁夏回族自治区","西藏自治区","新疆维吾尔自治区"],ce=["香港特别行政区","澳门特别行政区","台湾省"],rt=Ge((e,a)=>{var t,l,i,c;e||a(void 0);try{const f=pt(e);f||((t=window.$message)==null||t.error("地址解析失败，请确认格式"),a(void 0));const y=ge(f.province,f.city);y.length===2?(f.areaValues=y,(l=window.$message)==null||l.success("解析成功")):(i=window.$message)==null||i.error("无法找到对应的省市选项"),a(f)}catch{(c=window.$message)==null||c.error("解析地址失败，请检查格式是否正确"),a(void 0)}},500),lt=[{type:"municipality",condition:e=>ue.some(a=>e.startsWith(a)),parser:(e,a)=>{const t=ue.find(l=>e.startsWith(l));return t?ct(e,a,t):null}},{type:"autonomous",condition:e=>de.some(a=>e.startsWith(a)||e.startsWith(a.replace("自治区",""))),parser:(e,a)=>{const t=de.find(l=>e.startsWith(l)||e.startsWith(l.replace("自治区","")));return t?mt(e,a,t):null}},{type:"special",condition:e=>ce.some(a=>e.startsWith(a)||e.startsWith(a.replace(/(特别行政区|省)/,""))),parser:(e,a)=>{const t=ce.find(l=>e.startsWith(l)||e.startsWith(l.replace(/(特别行政区|省)/,"")));return t?ft(e,a,t):null}},{type:"normal",condition:()=>!0,parser:(e,a)=>vt(e,a)}],pe=q;function it(e){if(!e)return"";const a=e.split(/[\n\r]+/).map(l=>l.trim());return[/^姓名[:：]?\s*.+/,/^手机号码[:：]?\s*1[3-9]\d{9}/,/^所在地区[:：]?\s*[\u4E00-\u9FA5]+/,/^详细地址[:：]?\s*.+/].every(l=>a.some(i=>l.test(i)))?"":"error"}function ut(e){if(!e)return"";const a=e.split(/[\n\r]+/).map(i=>i.trim()),l=[{name:"姓名",regex:/^姓名[:：]?\s*.+/},{name:"手机号码",regex:/^手机号码[:：]?\s*1[3-9]\d{9}/},{name:"所在地区",regex:/^所在地区[:：]?\s*[\u4E00-\u9FA5]+/},{name:"详细地址",regex:/^详细地址[:：]?\s*.+/}].filter(i=>!a.some(c=>i.regex.test(c)));return l.length>0?`地址格式不正确

当前缺少或格式不正确：${l.map(i=>i.name).join("、")}`:""}function dt(e){return new Promise(a=>{rt(e,t=>{a(t)})})}function ge(e,a){var i,c;const t=(i=Object.entries(q[86]).find(([f,y])=>y===e))==null?void 0:i[0];if(!t)return[];const l=(c=Object.entries(q[t]).find(([f,y])=>y===a))==null?void 0:c[0];return l?[t,l]:[]}function ct(e,a,t){const l=`${t}市`;let i=e;i=i.replace(new RegExp(`^${t}${t}市`),t),i=i.replace(new RegExp(`^${t}市${t}市`),`${t}市`),i=i.replace(new RegExp(`^${t}${t}`),t),i=i.replace(new RegExp(`^${t}市`),t),i=i.replace(new RegExp(`^${t}`),t);const c=i.match(new RegExp(`${t}(.+?区|.+?县)(.+)?$`));if(c){const y=c[1],g=(c[2]||"")+(a?` ${a}`:"");return{province:l,city:y,address:g}}const f=i.replace(new RegExp(`^${t}`),"")+(a?` ${a}`:"");return{province:l,city:f,address:""}}function pt(e){const a=e.replace(/：/g,":").replace(/\s+/g," ").trim();if(!["姓名:","手机号码:","所在地区:","详细地址:"].every(A=>a.includes(A)))return null;const i=a.match(/姓名:\s*(.+?)\s*(?=手机号码:|$)/),c=a.match(/手机号码:\s*(1[3-9]\d{9})\s*(?=所在地区:|$)/),f=a.match(/所在地区:\s*([^\n]+?)(?=详细地址:|$)/),y=a.match(/详细地址:\s*([^\n]+?)(?=$)/);if(!i||!c||!f||!y)return null;const o=i[1].trim(),g=c[1].trim(),k=f[1].trim(),_=y[1].trim();if(!o||!g||!k||!_)return null;const x=k.replace(/\s+/g,""),P=yt(x,_);return!P||!P.province||!P.city?null:{...P,phone:g,name:o}}function mt(e,a,t){const l=t,i=e.slice(e.startsWith(t)?t.length:t.replace("自治区","").length),c=i.match(/^[^市]+市/),f=c?c[0]:"",y=c?i.slice(f.length)+(a?` ${a}`:""):i+(a?` ${a}`:"");return{province:l,city:f,address:y}}function ft(e,a,t){const l=t,i=e.slice(e.startsWith(t)?t.length:t.replace(/(特别行政区|省)/,"").length);return{province:l,city:"",address:i+(a?` ${a}`:"")}}function vt(e,a){const t=e.match(/^(.*?省)(.*?市)(.*)$/);if(t)return{province:t[1],city:t[2],address:t[3]+(a?` ${a}`:"")};const l=e.match(/^(.*?)(市)(.*)$/);if(l){const i=l[1],c=Object.entries(q[86]).find(([f,y])=>y.startsWith(i)||y.replace(/(省|自治区|特别行政区)/,"").startsWith(i));if(c)return{province:c[1],city:l[1]+l[2],address:l[3]+(a?` ${a}`:"")}}return null}function yt(e,a){for(const{condition:t,parser:l}of lt)if(t(e)){const i=l(e,a);if(i)return i}return null}const ht={class:"body"},_t=`姓名: 李四
手机号码: 10000000000
所在地区: 北京市 朝阳区
详细地址: XXX街道xxx号`,gt=Z({name:"DeviceAlibabaEditDrawer",__name:"edit-drawer",props:V({rowData:{},authStore:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(e,{emit:a}){const t=me(e,"visible"),l=B(null),i=B(null),{formRef:c,validate:f,resetFields:y}=fe(),o=De({id:"",payPassword:"",payPhone:"",province:"",city:"",address:"",name:"",phone:"",currentMonth:0,lastMonth:0,aliAddress:"",loading:!0,submitLoading:!1}),g=e,{defaultRequiredRule:k}=Be(),_={payPassword:[{required:!0,message:"支付密码不能为空",trigger:"blur"},{validator:(u,s)=>s&&(s.length!==6||!/^\d+$/.test(s))?Promise.reject(new Error("支付密码应为六位数字")):Promise.resolve(),trigger:"blur"}],payPhone:[k,{validator:(u,s)=>s?ie.test(s)?Promise.resolve():Promise.reject(new Error("代付手机号格式错误")):Promise.resolve()}],name:[{validator:(u,s)=>s&&s.length>30?Promise.reject(new Error("收货人姓名至少2个字符,可以是汉字或英文字母")):Promise.resolve(),trigger:"blur"}],phone:[{validator:(u,s)=>s?ie.test(s)?Promise.resolve():Promise.reject(new Error("联系电话格式错误")):Promise.resolve(),trigger:"blur"}],currentMonth:[{required:!0,message:"请输入本月牛气值",trigger:"blur"}],lastMonth:[{required:!0,message:"请输入上月牛气值",trigger:"blur"}]},x=a,P=B([]),A=B([]);ae(()=>o.aliAddress,S),ae(t,async(u,s)=>{u&&!s&&(E(),await $())});async function $(){var u,s;o.loading=!0;try{const{data:p,error:v}=await tt((u=g.rowData)==null?void 0:u.id);if(v||(p==null?void 0:p.code)!==0){(s=window.$message)==null||s.error("获取详情失败");return}if(Object.assign(o,{id:p.data.id,payPassword:p.data.payPassword,payPhone:p.data.payPhone,name:p.data.name,phone:p.data.phone,province:p.data.province,city:p.data.city,address:p.data.address,currentMonth:g.rowData.currentMonth,lastMonth:g.rowData.lastMonth}),p.data.province&&p.data.city){const T=ge(p.data.province,p.data.city);T.length===2&&(A.value=T)}}finally{o.loading=!1}}function E(){y(),o.id="",o.aliAddress="",A.value=[],Object.assign(o,{payPassword:"",payPhone:"",name:"",phone:"",province:"",city:"",address:"",currentMonth:0,lastMonth:0})}Y(()=>{const u=pe[86];P.value=Object.entries(u).map(([s,p])=>{const v=pe[s],T=v?Object.entries(v).map(([m,r])=>({value:m,label:r,isLeaf:!0})):[];return{value:s,label:p,children:T}})});async function S(u){if(!u)return;const s=await dt(u);Object.assign(o,s),A.value=s.areaValues}function F(){t.value=!1}async function N(){var u,s;await f();try{o.submitLoading=!0;const p={id:(u=g.rowData)==null?void 0:u.id,payPassword:o.payPassword,payPhone:o.payPhone,province:o.province,city:o.city,address:o.address,name:o.name,phone:o.phone,currentMonth:o.currentMonth,lastMonth:o.lastMonth},{data:v,error:T}=await et(p);!T&&(v==null?void 0:v.code)===0&&((s=window.$message)==null||s.success("保存成功"),x("submitted"),F())}finally{o.submitLoading=!1}}function D(u){var s;if(u&&u.length===2){const p=P.value.find(v=>v.value===u[0]);if(p){o.province=p.label;const v=(s=p.children)==null?void 0:s.find(T=>T.value===u[1]);v&&(o.city=v.label)}}else o.province="",o.city=""}async function W(){var u;await((u=c.value)==null?void 0:u.validateFields(["aliAddress"]))}return(u,s)=>{const p=he,v=ye,T=Pe,m=Le,r=ve,w=z,R=He,H=Ke;return I(),M(H,{open:t.value,"onUpdate:open":s[9]||(s[9]=b=>t.value=b),title:"编辑1688设备",width:500},{footer:d(()=>[n(R,{size:16},{default:d(()=>[n(w,{onClick:F},{default:d(()=>s[10]||(s[10]=[C("取消")])),_:1}),n(w,{type:"primary",loading:o.submitLoading,onClick:N},{default:d(()=>s[11]||(s[11]=[C("保存")])),_:1},8,["loading"])]),_:1})]),default:d(()=>[O("div",ht,[n(r,{ref_key:"formRef",ref:c,name:"operate",layout:"vertical",model:o,rules:_},{default:d(()=>[g.authStore.isInternalTenant&&!g.authStore.userInfo.isTenantUser?(I(),M(v,{key:0,label:"本月牛气值",name:"currentMonth"},{default:d(()=>[n(p,{ref_key:"payPasswordRef",ref:i,value:o.currentMonth,"onUpdate:value":s[0]||(s[0]=b=>o.currentMonth=b),placeholder:"请输入本月牛气值"},null,8,["value"])]),_:1})):L("",!0),g.authStore.isInternalTenant&&!g.authStore.userInfo.isTenantUser?(I(),M(v,{key:1,label:"上月牛气值",name:"lastMonth"},{default:d(()=>[n(p,{ref_key:"payPasswordRef",ref:i,value:o.lastMonth,"onUpdate:value":s[1]||(s[1]=b=>o.lastMonth=b),placeholder:"请输入上月牛气值"},null,8,["value"])]),_:1})):L("",!0),o.buyPayType===2?(I(),M(v,{key:2,label:"代付手机",name:"payPhone"},{default:d(()=>[n(p,{ref_key:"payPhoneRef",ref:l,value:o.payPhone,"onUpdate:value":s[2]||(s[2]=b=>o.payPhone=b),placeholder:"请输入代付手机号"},null,8,["value"])]),_:1})):(I(),M(v,{key:3,label:"支付密码",name:"payPassword"},{default:d(()=>[n(p,{ref_key:"payPasswordRef",ref:i,value:o.payPassword,"onUpdate:value":s[3]||(s[3]=b=>o.payPassword=b),placeholder:"请输入支付密码",type:"password"},null,8,["value"])]),_:1})),n(v,{label:"收货人",name:"name"},{default:d(()=>[n(p,{value:o.name,"onUpdate:value":s[4]||(s[4]=b=>o.name=b),placeholder:"请输入收货人姓名"},null,8,["value"])]),_:1}),n(v,{label:"联系电话",name:"phone"},{default:d(()=>[n(p,{value:o.phone,"onUpdate:value":s[5]||(s[5]=b=>o.phone=b),placeholder:"请输入联系电话"},null,8,["value"])]),_:1}),n(v,{label:"所在地区",name:"selectedArea"},{default:d(()=>[n(T,{value:A.value,"onUpdate:value":s[6]||(s[6]=b=>A.value=b),options:P.value,placeholder:"请选择省市",onChange:D},null,8,["value","options"])]),_:1}),n(v,{label:"详细地址",name:"address"},{default:d(()=>[n(m,{value:o.address,"onUpdate:value":s[7]||(s[7]=b=>o.address=b),placeholder:"请输入详细地址",rows:3},null,8,["value"])]),_:1}),n(v,{label:"地址文本解析",name:"aliAddress","validate-status":h(it)(o.aliAddress),help:h(ut)(o.aliAddress)},{default:d(()=>[n(m,{value:o.aliAddress,"onUpdate:value":s[8]||(s[8]=b=>o.aliAddress=b),placeholder:_t,rows:4,"auto-size":{minRows:4,maxRows:6},onInput:W},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["model"]),n(qe,{loading:o.loading},null,8,["loading"])])]),_:1},8,["open"])}}}),bt=_e(gt,[["__scopeId","data-v-0131380e"]]),wt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Pt=Z({name:"device_alibaba",__name:"index",setup(e){const a=We(),t=Ee(),{tableWrapperRef:l,scrollConfig:i}=ke(),c=Ue(),f=B([0]),y=Oe(()=>t.userInfo.isTenant?J.filter(m=>f.value.includes(m.value)):J),{columns:o,columnChecks:g,data:k,getData:_,getDataByPage:x,loading:P,mobilePagination:A,searchParams:$,resetSearchParams:E}=Ce({apiFn:Ze,apiParams:{pageIndex:1,pageSize:10},columns:u}),{drawerVisible:S,editingData:F,handleEdit:N,checkedRowKeys:D,rowSelection:W}=Se(k,_);Y(()=>{const m=c.getParams();m&&m.deviceId&&($.deviceId=m.deviceId,setTimeout(()=>x(1),0))}),se(()=>{const m=c.getParams();m&&m.deviceId&&($.deviceId=m.deviceId,x(1))});function u(){const m=[{key:"accountInfo",dataIndex:"accountInfo",title:"账号信息",align:"center",width:300,customRender:({record:r})=>n("div",{style:"font-size:14px"},[n("p",{class:"info mb-6px"},[n("span",null,[C("账号：")]),n("span",{title:r.account||"-"},[r.account||"-"])]),n("p",null,[n("p",{class:"info mb-6px"},[n("span",null,[C("性别：")]),n("span",{title:r.gender||"-"},[T(r.gender)||"-"])])]),n("p",{class:"info mb-6px"},[n("span",{class:"text-right"},[C("本月牛气值：")]),n("span",{title:r.currentMonth||"-"},[r.currentMonth||"-"])]),n("p",{class:"info mb-6px"},[n("span",null,[C("上月牛气值：")]),n("span",{title:r.lastMonth||"-"},[r.lastMonth||"-"])])])},{key:"buyPayType",dataIndex:"buyPayType",title:"支付方式",align:"center",width:100,customRender:({record:r})=>{const w=J.filter(R=>R.value===r.buyPayType)[0];return n(j,{color:w.color},{default:()=>[w.label]})}},{key:"init",dataIndex:"init",title:"账号初始化",align:"center",width:120,customRender:({record:r})=>{const w=le.filter(R=>R.value===r.init)[0];return r.init===3?n(oe,{placement:"top",title:n("span",null,[r.remark])},{default:()=>[n(j,{color:w.color},{default:()=>[w.label]})]}):n(j,{color:w.color},{default:()=>[w.label]})}},{key:"status",dataIndex:"status",title:"账号状态",align:"center",width:100,customRender:({record:r})=>{const w=Xe.filter(R=>R.value===r.status)[0];return n(j,{color:w.color},{default:()=>[w.label]})}},{key:"dayCount",dataIndex:"dayCount",title:"当日执行任务数",align:"center",width:150,customRender:({record:r})=>n("span",null,[r.dayCount||0])},{key:"monthCount",dataIndex:"monthCount",title:"当月执行任务数",align:"center",width:150,customRender:({record:r})=>n("span",null,[r.monthCount||0])},{key:"nextPairTime",dataIndex:"nextPairTime",title:"下次执行日期",align:"center",width:150,customRender:({record:r})=>n("span",null,[r.nextPairTime||"-"])},{key:"lastInitTime",dataIndex:"lastInitTime",title:"最后同步时间",align:"center",width:200,customRender:({record:r})=>r.lastInitTime||"-"},{key:"device",dataIndex:"device",title:"所属设备",align:"center",width:200,customRender:({record:r})=>`${r.deviceName} (${r.deviceId})`}];return t.userInfo.isTenant||m.push({key:"tenantName",dataIndex:"tenantName",title:"所属商户",align:"center",width:100}),m.push({key:"operate",title:"操作",align:"center",fixed:"right",width:80,customRender:({record:r})=>n("div",{class:"flex-center gap-4px"},[s(r)])}),m}function s(m){return a.hasOne(re.Device.Ali1688.UPDATE)?n(oe,{placement:"top",title:"编辑"},{default:()=>[n(z,{size:"small",type:"link",onClick:()=>N(m.id)},{default:()=>[n(Ye,null,null)]})]}):""}function p(){Ne.confirm({title:"提示",content:"初始化设备前，请确认主控设备已返回App主界面，初始化过程中，请不要添加商品及任务！",okText:"确认",cancelText:"取消",onOk:async()=>{var m;try{const r=D.value;if(r&&r.length){const{data:w,error:R}=await nt(r);!R&&w&&w.code===0&&((m=window.$message)==null||m.success("指令已下发"),x())}}catch{}}})}Y(async()=>{t.userInfo.isTenant&&await v()}),se(async()=>{t.userInfo.isTenant&&await v()});async function v(){try{const{data:m,error:r}=await Je();!r&&m&&m.code===0&&(f.value=m.data.list)}catch{}}function T(m){const r=je.filter(w=>w.value===m)[0];return n(j,{color:r.color},{default:()=>[r.label]})}return(m,r)=>{const w=Ae,R=z,H=we,b=Fe,be=Qe;return I(),Q("div",wt,[n(ot,{model:h($),"onUpdate:model":r[0]||(r[0]=U=>X($)?$.value=U:null),"user-info":h(t).userInfo,init:h(le),"buy-pay-type":y.value,onReset:h(E),onSearch:r[1]||(r[1]=U=>h(x)(1))},null,8,["model","user-info","init","buy-pay-type","onReset"]),n(be,{title:"1688设备",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:d(()=>[n(H,{columns:h(g),"onUpdate:columns":r[2]||(r[2]=U=>X(g)?g.value=U:null),"disabled-delete":h(D).length===0,loading:h(P),"add-btn":!1,"delete-btn":!1},{default:d(()=>[h(a).hasOne(h(re).Device.Ali1688.UPDATE)&&h(t).userInfo.isTenant?(I(),M(R,{key:0,size:"small",ghost:"",type:"primary",disabled:h(D).length===0,onClick:p},{icon:d(()=>[n(w)]),default:d(()=>[r[4]||(r[4]=O("span",{class:"ml-6px"},"初始化",-1))]),_:1},8,["disabled"])):L("",!0)]),_:1},8,["columns","disabled-delete","loading"])]),default:d(()=>[n(b,{ref_key:"tableWrapperRef",ref:l,columns:h(o),"data-source":h(k),size:"small","row-selection":h(W),scroll:h(i),loading:h(P),"row-key":"id",pagination:h(A),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),n(bt,{visible:h(S),"onUpdate:visible":r[3]||(r[3]=U=>X(S)?S.value=U:null),"auth-store":h(t),"row-data":h(F),"pay-type":y.value,onSubmitted:h(x)},null,8,["visible","auth-store","row-data","pay-type","onSubmitted"])]),_:1})])}}}),Xt=_e(Pt,[["__scopeId","data-v-bdafa830"]]);export{Xt as default};
