import{_ as re}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BX-iDe8o.js";import{_ as ie,S as Y,a as ue,b as de,T as me,u as ce,c as pe,d as fe,e as _e,f as ve}from"./table-search-filter-oeJAv4cw.js";import{aP as Z,m as z,d as G,D as B,E as ee,c as O,o as C,w as l,f as e,z as te,e as N,B as $,s as ge,a as j,r as be,F as we,g as K,q as Te,b as ye,h as o,a8 as q,a9 as J}from"./index-C4fDvJn1.js";import{u as Ae,A as P}from"./app.permissions-eEP3QY97.js";import{u as W}from"./enum-map-user-BJSgMiaF.js";import{u as ae,F as ne,_ as se,I as le,a as ke,w as he}from"./form-C4lsPmD3.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-zW4wEoU_.js";import{_ as Ie}from"./index-Bgjt1Cd5.js";import{S as De}from"./index-DjcmxpZa.js";import{_ as Ue}from"./index-B0OEq9ON.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as Re}from"./index-CfF1NG6B.js";import{T as Q}from"./index-Cd0TkKik.js";import{E as Ne}from"./EditOutlined-CFKuvutP.js";import{D as Ce}from"./DeleteOutlined-vV5-dJ7B.js";import"./index-BSgdO99v.js";import"./EyeOutlined-DMOywdMm.js";import"./index-tKWHzGWZ.js";import"./LeftOutlined-byKmxFgc.js";import"./responsiveObserve-k0SNxmCv.js";import"./debounce-C-eHgR1J.js";import"./isSymbol-7IJmde0n.js";import"./enums-Cr_YM2zq.js";function Se(t){const{pageIndex:d,pageSize:r}=t,_={pageIndex:d,pageSize:r};return t.email&&(_.email=t.email),t.status!==void 0&&t.status!==null&&t.status>0&&(_.status=t.status),z({url:"/api/tenant/user/list",params:{..._}})}function Ee(t){const{email:d,password:r,nickName:_,isTenantAdmin:g}=t;return z({url:"/api/tenant/user",method:"post",data:{...{email:d,password:r,nickName:_,isTenantAdmin:g===1}}})}function Fe(t){const{id:d}=t,r={id:d};return t.email&&(r.email=t.email),t.password&&(r.password=t.password),t.nickName&&(r.nickName=t.nickName),t.status=Number.parseInt(t.status,10),Number.isNaN(t.status)||(r.status=t.status),t.email&&(r.email=t.email),typeof t.isTenantAdmin=="number"&&(r.isTenantAdmin=t.isTenantAdmin===1),Object.keys(r).length===1?Z():z({url:"/api/tenant/user",method:"put",data:{...r}})}function X(t){return!t||!t.length?Z():z({url:"/api/tenant/user",method:"delete",params:{ids:t}})}const Pe={class:"flex-1"},Be={class:"w-full flex-y-center justify-end gap-12px"},Oe=G({name:"PlatformVipListSearch",__name:"search-filter",props:B({status:{default:()=>[]},userInfo:{default:()=>{}}},{model:{required:!0},modelModifiers:{}}),emits:B(["reset","search"],["update:model"]),setup(t,{emit:d}){const{formRef:r,validate:_,resetFields:g}=ae(),i=ee(t,"model"),b=t,f=d;async function I(){await g(),f("reset")}async function h(){await _(),f("search")}return(T,a)=>{const k=le,y=se,w=Ie,D=Y,U=ue,A=$,R=de,m=ie,n=ne;return C(),O(me,null,{default:l(()=>[e(n,{ref_key:"formRef",ref:r,name:"filer",model:i.value,"label-col":{span:5,md:7}},{default:l(()=>[e(m,{gutter:[16,16],wrap:""},{default:l(()=>[e(w,{span:24,md:12,lg:6},{default:l(()=>[e(y,{label:"邮箱",name:"email",class:"m-0"},{default:l(()=>[e(k,{value:i.value.email,"onUpdate:value":a[0]||(a[0]=c=>i.value.email=c),autocomplete:"off",placeholder:"支持模糊查询"},null,8,["value"])]),_:1})]),_:1}),e(w,{span:24,md:12,lg:6},{default:l(()=>[e(y,{label:"状态",name:"status"},{default:l(()=>[e(D,{value:i.value.status,"onUpdate:value":a[1]||(a[1]=c=>i.value.status=c),placeholder:"- 全部 -",options:b.status,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),b.userInfo.isTenant?te("",!0):(C(),O(w,{key:0,span:24,md:12,lg:6},{default:l(()=>[e(y,{label:"所属商户",name:"tenantId",class:"m-0"},{default:l(()=>[e(xe,{value:i.value.tenantId,"onUpdate:value":a[2]||(a[2]=c=>i.value.tenantId=c),placeholder:"- 全部 -"},null,8,["value"])]),_:1})]),_:1})),N("div",Pe,[e(y,{class:"m-0"},{default:l(()=>[N("div",Be,[e(A,{onClick:I},{icon:l(()=>[e(U,{class:"align-sub text-icon"})]),default:l(()=>[a[3]||(a[3]=N("span",{class:"ml-8px"},"重置",-1))]),_:1}),e(A,{type:"primary",ghost:"",onClick:h},{icon:l(()=>[e(R,{class:"align-sub text-icon"})]),default:l(()=>[a[4]||(a[4]=N("span",{class:"ml-8px"},"搜索",-1))]),_:1})])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}}),$e={class:"body"},ze=G({name:"TenantUserOperateDrawer",__name:"operate-drawer",props:B({operateType:{default:"add"},rowData:{default:null},status:{default:()=>[]}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:B(["submitted"],["update:visible"]),setup(t,{emit:d}){const{formRef:r,validate:_,resetFields:g}=ae(),i=ee(t,"visible"),b=ge({submit:!1}),f=t,I=d,h=j(()=>({add:"新增员工",edit:"编辑员工"})[f.operateType]),T=j(()=>f.operateType==="edit"),a=be(w()),k=j(()=>{const{formRules:m,defaultRequiredRule:n}=ke();return{email:m.email,nickName:m.userName,password:T.value?[{validator(c,v){return v&&v.trim()&&!he.test(v)?Promise.reject(new Error("密码格式不正确，6-18位字符，英文字母、数字及@#_!")):Promise.resolve()},trigger:"blur"}]:m.pwd,status:n,settingAmount:n,isTenantAdmin:n}});we(i,()=>{i.value&&(D(),g())});const y=[{value:1,label:"管理员"},{value:0,label:"员工"}];function w(){return{email:"",password:"",nickName:"",status:0,settingAmount:0,isTenantAdmin:0}}function D(){a.value=w(),T.value&&f.rowData&&(Object.assign(a.value,f.rowData),a.value.isTenantAdmin=f.rowData.isTenantAdmin?1:0)}function U(){var m;a.value.email&&(a.value.email=(m=a.value.email)==null?void 0:m.toLowerCase())}function A(){i.value=!1}async function R(){var m;await _(),b.submit=!0;try{const{data:n,error:c}=T.value?await Fe({...a.value}):await Ee({...a.value});!c&&n&&n.code===0&&((m=window.$message)==null||m.success("保存成功"),A(),I("submitted"))}finally{b.submit=!1}}return(m,n)=>{const c=le,v=se,S=Y,M=ne,E=$,H=De,V=Ue;return C(),O(V,{open:i.value,"onUpdate:open":n[5]||(n[5]=s=>i.value=s),title:h.value,width:550},{footer:l(()=>[e(H,{size:16},{default:l(()=>[e(E,{onClick:A},{default:l(()=>n[6]||(n[6]=[K("取消")])),_:1}),e(E,{type:"primary",loading:b.submit,onClick:R},{default:l(()=>n[7]||(n[7]=[K("保存")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[N("div",$e,[e(M,{ref_key:"formRef",ref:r,name:"operate",layout:"vertical",model:a.value,rules:k.value},{default:l(()=>[e(v,{label:"邮箱",name:"email"},{default:l(()=>[e(c,{value:a.value.email,"onUpdate:value":n[0]||(n[0]=s=>a.value.email=s),autocomplete:"off",placeholder:"请输入邮箱",onBlur:U},null,8,["value"])]),_:1}),e(v,{label:"密码",name:"password"},{default:l(()=>[e(c,{value:a.value.password,"onUpdate:value":n[1]||(n[1]=s=>a.value.password=s),autocomplete:"off",placeholder:"请输入密码",type:"password"},null,8,["value"])]),_:1}),e(v,{label:"昵称",name:"nickName"},{default:l(()=>[e(c,{value:a.value.nickName,"onUpdate:value":n[2]||(n[2]=s=>a.value.nickName=s),autocomplete:"off",placeholder:"请输入昵称"},null,8,["value"])]),_:1}),e(v,{label:"权限",name:"isTenantAdmin"},{default:l(()=>[e(S,{value:a.value.isTenantAdmin,"onUpdate:value":n[3]||(n[3]=s=>a.value.isTenantAdmin=s),placeholder:"请选择",options:y},null,8,["value"])]),_:1}),T.value?(C(),O(v,{key:0,label:"状态",name:"status"},{default:l(()=>[e(S,{value:a.value.status,"onUpdate:value":n[4]||(n[4]=s=>a.value.status=s),options:f.status},null,8,["value","options"])]),_:1})):te("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["open","title"])}}}),Me=oe(ze,[["__scopeId","data-v-7373c4a4"]]),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ve=G({name:"platform_tenantuser",__name:"index",setup(t){const d=Te(),{tableWrapperRef:r,scrollConfig:_}=ce(),g=Ae(),{columns:i,columnChecks:b,data:f,getData:I,getDataByPage:h,loading:T,mobilePagination:a,searchParams:k,resetSearchParams:y}=pe({apiFn:s=>Se(s),apiParams:{pageIndex:1,pageSize:10},columns:E}),{drawerVisible:w,editingData:D,operateType:U,checkedRowKeys:A,rowSelection:R,onBatchDeleted:m,onDeleted:n,handleAdd:c,handleEdit:v}=fe(f,I);async function S(){const s=A.value;if(s&&s.length){const{data:u,error:p}=await X(s);!p&&u&&u.code===0&&m()}}async function M(s){const{data:u,error:p}=await X([s]);!p&&u&&u.code===0&&n()}function E(){const s=[{key:"email",dataIndex:"email",title:"邮箱",align:"center",width:200},{key:"nickName",dataIndex:"nickName",title:"昵称",align:"center",width:200},{key:"isTenantAdmin",dataIndex:"isTenantAdmin",title:"权限",align:"center",width:120,customRender:({record:p})=>e(Q,{color:p.isTenantAdmin?"purple":"processing"},{default:()=>[p.isTenantAdmin?"管理员":"员工"]})}];d.userInfo.isTenant||s.push({key:"tenantName",dataIndex:"tenantName",title:"所属商户",align:"center",width:200});const u=[{key:"status",dataIndex:"status",title:"状态",align:"center",width:100,customRender:({record:p})=>{const F=W.filter(L=>L.value===p.status)[0];return e(Q,{color:F.color},{default:()=>[F.label]})}},{key:"createTime",dataIndex:"createTime",title:d.userInfo.isTenant?"添加时间":"注册时间",align:"center",width:200},{key:"operate",title:"操作",align:"center",width:100,customRender:({record:p})=>e("div",{class:"flex-center gap-4px"},[H(p),V(p)])}];return[...s,...u]}function H(s){return g.hasOne(P.Platform.TenantUser.UPDATE)?e(J,{placement:"top",title:"编辑"},{default:()=>[e($,{size:"small",type:"link",onClick:()=>v(s.id)},{default:()=>[e(Ne,null,null)]})]}):""}function V(s){return g.hasOne(P.Platform.TenantUser.DELETE)?e(ve,{title:"确认删除吗？",onConfirm:()=>M(s.id)},{default:()=>[e(J,{placement:"top",title:"删除"},{default:()=>[e($,{danger:!0,size:"small",type:"link"},{default:()=>[e(Ce,null,null)]})]})]}):""}return(s,u)=>{const p=re,F=_e,L=Re;return C(),ye("div",He,[e(Oe,{model:o(k),"onUpdate:model":u[0]||(u[0]=x=>q(k)?k.value=x:null),status:o(W),"user-info":o(d).userInfo,onReset:o(y),onSearch:u[1]||(u[1]=x=>o(h)(1))},null,8,["model","status","user-info","onReset"]),e(L,{title:"员工列表",bordered:!1,"body-style":{flex:1,overflow:"hidden"},class:"flex-col-stretch sm:flex-1-hidden card-wrapper"},{extra:l(()=>[e(p,{columns:o(b),"onUpdate:columns":u[2]||(u[2]=x=>q(b)?b.value=x:null),"disabled-delete":o(A).length===0,loading:o(T),"add-btn":o(g).hasOne(o(P).Platform.TenantUser.CREATE)&&o(d).userInfo.isTenant&&!o(d).userInfo.isTenantUser,"delete-btn":o(g).hasOne(o(P).Platform.TenantUser.DELETE),onAdd:o(c),onDelete:S},null,8,["columns","disabled-delete","loading","add-btn","delete-btn","onAdd"])]),default:l(()=>[e(F,{ref_key:"tableWrapperRef",ref:r,columns:o(i),"data-source":o(f),size:"small","row-selection":o(R),scroll:o(_),loading:o(T),"row-key":"id",pagination:o(a),class:"h-full"},null,8,["columns","data-source","row-selection","scroll","loading","pagination"]),e(Me,{visible:o(w),"onUpdate:visible":u[3]||(u[3]=x=>q(w)?w.value=x:null),"operate-type":o(U),"row-data":o(D),status:o(W),onSubmitted:o(h)},null,8,["visible","operate-type","row-data","status","onSubmitted"])]),_:1})])}}}),ct=oe(Ve,[["__scopeId","data-v-370de445"]]);export{ct as default};
